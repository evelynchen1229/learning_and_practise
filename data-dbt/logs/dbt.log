

============================== 2022-06-21 12:01:32.420978 | 4793ab9d-c146-47cd-b64b-c2a8558c3c04 ==============================
12:01:32.420982 [info ] [MainThread]: Running with dbt=1.1.0
12:01:32.421201 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'skip_profile_setup': False, 'which': 'init', 'indirect_selection': 'eager'}
12:01:32.421269 [debug] [MainThread]: Tracking: tracking
12:01:32.442080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a841c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a84190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a84760>]}
12:01:42.872973 [debug] [MainThread]: Starter project path: /Users/evelynchen/Documents/code/env/lib/python3.8/site-packages/dbt/include/starter_project
12:03:09.035816 [info ] [MainThread]: Profile amplitude_event written to /Users/evelynchen/.dbt/profiles.yml using target's profile_template.yml and your supplied values. Run 'dbt debug' to validate the connection.
12:03:09.037119 [info ] [MainThread]: 
Your new dbt project "amplitude_event" was created!

For more information on how to configure the profiles.yml file,
please consult the dbt documentation here:

  https://docs.getdbt.com/docs/configure-your-profile

One more thing:

Need help? Don't hesitate to reach out to us via GitHub issues or on Slack:

  https://community.getdbt.com/

Happy modeling!

12:03:09.037703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a84d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a84190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a84e20>]}


============================== 2022-07-11 14:59:53.583494 | 37e3b33d-b8a3-4b74-8aeb-d80d65acbf89 ==============================
14:59:53.583499 [info ] [MainThread]: Running with dbt=1.1.1
14:59:53.583838 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'skip_profile_setup': False, 'which': 'init', 'indirect_selection': 'eager'}
14:59:53.583907 [debug] [MainThread]: Tracking: tracking
14:59:53.612623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10833fc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108325b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108325940>]}
14:59:53.613340 [info ] [MainThread]: Setting up your profile.


============================== 2022-07-11 16:19:42.824460 | fbe20fbe-a980-4ae8-8ccb-9bc51bde95b4 ==============================
16:19:42.824475 [info ] [MainThread]: Running with dbt=1.1.1
16:19:42.824679 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
16:19:42.824745 [debug] [MainThread]: Tracking: tracking
16:19:42.842206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108554eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085b0e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085b0520>]}
16:19:42.855779 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
16:19:42.855965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'fbe20fbe-a980-4ae8-8ccb-9bc51bde95b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108554f40>]}
16:19:42.870123 [debug] [MainThread]: Parsing macros/json_extract_text.sql
16:19:42.870990 [debug] [MainThread]: Parsing macros/catalog.sql
16:19:42.878200 [debug] [MainThread]: Parsing macros/relations.sql
16:19:42.878452 [debug] [MainThread]: Parsing macros/adapters.sql
16:19:42.894839 [debug] [MainThread]: Parsing macros/materializations/snapshot_merge.sql
16:19:42.895131 [debug] [MainThread]: Parsing macros/catalog.sql
16:19:42.896260 [debug] [MainThread]: Parsing macros/relations.sql
16:19:42.896950 [debug] [MainThread]: Parsing macros/adapters.sql
16:19:42.908702 [debug] [MainThread]: Parsing macros/materializations/snapshot_merge.sql
16:19:42.909518 [debug] [MainThread]: Parsing macros/materializations/hooks.sql
16:19:42.911401 [debug] [MainThread]: Parsing macros/materializations/configs.sql
16:19:42.912583 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot_merge.sql
16:19:42.913377 [debug] [MainThread]: Parsing macros/materializations/snapshots/strategies.sql
16:19:42.921915 [debug] [MainThread]: Parsing macros/materializations/snapshots/helpers.sql
16:19:42.929031 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot.sql
16:19:42.935012 [debug] [MainThread]: Parsing macros/materializations/tests/test.sql
16:19:42.937262 [debug] [MainThread]: Parsing macros/materializations/tests/helpers.sql
16:19:42.938118 [debug] [MainThread]: Parsing macros/materializations/tests/where_subquery.sql
16:19:42.938975 [debug] [MainThread]: Parsing macros/materializations/models/incremental/column_helpers.sql
16:19:42.941146 [debug] [MainThread]: Parsing macros/materializations/models/incremental/merge.sql
16:19:42.950408 [debug] [MainThread]: Parsing macros/materializations/models/incremental/is_incremental.sql
16:19:42.951149 [debug] [MainThread]: Parsing macros/materializations/models/incremental/incremental.sql
16:19:42.956409 [debug] [MainThread]: Parsing macros/materializations/models/incremental/on_schema_change.sql
16:19:42.964827 [debug] [MainThread]: Parsing macros/materializations/models/table/table.sql
16:19:42.968898 [debug] [MainThread]: Parsing macros/materializations/models/table/create_table_as.sql
16:19:42.970256 [debug] [MainThread]: Parsing macros/materializations/models/view/view.sql
16:19:42.974100 [debug] [MainThread]: Parsing macros/materializations/models/view/helpers.sql
16:19:42.974707 [debug] [MainThread]: Parsing macros/materializations/models/view/create_or_replace_view.sql
16:19:42.976030 [debug] [MainThread]: Parsing macros/materializations/models/view/create_view_as.sql
16:19:42.977102 [debug] [MainThread]: Parsing macros/materializations/seeds/seed.sql
16:19:42.980264 [debug] [MainThread]: Parsing macros/materializations/seeds/helpers.sql
16:19:42.989184 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_alias.sql
16:19:42.989892 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_schema.sql
16:19:42.991068 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_database.sql
16:19:42.991810 [debug] [MainThread]: Parsing macros/generic_test_sql/relationships.sql
16:19:42.992225 [debug] [MainThread]: Parsing macros/generic_test_sql/not_null.sql
16:19:42.992599 [debug] [MainThread]: Parsing macros/generic_test_sql/unique.sql
16:19:42.992915 [debug] [MainThread]: Parsing macros/generic_test_sql/accepted_values.sql
16:19:42.993632 [debug] [MainThread]: Parsing macros/etc/statement.sql
16:19:42.995802 [debug] [MainThread]: Parsing macros/etc/datetime.sql
16:19:43.000086 [debug] [MainThread]: Parsing macros/adapters/schema.sql
16:19:43.001102 [debug] [MainThread]: Parsing macros/adapters/indexes.sql
16:19:43.002372 [debug] [MainThread]: Parsing macros/adapters/relation.sql
16:19:43.007096 [debug] [MainThread]: Parsing macros/adapters/freshness.sql
16:19:43.008477 [debug] [MainThread]: Parsing macros/adapters/persist_docs.sql
16:19:43.010595 [debug] [MainThread]: Parsing macros/adapters/metadata.sql
16:19:43.014321 [debug] [MainThread]: Parsing macros/adapters/columns.sql
16:19:43.019462 [debug] [MainThread]: Parsing tests/generic/builtin.sql
16:19:43.114321 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_device.sql
16:19:43.121126 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_device.sql
16:19:43.121783 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
16:19:43.124937 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
16:19:43.125387 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_profile.sql
16:19:43.126654 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_profile.sql
16:19:43.127300 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_workouts.sql
16:19:43.130752 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_workouts.sql
16:19:43.169652 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

16:19:43.172295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fbe20fbe-a980-4ae8-8ccb-9bc51bde95b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10869d970>]}
16:19:43.175663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fbe20fbe-a980-4ae8-8ccb-9bc51bde95b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108733610>]}
16:19:43.175798 [info ] [MainThread]: Found 4 models, 8 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
16:19:43.175917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fbe20fbe-a980-4ae8-8ccb-9bc51bde95b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10869d850>]}
16:19:43.176658 [info ] [MainThread]: 
16:19:43.176862 [debug] [MainThread]: Acquiring new redshift connection "master"
16:19:43.177263 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
16:19:43.182400 [debug] [ThreadPool]: Using redshift connection "list_dev"
16:19:43.182482 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
16:19:43.182545 [debug] [ThreadPool]: Opening a new connection, currently in state init
16:19:43.182610 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:19:44.198000 [debug] [ThreadPool]: SQL status: SELECT in 1.02 seconds
16:19:44.205104 [debug] [ThreadPool]: On list_dev: Close
16:19:44.209270 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
16:19:44.223823 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
16:19:44.224206 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
16:19:44.224385 [debug] [ThreadPool]: Opening a new connection, currently in state closed
16:19:44.224582 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:19:45.154827 [debug] [ThreadPool]: SQL status: BEGIN in 0.93 seconds
16:19:45.156271 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
16:19:45.156672 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
16:19:45.270450 [debug] [ThreadPool]: SQL status: SELECT in 0.11 seconds
16:19:45.275532 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
16:19:45.371365 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
16:19:45.384582 [debug] [MainThread]: Using redshift connection "master"
16:19:45.385196 [debug] [MainThread]: On master: BEGIN
16:19:45.385461 [debug] [MainThread]: Opening a new connection, currently in state init
16:19:45.385787 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:19:46.311339 [debug] [MainThread]: SQL status: BEGIN in 0.93 seconds
16:19:46.312501 [debug] [MainThread]: Using redshift connection "master"
16:19:46.312895 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
16:19:46.492742 [debug] [MainThread]: SQL status: SELECT in 0.18 seconds
16:19:46.500619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fbe20fbe-a980-4ae8-8ccb-9bc51bde95b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085a63d0>]}
16:19:46.503215 [debug] [MainThread]: On master: ROLLBACK
16:19:46.595420 [debug] [MainThread]: Using redshift connection "master"
16:19:46.597657 [debug] [MainThread]: On master: BEGIN
16:19:46.805070 [debug] [MainThread]: SQL status: BEGIN in 0.19 seconds
16:19:46.806196 [debug] [MainThread]: On master: COMMIT
16:19:46.806628 [debug] [MainThread]: Using redshift connection "master"
16:19:46.806983 [debug] [MainThread]: On master: COMMIT
16:19:46.903370 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
16:19:46.904387 [debug] [MainThread]: On master: Close
16:19:46.906343 [info ] [MainThread]: Concurrency: 1 threads (target='test')
16:19:46.907177 [info ] [MainThread]: 
16:19:46.927360 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
16:19:46.928513 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
16:19:46.930058 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
16:19:46.930383 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
16:19:46.930634 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
16:19:46.935283 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
16:19:46.936427 [debug] [Thread-1  ]: finished collecting timing info
16:19:46.936610 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
16:19:46.963405 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
16:19:46.964330 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
16:19:46.964472 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
16:19:46.964582 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
16:19:46.964711 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:19:47.846936 [debug] [Thread-1  ]: SQL status: BEGIN in 0.88 seconds
16:19:47.848604 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
16:19:47.849052 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
  ) ;

16:19:47.951189 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
16:19:47.970414 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
16:19:47.970930 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
16:19:48.064306 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
16:19:48.084266 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
16:19:48.084801 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
16:19:48.085004 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
16:19:48.232655 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
16:19:48.234502 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
16:19:48.234837 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
16:19:48.340605 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
16:19:48.354542 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
16:19:48.354943 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
16:19:48.467234 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
16:19:48.469459 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
16:19:48.469848 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
16:19:48.470033 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
16:19:48.593638 [debug] [Thread-1  ]: SQL status: COMMIT in 0.12 seconds
16:19:48.594898 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
16:19:48.595206 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
16:19:48.699867 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
16:19:48.702489 [debug] [Thread-1  ]: finished collecting timing info
16:19:48.703197 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
16:19:48.803357 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
16:19:48.806098 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fbe20fbe-a980-4ae8-8ccb-9bc51bde95b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108826c10>]}
16:19:48.807623 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 1.88s]
16:19:48.809551 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
16:19:48.813889 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
16:19:48.814514 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
16:19:48.815252 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
16:19:48.815460 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
16:19:48.815681 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
16:19:48.831346 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
16:19:48.833576 [debug] [Thread-1  ]: finished collecting timing info
16:19:48.833905 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
16:19:48.836830 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
16:19:48.837601 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
16:19:48.837768 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
16:19:48.837909 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
16:19:48.838069 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:19:49.759699 [debug] [Thread-1  ]: SQL status: BEGIN in 0.92 seconds
16:19:49.760904 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
16:19:49.761298 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    WITH events AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))
 
        AS device_type
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
)

SELECT *
FROM events
  ) ;

16:19:49.881582 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
16:19:49.891082 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
16:19:49.892280 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
16:19:49.988649 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
16:19:49.996870 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
16:19:49.997632 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
16:19:50.093481 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
16:19:50.099079 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
16:19:50.099640 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
16:19:50.100001 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
16:19:50.292507 [debug] [Thread-1  ]: SQL status: COMMIT in 0.19 seconds
16:19:50.293809 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
16:19:50.294171 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
16:19:50.401861 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
16:19:50.413116 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
16:19:50.413909 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
16:19:50.511766 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
16:19:50.514080 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
16:19:50.514310 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
16:19:50.514537 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
16:19:50.645307 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
16:19:50.646623 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
16:19:50.647016 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
16:19:50.742246 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
16:19:50.744655 [debug] [Thread-1  ]: finished collecting timing info
16:19:50.745173 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
16:19:50.837087 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
16:19:50.840502 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fbe20fbe-a980-4ae8-8ccb-9bc51bde95b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108592dc0>]}
16:19:50.842306 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.03s]
16:19:50.848319 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
16:19:50.848939 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
16:19:50.849503 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
16:19:50.850220 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
16:19:50.850454 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
16:19:50.850707 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
16:19:50.859143 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
16:19:50.861048 [debug] [Thread-1  ]: finished collecting timing info
16:19:50.861305 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
16:19:50.866201 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
16:19:50.867929 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
16:19:50.868127 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
16:19:50.868241 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
16:19:50.868372 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:19:51.776482 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
16:19:51.777738 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
16:19:51.778131 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

16:19:51.880457 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
16:19:51.889461 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
16:19:51.889945 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
16:19:51.982744 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
16:19:51.986914 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
16:19:51.987559 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
16:19:51.987961 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
16:19:52.122264 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
16:19:52.124297 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
16:19:52.124678 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
16:19:52.226488 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
16:19:52.232706 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
16:19:52.233202 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
16:19:52.340221 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
16:19:52.343786 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
16:19:52.344354 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
16:19:52.344703 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
16:19:52.484687 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
16:19:52.485670 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
16:19:52.485877 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
16:19:52.582046 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
16:19:52.585622 [debug] [Thread-1  ]: finished collecting timing info
16:19:52.586300 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
16:19:52.685812 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
16:19:52.688148 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fbe20fbe-a980-4ae8-8ccb-9bc51bde95b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108569eb0>]}
16:19:52.689502 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.84s]
16:19:52.690858 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
16:19:52.695668 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
16:19:52.696244 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
16:19:52.696942 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
16:19:52.697155 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
16:19:52.697391 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
16:19:52.715646 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
16:19:52.717686 [debug] [Thread-1  ]: finished collecting timing info
16:19:52.717927 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
16:19:52.721482 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
16:19:52.722425 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
16:19:52.722636 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
16:19:52.722781 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
16:19:52.722929 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:19:53.661592 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
16:19:53.663173 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
16:19:53.663615 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

16:19:53.777472 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
16:19:53.787327 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
16:19:53.787879 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
16:19:53.883248 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
16:19:53.890641 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
16:19:53.891230 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
16:19:53.988106 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
16:19:53.993220 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
16:19:53.993876 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
16:19:53.994288 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
16:19:54.126363 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
16:19:54.128507 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
16:19:54.129098 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
16:19:54.228915 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
16:19:54.235404 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
16:19:54.235950 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
16:19:54.333839 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
16:19:54.337272 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
16:19:54.337659 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
16:19:54.338088 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
16:19:54.470501 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
16:19:54.471857 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
16:19:54.472262 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
16:19:54.565857 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
16:19:54.569647 [debug] [Thread-1  ]: finished collecting timing info
16:19:54.570316 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
16:19:54.665121 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
16:19:54.667665 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fbe20fbe-a980-4ae8-8ccb-9bc51bde95b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086960a0>]}
16:19:54.669065 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 1.97s]
16:19:54.670488 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
16:19:54.678757 [debug] [MainThread]: Acquiring new redshift connection "master"
16:19:54.679361 [debug] [MainThread]: Using redshift connection "master"
16:19:54.679545 [debug] [MainThread]: On master: BEGIN
16:19:54.679712 [debug] [MainThread]: Opening a new connection, currently in state closed
16:19:54.679928 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:19:55.594795 [debug] [MainThread]: SQL status: BEGIN in 0.91 seconds
16:19:55.596090 [debug] [MainThread]: On master: COMMIT
16:19:55.596477 [debug] [MainThread]: Using redshift connection "master"
16:19:55.596906 [debug] [MainThread]: On master: COMMIT
16:19:55.689002 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
16:19:55.690202 [debug] [MainThread]: On master: Close
16:19:55.692332 [info ] [MainThread]: 
16:19:55.693189 [info ] [MainThread]: Finished running 4 view models in 12.52s.
16:19:55.699084 [debug] [MainThread]: Connection 'master' was properly closed.
16:19:55.699592 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
16:19:55.716756 [info ] [MainThread]: 
16:19:55.717547 [info ] [MainThread]: [32mCompleted successfully[0m
16:19:55.718037 [info ] [MainThread]: 
16:19:55.718497 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
16:19:55.719167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087ef130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086b63d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085bb9d0>]}


============================== 2022-07-11 17:10:46.310828 | aa09196c-8ef9-4448-8439-50f4a2fc13f4 ==============================
17:10:46.310843 [info ] [MainThread]: Running with dbt=1.1.1
17:10:46.311260 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
17:10:46.311330 [debug] [MainThread]: Tracking: tracking
17:10:46.327693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e3a0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e3a6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e3a490>]}
17:10:46.351800 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
17:10:46.352027 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_device.sql
17:10:46.357630 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_device.sql
17:10:46.364624 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_device.sql
17:10:46.376767 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

17:10:46.379269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aa09196c-8ef9-4448-8439-50f4a2fc13f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f31940>]}
17:10:46.382237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aa09196c-8ef9-4448-8439-50f4a2fc13f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e68910>]}
17:10:46.382367 [info ] [MainThread]: Found 4 models, 8 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
17:10:46.382488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aa09196c-8ef9-4448-8439-50f4a2fc13f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e68820>]}
17:10:46.383230 [info ] [MainThread]: 
17:10:46.383434 [debug] [MainThread]: Acquiring new redshift connection "master"
17:10:46.383858 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
17:10:46.389036 [debug] [ThreadPool]: Using redshift connection "list_dev"
17:10:46.389131 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
17:10:46.389197 [debug] [ThreadPool]: Opening a new connection, currently in state init
17:10:46.389266 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:10:47.422432 [debug] [ThreadPool]: SQL status: SELECT in 1.03 seconds
17:10:47.429754 [debug] [ThreadPool]: On list_dev: Close
17:10:47.434973 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
17:10:47.450236 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
17:10:47.450598 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
17:10:47.450781 [debug] [ThreadPool]: Opening a new connection, currently in state closed
17:10:47.450980 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:10:48.375775 [debug] [ThreadPool]: SQL status: BEGIN in 0.92 seconds
17:10:48.376936 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
17:10:48.377319 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
17:10:48.533826 [debug] [ThreadPool]: SQL status: SELECT in 0.16 seconds
17:10:48.541534 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
17:10:48.648182 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
17:10:48.664488 [debug] [MainThread]: Using redshift connection "master"
17:10:48.665051 [debug] [MainThread]: On master: BEGIN
17:10:48.665313 [debug] [MainThread]: Opening a new connection, currently in state init
17:10:48.665628 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:10:49.585949 [debug] [MainThread]: SQL status: BEGIN in 0.92 seconds
17:10:49.587047 [debug] [MainThread]: Using redshift connection "master"
17:10:49.587359 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
17:10:49.861949 [debug] [MainThread]: SQL status: SELECT in 0.27 seconds
17:10:49.869450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aa09196c-8ef9-4448-8439-50f4a2fc13f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080196d0>]}
17:10:49.870739 [debug] [MainThread]: On master: ROLLBACK
17:10:49.963601 [debug] [MainThread]: Using redshift connection "master"
17:10:49.964474 [debug] [MainThread]: On master: BEGIN
17:10:50.177299 [debug] [MainThread]: SQL status: BEGIN in 0.21 seconds
17:10:50.178765 [debug] [MainThread]: On master: COMMIT
17:10:50.179173 [debug] [MainThread]: Using redshift connection "master"
17:10:50.179541 [debug] [MainThread]: On master: COMMIT
17:10:50.273943 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
17:10:50.290703 [debug] [MainThread]: On master: Close
17:10:50.312082 [info ] [MainThread]: Concurrency: 1 threads (target='test')
17:10:50.335625 [info ] [MainThread]: 
17:10:50.363408 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
17:10:50.364730 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
17:10:50.366236 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
17:10:50.366661 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
17:10:50.367022 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
17:10:50.375852 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
17:10:50.378422 [debug] [Thread-1  ]: finished collecting timing info
17:10:50.379126 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
17:10:50.408587 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
17:10:50.409491 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:10:50.409619 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
17:10:50.409726 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
17:10:50.409853 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:10:51.308969 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
17:10:51.310151 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:10:51.310608 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

17:10:51.410802 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
17:10:51.430146 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:10:51.430475 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
17:10:51.528085 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
17:10:51.533456 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:10:51.533865 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
17:10:51.629267 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:10:51.652894 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
17:10:51.653396 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:10:51.653576 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
17:10:51.799713 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
17:10:51.801141 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:10:51.801531 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
17:10:51.916882 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
17:10:51.933075 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:10:51.933822 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
17:10:52.030563 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
17:10:52.035020 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
17:10:52.035384 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:10:52.035613 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
17:10:52.163730 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:10:52.165001 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:10:52.165391 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
17:10:52.259496 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
17:10:52.262487 [debug] [Thread-1  ]: finished collecting timing info
17:10:52.263145 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
17:10:52.355871 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
17:10:52.358321 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa09196c-8ef9-4448-8439-50f4a2fc13f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108028fd0>]}
17:10:52.359628 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 1.99s]
17:10:52.365217 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
17:10:52.365954 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
17:10:52.366497 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
17:10:52.367486 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
17:10:52.368198 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
17:10:52.368425 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
17:10:52.384631 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
17:10:52.385793 [debug] [Thread-1  ]: finished collecting timing info
17:10:52.386100 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
17:10:52.389881 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
17:10:52.390535 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:10:52.390741 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
17:10:52.390971 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
17:10:52.391229 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:10:53.302685 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
17:10:53.303877 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:10:53.304276 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    WITH events AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))
 
        AS device_type
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
)

SELECT *
FROM events
  ) ;

17:10:53.414646 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
17:10:53.424541 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:10:53.425161 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
17:10:53.519980 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:10:53.525666 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:10:53.526293 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
17:10:53.624755 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
17:10:53.628364 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
17:10:53.628669 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:10:53.628842 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
17:10:53.762100 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:10:53.764078 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:10:53.764595 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
17:10:53.857726 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
17:10:53.864339 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:10:53.865235 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
17:10:53.962422 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
17:10:53.965814 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
17:10:53.966234 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:10:53.966588 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
17:10:54.094096 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:10:54.095380 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:10:54.095771 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
17:10:54.191481 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
17:10:54.194134 [debug] [Thread-1  ]: finished collecting timing info
17:10:54.194658 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
17:10:54.287562 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
17:10:54.290318 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa09196c-8ef9-4448-8439-50f4a2fc13f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108028fd0>]}
17:10:54.291708 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 1.92s]
17:10:54.293134 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
17:10:54.298519 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
17:10:54.299161 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
17:10:54.299955 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
17:10:54.300168 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
17:10:54.300383 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
17:10:54.307526 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
17:10:54.309430 [debug] [Thread-1  ]: finished collecting timing info
17:10:54.309710 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
17:10:54.314935 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
17:10:54.316598 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:10:54.316819 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
17:10:54.317016 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
17:10:54.317237 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:10:55.249241 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
17:10:55.250442 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:10:55.250838 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

17:10:55.356539 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
17:10:55.366165 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:10:55.366856 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
17:10:55.478451 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.11 seconds
17:10:55.489728 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:10:55.490447 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
17:10:55.587971 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
17:10:55.591675 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
17:10:55.591944 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:10:55.592116 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
17:10:55.724678 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:10:55.725668 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:10:55.726020 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
17:10:55.822354 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
17:10:55.828344 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:10:55.828792 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
17:10:55.925553 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
17:10:55.929030 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
17:10:55.930016 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:10:55.930368 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
17:10:56.115302 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
17:10:56.116543 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:10:56.116857 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
17:10:56.221825 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
17:10:56.224268 [debug] [Thread-1  ]: finished collecting timing info
17:10:56.224768 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
17:10:56.318823 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
17:10:56.321125 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa09196c-8ef9-4448-8439-50f4a2fc13f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10810c790>]}
17:10:56.322527 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.02s]
17:10:56.323914 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
17:10:56.328816 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
17:10:56.329650 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
17:10:56.330374 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
17:10:56.330591 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
17:10:56.330824 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
17:10:56.346668 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
17:10:56.347741 [debug] [Thread-1  ]: finished collecting timing info
17:10:56.347961 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
17:10:56.350859 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
17:10:56.351539 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:10:56.351726 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
17:10:56.351894 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
17:10:56.352077 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:10:57.256674 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
17:10:57.258001 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:10:57.258523 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

17:10:57.368111 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
17:10:57.378720 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:10:57.379643 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
17:10:57.474403 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:10:57.482007 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:10:57.482696 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
17:10:57.577348 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:10:57.581755 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
17:10:57.582255 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:10:57.582504 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
17:10:57.734619 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
17:10:57.736512 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:10:57.736895 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
17:10:57.850997 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
17:10:57.857650 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:10:57.858309 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
17:10:57.955653 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
17:10:57.958919 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
17:10:57.959332 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:10:57.959774 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
17:10:58.080936 [debug] [Thread-1  ]: SQL status: COMMIT in 0.12 seconds
17:10:58.081891 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:10:58.082415 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
17:10:58.177813 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
17:10:58.179979 [debug] [Thread-1  ]: finished collecting timing info
17:10:58.180443 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
17:10:58.275153 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
17:10:58.277546 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aa09196c-8ef9-4448-8439-50f4a2fc13f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108028be0>]}
17:10:58.279310 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 1.95s]
17:10:58.280943 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
17:10:58.288483 [debug] [MainThread]: Acquiring new redshift connection "master"
17:10:58.288938 [debug] [MainThread]: Using redshift connection "master"
17:10:58.289120 [debug] [MainThread]: On master: BEGIN
17:10:58.289286 [debug] [MainThread]: Opening a new connection, currently in state closed
17:10:58.289507 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:10:59.204374 [debug] [MainThread]: SQL status: BEGIN in 0.91 seconds
17:10:59.205705 [debug] [MainThread]: On master: COMMIT
17:10:59.206108 [debug] [MainThread]: Using redshift connection "master"
17:10:59.206493 [debug] [MainThread]: On master: COMMIT
17:10:59.298675 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
17:10:59.299784 [debug] [MainThread]: On master: Close
17:10:59.301938 [info ] [MainThread]: 
17:10:59.302906 [info ] [MainThread]: Finished running 4 view models in 12.92s.
17:10:59.307327 [debug] [MainThread]: Connection 'master' was properly closed.
17:10:59.307862 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
17:10:59.322498 [info ] [MainThread]: 
17:10:59.322994 [info ] [MainThread]: [32mCompleted successfully[0m
17:10:59.323392 [info ] [MainThread]: 
17:10:59.323700 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
17:10:59.324274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ff7b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e687c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f1c2b0>]}


============================== 2022-07-11 17:45:55.284724 | dc63a765-bdb1-4eb0-ae0d-35651a3c5056 ==============================
17:45:55.284739 [info ] [MainThread]: Running with dbt=1.1.1
17:45:55.284933 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
17:45:55.284996 [debug] [MainThread]: Tracking: tracking
17:45:55.303508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c5ef10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c92ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c92580>]}
17:45:55.327388 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
17:45:55.327619 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
17:45:55.333323 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
17:45:55.341823 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
17:45:55.353385 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

17:45:55.355951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dc63a765-bdb1-4eb0-ae0d-35651a3c5056', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d86970>]}
17:45:55.359376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dc63a765-bdb1-4eb0-ae0d-35651a3c5056', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c5efd0>]}
17:45:55.359514 [info ] [MainThread]: Found 4 models, 8 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
17:45:55.359636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc63a765-bdb1-4eb0-ae0d-35651a3c5056', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c9c700>]}
17:45:55.360361 [info ] [MainThread]: 
17:45:55.360564 [debug] [MainThread]: Acquiring new redshift connection "master"
17:45:55.360967 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
17:45:55.365945 [debug] [ThreadPool]: Using redshift connection "list_dev"
17:45:55.366039 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
17:45:55.366105 [debug] [ThreadPool]: Opening a new connection, currently in state init
17:45:55.366169 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:45:56.392210 [debug] [ThreadPool]: SQL status: SELECT in 1.03 seconds
17:45:56.399782 [debug] [ThreadPool]: On list_dev: Close
17:45:56.405092 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
17:45:56.420063 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
17:45:56.420432 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
17:45:56.420620 [debug] [ThreadPool]: Opening a new connection, currently in state closed
17:45:56.420833 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:45:57.334621 [debug] [ThreadPool]: SQL status: BEGIN in 0.91 seconds
17:45:57.335639 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
17:45:57.335857 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
17:45:57.450013 [debug] [ThreadPool]: SQL status: SELECT in 0.11 seconds
17:45:57.455143 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
17:45:57.549926 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
17:45:57.562877 [debug] [MainThread]: Using redshift connection "master"
17:45:57.563706 [debug] [MainThread]: On master: BEGIN
17:45:57.563901 [debug] [MainThread]: Opening a new connection, currently in state init
17:45:57.564928 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:45:58.494150 [debug] [MainThread]: SQL status: BEGIN in 0.93 seconds
17:45:58.495308 [debug] [MainThread]: Using redshift connection "master"
17:45:58.495712 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
17:45:58.669124 [debug] [MainThread]: SQL status: SELECT in 0.17 seconds
17:45:58.676899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc63a765-bdb1-4eb0-ae0d-35651a3c5056', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d28f40>]}
17:45:58.678320 [debug] [MainThread]: On master: ROLLBACK
17:45:58.771436 [debug] [MainThread]: Using redshift connection "master"
17:45:58.772199 [debug] [MainThread]: On master: BEGIN
17:45:58.961729 [debug] [MainThread]: SQL status: BEGIN in 0.19 seconds
17:45:58.962940 [debug] [MainThread]: On master: COMMIT
17:45:58.963377 [debug] [MainThread]: Using redshift connection "master"
17:45:58.963757 [debug] [MainThread]: On master: COMMIT
17:45:59.057220 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
17:45:59.058464 [debug] [MainThread]: On master: Close
17:45:59.060226 [info ] [MainThread]: Concurrency: 1 threads (target='test')
17:45:59.061133 [info ] [MainThread]: 
17:45:59.071660 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
17:45:59.072549 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
17:45:59.073462 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
17:45:59.073728 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
17:45:59.074041 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
17:45:59.080741 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
17:45:59.082907 [debug] [Thread-1  ]: finished collecting timing info
17:45:59.083122 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
17:45:59.109574 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
17:45:59.110834 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:45:59.110988 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
17:45:59.111104 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
17:45:59.111232 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:46:00.034020 [debug] [Thread-1  ]: SQL status: BEGIN in 0.92 seconds
17:46:00.035000 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:46:00.035208 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

17:46:00.141986 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
17:46:00.161800 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:46:00.162404 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
17:46:00.256824 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:46:00.265097 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:46:00.265873 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
17:46:00.360159 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:46:00.379195 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
17:46:00.380657 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:46:00.380873 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
17:46:00.516896 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
17:46:00.520324 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:46:00.520898 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
17:46:00.641291 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
17:46:00.657353 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:46:00.658159 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
17:46:00.756420 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
17:46:00.760324 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
17:46:00.760973 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:46:00.761791 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
17:46:00.889657 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:46:00.891016 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:46:00.891465 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
17:46:00.988943 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
17:46:00.991760 [debug] [Thread-1  ]: finished collecting timing info
17:46:00.992321 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
17:46:01.088386 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
17:46:01.092198 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc63a765-bdb1-4eb0-ae0d-35651a3c5056', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e7fe50>]}
17:46:01.093920 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.02s]
17:46:01.095450 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
17:46:01.100298 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
17:46:01.100965 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
17:46:01.101724 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
17:46:01.101951 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
17:46:01.102207 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
17:46:01.122561 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
17:46:01.123933 [debug] [Thread-1  ]: finished collecting timing info
17:46:01.124225 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
17:46:01.127838 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
17:46:01.128478 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:46:01.128677 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
17:46:01.128844 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
17:46:01.129037 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:46:02.052034 [debug] [Thread-1  ]: SQL status: BEGIN in 0.92 seconds
17:46:02.053102 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:46:02.053330 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    WITH events AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
)

SELECT *
FROM events
  ) ;

17:46:02.170791 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
17:46:02.180520 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:46:02.181409 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
17:46:02.275856 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:46:02.282622 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:46:02.283861 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
17:46:02.378920 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:46:02.382617 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
17:46:02.383067 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:46:02.383511 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
17:46:02.520116 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
17:46:02.522664 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:46:02.523016 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
17:46:02.620601 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
17:46:02.627913 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:46:02.628502 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
17:46:02.726585 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
17:46:02.729934 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
17:46:02.730404 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:46:02.730771 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
17:46:02.863142 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:46:02.863929 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:46:02.864298 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
17:46:02.962205 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
17:46:02.964640 [debug] [Thread-1  ]: finished collecting timing info
17:46:02.965154 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
17:46:03.059641 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
17:46:03.063196 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc63a765-bdb1-4eb0-ae0d-35651a3c5056', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e21f70>]}
17:46:03.064584 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 1.96s]
17:46:03.065669 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
17:46:03.066091 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
17:46:03.066890 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
17:46:03.068112 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
17:46:03.068359 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
17:46:03.068585 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
17:46:03.075919 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
17:46:03.078107 [debug] [Thread-1  ]: finished collecting timing info
17:46:03.078405 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
17:46:03.083747 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
17:46:03.085765 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:46:03.086231 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
17:46:03.086455 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
17:46:03.086662 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:46:04.011785 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
17:46:04.013161 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:46:04.013578 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

17:46:04.116082 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
17:46:04.126097 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:46:04.126667 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
17:46:04.219861 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:46:04.230127 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:46:04.230722 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
17:46:04.324084 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:46:04.328002 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
17:46:04.328574 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:46:04.328934 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
17:46:04.457222 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:46:04.458508 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:46:04.459053 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
17:46:04.554726 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
17:46:04.562319 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:46:04.563015 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
17:46:04.658426 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
17:46:04.661501 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
17:46:04.661901 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:46:04.662257 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
17:46:04.789850 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:46:04.790645 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:46:04.791022 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
17:46:04.896645 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
17:46:04.898185 [debug] [Thread-1  ]: finished collecting timing info
17:46:04.898473 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
17:46:04.997912 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
17:46:05.000727 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc63a765-bdb1-4eb0-ae0d-35651a3c5056', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070619a0>]}
17:46:05.001890 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.93s]
17:46:05.002793 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
17:46:05.007776 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
17:46:05.008789 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
17:46:05.009711 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
17:46:05.009945 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
17:46:05.010165 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
17:46:05.024612 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
17:46:05.026491 [debug] [Thread-1  ]: finished collecting timing info
17:46:05.026756 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
17:46:05.029853 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
17:46:05.030807 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:46:05.031016 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
17:46:05.031184 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
17:46:05.031370 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:46:05.935705 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
17:46:05.937240 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:46:05.937716 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

17:46:06.049977 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
17:46:06.060160 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:46:06.060982 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
17:46:06.154853 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:46:06.161882 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:46:06.162501 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
17:46:06.257777 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:46:06.262029 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
17:46:06.262587 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:46:06.262861 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
17:46:06.392515 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:46:06.393867 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:46:06.394139 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
17:46:06.489677 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
17:46:06.496275 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:46:06.496964 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
17:46:06.594112 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
17:46:06.598069 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
17:46:06.598492 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:46:06.598875 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
17:46:06.731323 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:46:06.732324 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:46:06.732725 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
17:46:06.831799 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
17:46:06.834234 [debug] [Thread-1  ]: finished collecting timing info
17:46:06.834759 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
17:46:06.935096 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
17:46:06.937744 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc63a765-bdb1-4eb0-ae0d-35651a3c5056', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e7e460>]}
17:46:06.939857 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 1.93s]
17:46:06.941563 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
17:46:06.948414 [debug] [MainThread]: Acquiring new redshift connection "master"
17:46:06.948978 [debug] [MainThread]: Using redshift connection "master"
17:46:06.949163 [debug] [MainThread]: On master: BEGIN
17:46:06.949345 [debug] [MainThread]: Opening a new connection, currently in state closed
17:46:06.949569 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:46:07.864171 [debug] [MainThread]: SQL status: BEGIN in 0.91 seconds
17:46:07.865442 [debug] [MainThread]: On master: COMMIT
17:46:07.865991 [debug] [MainThread]: Using redshift connection "master"
17:46:07.866447 [debug] [MainThread]: On master: COMMIT
17:46:07.959038 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
17:46:07.959880 [debug] [MainThread]: On master: Close
17:46:07.962154 [info ] [MainThread]: 
17:46:07.963150 [info ] [MainThread]: Finished running 4 view models in 12.60s.
17:46:07.968656 [debug] [MainThread]: Connection 'master' was properly closed.
17:46:07.969365 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
17:46:07.986874 [info ] [MainThread]: 
17:46:07.987721 [info ] [MainThread]: [32mCompleted successfully[0m
17:46:07.988131 [info ] [MainThread]: 
17:46:07.988604 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
17:46:07.988901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d74220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d741f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e65dc0>]}


============================== 2022-07-11 17:58:49.914694 | 6cf46a02-013c-482e-bdf3-2a8cda253da1 ==============================
17:58:49.914713 [info ] [MainThread]: Running with dbt=1.1.1
17:58:49.915114 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['amplitude_event.sql'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
17:58:49.915185 [debug] [MainThread]: Tracking: tracking
17:58:49.932606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10750b370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10750bf70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10750b970>]}
17:58:49.957684 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
17:58:49.958050 [debug] [MainThread]: Partial parsing: update schema file: amplitude_event://models/amplitude/schema.yml
17:58:49.963616 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_device.sql
17:58:49.970641 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_device.sql
17:58:49.971331 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
17:58:49.974862 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
17:58:49.976071 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_workouts.sql
17:58:49.979491 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_workouts.sql
17:58:49.986093 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

17:58:49.988677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6cf46a02-013c-482e-bdf3-2a8cda253da1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10761ebb0>]}
17:58:49.991534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6cf46a02-013c-482e-bdf3-2a8cda253da1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075197f0>]}
17:58:49.991673 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
17:58:49.991800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6cf46a02-013c-482e-bdf3-2a8cda253da1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107609730>]}
17:58:49.992017 [warn ] [MainThread]: The selection criterion 'amplitude_event.sql' does not match any nodes
17:58:49.992433 [info ] [MainThread]: 
17:58:49.992548 [warn ] [MainThread]: [[33mWARNING[0m]: Nothing to do. Try checking your model configs and model specification args
17:58:49.995152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107696fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107519a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107519d90>]}


============================== 2022-07-11 17:59:00.557582 | 2607beaf-d4ef-473f-a72c-37363afacbfc ==============================
17:59:00.557601 [info ] [MainThread]: Running with dbt=1.1.1
17:59:00.557817 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['amplitude_event'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
17:59:00.557891 [debug] [MainThread]: Tracking: tracking
17:59:00.572980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10494c430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10494c820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10499a0a0>]}
17:59:00.593583 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
17:59:00.593709 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
17:59:00.593926 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

17:59:00.596900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2607beaf-d4ef-473f-a72c-37363afacbfc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b91d60>]}
17:59:00.599760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2607beaf-d4ef-473f-a72c-37363afacbfc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b28850>]}
17:59:00.599892 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
17:59:00.600011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2607beaf-d4ef-473f-a72c-37363afacbfc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b284f0>]}
17:59:00.600663 [info ] [MainThread]: 
17:59:00.600869 [debug] [MainThread]: Acquiring new redshift connection "master"
17:59:00.601323 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
17:59:00.606450 [debug] [ThreadPool]: Using redshift connection "list_dev"
17:59:00.606539 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
17:59:00.606603 [debug] [ThreadPool]: Opening a new connection, currently in state init
17:59:00.606669 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:59:01.669795 [debug] [ThreadPool]: SQL status: SELECT in 1.06 seconds
17:59:01.676644 [debug] [ThreadPool]: On list_dev: Close
17:59:01.680876 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
17:59:01.695493 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
17:59:01.695889 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
17:59:01.696081 [debug] [ThreadPool]: Opening a new connection, currently in state closed
17:59:01.696290 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:59:02.587749 [debug] [ThreadPool]: SQL status: BEGIN in 0.89 seconds
17:59:02.588922 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
17:59:02.589220 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
17:59:02.701885 [debug] [ThreadPool]: SQL status: SELECT in 0.11 seconds
17:59:02.707009 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
17:59:02.801421 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
17:59:02.816918 [debug] [MainThread]: Using redshift connection "master"
17:59:02.817530 [debug] [MainThread]: On master: BEGIN
17:59:02.817747 [debug] [MainThread]: Opening a new connection, currently in state init
17:59:02.818013 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:59:03.720383 [debug] [MainThread]: SQL status: BEGIN in 0.9 seconds
17:59:03.721330 [debug] [MainThread]: Using redshift connection "master"
17:59:03.721540 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
17:59:03.885428 [debug] [MainThread]: SQL status: SELECT in 0.16 seconds
17:59:03.893029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2607beaf-d4ef-473f-a72c-37363afacbfc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bfbee0>]}
17:59:03.894462 [debug] [MainThread]: On master: ROLLBACK
17:59:03.987685 [debug] [MainThread]: Using redshift connection "master"
17:59:03.988573 [debug] [MainThread]: On master: BEGIN
17:59:04.181152 [debug] [MainThread]: SQL status: BEGIN in 0.19 seconds
17:59:04.182469 [debug] [MainThread]: On master: COMMIT
17:59:04.182922 [debug] [MainThread]: Using redshift connection "master"
17:59:04.183307 [debug] [MainThread]: On master: COMMIT
17:59:04.278061 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
17:59:04.278993 [debug] [MainThread]: On master: Close
17:59:04.281140 [info ] [MainThread]: Concurrency: 1 threads (target='test')
17:59:04.282039 [info ] [MainThread]: 
17:59:04.297924 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
17:59:04.298888 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
17:59:04.299880 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
17:59:04.300150 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
17:59:04.300462 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
17:59:04.309226 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
17:59:04.310957 [debug] [Thread-1  ]: finished collecting timing info
17:59:04.311230 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
17:59:04.336618 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
17:59:04.337378 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:59:04.337490 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
17:59:04.337586 [debug] [Thread-1  ]: Opening a new connection, currently in state init
17:59:04.339687 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:59:05.255743 [debug] [Thread-1  ]: SQL status: BEGIN in 0.92 seconds
17:59:05.257064 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:59:05.257472 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

17:59:05.366140 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
17:59:05.386940 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:59:05.387478 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
17:59:05.480234 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:59:05.487718 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:59:05.488358 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
17:59:05.581374 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:59:05.600767 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
17:59:05.601342 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:59:05.601551 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
17:59:05.730150 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:59:05.732426 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:59:05.732845 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
17:59:05.830395 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
17:59:05.846719 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:59:05.847287 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
17:59:05.942163 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.09 seconds
17:59:05.945242 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
17:59:05.945653 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:59:05.946038 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
17:59:06.122959 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
17:59:06.124296 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
17:59:06.124685 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
17:59:06.237107 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
17:59:06.239587 [debug] [Thread-1  ]: finished collecting timing info
17:59:06.240116 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
17:59:06.343398 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
17:59:06.346612 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2607beaf-d4ef-473f-a72c-37363afacbfc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c61550>]}
17:59:06.348121 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.05s]
17:59:06.349568 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
17:59:06.354633 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
17:59:06.355294 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
17:59:06.356124 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
17:59:06.356487 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
17:59:06.356718 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
17:59:06.371471 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
17:59:06.373927 [debug] [Thread-1  ]: finished collecting timing info
17:59:06.374192 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
17:59:06.378845 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
17:59:06.379744 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:59:06.379887 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
17:59:06.380008 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
17:59:06.380140 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:59:07.297980 [debug] [Thread-1  ]: SQL status: BEGIN in 0.92 seconds
17:59:07.299156 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:59:07.299601 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    WITH events AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
)

SELECT *
FROM events
  ) ;

17:59:07.411676 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
17:59:07.421969 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:59:07.422617 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
17:59:07.520640 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
17:59:07.528495 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:59:07.529026 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
17:59:07.623525 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:59:07.628335 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
17:59:07.628836 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:59:07.629060 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
17:59:07.777044 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
17:59:07.778255 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:59:07.778622 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
17:59:07.894506 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
17:59:07.898760 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:59:07.899283 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
17:59:07.995323 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
17:59:07.998251 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
17:59:07.998643 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:59:07.998989 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
17:59:08.131556 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:59:08.132857 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
17:59:08.133247 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
17:59:08.244146 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
17:59:08.246556 [debug] [Thread-1  ]: finished collecting timing info
17:59:08.247053 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
17:59:08.341699 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
17:59:08.343935 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2607beaf-d4ef-473f-a72c-37363afacbfc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c4ff40>]}
17:59:08.345314 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 1.99s]
17:59:08.346545 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
17:59:08.350479 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
17:59:08.351207 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
17:59:08.352119 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
17:59:08.352327 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
17:59:08.352543 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
17:59:08.358463 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
17:59:08.360586 [debug] [Thread-1  ]: finished collecting timing info
17:59:08.360924 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
17:59:08.369957 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
17:59:08.371174 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:59:08.371428 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
17:59:08.371646 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
17:59:08.371878 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:59:09.329574 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
17:59:09.330815 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:59:09.331250 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

17:59:09.433644 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
17:59:09.445811 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:59:09.446308 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
17:59:09.541488 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
17:59:09.548423 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:59:09.549493 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
17:59:09.645195 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
17:59:09.650909 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
17:59:09.651402 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:59:09.651748 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
17:59:09.781447 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:59:09.783169 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:59:09.783655 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
17:59:09.881167 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
17:59:09.887747 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:59:09.888364 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
17:59:09.986899 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
17:59:09.990139 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
17:59:09.990570 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:59:09.990920 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
17:59:10.118624 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:59:10.119992 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
17:59:10.120373 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
17:59:10.216040 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
17:59:10.218433 [debug] [Thread-1  ]: finished collecting timing info
17:59:10.218897 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
17:59:10.311949 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
17:59:10.314365 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2607beaf-d4ef-473f-a72c-37363afacbfc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c610a0>]}
17:59:10.315754 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.96s]
17:59:10.316992 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
17:59:10.322499 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
17:59:10.323221 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
17:59:10.324411 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
17:59:10.324850 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
17:59:10.325087 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
17:59:10.339503 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
17:59:10.344319 [debug] [Thread-1  ]: finished collecting timing info
17:59:10.344593 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
17:59:10.347340 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
17:59:10.347973 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:59:10.348124 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
17:59:10.348260 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
17:59:10.348415 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:59:11.258871 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
17:59:11.260181 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:59:11.260572 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

17:59:11.380925 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
17:59:11.387636 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:59:11.388167 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
17:59:11.484004 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
17:59:11.493509 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:59:11.494195 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
17:59:11.589674 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
17:59:11.596031 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
17:59:11.596745 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:59:11.597099 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
17:59:11.727735 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:59:11.728927 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:59:11.729300 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
17:59:11.824032 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
17:59:11.830551 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:59:11.831141 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
17:59:11.927750 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
17:59:11.931679 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
17:59:11.932201 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:59:11.932571 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
17:59:12.063980 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
17:59:12.064895 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
17:59:12.065109 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
17:59:12.188455 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
17:59:12.190978 [debug] [Thread-1  ]: finished collecting timing info
17:59:12.191515 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
17:59:12.288261 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
17:59:12.291040 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2607beaf-d4ef-473f-a72c-37363afacbfc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104be4a00>]}
17:59:12.292750 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 1.97s]
17:59:12.294122 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
17:59:12.300009 [debug] [MainThread]: Acquiring new redshift connection "master"
17:59:12.300543 [debug] [MainThread]: Using redshift connection "master"
17:59:12.300722 [debug] [MainThread]: On master: BEGIN
17:59:12.300894 [debug] [MainThread]: Opening a new connection, currently in state closed
17:59:12.301134 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:59:13.214824 [debug] [MainThread]: SQL status: BEGIN in 0.91 seconds
17:59:13.216142 [debug] [MainThread]: On master: COMMIT
17:59:13.216513 [debug] [MainThread]: Using redshift connection "master"
17:59:13.216886 [debug] [MainThread]: On master: COMMIT
17:59:13.311061 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
17:59:13.311884 [debug] [MainThread]: On master: Close
17:59:13.313980 [info ] [MainThread]: 
17:59:13.314849 [info ] [MainThread]: Finished running 4 view models in 12.71s.
17:59:13.320084 [debug] [MainThread]: Connection 'master' was properly closed.
17:59:13.320277 [debug] [MainThread]: Connection 'list_dev_dbt_amplitude_test' was properly closed.
17:59:13.320433 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
17:59:13.335523 [info ] [MainThread]: 
17:59:13.336286 [info ] [MainThread]: [32mCompleted successfully[0m
17:59:13.336708 [info ] [MainThread]: 
17:59:13.337191 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
17:59:13.337929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b76e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049be460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b281f0>]}


============================== 2022-07-11 18:00:32.894198 | b2c6334b-2722-40cb-9ad0-56d7cf42487d ==============================
18:00:32.894221 [info ] [MainThread]: Running with dbt=1.1.1
18:00:32.894421 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'select': ['models/amplitude/amplitude_event'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:00:32.894485 [debug] [MainThread]: Tracking: tracking
18:00:32.909406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f773a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f77fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f779a0>]}
18:00:32.933730 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
18:00:32.933973 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
18:00:32.939614 [debug] [MainThread]: 1699: static parser successfully parsed amplitude/amplitude_event.sql
18:00:32.950920 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:00:32.953361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b2c6334b-2722-40cb-9ad0-56d7cf42487d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106895790>]}
18:00:32.956007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b2c6334b-2722-40cb-9ad0-56d7cf42487d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fd0640>]}
18:00:32.956138 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:00:32.956259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b2c6334b-2722-40cb-9ad0-56d7cf42487d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fd0eb0>]}
18:00:32.956634 [warn ] [MainThread]: The selection criterion 'models/amplitude/amplitude_event' does not match any nodes
18:00:32.957044 [info ] [MainThread]: 
18:00:32.957156 [warn ] [MainThread]: [[33mWARNING[0m]: Nothing to do. Try checking your model configs and model specification args
18:00:32.959403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106876d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ff8a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ff8610>]}


============================== 2022-07-11 18:00:42.281700 | 762e22dd-9102-4e23-887c-f35b142aeb7f ==============================
18:00:42.281722 [info ] [MainThread]: Running with dbt=1.1.1
18:00:42.281944 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:00:42.282007 [debug] [MainThread]: Tracking: tracking
18:00:42.297177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065cce80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106748e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067484f0>]}
18:00:42.321098 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
18:00:42.321222 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
18:00:42.321464 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:00:42.324658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '762e22dd-9102-4e23-887c-f35b142aeb7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10680d700>]}
18:00:42.327614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '762e22dd-9102-4e23-887c-f35b142aeb7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067a7070>]}
18:00:42.327747 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:00:42.327872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '762e22dd-9102-4e23-887c-f35b142aeb7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067a7040>]}
18:00:42.328527 [info ] [MainThread]: 
18:00:42.328734 [debug] [MainThread]: Acquiring new redshift connection "master"
18:00:42.329187 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
18:00:42.334272 [debug] [ThreadPool]: Using redshift connection "list_dev"
18:00:42.334353 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
18:00:42.334416 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:00:42.334485 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:00:43.374456 [debug] [ThreadPool]: SQL status: SELECT in 1.04 seconds
18:00:43.382518 [debug] [ThreadPool]: On list_dev: Close
18:00:43.386842 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
18:00:43.403520 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:00:43.403807 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
18:00:43.403963 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:00:43.404133 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:00:44.335094 [debug] [ThreadPool]: SQL status: BEGIN in 0.93 seconds
18:00:44.336237 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:00:44.336633 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
18:00:44.461262 [debug] [ThreadPool]: SQL status: SELECT in 0.12 seconds
18:00:44.467048 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
18:00:44.565222 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
18:00:44.581644 [debug] [MainThread]: Using redshift connection "master"
18:00:44.582060 [debug] [MainThread]: On master: BEGIN
18:00:44.582270 [debug] [MainThread]: Opening a new connection, currently in state init
18:00:44.582514 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:00:45.484757 [debug] [MainThread]: SQL status: BEGIN in 0.9 seconds
18:00:45.485950 [debug] [MainThread]: Using redshift connection "master"
18:00:45.486345 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:00:45.650985 [debug] [MainThread]: SQL status: SELECT in 0.16 seconds
18:00:45.658010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '762e22dd-9102-4e23-887c-f35b142aeb7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067fcdf0>]}
18:00:45.658889 [debug] [MainThread]: On master: ROLLBACK
18:00:45.752767 [debug] [MainThread]: Using redshift connection "master"
18:00:45.753587 [debug] [MainThread]: On master: BEGIN
18:00:45.949651 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
18:00:45.950489 [debug] [MainThread]: On master: COMMIT
18:00:45.950933 [debug] [MainThread]: Using redshift connection "master"
18:00:45.951291 [debug] [MainThread]: On master: COMMIT
18:00:46.048496 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:00:46.049704 [debug] [MainThread]: On master: Close
18:00:46.051512 [info ] [MainThread]: Concurrency: 1 threads (target='test')
18:00:46.052542 [info ] [MainThread]: 
18:00:46.066802 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
18:00:46.067862 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
18:00:46.068876 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
18:00:46.069160 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
18:00:46.069433 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
18:00:46.076299 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
18:00:46.077288 [debug] [Thread-1  ]: finished collecting timing info
18:00:46.077501 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
18:00:46.103268 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
18:00:46.103830 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:00:46.103957 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:00:46.104066 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:00:46.104196 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:00:47.028397 [debug] [Thread-1  ]: SQL status: BEGIN in 0.92 seconds
18:00:47.030662 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:00:47.030934 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

18:00:47.132336 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:00:47.151108 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:00:47.151698 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
18:00:47.246225 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
18:00:47.252902 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:00:47.253684 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
18:00:47.353638 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:00:47.375427 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:00:47.375960 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:00:47.376171 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:00:47.505538 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:00:47.507446 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:00:47.507873 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:00:47.606530 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:00:47.622799 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:00:47.623357 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
18:00:47.719575 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:00:47.723928 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:00:47.724564 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:00:47.724948 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:00:47.853959 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:00:47.854843 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:00:47.855285 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:00:47.950412 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
18:00:47.952817 [debug] [Thread-1  ]: finished collecting timing info
18:00:47.953151 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
18:00:48.055575 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
18:00:48.056992 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '762e22dd-9102-4e23-887c-f35b142aeb7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067a7310>]}
18:00:48.057660 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 1.99s]
18:00:48.060893 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
18:00:48.061443 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
18:00:48.061925 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
18:00:48.062916 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
18:00:48.063139 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
18:00:48.063324 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
18:00:48.067404 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
18:00:48.068969 [debug] [Thread-1  ]: finished collecting timing info
18:00:48.069211 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
18:00:48.072885 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
18:00:48.073835 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:00:48.074103 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:00:48.074353 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:00:48.074626 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:00:48.973594 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
18:00:48.974854 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:00:48.975300 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
FROM "dev"."stg_amplitude"."event"
  ) ;

18:00:49.079052 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:00:49.089402 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:00:49.090150 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
18:00:49.199814 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.11 seconds
18:00:49.206300 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:00:49.206822 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
18:00:49.302670 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:00:49.305271 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:00:49.305564 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:00:49.305813 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:00:49.447560 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
18:00:49.449194 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:00:49.449633 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:00:49.543929 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
18:00:49.551520 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:00:49.552064 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
18:00:49.648258 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:00:49.652117 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:00:49.652812 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:00:49.653197 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:00:49.782858 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:00:49.783672 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:00:49.784070 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:00:49.888009 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:00:49.890308 [debug] [Thread-1  ]: finished collecting timing info
18:00:49.890787 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
18:00:49.984212 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
18:00:49.986619 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '762e22dd-9102-4e23-887c-f35b142aeb7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068d9cd0>]}
18:00:49.988069 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 1.92s]
18:00:49.989461 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
18:00:49.992825 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
18:00:49.993527 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
18:00:49.994364 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
18:00:49.994665 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
18:00:49.994904 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
18:00:50.000970 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
18:00:50.004997 [debug] [Thread-1  ]: finished collecting timing info
18:00:50.005504 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
18:00:50.011204 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
18:00:50.013335 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:00:50.013622 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:00:50.013805 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:00:50.013996 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:00:50.938716 [debug] [Thread-1  ]: SQL status: BEGIN in 0.92 seconds
18:00:50.941726 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:00:50.942413 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

18:00:51.054292 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:00:51.061273 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:00:51.061763 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
18:00:51.166186 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:00:51.176851 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:00:51.177584 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
18:00:51.275006 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:00:51.280571 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:00:51.281190 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:00:51.281549 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:00:51.436932 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:00:51.438068 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:00:51.438503 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:00:51.544089 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:00:51.552101 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:00:51.552616 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
18:00:51.650903 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:00:51.655213 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:00:51.655828 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:00:51.656206 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:00:51.810047 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
18:00:51.810836 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:00:51.811203 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:00:51.936318 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:00:51.939356 [debug] [Thread-1  ]: finished collecting timing info
18:00:51.940076 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
18:00:52.035604 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
18:00:52.037701 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '762e22dd-9102-4e23-887c-f35b142aeb7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068d99d0>]}
18:00:52.038941 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.04s]
18:00:52.039611 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
18:00:52.039868 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
18:00:52.040220 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
18:00:52.040866 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
18:00:52.041073 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
18:00:52.041310 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
18:00:52.052642 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
18:00:52.053714 [debug] [Thread-1  ]: finished collecting timing info
18:00:52.054192 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
18:00:52.059722 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
18:00:52.061319 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:00:52.061666 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:00:52.061821 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:00:52.062007 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:00:52.979046 [debug] [Thread-1  ]: SQL status: BEGIN in 0.92 seconds
18:00:52.980239 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:00:52.980948 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

18:00:53.099469 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
18:00:53.110014 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:00:53.110599 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
18:00:53.211817 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:00:53.219855 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:00:53.220562 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
18:00:53.314287 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
18:00:53.318149 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:00:53.318715 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:00:53.319064 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:00:53.485745 [debug] [Thread-1  ]: SQL status: COMMIT in 0.17 seconds
18:00:53.487247 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:00:53.487637 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:00:53.613402 [debug] [Thread-1  ]: SQL status: BEGIN in 0.13 seconds
18:00:53.620984 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:00:53.621681 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
18:00:53.725126 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:00:53.728773 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:00:53.729198 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:00:53.729550 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:00:53.885499 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:00:53.886793 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:00:53.887173 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:00:53.996336 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:00:53.999105 [debug] [Thread-1  ]: finished collecting timing info
18:00:53.999624 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
18:00:54.093486 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
18:00:54.096577 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '762e22dd-9102-4e23-887c-f35b142aeb7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068603d0>]}
18:00:54.098162 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.06s]
18:00:54.099236 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
18:00:54.105066 [debug] [MainThread]: Acquiring new redshift connection "master"
18:00:54.105703 [debug] [MainThread]: Using redshift connection "master"
18:00:54.105896 [debug] [MainThread]: On master: BEGIN
18:00:54.106071 [debug] [MainThread]: Opening a new connection, currently in state closed
18:00:54.106307 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:00:55.037465 [debug] [MainThread]: SQL status: BEGIN in 0.93 seconds
18:00:55.038679 [debug] [MainThread]: On master: COMMIT
18:00:55.038883 [debug] [MainThread]: Using redshift connection "master"
18:00:55.039307 [debug] [MainThread]: On master: COMMIT
18:00:55.132768 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
18:00:55.134208 [debug] [MainThread]: On master: Close
18:00:55.136461 [info ] [MainThread]: 
18:00:55.137400 [info ] [MainThread]: Finished running 4 view models in 12.81s.
18:00:55.138276 [debug] [MainThread]: Connection 'master' was properly closed.
18:00:55.144176 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
18:00:55.157709 [info ] [MainThread]: 
18:00:55.158319 [info ] [MainThread]: [32mCompleted successfully[0m
18:00:55.158822 [info ] [MainThread]: 
18:00:55.159203 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
18:00:55.159793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106874160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067a7100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068c2cd0>]}


============================== 2022-07-11 18:08:44.275635 | b522ddb6-2579-4bc7-93a5-7363becbd7c8 ==============================
18:08:44.275654 [info ] [MainThread]: Running with dbt=1.1.1
18:08:44.276135 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:08:44.276221 [debug] [MainThread]: Tracking: tracking
18:08:44.296247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107448100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107448730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074484f0>]}
18:08:44.321034 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
18:08:44.321263 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
18:08:44.326978 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
18:08:44.335421 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
18:08:44.341273 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:08:44.343672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b522ddb6-2579-4bc7-93a5-7363becbd7c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107564e20>]}
18:08:44.346264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b522ddb6-2579-4bc7-93a5-7363becbd7c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107458c70>]}
18:08:44.346390 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:08:44.346507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b522ddb6-2579-4bc7-93a5-7363becbd7c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107530fd0>]}
18:08:44.347177 [info ] [MainThread]: 
18:08:44.347367 [debug] [MainThread]: Acquiring new redshift connection "master"
18:08:44.347826 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
18:08:44.352885 [debug] [ThreadPool]: Using redshift connection "list_dev"
18:08:44.352969 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
18:08:44.353030 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:08:44.353095 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:08:45.399186 [debug] [ThreadPool]: SQL status: SELECT in 1.05 seconds
18:08:45.403706 [debug] [ThreadPool]: On list_dev: Close
18:08:45.407618 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
18:08:45.423640 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:08:45.423973 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
18:08:45.424152 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:08:45.424342 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:08:46.335662 [debug] [ThreadPool]: SQL status: BEGIN in 0.91 seconds
18:08:46.336863 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:08:46.337247 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
18:08:46.452805 [debug] [ThreadPool]: SQL status: SELECT in 0.11 seconds
18:08:46.458033 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
18:08:46.556010 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
18:08:46.572927 [debug] [MainThread]: Using redshift connection "master"
18:08:46.573829 [debug] [MainThread]: On master: BEGIN
18:08:46.574099 [debug] [MainThread]: Opening a new connection, currently in state init
18:08:46.574445 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:08:47.489062 [debug] [MainThread]: SQL status: BEGIN in 0.91 seconds
18:08:47.490262 [debug] [MainThread]: Using redshift connection "master"
18:08:47.490643 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:08:47.696043 [debug] [MainThread]: SQL status: SELECT in 0.2 seconds
18:08:47.703423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b522ddb6-2579-4bc7-93a5-7363becbd7c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107548d90>]}
18:08:47.704500 [debug] [MainThread]: On master: ROLLBACK
18:08:47.801595 [debug] [MainThread]: Using redshift connection "master"
18:08:47.802161 [debug] [MainThread]: On master: BEGIN
18:08:48.006650 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
18:08:48.007609 [debug] [MainThread]: On master: COMMIT
18:08:48.008065 [debug] [MainThread]: Using redshift connection "master"
18:08:48.008413 [debug] [MainThread]: On master: COMMIT
18:08:48.104787 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:08:48.106058 [debug] [MainThread]: On master: Close
18:08:48.107773 [info ] [MainThread]: Concurrency: 1 threads (target='test')
18:08:48.108418 [info ] [MainThread]: 
18:08:48.123650 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
18:08:48.124650 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
18:08:48.125664 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
18:08:48.125964 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
18:08:48.126256 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
18:08:48.133487 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
18:08:48.134673 [debug] [Thread-1  ]: finished collecting timing info
18:08:48.134915 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
18:08:48.162297 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
18:08:48.162839 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:08:48.162961 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:08:48.163073 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:08:48.163195 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:08:49.062437 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
18:08:49.063783 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:08:49.064252 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

18:08:49.169987 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:08:49.188279 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:08:49.188844 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
18:08:49.286228 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:08:49.293050 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:08:49.293710 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
18:08:49.389942 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:08:49.409998 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:08:49.410559 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:08:49.410766 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:08:49.560833 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
18:08:49.563591 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:08:49.564271 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:08:49.671442 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:08:49.687704 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:08:49.688256 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
18:08:49.783602 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.09 seconds
18:08:49.786883 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:08:49.787464 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:08:49.787820 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:08:49.951390 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:08:49.952237 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:08:49.952710 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:08:50.061178 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:08:50.065824 [debug] [Thread-1  ]: finished collecting timing info
18:08:50.066420 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
18:08:50.164114 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
18:08:50.167729 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b522ddb6-2579-4bc7-93a5-7363becbd7c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108061dc0>]}
18:08:50.169236 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.04s]
18:08:50.170749 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
18:08:50.175290 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
18:08:50.175945 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
18:08:50.176832 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
18:08:50.177063 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
18:08:50.177286 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
18:08:50.190919 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
18:08:50.192754 [debug] [Thread-1  ]: finished collecting timing info
18:08:50.194022 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
18:08:50.198747 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
18:08:50.199514 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:08:50.199679 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:08:50.199816 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:08:50.199975 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:08:51.104194 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
18:08:51.105395 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:08:51.105899 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
  AS class_length
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
  AS elapsed_time
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
FROM "dev"."stg_amplitude"."event"
  ) ;

18:08:51.220982 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:08:51.230077 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:08:51.230644 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
18:08:51.328958 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:08:51.336504 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:08:51.337123 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
18:08:51.436417 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:08:51.440693 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:08:51.441240 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:08:51.441518 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:08:51.592830 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
18:08:51.594599 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:08:51.595055 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:08:51.700868 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:08:51.707430 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:08:51.708026 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
18:08:51.806303 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:08:51.809587 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:08:51.810027 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:08:51.810406 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:08:51.965056 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
18:08:51.966214 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:08:51.966671 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:08:52.077564 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:08:52.081052 [debug] [Thread-1  ]: finished collecting timing info
18:08:52.081653 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
18:08:52.178855 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
18:08:52.181328 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b522ddb6-2579-4bc7-93a5-7363becbd7c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108054220>]}
18:08:52.182884 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.00s]
18:08:52.184194 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
18:08:52.189126 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
18:08:52.190006 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
18:08:52.190803 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
18:08:52.191059 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
18:08:52.191292 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
18:08:52.197411 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
18:08:52.199308 [debug] [Thread-1  ]: finished collecting timing info
18:08:52.199613 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
18:08:52.204074 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
18:08:52.205504 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:08:52.205692 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:08:52.205873 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:08:52.206127 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:08:53.116392 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
18:08:53.117861 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:08:53.118215 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

18:08:53.220145 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:08:53.231072 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:08:53.231671 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
18:08:53.325533 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
18:08:53.332439 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:08:53.333050 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
18:08:53.428902 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:08:53.433334 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:08:53.433901 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:08:53.434159 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:08:53.584179 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
18:08:53.586254 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:08:53.586636 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:08:53.694301 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:08:53.700809 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:08:53.701432 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
18:08:53.801929 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:08:53.804993 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:08:53.805404 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:08:53.805752 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:08:53.954987 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
18:08:53.955882 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:08:53.956486 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:08:54.063535 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:08:54.065509 [debug] [Thread-1  ]: finished collecting timing info
18:08:54.066063 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
18:08:54.168276 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
18:08:54.170097 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b522ddb6-2579-4bc7-93a5-7363becbd7c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108054280>]}
18:08:54.170742 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.98s]
18:08:54.171390 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
18:08:54.174506 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
18:08:54.175025 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
18:08:54.176058 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
18:08:54.176314 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
18:08:54.176919 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
18:08:54.189412 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
18:08:54.190641 [debug] [Thread-1  ]: finished collecting timing info
18:08:54.190923 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
18:08:54.195216 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
18:08:54.195802 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:08:54.195883 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:08:54.195950 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:08:54.196036 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:08:55.189026 [debug] [Thread-1  ]: SQL status: BEGIN in 0.99 seconds
18:08:55.203014 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:08:55.203251 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

18:08:55.328541 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.13 seconds
18:08:55.342879 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:08:55.343239 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
18:08:55.436266 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
18:08:55.443013 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:08:55.443494 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
18:08:55.542393 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:08:55.552683 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:08:55.553196 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:08:55.553372 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:08:55.687322 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:08:55.689280 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:08:55.689679 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:08:55.793653 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:08:55.801413 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:08:55.802101 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
18:08:55.900309 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:08:55.904889 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:08:55.905427 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:08:55.905724 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:08:56.056360 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
18:08:56.057180 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:08:56.057366 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:08:56.177348 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:08:56.179457 [debug] [Thread-1  ]: finished collecting timing info
18:08:56.179742 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
18:08:56.275797 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
18:08:56.278815 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b522ddb6-2579-4bc7-93a5-7363becbd7c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108206df0>]}
18:08:56.279949 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.10s]
18:08:56.280726 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
18:08:56.285415 [debug] [MainThread]: Acquiring new redshift connection "master"
18:08:56.286095 [debug] [MainThread]: Using redshift connection "master"
18:08:56.286846 [debug] [MainThread]: On master: BEGIN
18:08:56.287116 [debug] [MainThread]: Opening a new connection, currently in state closed
18:08:56.287430 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:08:57.230753 [debug] [MainThread]: SQL status: BEGIN in 0.94 seconds
18:08:57.231774 [debug] [MainThread]: On master: COMMIT
18:08:57.232171 [debug] [MainThread]: Using redshift connection "master"
18:08:57.232369 [debug] [MainThread]: On master: COMMIT
18:08:57.336399 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:08:57.337805 [debug] [MainThread]: On master: Close
18:08:57.340634 [info ] [MainThread]: 
18:08:57.341678 [info ] [MainThread]: Finished running 4 view models in 12.99s.
18:08:57.344339 [debug] [MainThread]: Connection 'master' was properly closed.
18:08:57.345156 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
18:08:57.363696 [info ] [MainThread]: 
18:08:57.364065 [info ] [MainThread]: [32mCompleted successfully[0m
18:08:57.364302 [info ] [MainThread]: 
18:08:57.364482 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
18:08:57.364852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107520580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080c6910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080447f0>]}


============================== 2022-07-11 18:10:05.541838 | c3f889e8-509b-417a-ac3a-7967606147ec ==============================
18:10:05.541852 [info ] [MainThread]: Running with dbt=1.1.1
18:10:05.542334 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:10:05.542432 [debug] [MainThread]: Tracking: tracking
18:10:05.565853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104581100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104581730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045814f0>]}
18:10:05.591244 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
18:10:05.591491 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
18:10:05.597350 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
18:10:05.606183 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
18:10:05.612323 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:10:05.614784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c3f889e8-509b-417a-ac3a-7967606147ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104664fa0>]}
18:10:05.617456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c3f889e8-509b-417a-ac3a-7967606147ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10458fcd0>]}
18:10:05.617593 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:10:05.617715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c3f889e8-509b-417a-ac3a-7967606147ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104631fd0>]}
18:10:05.618396 [info ] [MainThread]: 
18:10:05.618606 [debug] [MainThread]: Acquiring new redshift connection "master"
18:10:05.619043 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
18:10:05.624149 [debug] [ThreadPool]: Using redshift connection "list_dev"
18:10:05.624231 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
18:10:05.624310 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:10:05.624387 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:10:06.630677 [debug] [ThreadPool]: SQL status: SELECT in 1.01 seconds
18:10:06.637358 [debug] [ThreadPool]: On list_dev: Close
18:10:06.642005 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
18:10:06.657225 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:10:06.657540 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
18:10:06.657690 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:10:06.657855 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:10:07.573400 [debug] [ThreadPool]: SQL status: BEGIN in 0.92 seconds
18:10:07.574509 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:10:07.574718 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
18:10:07.688283 [debug] [ThreadPool]: SQL status: SELECT in 0.11 seconds
18:10:07.693713 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
18:10:07.789766 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
18:10:07.805894 [debug] [MainThread]: Using redshift connection "master"
18:10:07.807053 [debug] [MainThread]: On master: BEGIN
18:10:07.807363 [debug] [MainThread]: Opening a new connection, currently in state init
18:10:07.807664 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:10:08.718813 [debug] [MainThread]: SQL status: BEGIN in 0.91 seconds
18:10:08.720044 [debug] [MainThread]: Using redshift connection "master"
18:10:08.720444 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:10:08.886645 [debug] [MainThread]: SQL status: SELECT in 0.17 seconds
18:10:08.893948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c3f889e8-509b-417a-ac3a-7967606147ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104648d90>]}
18:10:08.895623 [debug] [MainThread]: On master: ROLLBACK
18:10:08.992324 [debug] [MainThread]: Using redshift connection "master"
18:10:08.993166 [debug] [MainThread]: On master: BEGIN
18:10:09.194626 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
18:10:09.195287 [debug] [MainThread]: On master: COMMIT
18:10:09.195654 [debug] [MainThread]: Using redshift connection "master"
18:10:09.196017 [debug] [MainThread]: On master: COMMIT
18:10:09.292217 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:10:09.293124 [debug] [MainThread]: On master: Close
18:10:09.294549 [info ] [MainThread]: Concurrency: 1 threads (target='test')
18:10:09.295213 [info ] [MainThread]: 
18:10:09.307879 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
18:10:09.308495 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
18:10:09.309493 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
18:10:09.309861 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
18:10:09.310180 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
18:10:09.317641 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
18:10:09.319005 [debug] [Thread-1  ]: finished collecting timing info
18:10:09.319336 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
18:10:09.347833 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
18:10:09.348714 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:10:09.348854 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:10:09.348964 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:10:09.349087 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:10:10.260658 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
18:10:10.261864 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:10:10.262261 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

18:10:10.366337 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:10:10.384618 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:10:10.385154 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
18:10:10.479448 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
18:10:10.486083 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:10:10.486654 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
18:10:10.584209 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:10:10.608854 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:10:10.609250 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:10:10.609487 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:10:10.746116 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
18:10:10.747710 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:10:10.748129 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:10:10.854713 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:10:10.871258 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:10:10.871863 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
18:10:10.966855 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.09 seconds
18:10:10.971077 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:10:10.971549 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:10:10.972028 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:10:11.098124 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:10:11.099363 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:10:11.099675 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:10:11.195572 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:10:11.198013 [debug] [Thread-1  ]: finished collecting timing info
18:10:11.198316 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
18:10:11.291610 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
18:10:11.293905 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3f889e8-509b-417a-ac3a-7967606147ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104760dc0>]}
18:10:11.296115 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 1.98s]
18:10:11.301692 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
18:10:11.302378 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
18:10:11.302916 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
18:10:11.303645 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
18:10:11.303863 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
18:10:11.304097 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
18:10:11.319505 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
18:10:11.321433 [debug] [Thread-1  ]: finished collecting timing info
18:10:11.321890 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
18:10:11.325436 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
18:10:11.326382 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:10:11.326584 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:10:11.326757 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:10:11.326942 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:10:12.236498 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
18:10:12.237762 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:10:12.238223 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
  AS class_length
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
  AS elapsed_time
FROM "dev"."stg_amplitude"."event"
  ) ;

18:10:12.344093 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:10:12.354115 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:10:12.354787 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
18:10:12.449313 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
18:10:12.457068 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:10:12.457852 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
18:10:12.552827 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
18:10:12.556782 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:10:12.557401 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:10:12.557762 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:10:12.707595 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
18:10:12.708841 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:10:12.709211 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:10:12.818084 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:10:12.822807 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:10:12.823289 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
18:10:12.925267 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:10:12.927822 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:10:12.928056 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:10:12.928247 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:10:13.053516 [debug] [Thread-1  ]: SQL status: COMMIT in 0.12 seconds
18:10:13.054995 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:10:13.055457 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:10:13.149934 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
18:10:13.152465 [debug] [Thread-1  ]: finished collecting timing info
18:10:13.153007 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
18:10:13.245573 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
18:10:13.246713 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3f889e8-509b-417a-ac3a-7967606147ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104754250>]}
18:10:13.247456 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 1.94s]
18:10:13.251405 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
18:10:13.251868 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
18:10:13.252260 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
18:10:13.253115 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
18:10:13.253473 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
18:10:13.253672 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
18:10:13.257218 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
18:10:13.258012 [debug] [Thread-1  ]: finished collecting timing info
18:10:13.258221 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
18:10:13.261204 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
18:10:13.261911 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:10:13.262089 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:10:13.262254 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:10:13.262560 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:10:14.173771 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
18:10:14.175058 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:10:14.175497 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

18:10:14.276623 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:10:14.286365 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:10:14.293479 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
18:10:14.389130 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
18:10:14.403201 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:10:14.404062 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
18:10:14.497766 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
18:10:14.502581 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:10:14.503276 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:10:14.503720 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:10:14.659434 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:10:14.661556 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:10:14.661920 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:10:14.787752 [debug] [Thread-1  ]: SQL status: BEGIN in 0.13 seconds
18:10:14.792816 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:10:14.793317 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
18:10:14.890640 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:10:14.894806 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:10:14.895333 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:10:14.895705 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:10:15.024770 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:10:15.026130 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:10:15.026537 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:10:15.121576 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
18:10:15.124761 [debug] [Thread-1  ]: finished collecting timing info
18:10:15.125304 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
18:10:15.217952 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
18:10:15.219981 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3f889e8-509b-417a-ac3a-7967606147ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104754250>]}
18:10:15.221718 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.97s]
18:10:15.223496 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
18:10:15.227194 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
18:10:15.228070 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
18:10:15.228833 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
18:10:15.229190 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
18:10:15.229435 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
18:10:15.242986 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
18:10:15.245393 [debug] [Thread-1  ]: finished collecting timing info
18:10:15.245669 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
18:10:15.250357 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
18:10:15.250829 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:10:15.250907 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:10:15.250972 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:10:15.251049 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:10:16.138767 [debug] [Thread-1  ]: SQL status: BEGIN in 0.89 seconds
18:10:16.139387 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:10:16.139586 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

18:10:16.248896 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:10:16.252876 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:10:16.253224 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
18:10:16.351454 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:10:16.376091 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:10:16.378262 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
18:10:16.471732 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
18:10:16.480974 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:10:16.481360 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:10:16.481624 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:10:16.604422 [debug] [Thread-1  ]: SQL status: COMMIT in 0.12 seconds
18:10:16.605076 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:10:16.605247 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:10:16.708829 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:10:16.714437 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:10:16.716238 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
18:10:16.811563 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:10:16.814039 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:10:16.814420 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:10:16.816730 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:10:16.947811 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:10:16.948673 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:10:16.949188 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:10:17.044400 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
18:10:17.047148 [debug] [Thread-1  ]: finished collecting timing info
18:10:17.047589 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
18:10:17.147499 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
18:10:17.149746 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3f889e8-509b-417a-ac3a-7967606147ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104743fa0>]}
18:10:17.150623 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 1.92s]
18:10:17.151464 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
18:10:17.155841 [debug] [MainThread]: Acquiring new redshift connection "master"
18:10:17.156534 [debug] [MainThread]: Using redshift connection "master"
18:10:17.156892 [debug] [MainThread]: On master: BEGIN
18:10:17.157229 [debug] [MainThread]: Opening a new connection, currently in state closed
18:10:17.157611 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:10:18.081516 [debug] [MainThread]: SQL status: BEGIN in 0.92 seconds
18:10:18.083065 [debug] [MainThread]: On master: COMMIT
18:10:18.083454 [debug] [MainThread]: Using redshift connection "master"
18:10:18.083928 [debug] [MainThread]: On master: COMMIT
18:10:18.178455 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
18:10:18.179453 [debug] [MainThread]: On master: Close
18:10:18.181093 [info ] [MainThread]: 
18:10:18.181689 [info ] [MainThread]: Finished running 4 view models in 12.56s.
18:10:18.182069 [debug] [MainThread]: Connection 'master' was properly closed.
18:10:18.183111 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
18:10:18.196838 [info ] [MainThread]: 
18:10:18.197680 [info ] [MainThread]: [32mCompleted successfully[0m
18:10:18.198103 [info ] [MainThread]: 
18:10:18.198439 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
18:10:18.199556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104622580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104743c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104743c70>]}


============================== 2022-07-11 18:11:18.494929 | dde4cce6-0f40-4380-9ebb-6d0ce86c68d6 ==============================
18:11:18.494945 [info ] [MainThread]: Running with dbt=1.1.1
18:11:18.495140 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:11:18.495204 [debug] [MainThread]: Tracking: tracking
18:11:18.512442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057c50a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057c56d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057c5490>]}
18:11:18.535761 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
18:11:18.535984 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
18:11:18.541636 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
18:11:18.548609 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
18:11:18.554526 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:11:18.556987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dde4cce6-0f40-4380-9ebb-6d0ce86c68d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105898c70>]}
18:11:18.559588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dde4cce6-0f40-4380-9ebb-6d0ce86c68d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057d3c70>]}
18:11:18.559729 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:11:18.559855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dde4cce6-0f40-4380-9ebb-6d0ce86c68d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105870df0>]}
18:11:18.560667 [info ] [MainThread]: 
18:11:18.560967 [debug] [MainThread]: Acquiring new redshift connection "master"
18:11:18.561398 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
18:11:18.566761 [debug] [ThreadPool]: Using redshift connection "list_dev"
18:11:18.566868 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
18:11:18.566940 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:11:18.567017 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:11:19.525939 [debug] [ThreadPool]: SQL status: SELECT in 0.96 seconds
18:11:19.531868 [debug] [ThreadPool]: On list_dev: Close
18:11:19.535118 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
18:11:19.550552 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:11:19.551397 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
18:11:19.551759 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:11:19.552053 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:11:20.467503 [debug] [ThreadPool]: SQL status: BEGIN in 0.92 seconds
18:11:20.468732 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:11:20.469118 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
18:11:20.583385 [debug] [ThreadPool]: SQL status: SELECT in 0.11 seconds
18:11:20.588894 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
18:11:20.685040 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
18:11:20.699607 [debug] [MainThread]: Using redshift connection "master"
18:11:20.700126 [debug] [MainThread]: On master: BEGIN
18:11:20.700364 [debug] [MainThread]: Opening a new connection, currently in state init
18:11:20.700621 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:11:21.611587 [debug] [MainThread]: SQL status: BEGIN in 0.91 seconds
18:11:21.612861 [debug] [MainThread]: Using redshift connection "master"
18:11:21.613165 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:11:21.781418 [debug] [MainThread]: SQL status: SELECT in 0.17 seconds
18:11:21.790558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dde4cce6-0f40-4380-9ebb-6d0ce86c68d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10582a460>]}
18:11:21.791858 [debug] [MainThread]: On master: ROLLBACK
18:11:21.884591 [debug] [MainThread]: Using redshift connection "master"
18:11:21.885323 [debug] [MainThread]: On master: BEGIN
18:11:22.075546 [debug] [MainThread]: SQL status: BEGIN in 0.19 seconds
18:11:22.076925 [debug] [MainThread]: On master: COMMIT
18:11:22.077183 [debug] [MainThread]: Using redshift connection "master"
18:11:22.077431 [debug] [MainThread]: On master: COMMIT
18:11:22.170657 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
18:11:22.171562 [debug] [MainThread]: On master: Close
18:11:22.173526 [info ] [MainThread]: Concurrency: 1 threads (target='test')
18:11:22.174468 [info ] [MainThread]: 
18:11:22.191433 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
18:11:22.192556 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
18:11:22.193643 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
18:11:22.193977 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
18:11:22.194266 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
18:11:22.201323 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
18:11:22.202656 [debug] [Thread-1  ]: finished collecting timing info
18:11:22.202975 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
18:11:22.229154 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
18:11:22.229711 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:11:22.229840 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:11:22.229949 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:11:22.230078 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:11:23.140493 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
18:11:23.141698 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:11:23.142089 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

18:11:23.245895 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:11:23.264479 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:11:23.264995 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
18:11:23.372880 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.11 seconds
18:11:23.380692 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:11:23.381373 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
18:11:23.477466 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:11:23.503218 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:11:23.503606 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:11:23.503791 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:11:23.628278 [debug] [Thread-1  ]: SQL status: COMMIT in 0.12 seconds
18:11:23.630223 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:11:23.630623 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:11:23.724463 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
18:11:23.739183 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:11:23.739686 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
18:11:23.844921 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:11:23.848101 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:11:23.848497 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:11:23.848849 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:11:24.019682 [debug] [Thread-1  ]: SQL status: COMMIT in 0.17 seconds
18:11:24.020594 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:11:24.021009 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:11:24.130440 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:11:24.133576 [debug] [Thread-1  ]: finished collecting timing info
18:11:24.134246 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
18:11:24.231519 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
18:11:24.233929 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dde4cce6-0f40-4380-9ebb-6d0ce86c68d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ca1d30>]}
18:11:24.235342 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.04s]
18:11:24.236803 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
18:11:24.242371 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
18:11:24.242811 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
18:11:24.243594 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
18:11:24.243845 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
18:11:24.244108 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
18:11:24.250994 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
18:11:24.252683 [debug] [Thread-1  ]: finished collecting timing info
18:11:24.252949 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
18:11:24.259927 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
18:11:24.261789 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:11:24.262135 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:11:24.262322 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:11:24.262532 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:11:25.160139 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
18:11:25.161298 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:11:25.161561 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
FROM "dev"."stg_amplitude"."event"
  ) ;

18:11:25.264987 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:11:25.274342 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:11:25.275027 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
18:11:25.368255 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
18:11:25.375305 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:11:25.375958 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
18:11:25.470758 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
18:11:25.474451 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:11:25.474932 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:11:25.475194 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:11:25.612716 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
18:11:25.614506 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:11:25.614745 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:11:25.710093 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:11:25.716220 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:11:25.717486 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
18:11:25.814206 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:11:25.817871 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:11:25.818472 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:11:25.818848 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:11:25.945976 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:11:25.946858 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:11:25.947232 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:11:26.044122 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:11:26.046124 [debug] [Thread-1  ]: finished collecting timing info
18:11:26.046603 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
18:11:26.138935 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
18:11:26.141260 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dde4cce6-0f40-4380-9ebb-6d0ce86c68d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c951c0>]}
18:11:26.142490 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 1.90s]
18:11:26.144208 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
18:11:26.150638 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
18:11:26.151032 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
18:11:26.152111 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
18:11:26.153730 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
18:11:26.154084 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
18:11:26.160243 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
18:11:26.162078 [debug] [Thread-1  ]: finished collecting timing info
18:11:26.162391 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
18:11:26.166745 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
18:11:26.168294 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:11:26.168667 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:11:26.168883 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:11:26.169108 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:11:27.077020 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
18:11:27.078118 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:11:27.078365 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

18:11:27.181940 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:11:27.190862 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:11:27.191378 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
18:11:27.285122 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
18:11:27.292965 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:11:27.293648 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
18:11:27.386865 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
18:11:27.389161 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:11:27.389382 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:11:27.389548 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:11:27.519307 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:11:27.520801 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:11:27.521190 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:11:27.616517 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
18:11:27.622685 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:11:27.623169 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
18:11:27.719939 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:11:27.723025 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:11:27.723429 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:11:27.723850 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:11:27.851462 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:11:27.852229 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:11:27.852589 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:11:27.947702 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
18:11:27.951046 [debug] [Thread-1  ]: finished collecting timing info
18:11:27.951725 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
18:11:28.050923 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
18:11:28.055081 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dde4cce6-0f40-4380-9ebb-6d0ce86c68d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c2fb80>]}
18:11:28.056926 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.90s]
18:11:28.058359 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
18:11:28.058910 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
18:11:28.059387 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
18:11:28.060410 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
18:11:28.060725 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
18:11:28.061025 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
18:11:28.076444 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
18:11:28.077577 [debug] [Thread-1  ]: finished collecting timing info
18:11:28.077785 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
18:11:28.082486 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
18:11:28.083169 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:11:28.083323 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:11:28.083466 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:11:28.083627 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:11:28.985933 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
18:11:28.987223 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:11:28.987616 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

18:11:29.100708 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:11:29.108945 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:11:29.109526 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
18:11:29.205186 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:11:29.211887 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:11:29.212415 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
18:11:29.306058 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
18:11:29.310019 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:11:29.310705 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:11:29.310979 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:11:29.449891 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
18:11:29.452327 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:11:29.452789 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:11:29.546193 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
18:11:29.553552 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:11:29.554155 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
18:11:29.653222 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:11:29.657279 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:11:29.657696 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:11:29.657973 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:11:29.781293 [debug] [Thread-1  ]: SQL status: COMMIT in 0.12 seconds
18:11:29.782116 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:11:29.782476 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:11:29.876060 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
18:11:29.878385 [debug] [Thread-1  ]: finished collecting timing info
18:11:29.879496 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
18:11:29.975882 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
18:11:29.978407 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dde4cce6-0f40-4380-9ebb-6d0ce86c68d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e48e80>]}
18:11:29.979911 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 1.92s]
18:11:29.981279 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
18:11:29.988631 [debug] [MainThread]: Acquiring new redshift connection "master"
18:11:29.989126 [debug] [MainThread]: Using redshift connection "master"
18:11:29.989314 [debug] [MainThread]: On master: BEGIN
18:11:29.989489 [debug] [MainThread]: Opening a new connection, currently in state closed
18:11:29.989714 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:11:30.918972 [debug] [MainThread]: SQL status: BEGIN in 0.93 seconds
18:11:30.920317 [debug] [MainThread]: On master: COMMIT
18:11:30.920704 [debug] [MainThread]: Using redshift connection "master"
18:11:30.921735 [debug] [MainThread]: On master: COMMIT
18:11:31.031811 [debug] [MainThread]: SQL status: COMMIT in 0.11 seconds
18:11:31.032676 [debug] [MainThread]: On master: Close
18:11:31.034154 [info ] [MainThread]: 
18:11:31.034715 [info ] [MainThread]: Finished running 4 view models in 12.47s.
18:11:31.035044 [debug] [MainThread]: Connection 'master' was properly closed.
18:11:31.035254 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
18:11:31.049548 [info ] [MainThread]: 
18:11:31.050631 [info ] [MainThread]: [32mCompleted successfully[0m
18:11:31.051124 [info ] [MainThread]: 
18:11:31.051599 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
18:11:31.052505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058a4b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c83eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c839d0>]}


============================== 2022-07-11 18:15:24.434485 | 959910f2-ef31-4fb8-82f0-04dbf055b736 ==============================
18:15:24.434499 [info ] [MainThread]: Running with dbt=1.1.1
18:15:24.434933 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:15:24.435012 [debug] [MainThread]: Tracking: tracking
18:15:24.450124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107daf0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107daf6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107daf490>]}
18:15:24.474362 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
18:15:24.474596 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
18:15:24.480335 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
18:15:24.488777 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
18:15:24.494849 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:15:24.497270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '959910f2-ef31-4fb8-82f0-04dbf055b736', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e8cdf0>]}
18:15:24.499891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '959910f2-ef31-4fb8-82f0-04dbf055b736', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107db9c40>]}
18:15:24.500026 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:15:24.500148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '959910f2-ef31-4fb8-82f0-04dbf055b736', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e59f40>]}
18:15:24.500839 [info ] [MainThread]: 
18:15:24.501038 [debug] [MainThread]: Acquiring new redshift connection "master"
18:15:24.501445 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
18:15:24.506466 [debug] [ThreadPool]: Using redshift connection "list_dev"
18:15:24.506547 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
18:15:24.506611 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:15:24.506676 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:15:25.563597 [debug] [ThreadPool]: SQL status: SELECT in 1.06 seconds
18:15:25.574523 [debug] [ThreadPool]: On list_dev: Close
18:15:25.577246 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
18:15:25.590728 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:15:25.590898 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
18:15:25.590983 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:15:25.591072 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:15:26.493982 [debug] [ThreadPool]: SQL status: BEGIN in 0.9 seconds
18:15:26.495516 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:15:26.495918 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
18:15:26.611250 [debug] [ThreadPool]: SQL status: SELECT in 0.11 seconds
18:15:26.618495 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
18:15:26.724293 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
18:15:26.758829 [debug] [MainThread]: Using redshift connection "master"
18:15:26.759924 [debug] [MainThread]: On master: BEGIN
18:15:26.760364 [debug] [MainThread]: Opening a new connection, currently in state init
18:15:26.760750 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:16:16.386806 [debug] [MainThread]: Postgres adapter: Got an error when attempting to open a postgres connection: 'connection to server at "redshift-cluster-1.ct0wmhwbmwm9.us-east-1.redshift.amazonaws.com" (172.28.101.169), port 5439 failed: timeout expired
'
18:16:16.390271 [debug] [MainThread]: Postgres adapter: Error running SQL: BEGIN
18:16:16.391829 [debug] [MainThread]: Postgres adapter: Rolling back transaction.
18:16:16.393281 [debug] [MainThread]: Postgres adapter: Error running SQL: macro postgres_get_relations
18:16:16.393655 [debug] [MainThread]: Postgres adapter: Rolling back transaction.
18:16:16.394499 [debug] [MainThread]: On master: No close available on handle
18:16:16.399807 [debug] [MainThread]: Connection 'master' was properly closed.
18:16:16.400229 [debug] [MainThread]: Connection 'list_dev_dbt_amplitude_test' was properly closed.
18:16:16.403351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107efff70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107effc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107effb50>]}


============================== 2022-07-11 18:16:24.992074 | 7bcefaae-ad83-460c-97d8-8827e812b319 ==============================
18:16:24.992090 [info ] [MainThread]: Running with dbt=1.1.1
18:16:24.992289 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:16:24.992353 [debug] [MainThread]: Tracking: tracking
18:16:25.008191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bc40d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bc4700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bc44c0>]}
18:16:25.033419 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
18:16:25.033541 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
18:16:25.033766 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:16:25.036954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7bcefaae-ad83-460c-97d8-8827e812b319', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c91910>]}
18:16:25.039651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7bcefaae-ad83-460c-97d8-8827e812b319', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c83430>]}
18:16:25.039786 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:16:25.039906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7bcefaae-ad83-460c-97d8-8827e812b319', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c83250>]}
18:16:25.040577 [info ] [MainThread]: 
18:16:25.040776 [debug] [MainThread]: Acquiring new redshift connection "master"
18:16:25.041208 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
18:16:25.046327 [debug] [ThreadPool]: Using redshift connection "list_dev"
18:16:25.046415 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
18:16:25.046480 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:16:25.046548 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:16:26.088850 [debug] [ThreadPool]: SQL status: SELECT in 1.04 seconds
18:16:26.093921 [debug] [ThreadPool]: On list_dev: Close
18:16:26.097384 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
18:16:26.110829 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:16:26.111181 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
18:16:26.111481 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:16:26.111850 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:16:27.073081 [debug] [ThreadPool]: SQL status: BEGIN in 0.96 seconds
18:16:27.074407 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:16:27.074803 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
18:16:27.233373 [debug] [ThreadPool]: SQL status: SELECT in 0.16 seconds
18:16:27.238656 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
18:16:27.359110 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
18:16:27.375181 [debug] [MainThread]: Using redshift connection "master"
18:16:27.375728 [debug] [MainThread]: On master: BEGIN
18:16:27.375936 [debug] [MainThread]: Opening a new connection, currently in state init
18:16:27.376198 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:16:28.335142 [debug] [MainThread]: SQL status: BEGIN in 0.96 seconds
18:16:28.336295 [debug] [MainThread]: Using redshift connection "master"
18:16:28.336564 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:16:28.644979 [debug] [MainThread]: SQL status: SELECT in 0.31 seconds
18:16:28.650426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7bcefaae-ad83-460c-97d8-8827e812b319', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bf6790>]}
18:16:28.651482 [debug] [MainThread]: On master: ROLLBACK
18:16:28.751765 [debug] [MainThread]: Using redshift connection "master"
18:16:28.752592 [debug] [MainThread]: On master: BEGIN
18:16:28.950950 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
18:16:28.951581 [debug] [MainThread]: On master: COMMIT
18:16:28.951763 [debug] [MainThread]: Using redshift connection "master"
18:16:28.951946 [debug] [MainThread]: On master: COMMIT
18:16:29.052043 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:16:29.053326 [debug] [MainThread]: On master: Close
18:16:29.055252 [info ] [MainThread]: Concurrency: 1 threads (target='test')
18:16:29.055975 [info ] [MainThread]: 
18:16:29.073544 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
18:16:29.074212 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
18:16:29.074931 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
18:16:29.075150 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
18:16:29.075384 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
18:16:29.083824 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
18:16:29.085067 [debug] [Thread-1  ]: finished collecting timing info
18:16:29.085254 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
18:16:29.107945 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
18:16:29.108442 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:16:29.108600 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:16:29.108718 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:16:29.108837 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:16:30.088388 [debug] [Thread-1  ]: SQL status: BEGIN in 0.98 seconds
18:16:30.089421 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:16:30.089716 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

18:16:30.210520 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
18:16:30.229749 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:16:30.230324 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
18:16:30.328686 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:16:30.335431 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:16:30.335986 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
18:16:30.435013 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:16:30.455556 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:16:30.456094 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:16:30.456298 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:16:30.638866 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
18:16:30.640276 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:16:30.640687 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:16:30.765043 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:16:30.779107 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:16:30.779680 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
18:16:30.882190 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:16:30.885356 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:16:30.886000 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:16:30.886442 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:16:31.054833 [debug] [Thread-1  ]: SQL status: COMMIT in 0.17 seconds
18:16:31.055739 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:16:31.056118 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:16:31.170807 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:16:31.173700 [debug] [Thread-1  ]: finished collecting timing info
18:16:31.174275 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
18:16:31.272354 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
18:16:31.275119 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7bcefaae-ad83-460c-97d8-8827e812b319', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bfdd30>]}
18:16:31.276649 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.20s]
18:16:31.278233 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
18:16:31.283502 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
18:16:31.284376 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
18:16:31.285242 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
18:16:31.285508 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
18:16:31.285755 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
18:16:31.301309 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
18:16:31.303111 [debug] [Thread-1  ]: finished collecting timing info
18:16:31.303272 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
18:16:31.305588 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
18:16:31.306132 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:16:31.306270 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:16:31.306383 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:16:31.306508 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:16:32.261505 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
18:16:32.262586 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:16:32.263004 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
--        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
--        AS class_length
--        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
--        AS multiplayer_mode
--        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
--        AS genre
--        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

--        AS is_tutorial
--        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
--        AS studio
--        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
--            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

--            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

--        END AS class_name
--        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
--        AS class_id
--        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
--        AS elapsed_time
--        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

--        AS class_quit_reason
FROM "dev"."stg_amplitude"."event"
  ) ;

18:16:32.381925 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "("
LINE 15:     (nullif(json_extract_path_text(event_properties,'classLe...
             ^

18:16:32.383405 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
18:16:32.482862 [debug] [Thread-1  ]: finished collecting timing info
18:16:32.483671 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
18:16:32.485727 [debug] [Thread-1  ]: Database Error in model amplitude_event (models/amplitude/amplitude_event.sql)
  syntax error at or near "("
  LINE 15:     (nullif(json_extract_path_text(event_properties,'classLe...
               ^
  compiled SQL at target/run/amplitude_event/models/amplitude/amplitude_event.sql
18:16:32.486952 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7bcefaae-ad83-460c-97d8-8827e812b319', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dbcbe0>]}
18:16:32.488546 [error] [Thread-1  ]: 2 of 4 ERROR creating view model dbt_amplitude_test.amplitude_event ............ [[31mERROR[0m in 1.20s]
18:16:32.489890 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
18:16:32.494599 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
18:16:32.495566 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
18:16:32.496295 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
18:16:32.496494 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
18:16:32.496708 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
18:16:32.502303 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
18:16:32.504723 [debug] [Thread-1  ]: finished collecting timing info
18:16:32.505094 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
18:16:32.510737 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
18:16:32.512895 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:16:32.513151 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:16:32.513324 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:16:32.513541 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:16:33.480008 [debug] [Thread-1  ]: SQL status: BEGIN in 0.97 seconds
18:16:33.481092 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:16:33.481320 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

18:16:33.593636 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:16:33.599413 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:16:33.599900 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
18:16:33.700612 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:16:33.706497 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:16:33.707177 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
18:16:33.803765 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:16:33.806393 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:16:33.806737 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:16:33.806950 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:16:33.971564 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:16:33.972277 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:16:33.972461 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:16:34.090616 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:16:34.098409 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:16:34.099645 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
18:16:34.198587 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:16:34.204954 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:16:34.205839 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:16:34.206532 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:16:34.365511 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:16:34.365950 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:16:34.366126 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:16:34.476679 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:16:34.478505 [debug] [Thread-1  ]: finished collecting timing info
18:16:34.478876 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
18:16:34.577362 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
18:16:34.581115 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7bcefaae-ad83-460c-97d8-8827e812b319', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d5abe0>]}
18:16:34.583855 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.08s]
18:16:34.584978 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
18:16:34.585692 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
18:16:34.592154 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
18:16:34.593126 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
18:16:34.593375 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
18:16:34.593592 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
18:16:34.607642 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
18:16:34.608695 [debug] [Thread-1  ]: finished collecting timing info
18:16:34.609048 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
18:16:34.610919 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
18:16:34.611485 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:16:34.611582 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:16:34.611667 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:16:34.611769 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:16:35.564917 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
18:16:35.568814 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:16:35.569315 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

18:16:35.713337 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.14 seconds
18:16:35.722567 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:16:35.723155 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
18:16:35.821927 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:16:35.833636 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:16:35.834361 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
18:16:35.932925 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:16:35.935959 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:16:35.936276 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:16:35.936466 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:16:36.116175 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
18:16:36.118056 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:16:36.118542 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:16:36.232543 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:16:36.240249 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:16:36.240747 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
18:16:36.344584 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:16:36.347094 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:16:36.347390 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:16:36.347707 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:16:36.532849 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
18:16:36.534149 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:16:36.534568 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:16:36.650666 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:16:36.653786 [debug] [Thread-1  ]: finished collecting timing info
18:16:36.654532 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
18:16:36.751139 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
18:16:36.753600 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7bcefaae-ad83-460c-97d8-8827e812b319', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d5aca0>]}
18:16:36.754741 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.16s]
18:16:36.755609 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
18:16:36.761533 [debug] [MainThread]: Acquiring new redshift connection "master"
18:16:36.762398 [debug] [MainThread]: Using redshift connection "master"
18:16:36.762716 [debug] [MainThread]: On master: BEGIN
18:16:36.762981 [debug] [MainThread]: Opening a new connection, currently in state closed
18:16:36.763397 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:16:38.047269 [debug] [MainThread]: SQL status: BEGIN in 1.28 seconds
18:16:38.047731 [debug] [MainThread]: On master: COMMIT
18:16:38.048013 [debug] [MainThread]: Using redshift connection "master"
18:16:38.048236 [debug] [MainThread]: On master: COMMIT
18:16:38.363736 [debug] [MainThread]: SQL status: COMMIT in 0.32 seconds
18:16:38.365124 [debug] [MainThread]: On master: Close
18:16:38.367379 [info ] [MainThread]: 
18:16:38.368376 [info ] [MainThread]: Finished running 4 view models in 13.33s.
18:16:38.373068 [debug] [MainThread]: Connection 'master' was properly closed.
18:16:38.373610 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
18:16:38.387471 [info ] [MainThread]: 
18:16:38.387951 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
18:16:38.388319 [info ] [MainThread]: 
18:16:38.388616 [error] [MainThread]: [33mDatabase Error in model amplitude_event (models/amplitude/amplitude_event.sql)[0m
18:16:38.388904 [error] [MainThread]:   syntax error at or near "("
18:16:38.389175 [error] [MainThread]:   LINE 15:     (nullif(json_extract_path_text(event_properties,'classLe...
18:16:38.389435 [error] [MainThread]:                ^
18:16:38.389694 [error] [MainThread]:   compiled SQL at target/run/amplitude_event/models/amplitude/amplitude_event.sql
18:16:38.389973 [info ] [MainThread]: 
18:16:38.390251 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
18:16:38.390692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bf6940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c834f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dd52b0>]}


============================== 2022-07-11 18:18:24.367085 | f2b2971c-0461-43a5-a280-335f992147f9 ==============================
18:18:24.367101 [info ] [MainThread]: Running with dbt=1.1.1
18:18:24.367321 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:18:24.367388 [debug] [MainThread]: Tracking: tracking
18:18:24.384545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bdc7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c1afa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c1a640>]}
18:18:24.411412 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
18:18:24.411682 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
18:18:24.417636 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
18:18:24.425175 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
18:18:24.431473 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:18:24.434045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f2b2971c-0461-43a5-a280-335f992147f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d24c10>]}
18:18:24.436752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f2b2971c-0461-43a5-a280-335f992147f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c26b80>]}
18:18:24.436891 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:18:24.437018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2b2971c-0461-43a5-a280-335f992147f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d068e0>]}
18:18:24.437742 [info ] [MainThread]: 
18:18:24.437960 [debug] [MainThread]: Acquiring new redshift connection "master"
18:18:24.438423 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
18:18:24.443847 [debug] [ThreadPool]: Using redshift connection "list_dev"
18:18:24.443981 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
18:18:24.444052 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:18:24.444122 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:18:25.516793 [debug] [ThreadPool]: SQL status: SELECT in 1.07 seconds
18:18:25.524181 [debug] [ThreadPool]: On list_dev: Close
18:18:25.529029 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
18:18:25.544804 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:18:25.545163 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
18:18:25.545361 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:18:25.545561 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:18:26.528150 [debug] [ThreadPool]: SQL status: BEGIN in 0.98 seconds
18:18:26.529213 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:18:26.529630 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
18:18:26.648317 [debug] [ThreadPool]: SQL status: SELECT in 0.12 seconds
18:18:26.653706 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
18:18:26.753804 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
18:18:26.770382 [debug] [MainThread]: Using redshift connection "master"
18:18:26.770993 [debug] [MainThread]: On master: BEGIN
18:18:26.771247 [debug] [MainThread]: Opening a new connection, currently in state init
18:18:26.771590 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:18:27.758281 [debug] [MainThread]: SQL status: BEGIN in 0.99 seconds
18:18:27.759600 [debug] [MainThread]: Using redshift connection "master"
18:18:27.760107 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:18:27.941710 [debug] [MainThread]: SQL status: SELECT in 0.18 seconds
18:18:27.950145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2b2971c-0461-43a5-a280-335f992147f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d06610>]}
18:18:27.951622 [debug] [MainThread]: On master: ROLLBACK
18:18:28.056440 [debug] [MainThread]: Using redshift connection "master"
18:18:28.057325 [debug] [MainThread]: On master: BEGIN
18:18:28.257654 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
18:18:28.258484 [debug] [MainThread]: On master: COMMIT
18:18:28.259074 [debug] [MainThread]: Using redshift connection "master"
18:18:28.259455 [debug] [MainThread]: On master: COMMIT
18:18:28.367052 [debug] [MainThread]: SQL status: COMMIT in 0.11 seconds
18:18:28.368074 [debug] [MainThread]: On master: Close
18:18:28.370299 [info ] [MainThread]: Concurrency: 1 threads (target='test')
18:18:28.376637 [info ] [MainThread]: 
18:18:28.389060 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
18:18:28.389767 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
18:18:28.390779 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
18:18:28.391022 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
18:18:28.391260 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
18:18:28.397479 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
18:18:28.398492 [debug] [Thread-1  ]: finished collecting timing info
18:18:28.398700 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
18:18:28.422547 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
18:18:28.423262 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:18:28.423391 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:18:28.423499 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:18:28.423614 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:18:29.372125 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
18:18:29.373288 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:18:29.373763 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

18:18:29.477609 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:18:29.497700 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:18:29.498259 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
18:18:29.594892 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:18:29.601765 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:18:29.602398 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
18:18:29.701588 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:18:29.729648 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:18:29.730180 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:18:29.730371 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:18:29.859032 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:18:29.860963 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:18:29.861383 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:18:29.960722 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:18:29.978063 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:18:29.978639 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
18:18:30.081339 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:18:30.084509 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:18:30.084931 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:18:30.085354 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:18:30.211725 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:18:30.212677 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:18:30.213075 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:18:30.311404 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:18:30.313948 [debug] [Thread-1  ]: finished collecting timing info
18:18:30.314476 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
18:18:30.413702 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
18:18:30.416329 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2b2971c-0461-43a5-a280-335f992147f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e2bcd0>]}
18:18:30.417812 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.03s]
18:18:30.419411 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
18:18:30.423895 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
18:18:30.424519 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
18:18:30.425343 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
18:18:30.425574 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
18:18:30.425819 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
18:18:30.440042 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
18:18:30.443918 [debug] [Thread-1  ]: finished collecting timing info
18:18:30.444227 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
18:18:30.449562 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
18:18:30.451426 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:18:30.451751 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:18:30.451910 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:18:30.452074 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:18:31.409592 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
18:18:31.410668 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:18:31.411097 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
FROM "dev"."stg_amplitude"."event"
  ) ;

18:18:31.519500 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:18:31.529803 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:18:31.530513 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
18:18:31.626501 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:18:31.633943 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:18:31.634642 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
18:18:31.731331 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:18:31.736834 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:18:31.737379 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:18:31.737824 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:18:31.903582 [debug] [Thread-1  ]: SQL status: COMMIT in 0.17 seconds
18:18:31.904774 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:18:31.905162 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:18:32.028554 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:18:32.034596 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:18:32.035098 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
18:18:32.137967 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:18:32.140802 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:18:32.141243 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:18:32.141620 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:18:32.271928 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:18:32.272899 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:18:32.273595 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:18:32.372899 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:18:32.374873 [debug] [Thread-1  ]: finished collecting timing info
18:18:32.375381 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
18:18:32.472836 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
18:18:32.475275 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2b2971c-0461-43a5-a280-335f992147f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e20130>]}
18:18:32.476751 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.05s]
18:18:32.478308 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
18:18:32.483292 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
18:18:32.483895 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
18:18:32.484649 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
18:18:32.484881 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
18:18:32.485112 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
18:18:32.492065 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
18:18:32.495634 [debug] [Thread-1  ]: finished collecting timing info
18:18:32.496024 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
18:18:32.501342 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
18:18:32.503002 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:18:32.503392 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:18:32.503581 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:18:32.503812 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:18:33.446011 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
18:18:33.447334 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:18:33.447880 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

18:18:33.553809 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:18:33.564560 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:18:33.565297 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
18:18:33.663251 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:18:33.669778 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:18:33.670378 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
18:18:33.770153 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:18:33.775240 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:18:33.775943 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:18:33.776317 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:18:33.911712 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
18:18:33.912951 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:18:33.913341 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:18:34.014917 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:18:34.020740 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:18:34.021264 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
18:18:34.121641 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:18:34.124465 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:18:34.125087 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:18:34.125457 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:18:34.256585 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:18:34.257386 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:18:34.257766 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:18:34.356658 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:18:34.359389 [debug] [Thread-1  ]: finished collecting timing info
18:18:34.360689 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
18:18:34.464474 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
18:18:34.467706 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2b2971c-0461-43a5-a280-335f992147f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e0ddf0>]}
18:18:34.469199 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.98s]
18:18:34.470548 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
18:18:34.475835 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
18:18:34.476546 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
18:18:34.477300 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
18:18:34.477544 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
18:18:34.477778 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
18:18:34.492812 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
18:18:34.494053 [debug] [Thread-1  ]: finished collecting timing info
18:18:34.494296 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
18:18:34.500372 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
18:18:34.501480 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:18:34.501664 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:18:34.501821 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:18:34.501992 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:18:35.456893 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
18:18:35.457872 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:18:35.458263 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

18:18:35.576926 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
18:18:35.587242 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:18:35.587963 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
18:18:35.684196 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:18:35.689597 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:18:35.690027 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
18:18:35.789685 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:18:35.793847 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:18:35.794495 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:18:35.794862 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:18:35.933024 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
18:18:35.934166 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:18:35.934689 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:18:36.035773 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:18:36.042563 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:18:36.043356 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
18:18:36.143786 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:18:36.146910 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:18:36.147349 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:18:36.147566 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:18:36.277541 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:18:36.278428 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:18:36.278818 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:18:36.378776 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:18:36.381231 [debug] [Thread-1  ]: finished collecting timing info
18:18:36.381755 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
18:18:36.487626 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
18:18:36.490086 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2b2971c-0461-43a5-a280-335f992147f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107808e50>]}
18:18:36.491599 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.01s]
18:18:36.492984 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
18:18:36.499245 [debug] [MainThread]: Acquiring new redshift connection "master"
18:18:36.499804 [debug] [MainThread]: Using redshift connection "master"
18:18:36.499988 [debug] [MainThread]: On master: BEGIN
18:18:36.500163 [debug] [MainThread]: Opening a new connection, currently in state closed
18:18:36.500378 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:18:37.459830 [debug] [MainThread]: SQL status: BEGIN in 0.96 seconds
18:18:37.461229 [debug] [MainThread]: On master: COMMIT
18:18:37.461631 [debug] [MainThread]: Using redshift connection "master"
18:18:37.462038 [debug] [MainThread]: On master: COMMIT
18:18:37.561103 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:18:37.562991 [debug] [MainThread]: On master: Close
18:18:37.565375 [info ] [MainThread]: 
18:18:37.566306 [info ] [MainThread]: Finished running 4 view models in 13.13s.
18:18:37.572048 [debug] [MainThread]: Connection 'master' was properly closed.
18:18:37.572533 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
18:18:37.586297 [info ] [MainThread]: 
18:18:37.586953 [info ] [MainThread]: [32mCompleted successfully[0m
18:18:37.587453 [info ] [MainThread]: 
18:18:37.587831 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
18:18:37.588518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cef490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e0dc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e0d040>]}


============================== 2022-07-11 18:25:09.056616 | 5ed08e48-b000-484e-8457-9b45a9c9241e ==============================
18:25:09.056634 [info ] [MainThread]: Running with dbt=1.1.1
18:25:09.057021 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:25:09.057098 [debug] [MainThread]: Tracking: tracking
18:25:09.071004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112054f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112090f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120905e0>]}
18:25:09.095679 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
18:25:09.095973 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
18:25:09.101944 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
18:25:09.109897 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
18:25:09.116089 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:25:09.118579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ed08e48-b000-484e-8457-9b45a9c9241e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112197bb0>]}
18:25:09.121280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5ed08e48-b000-484e-8457-9b45a9c9241e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11209abb0>]}
18:25:09.121417 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:25:09.121546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5ed08e48-b000-484e-8457-9b45a9c9241e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11217ce20>]}
18:25:09.122228 [info ] [MainThread]: 
18:25:09.122431 [debug] [MainThread]: Acquiring new redshift connection "master"
18:25:09.122878 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
18:25:09.127963 [debug] [ThreadPool]: Using redshift connection "list_dev"
18:25:09.128040 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
18:25:09.128105 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:25:09.128172 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:25:10.179631 [debug] [ThreadPool]: SQL status: SELECT in 1.05 seconds
18:25:10.184976 [debug] [ThreadPool]: On list_dev: Close
18:25:10.188451 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
18:25:10.201400 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:25:10.201754 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
18:25:10.201916 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:25:10.202086 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:25:11.144747 [debug] [ThreadPool]: SQL status: BEGIN in 0.94 seconds
18:25:11.145669 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:25:11.145866 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
18:25:11.263453 [debug] [ThreadPool]: SQL status: SELECT in 0.12 seconds
18:25:11.267853 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
18:25:11.364899 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
18:25:11.376787 [debug] [MainThread]: Using redshift connection "master"
18:25:11.377352 [debug] [MainThread]: On master: BEGIN
18:25:11.377644 [debug] [MainThread]: Opening a new connection, currently in state init
18:25:11.378012 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:25:12.344948 [debug] [MainThread]: SQL status: BEGIN in 0.97 seconds
18:25:12.346138 [debug] [MainThread]: Using redshift connection "master"
18:25:12.346507 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:25:12.527798 [debug] [MainThread]: SQL status: SELECT in 0.18 seconds
18:25:12.531551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5ed08e48-b000-484e-8457-9b45a9c9241e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11217cc70>]}
18:25:12.532240 [debug] [MainThread]: On master: ROLLBACK
18:25:12.632031 [debug] [MainThread]: Using redshift connection "master"
18:25:12.633060 [debug] [MainThread]: On master: BEGIN
18:25:12.828449 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
18:25:12.828899 [debug] [MainThread]: On master: COMMIT
18:25:12.829076 [debug] [MainThread]: Using redshift connection "master"
18:25:12.829247 [debug] [MainThread]: On master: COMMIT
18:25:12.932907 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:25:12.933558 [debug] [MainThread]: On master: Close
18:25:12.934518 [info ] [MainThread]: Concurrency: 1 threads (target='test')
18:25:12.935109 [info ] [MainThread]: 
18:25:12.942884 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
18:25:12.943626 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
18:25:12.944569 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
18:25:12.944806 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
18:25:12.945031 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
18:25:12.949593 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
18:25:12.951991 [debug] [Thread-1  ]: finished collecting timing info
18:25:12.952342 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
18:25:12.967563 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
18:25:12.968345 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:25:12.968426 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:25:12.968485 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:25:12.968549 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:25:13.929833 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
18:25:13.930343 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:25:13.930568 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

18:25:14.035948 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:25:14.052469 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:25:14.052872 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
18:25:14.149203 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:25:14.156202 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:25:14.156940 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
18:25:14.253928 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:25:14.275585 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:25:14.276129 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:25:14.276333 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:25:14.459418 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
18:25:14.460932 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:25:14.461188 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:25:14.576540 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:25:14.587486 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:25:14.587810 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
18:25:14.688055 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:25:14.689983 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:25:14.690298 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:25:14.690550 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:25:14.821181 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:25:14.822008 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:25:14.822378 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:25:14.922728 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:25:14.925707 [debug] [Thread-1  ]: finished collecting timing info
18:25:14.926199 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
18:25:15.027722 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
18:25:15.029472 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5ed08e48-b000-484e-8457-9b45a9c9241e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11229fc70>]}
18:25:15.030051 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.09s]
18:25:15.030657 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
18:25:15.031041 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
18:25:15.031484 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
18:25:15.032869 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
18:25:15.033242 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
18:25:15.033501 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
18:25:15.040626 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
18:25:15.041634 [debug] [Thread-1  ]: finished collecting timing info
18:25:15.041874 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
18:25:15.045337 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
18:25:15.046390 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:25:15.046636 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:25:15.046833 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:25:15.047052 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:25:15.988788 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
18:25:15.991055 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:25:15.991482 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
  AS class_length
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
FROM "dev"."stg_amplitude"."event"
  ) ;

18:25:16.107193 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
18:25:16.116158 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:25:16.116688 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
18:25:16.213456 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:25:16.220108 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:25:16.220666 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
18:25:16.356156 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.14 seconds
18:25:16.359739 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:25:16.360187 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:25:16.360535 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:25:16.504475 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
18:25:16.506339 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:25:16.506672 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:25:16.634906 [debug] [Thread-1  ]: SQL status: BEGIN in 0.13 seconds
18:25:16.639909 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:25:16.640404 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
18:25:16.741953 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:25:16.744637 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:25:16.745113 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:25:16.745531 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:25:16.876298 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:25:16.877506 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:25:16.877899 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:25:16.977502 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:25:16.980203 [debug] [Thread-1  ]: finished collecting timing info
18:25:16.980700 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
18:25:17.085589 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
18:25:17.088095 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5ed08e48-b000-484e-8457-9b45a9c9241e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122930d0>]}
18:25:17.089696 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.06s]
18:25:17.098904 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
18:25:17.099343 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
18:25:17.099850 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
18:25:17.100438 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
18:25:17.100554 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
18:25:17.100657 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
18:25:17.103057 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
18:25:17.105887 [debug] [Thread-1  ]: finished collecting timing info
18:25:17.106631 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
18:25:17.111832 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
18:25:17.113344 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:25:17.113582 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:25:17.113771 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:25:17.114008 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:25:18.068271 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
18:25:18.069383 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:25:18.069844 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

18:25:18.175055 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:25:18.184265 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:25:18.184848 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
18:25:18.280174 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:25:18.286560 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:25:18.287022 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
18:25:18.385816 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:25:18.388326 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:25:18.388610 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:25:18.388779 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:25:18.516810 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:25:18.517592 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:25:18.518268 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:25:18.615802 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:25:18.620845 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:25:18.621401 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
18:25:18.720765 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:25:18.722630 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:25:18.722890 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:25:18.723098 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:25:18.852110 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:25:18.852552 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:25:18.852730 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:25:18.951036 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:25:18.952019 [debug] [Thread-1  ]: finished collecting timing info
18:25:18.952232 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
18:25:19.048300 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
18:25:19.049483 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5ed08e48-b000-484e-8457-9b45a9c9241e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112293190>]}
18:25:19.050165 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.95s]
18:25:19.050848 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
18:25:19.051476 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
18:25:19.051986 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
18:25:19.052974 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
18:25:19.053372 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
18:25:19.053726 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
18:25:19.063657 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
18:25:19.064593 [debug] [Thread-1  ]: finished collecting timing info
18:25:19.064804 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
18:25:19.070723 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
18:25:19.071150 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:25:19.071225 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:25:19.071286 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:25:19.071352 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:25:20.026222 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
18:25:20.026634 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:25:20.026895 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

18:25:20.142324 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
18:25:20.146617 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:25:20.146930 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
18:25:20.246843 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:25:20.254932 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:25:20.255476 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
18:25:20.352905 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:25:20.355736 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:25:20.356023 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:25:20.356193 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:25:20.487775 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:25:20.489343 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:25:20.489743 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:25:20.586403 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:25:20.589395 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:25:20.590142 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
18:25:20.691412 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:25:20.693208 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:25:20.695017 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:25:20.695367 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:25:20.825571 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:25:20.826006 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:25:20.826184 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:25:20.923514 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:25:20.924839 [debug] [Thread-1  ]: finished collecting timing info
18:25:20.925333 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
18:25:21.023277 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
18:25:21.024986 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5ed08e48-b000-484e-8457-9b45a9c9241e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112407850>]}
18:25:21.025925 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 1.97s]
18:25:21.026537 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
18:25:21.030026 [debug] [MainThread]: Acquiring new redshift connection "master"
18:25:21.030388 [debug] [MainThread]: Using redshift connection "master"
18:25:21.030557 [debug] [MainThread]: On master: BEGIN
18:25:21.030716 [debug] [MainThread]: Opening a new connection, currently in state closed
18:25:21.030897 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:25:21.968035 [debug] [MainThread]: SQL status: BEGIN in 0.94 seconds
18:25:21.969981 [debug] [MainThread]: On master: COMMIT
18:25:21.970351 [debug] [MainThread]: Using redshift connection "master"
18:25:21.970681 [debug] [MainThread]: On master: COMMIT
18:25:22.068732 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:25:22.069201 [debug] [MainThread]: On master: Close
18:25:22.072606 [info ] [MainThread]: 
18:25:22.074758 [info ] [MainThread]: Finished running 4 view models in 12.95s.
18:25:22.075268 [debug] [MainThread]: Connection 'master' was properly closed.
18:25:22.075554 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
18:25:22.086637 [info ] [MainThread]: 
18:25:22.087118 [info ] [MainThread]: [32mCompleted successfully[0m
18:25:22.087570 [info ] [MainThread]: 
18:25:22.087966 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
18:25:22.088466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112160430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112216f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112216b50>]}


============================== 2022-07-11 18:26:47.921136 | eb72513c-3cc3-44f5-b9db-be4ee67120ea ==============================
18:26:47.921154 [info ] [MainThread]: Running with dbt=1.1.1
18:26:47.921584 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:26:47.921663 [debug] [MainThread]: Tracking: tracking
18:26:47.941445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e289d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e52f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e525e0>]}
18:26:47.967090 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
18:26:47.967330 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
18:26:47.973102 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
18:26:47.980916 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
18:26:47.987436 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:26:47.990251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eb72513c-3cc3-44f5-b9db-be4ee67120ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105eeaa00>]}
18:26:47.993434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eb72513c-3cc3-44f5-b9db-be4ee67120ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e5cbb0>]}
18:26:47.993616 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:26:47.993752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb72513c-3cc3-44f5-b9db-be4ee67120ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f3ce20>]}
18:26:47.994516 [info ] [MainThread]: 
18:26:47.994750 [debug] [MainThread]: Acquiring new redshift connection "master"
18:26:47.995186 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
18:26:48.000436 [debug] [ThreadPool]: Using redshift connection "list_dev"
18:26:48.000520 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
18:26:48.000586 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:26:48.000656 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:26:49.165009 [debug] [ThreadPool]: SQL status: SELECT in 1.16 seconds
18:26:49.172863 [debug] [ThreadPool]: On list_dev: Close
18:26:49.179747 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
18:26:49.194684 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:26:49.195031 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
18:26:49.195223 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:26:49.195419 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:26:50.130978 [debug] [ThreadPool]: SQL status: BEGIN in 0.94 seconds
18:26:50.132444 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:26:50.132864 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
18:26:50.248048 [debug] [ThreadPool]: SQL status: SELECT in 0.11 seconds
18:26:50.254339 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
18:26:50.350811 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
18:26:50.367508 [debug] [MainThread]: Using redshift connection "master"
18:26:50.368079 [debug] [MainThread]: On master: BEGIN
18:26:50.368389 [debug] [MainThread]: Opening a new connection, currently in state init
18:26:50.368669 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:26:51.311583 [debug] [MainThread]: SQL status: BEGIN in 0.94 seconds
18:26:51.312661 [debug] [MainThread]: Using redshift connection "master"
18:26:51.313073 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:26:51.487017 [debug] [MainThread]: SQL status: SELECT in 0.17 seconds
18:26:51.490736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb72513c-3cc3-44f5-b9db-be4ee67120ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f3cca0>]}
18:26:51.491698 [debug] [MainThread]: On master: ROLLBACK
18:26:51.593604 [debug] [MainThread]: Using redshift connection "master"
18:26:51.594028 [debug] [MainThread]: On master: BEGIN
18:26:51.816122 [debug] [MainThread]: SQL status: BEGIN in 0.22 seconds
18:26:51.817062 [debug] [MainThread]: On master: COMMIT
18:26:51.817266 [debug] [MainThread]: Using redshift connection "master"
18:26:51.817461 [debug] [MainThread]: On master: COMMIT
18:26:51.914353 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:26:51.914817 [debug] [MainThread]: On master: Close
18:26:51.915547 [info ] [MainThread]: Concurrency: 1 threads (target='test')
18:26:51.916653 [info ] [MainThread]: 
18:26:51.924961 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
18:26:51.929021 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
18:26:51.930714 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
18:26:51.931001 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
18:26:51.931209 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
18:26:51.936772 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
18:26:51.938870 [debug] [Thread-1  ]: finished collecting timing info
18:26:51.939518 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
18:26:51.964555 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
18:26:51.971395 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:26:51.971514 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:26:51.971581 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:26:51.971681 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:26:52.915844 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
18:26:52.916386 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:26:52.916605 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

18:26:53.021396 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:26:53.036905 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:26:53.037287 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
18:26:53.134379 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:26:53.148895 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:26:53.150815 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
18:26:53.248345 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:26:53.278213 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:26:53.278584 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:26:53.278777 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:26:53.424955 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
18:26:53.426288 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:26:53.426724 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:26:53.524177 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:26:53.533633 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:26:53.534020 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
18:26:53.643398 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
18:26:53.645252 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:26:53.645567 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:26:53.645760 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:26:53.777757 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:26:53.778324 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:26:53.778536 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:26:53.876393 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:26:53.878220 [debug] [Thread-1  ]: finished collecting timing info
18:26:53.878564 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
18:26:53.974091 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
18:26:53.983094 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb72513c-3cc3-44f5-b9db-be4ee67120ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106060c70>]}
18:26:53.984265 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.05s]
18:26:53.986227 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
18:26:53.986781 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
18:26:53.987112 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
18:26:53.987952 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
18:26:53.988323 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
18:26:53.988510 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
18:26:53.994575 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
18:26:53.995745 [debug] [Thread-1  ]: finished collecting timing info
18:26:53.995879 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
18:26:53.997211 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
18:26:53.997633 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:26:53.997707 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:26:53.997766 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:26:53.997832 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:26:54.936025 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
18:26:54.938030 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:26:54.938347 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
  AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

18:26:55.046694 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:26:55.052884 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:26:55.053176 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
18:26:55.155272 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:26:55.164605 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:26:55.164932 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
18:26:55.266719 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:26:55.270608 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:26:55.270929 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:26:55.271159 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:26:55.411128 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
18:26:55.411864 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:26:55.412061 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:26:55.508565 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:26:55.515628 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:26:55.516351 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
18:26:55.615134 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:26:55.620993 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:26:55.621442 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:26:55.621635 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:26:55.747916 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:26:55.748516 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:26:55.748753 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:26:55.847958 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:26:55.850676 [debug] [Thread-1  ]: finished collecting timing info
18:26:55.851676 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
18:26:55.951434 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
18:26:55.953919 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb72513c-3cc3-44f5-b9db-be4ee67120ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106055100>]}
18:26:55.954655 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 1.97s]
18:26:55.955465 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
18:26:55.955820 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
18:26:55.959259 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
18:26:55.962135 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
18:26:55.963212 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
18:26:55.963478 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
18:26:55.970436 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
18:26:55.972134 [debug] [Thread-1  ]: finished collecting timing info
18:26:55.972455 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
18:26:55.977472 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
18:26:55.979222 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:26:55.979571 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:26:55.979764 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:26:55.979971 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:26:56.928017 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
18:26:56.928636 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:26:56.928886 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

18:26:57.052970 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
18:26:57.058725 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:26:57.059221 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
18:26:57.157568 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:26:57.163413 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:26:57.163971 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
18:26:57.263024 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:26:57.265739 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:26:57.266405 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:26:57.266598 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:26:57.402178 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
18:26:57.403214 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:26:57.403499 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:26:57.501446 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:26:57.504682 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:26:57.505023 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
18:26:57.602468 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:26:57.607212 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:26:57.610342 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:26:57.612290 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:26:57.736526 [debug] [Thread-1  ]: SQL status: COMMIT in 0.12 seconds
18:26:57.737023 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:26:57.737209 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:26:57.835713 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:26:57.836895 [debug] [Thread-1  ]: finished collecting timing info
18:26:57.837146 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
18:26:57.934121 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
18:26:57.935834 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb72513c-3cc3-44f5-b9db-be4ee67120ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106055100>]}
18:26:57.936455 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.98s]
18:26:57.937304 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
18:26:57.937782 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
18:26:57.938497 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
18:26:57.939493 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
18:26:57.939761 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
18:26:57.940011 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
18:26:57.961254 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
18:26:57.964301 [debug] [Thread-1  ]: finished collecting timing info
18:26:57.964668 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
18:26:57.970575 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
18:26:57.971333 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:26:57.971479 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:26:57.971600 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:26:57.971735 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:26:58.903055 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
18:26:58.903594 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:26:58.903850 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

18:26:59.024055 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
18:26:59.030351 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:26:59.030904 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
18:26:59.128054 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:26:59.136171 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:26:59.136548 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
18:26:59.233070 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:26:59.237518 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:26:59.238151 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:26:59.238376 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:26:59.384478 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
18:26:59.386750 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:26:59.387096 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:26:59.485962 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:26:59.493219 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:26:59.493784 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
18:26:59.595081 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:26:59.596544 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:26:59.596750 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:26:59.596932 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:26:59.725382 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:26:59.726497 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:26:59.726706 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:26:59.826570 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:26:59.828874 [debug] [Thread-1  ]: finished collecting timing info
18:26:59.829494 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
18:26:59.925506 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
18:26:59.928319 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb72513c-3cc3-44f5-b9db-be4ee67120ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060c8850>]}
18:26:59.930760 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 1.99s]
18:26:59.932371 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
18:26:59.937750 [debug] [MainThread]: Acquiring new redshift connection "master"
18:26:59.938392 [debug] [MainThread]: Using redshift connection "master"
18:26:59.938616 [debug] [MainThread]: On master: BEGIN
18:26:59.938824 [debug] [MainThread]: Opening a new connection, currently in state closed
18:26:59.939098 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:27:00.970303 [debug] [MainThread]: SQL status: BEGIN in 1.03 seconds
18:27:00.971534 [debug] [MainThread]: On master: COMMIT
18:27:00.971764 [debug] [MainThread]: Using redshift connection "master"
18:27:00.971984 [debug] [MainThread]: On master: COMMIT
18:27:01.068446 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:27:01.068958 [debug] [MainThread]: On master: Close
18:27:01.069904 [info ] [MainThread]: 
18:27:01.070353 [info ] [MainThread]: Finished running 4 view models in 13.08s.
18:27:01.070955 [debug] [MainThread]: Connection 'master' was properly closed.
18:27:01.071179 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
18:27:01.086399 [info ] [MainThread]: 
18:27:01.086968 [info ] [MainThread]: [32mCompleted successfully[0m
18:27:01.087359 [info ] [MainThread]: 
18:27:01.087696 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
18:27:01.088162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f22430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ffafd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ffa8b0>]}


============================== 2022-07-11 18:29:14.933753 | 1f4ca9df-7892-4a97-93d3-728791968929 ==============================
18:29:14.933772 [info ] [MainThread]: Running with dbt=1.1.1
18:29:14.933992 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:29:14.934058 [debug] [MainThread]: Tracking: tracking
18:29:14.953727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105267fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105291f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052915e0>]}
18:29:14.981387 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
18:29:14.981656 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
18:29:14.987720 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
18:29:14.996578 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
18:29:15.003052 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:29:15.005889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1f4ca9df-7892-4a97-93d3-728791968929', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053a3880>]}
18:29:15.009228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1f4ca9df-7892-4a97-93d3-728791968929', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10529bbb0>]}
18:29:15.009410 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:29:15.009546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f4ca9df-7892-4a97-93d3-728791968929', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10537ce20>]}
18:29:15.010321 [info ] [MainThread]: 
18:29:15.010554 [debug] [MainThread]: Acquiring new redshift connection "master"
18:29:15.011103 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
18:29:15.016511 [debug] [ThreadPool]: Using redshift connection "list_dev"
18:29:15.016613 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
18:29:15.016677 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:29:15.016751 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:29:16.143693 [debug] [ThreadPool]: SQL status: SELECT in 1.13 seconds
18:29:16.151009 [debug] [ThreadPool]: On list_dev: Close
18:29:16.156779 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
18:29:16.171970 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:29:16.172322 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
18:29:16.172514 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:29:16.172715 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:29:17.115638 [debug] [ThreadPool]: SQL status: BEGIN in 0.94 seconds
18:29:17.116988 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:29:17.117390 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
18:29:17.236512 [debug] [ThreadPool]: SQL status: SELECT in 0.12 seconds
18:29:17.242138 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
18:29:17.340284 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
18:29:17.357248 [debug] [MainThread]: Using redshift connection "master"
18:29:17.357786 [debug] [MainThread]: On master: BEGIN
18:29:17.357995 [debug] [MainThread]: Opening a new connection, currently in state init
18:29:17.358264 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:29:18.306073 [debug] [MainThread]: SQL status: BEGIN in 0.95 seconds
18:29:18.307717 [debug] [MainThread]: Using redshift connection "master"
18:29:18.308750 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:29:18.483708 [debug] [MainThread]: SQL status: SELECT in 0.17 seconds
18:29:18.491238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f4ca9df-7892-4a97-93d3-728791968929', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10537cca0>]}
18:29:18.492534 [debug] [MainThread]: On master: ROLLBACK
18:29:18.588887 [debug] [MainThread]: Using redshift connection "master"
18:29:18.590004 [debug] [MainThread]: On master: BEGIN
18:29:18.794382 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
18:29:18.795935 [debug] [MainThread]: On master: COMMIT
18:29:18.796399 [debug] [MainThread]: Using redshift connection "master"
18:29:18.796863 [debug] [MainThread]: On master: COMMIT
18:29:18.894367 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:29:18.895492 [debug] [MainThread]: On master: Close
18:29:18.897627 [info ] [MainThread]: Concurrency: 1 threads (target='test')
18:29:18.898568 [info ] [MainThread]: 
18:29:18.912962 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
18:29:18.914118 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
18:29:18.915080 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
18:29:18.915325 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
18:29:18.915582 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
18:29:18.920713 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
18:29:18.922701 [debug] [Thread-1  ]: finished collecting timing info
18:29:18.922946 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
18:29:18.947139 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
18:29:18.947711 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:29:18.947830 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:29:18.947933 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:29:18.948044 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:29:19.899561 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
18:29:19.901367 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:29:19.901946 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

18:29:20.004735 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:29:20.024104 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:29:20.024464 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
18:29:20.128607 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:29:20.136118 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:29:20.137123 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
18:29:20.233080 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:29:20.262129 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:29:20.262385 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:29:20.262558 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:29:20.390760 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:29:20.392707 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:29:20.393101 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:29:20.488236 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
18:29:20.502829 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:29:20.503313 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
18:29:20.598769 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:29:20.602306 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:29:20.602730 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:29:20.603087 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:29:20.730069 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:29:20.731464 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:29:20.731873 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:29:20.829917 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:29:20.833258 [debug] [Thread-1  ]: finished collecting timing info
18:29:20.833809 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
18:29:20.932201 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
18:29:20.936505 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f4ca9df-7892-4a97-93d3-728791968929', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054a0c70>]}
18:29:20.938201 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.02s]
18:29:20.939754 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
18:29:20.940732 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
18:29:20.941671 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
18:29:20.943807 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
18:29:20.944483 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
18:29:20.945220 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
18:29:20.957849 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
18:29:20.958938 [debug] [Thread-1  ]: finished collecting timing info
18:29:20.959161 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
18:29:20.962339 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
18:29:20.962971 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:29:20.963151 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:29:20.963311 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:29:20.963495 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:29:21.897259 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
18:29:21.897947 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:29:21.898316 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
  AS elapsed_time
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
FROM "dev"."stg_amplitude"."event"
  ) ;

18:29:22.012924 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:29:22.020499 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:29:22.021108 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
18:29:22.124794 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:29:22.132180 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:29:22.132834 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
18:29:22.233718 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:29:22.239262 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:29:22.239887 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:29:22.240243 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:29:22.369536 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:29:22.389000 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:29:22.389486 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:29:22.494404 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:29:22.502960 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:29:22.503302 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
18:29:22.604254 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:29:22.608284 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:29:22.608727 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:29:22.609110 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:29:22.743447 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:29:22.744041 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:29:22.744218 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:29:22.851157 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:29:22.853598 [debug] [Thread-1  ]: finished collecting timing info
18:29:22.853901 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
18:29:22.958003 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
18:29:22.959807 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f4ca9df-7892-4a97-93d3-728791968929', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054930d0>]}
18:29:22.960830 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.02s]
18:29:22.962719 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
18:29:22.964058 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
18:29:22.965068 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
18:29:22.967731 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
18:29:22.968271 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
18:29:22.968830 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
18:29:22.973944 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
18:29:22.975191 [debug] [Thread-1  ]: finished collecting timing info
18:29:22.975414 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
18:29:22.978365 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
18:29:22.979198 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:29:22.979381 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:29:22.979552 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:29:22.979776 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:29:23.949849 [debug] [Thread-1  ]: SQL status: BEGIN in 0.97 seconds
18:29:23.951179 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:29:23.951575 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

18:29:24.056107 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:29:24.066389 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:29:24.067055 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
18:29:24.164563 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:29:24.172226 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:29:24.172898 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
18:29:24.270269 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:29:24.274316 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:29:24.274816 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:29:24.274996 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:29:24.453901 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
18:29:24.457476 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:29:24.461227 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:29:24.578053 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:29:24.580620 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:29:24.580951 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
18:29:24.680483 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:29:24.682486 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:29:24.682697 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:29:24.682884 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:29:24.813182 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:29:24.813959 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:29:24.814335 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:29:24.915088 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:29:24.916513 [debug] [Thread-1  ]: finished collecting timing info
18:29:24.916743 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
18:29:25.029679 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
18:29:25.031139 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f4ca9df-7892-4a97-93d3-728791968929', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054930d0>]}
18:29:25.033520 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.07s]
18:29:25.040546 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
18:29:25.041522 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
18:29:25.042284 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
18:29:25.042928 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
18:29:25.043126 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
18:29:25.043310 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
18:29:25.058143 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
18:29:25.059319 [debug] [Thread-1  ]: finished collecting timing info
18:29:25.059455 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
18:29:25.061344 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
18:29:25.061766 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:29:25.061853 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:29:25.061919 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:29:25.061986 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:29:25.991258 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
18:29:25.992589 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:29:25.992995 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

18:29:26.109955 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
18:29:26.120136 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:29:26.120786 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
18:29:26.218728 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:29:26.226269 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:29:26.226909 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
18:29:26.323476 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:29:26.329566 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:29:26.330331 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:29:26.330706 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:29:26.469300 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
18:29:26.470465 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:29:26.470889 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:29:26.570770 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:29:26.576987 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:29:26.577529 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
18:29:26.678163 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:29:26.680906 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:29:26.681316 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:29:26.681719 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:29:26.809658 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:29:26.810364 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:29:26.810640 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:29:26.909959 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:29:26.912187 [debug] [Thread-1  ]: finished collecting timing info
18:29:26.912714 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
18:29:27.009637 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
18:29:27.012078 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f4ca9df-7892-4a97-93d3-728791968929', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105542c70>]}
18:29:27.013480 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 1.97s]
18:29:27.014782 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
18:29:27.022677 [debug] [MainThread]: Acquiring new redshift connection "master"
18:29:27.023245 [debug] [MainThread]: Using redshift connection "master"
18:29:27.023434 [debug] [MainThread]: On master: BEGIN
18:29:27.023618 [debug] [MainThread]: Opening a new connection, currently in state closed
18:29:27.023883 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:29:27.957567 [debug] [MainThread]: SQL status: BEGIN in 0.93 seconds
18:29:27.958990 [debug] [MainThread]: On master: COMMIT
18:29:27.959381 [debug] [MainThread]: Using redshift connection "master"
18:29:27.959780 [debug] [MainThread]: On master: COMMIT
18:29:28.057805 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:29:28.059478 [debug] [MainThread]: On master: Close
18:29:28.061822 [info ] [MainThread]: 
18:29:28.062781 [info ] [MainThread]: Finished running 4 view models in 13.05s.
18:29:28.063451 [debug] [MainThread]: Connection 'master' was properly closed.
18:29:28.069112 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
18:29:28.084002 [info ] [MainThread]: 
18:29:28.084786 [info ] [MainThread]: [32mCompleted successfully[0m
18:29:28.085201 [info ] [MainThread]: 
18:29:28.085671 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
18:29:28.086173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105361430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10550f100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10543c790>]}


============================== 2022-07-11 18:30:44.135487 | c54fbdc7-9f42-448c-8e8b-d823deb6ab62 ==============================
18:30:44.135502 [info ] [MainThread]: Running with dbt=1.1.1
18:30:44.135920 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:30:44.135992 [debug] [MainThread]: Tracking: tracking
18:30:44.153249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b84f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106be9fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106be9610>]}
18:30:44.177497 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
18:30:44.177723 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
18:30:44.183484 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
18:30:44.191750 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
18:30:44.197668 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:30:44.200278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c54fbdc7-9f42-448c-8e8b-d823deb6ab62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cc3c70>]}
18:30:44.203139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c54fbdc7-9f42-448c-8e8b-d823deb6ab62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bf4be0>]}
18:30:44.203286 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:30:44.203410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c54fbdc7-9f42-448c-8e8b-d823deb6ab62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c9ceb0>]}
18:30:44.204101 [info ] [MainThread]: 
18:30:44.204319 [debug] [MainThread]: Acquiring new redshift connection "master"
18:30:44.204725 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
18:30:44.209733 [debug] [ThreadPool]: Using redshift connection "list_dev"
18:30:44.209809 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
18:30:44.209872 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:30:44.209934 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:30:45.308097 [debug] [ThreadPool]: SQL status: SELECT in 1.1 seconds
18:30:45.314909 [debug] [ThreadPool]: On list_dev: Close
18:30:45.318937 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
18:30:45.334357 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:30:45.334685 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
18:30:45.334871 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:30:45.335067 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:30:46.294090 [debug] [ThreadPool]: SQL status: BEGIN in 0.96 seconds
18:30:46.295249 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:30:46.295457 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
18:30:46.462592 [debug] [ThreadPool]: SQL status: SELECT in 0.17 seconds
18:30:46.467643 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
18:30:46.589345 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
18:30:46.605686 [debug] [MainThread]: Using redshift connection "master"
18:30:46.606221 [debug] [MainThread]: On master: BEGIN
18:30:46.606436 [debug] [MainThread]: Opening a new connection, currently in state init
18:30:46.606701 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:30:47.570778 [debug] [MainThread]: SQL status: BEGIN in 0.96 seconds
18:30:47.572202 [debug] [MainThread]: Using redshift connection "master"
18:30:47.572610 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:30:47.950818 [debug] [MainThread]: SQL status: SELECT in 0.38 seconds
18:30:47.954186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c54fbdc7-9f42-448c-8e8b-d823deb6ab62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c9cdc0>]}
18:30:47.954745 [debug] [MainThread]: On master: ROLLBACK
18:30:48.052553 [debug] [MainThread]: Using redshift connection "master"
18:30:48.053797 [debug] [MainThread]: On master: BEGIN
18:30:48.252677 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
18:30:48.253700 [debug] [MainThread]: On master: COMMIT
18:30:48.254204 [debug] [MainThread]: Using redshift connection "master"
18:30:48.259474 [debug] [MainThread]: On master: COMMIT
18:30:48.358213 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:30:48.359047 [debug] [MainThread]: On master: Close
18:30:48.360384 [info ] [MainThread]: Concurrency: 1 threads (target='test')
18:30:48.361101 [info ] [MainThread]: 
18:30:48.369174 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
18:30:48.369808 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
18:30:48.370685 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
18:30:48.371035 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
18:30:48.371344 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
18:30:48.376987 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
18:30:48.378361 [debug] [Thread-1  ]: finished collecting timing info
18:30:48.378610 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
18:30:48.408198 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
18:30:48.409153 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:30:48.409371 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:30:48.409495 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:30:48.409619 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:30:49.365436 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
18:30:49.366662 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:30:49.367079 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

18:30:49.474485 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:30:49.493930 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:30:49.494494 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
18:30:49.595895 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:30:49.602504 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:30:49.603101 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
18:30:49.699195 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:30:49.723235 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:30:49.723782 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:30:49.723991 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:30:50.411438 [debug] [Thread-1  ]: SQL status: COMMIT in 0.69 seconds
18:30:50.420963 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:30:50.421340 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:30:50.533788 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:30:50.552385 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:30:50.552852 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
18:30:50.692310 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.14 seconds
18:30:50.693690 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:30:50.693898 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:30:50.694119 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:30:50.848739 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
18:30:50.849744 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:30:50.850129 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:30:50.973946 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:30:50.976748 [debug] [Thread-1  ]: finished collecting timing info
18:30:50.977248 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
18:30:51.074768 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
18:30:51.077225 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c54fbdc7-9f42-448c-8e8b-d823deb6ab62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ef0fa0>]}
18:30:51.078612 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.71s]
18:30:51.080312 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
18:30:51.087476 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
18:30:51.088458 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
18:30:51.090019 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
18:30:51.092620 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
18:30:51.092886 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
18:30:51.104901 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
18:30:51.109508 [debug] [Thread-1  ]: finished collecting timing info
18:30:51.109928 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
18:30:51.112529 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
18:30:51.114011 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:30:51.114160 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:30:51.114284 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:30:51.114422 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:30:52.069975 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
18:30:52.070456 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:30:52.070796 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
FROM "dev"."stg_amplitude"."event"
  ) ;

18:30:52.192327 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
18:30:52.202413 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:30:52.202941 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
18:30:52.301406 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:30:52.308015 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:30:52.308582 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
18:30:52.409013 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:30:52.416152 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:30:52.417721 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:30:52.418002 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:30:52.578360 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:30:52.579483 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:30:52.579787 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:30:52.696788 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:30:52.702037 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:30:52.702657 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
18:30:52.808997 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
18:30:52.810982 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:30:52.811264 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:30:52.811442 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:30:52.969844 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:30:52.970732 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:30:52.970936 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:30:53.088556 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:30:53.090264 [debug] [Thread-1  ]: finished collecting timing info
18:30:53.090700 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
18:30:53.195591 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
18:30:53.196897 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c54fbdc7-9f42-448c-8e8b-d823deb6ab62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ed5280>]}
18:30:53.197589 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.11s]
18:30:53.198494 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
18:30:53.201002 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
18:30:53.201823 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
18:30:53.203550 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
18:30:53.203787 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
18:30:53.203972 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
18:30:53.210595 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
18:30:53.213454 [debug] [Thread-1  ]: finished collecting timing info
18:30:53.213716 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
18:30:53.218549 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
18:30:53.220048 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:30:53.220269 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:30:53.220466 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:30:53.220687 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:30:54.185397 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
18:30:54.186760 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:30:54.187172 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

18:30:54.296871 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:30:54.307365 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:30:54.308128 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
18:30:54.408924 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:30:54.415555 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:30:54.415986 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
18:30:54.517639 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:30:54.523336 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:30:54.523793 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:30:54.524152 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:30:54.679835 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:30:54.682787 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:30:54.683203 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:30:54.797668 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:30:54.809711 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:30:54.811327 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
18:30:54.914747 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:30:54.918727 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:30:54.919236 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:30:54.919611 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:30:55.076583 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:30:55.077399 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:30:55.077776 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:30:55.190362 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:30:55.196216 [debug] [Thread-1  ]: finished collecting timing info
18:30:55.196914 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
18:30:55.295034 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
18:30:55.296196 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c54fbdc7-9f42-448c-8e8b-d823deb6ab62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e4dee0>]}
18:30:55.297431 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.09s]
18:30:55.298781 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
18:30:55.299866 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
18:30:55.302357 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
18:30:55.305879 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
18:30:55.306551 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
18:30:55.306798 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
18:30:55.321983 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
18:30:55.325425 [debug] [Thread-1  ]: finished collecting timing info
18:30:55.325722 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
18:30:55.330047 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
18:30:55.330931 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:30:55.331058 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:30:55.331158 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:30:55.331275 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:30:56.285207 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
18:30:56.288084 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:30:56.288658 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

18:30:56.412625 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
18:30:56.421594 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:30:56.422238 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
18:30:56.520128 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:30:56.525877 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:30:56.526362 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
18:30:56.629956 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:30:56.635646 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:30:56.636229 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:30:56.636411 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:30:56.764211 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:30:56.766331 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:30:56.766762 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:30:56.861510 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
18:30:56.869024 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:30:56.869721 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
18:30:56.969906 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:30:56.973775 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:30:56.974762 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:30:56.975040 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:30:57.104938 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:30:57.106484 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:30:57.106897 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:30:57.213912 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:30:57.216569 [debug] [Thread-1  ]: finished collecting timing info
18:30:57.217054 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
18:30:57.318030 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
18:30:57.320560 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c54fbdc7-9f42-448c-8e8b-d823deb6ab62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110847880>]}
18:30:57.322676 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.01s]
18:30:57.324225 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
18:30:57.329206 [debug] [MainThread]: Acquiring new redshift connection "master"
18:30:57.330023 [debug] [MainThread]: Using redshift connection "master"
18:30:57.330424 [debug] [MainThread]: On master: BEGIN
18:30:57.330703 [debug] [MainThread]: Opening a new connection, currently in state closed
18:30:57.331043 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:30:58.269309 [debug] [MainThread]: SQL status: BEGIN in 0.94 seconds
18:30:58.269757 [debug] [MainThread]: On master: COMMIT
18:30:58.269932 [debug] [MainThread]: Using redshift connection "master"
18:30:58.270125 [debug] [MainThread]: On master: COMMIT
18:30:58.370391 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:30:58.371847 [debug] [MainThread]: On master: Close
18:30:58.374323 [info ] [MainThread]: 
18:30:58.375312 [info ] [MainThread]: Finished running 4 view models in 14.17s.
18:30:58.375650 [debug] [MainThread]: Connection 'master' was properly closed.
18:30:58.375814 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
18:30:58.391485 [info ] [MainThread]: 
18:30:58.391789 [info ] [MainThread]: [32mCompleted successfully[0m
18:30:58.391987 [info ] [MainThread]: 
18:30:58.392137 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
18:30:58.392427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110847880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e79ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e798e0>]}


============================== 2022-07-11 18:43:25.034183 | 4f7adb23-6a5c-4194-a212-c02dbfe1ccff ==============================
18:43:25.034201 [info ] [MainThread]: Running with dbt=1.1.1
18:43:25.034628 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:43:25.034697 [debug] [MainThread]: Tracking: tracking
18:43:25.060124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104680e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046dbe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046db4f0>]}
18:43:25.088398 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
18:43:25.088702 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
18:43:25.094929 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
18:43:25.103671 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
18:43:25.110494 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:43:25.113287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4f7adb23-6a5c-4194-a212-c02dbfe1ccff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047b6ca0>]}
18:43:25.116301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4f7adb23-6a5c-4194-a212-c02dbfe1ccff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104708a90>]}
18:43:25.116454 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:43:25.116584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f7adb23-6a5c-4194-a212-c02dbfe1ccff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104790ee0>]}
18:43:25.117339 [info ] [MainThread]: 
18:43:25.117573 [debug] [MainThread]: Acquiring new redshift connection "master"
18:43:25.118056 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
18:43:25.123668 [debug] [ThreadPool]: Using redshift connection "list_dev"
18:43:25.123802 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
18:43:25.123873 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:43:25.123947 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:43:26.386496 [debug] [ThreadPool]: SQL status: SELECT in 1.26 seconds
18:43:26.390233 [debug] [ThreadPool]: On list_dev: Close
18:43:26.393519 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
18:43:26.411030 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:43:26.411876 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
18:43:26.412065 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:43:26.412535 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:43:27.378314 [debug] [ThreadPool]: SQL status: BEGIN in 0.97 seconds
18:43:27.378751 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:43:27.378934 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
18:43:27.497736 [debug] [ThreadPool]: SQL status: SELECT in 0.12 seconds
18:43:27.500599 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
18:43:27.597266 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
18:43:27.607073 [debug] [MainThread]: Using redshift connection "master"
18:43:27.607592 [debug] [MainThread]: On master: BEGIN
18:43:27.607792 [debug] [MainThread]: Opening a new connection, currently in state init
18:43:27.607989 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:43:28.551700 [debug] [MainThread]: SQL status: BEGIN in 0.94 seconds
18:43:28.552121 [debug] [MainThread]: Using redshift connection "master"
18:43:28.552339 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:43:28.727323 [debug] [MainThread]: SQL status: SELECT in 0.17 seconds
18:43:28.730858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f7adb23-6a5c-4194-a212-c02dbfe1ccff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047ad130>]}
18:43:28.733028 [debug] [MainThread]: On master: ROLLBACK
18:43:28.834122 [debug] [MainThread]: Using redshift connection "master"
18:43:28.834582 [debug] [MainThread]: On master: BEGIN
18:43:29.031195 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
18:43:29.031996 [debug] [MainThread]: On master: COMMIT
18:43:29.032417 [debug] [MainThread]: Using redshift connection "master"
18:43:29.032595 [debug] [MainThread]: On master: COMMIT
18:43:29.131913 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:43:29.133020 [debug] [MainThread]: On master: Close
18:43:29.135296 [info ] [MainThread]: Concurrency: 1 threads (target='test')
18:43:29.136480 [info ] [MainThread]: 
18:43:29.158094 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
18:43:29.158629 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
18:43:29.159260 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
18:43:29.159506 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
18:43:29.159737 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
18:43:29.164522 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
18:43:29.165654 [debug] [Thread-1  ]: finished collecting timing info
18:43:29.165864 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
18:43:29.192205 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
18:43:29.193024 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:43:29.193233 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:43:29.193361 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:43:29.193500 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:43:30.137674 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
18:43:30.138724 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:43:30.139305 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

18:43:30.244597 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:43:30.259250 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:43:30.260266 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
18:43:30.357502 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:43:30.361798 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:43:30.362179 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
18:43:30.463502 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:43:30.490871 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:43:30.491243 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:43:30.492397 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:43:30.627563 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:43:30.628469 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:43:30.628855 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:43:30.735456 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:43:30.744775 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:43:30.745100 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
18:43:30.841238 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:43:30.842856 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:43:30.843055 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:43:30.843245 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:43:30.970775 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:43:30.971425 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:43:30.971672 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:43:31.070481 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:43:31.071638 [debug] [Thread-1  ]: finished collecting timing info
18:43:31.071885 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
18:43:31.169451 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
18:43:31.170703 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f7adb23-6a5c-4194-a212-c02dbfe1ccff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048b59a0>]}
18:43:31.171471 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.01s]
18:43:31.172080 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
18:43:31.172321 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
18:43:31.172584 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
18:43:31.174588 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
18:43:31.175425 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
18:43:31.175642 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
18:43:31.188945 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
18:43:31.189970 [debug] [Thread-1  ]: finished collecting timing info
18:43:31.190185 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
18:43:31.195090 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
18:43:31.195913 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:43:31.196005 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:43:31.196073 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:43:31.196221 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:43:32.135349 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
18:43:32.136564 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:43:32.136977 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason

        , NULLIF(
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT,null) 
        AS elapsed_time
        ,NULLIF( 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT,null) 
        AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

18:43:32.249619 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:43:32.256123 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:43:32.256652 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
18:43:32.354764 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:43:32.362114 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:43:32.362751 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
18:43:32.460744 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:43:32.466070 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:43:32.466534 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:43:32.466793 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:43:32.601687 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:43:32.602716 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:43:32.603100 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:43:32.701779 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:43:32.704963 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:43:32.705250 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
18:43:32.804941 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:43:32.808198 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:43:32.808735 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:43:32.809074 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:43:32.970705 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:43:32.972284 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:43:32.972815 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:43:33.088935 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:43:33.091641 [debug] [Thread-1  ]: finished collecting timing info
18:43:33.092175 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
18:43:33.189932 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
18:43:33.192662 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f7adb23-6a5c-4194-a212-c02dbfe1ccff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048a80a0>]}
18:43:33.194249 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.02s]
18:43:33.196992 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
18:43:33.198430 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
18:43:33.199324 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
18:43:33.200899 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
18:43:33.202189 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
18:43:33.204053 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
18:43:33.212940 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
18:43:33.214779 [debug] [Thread-1  ]: finished collecting timing info
18:43:33.215188 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
18:43:33.218690 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
18:43:33.219392 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:43:33.219583 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:43:33.219751 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:43:33.219935 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:43:34.190062 [debug] [Thread-1  ]: SQL status: BEGIN in 0.97 seconds
18:43:34.191190 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:43:34.191581 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

18:43:34.296104 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:43:34.304793 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:43:34.305371 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
18:43:34.403147 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:43:34.409884 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:43:34.410310 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
18:43:34.510893 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:43:34.512972 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:43:34.513259 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:43:34.513431 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:43:34.669056 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:43:34.670104 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:43:34.670478 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:43:34.785303 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:43:34.788519 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:43:34.789016 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
18:43:34.906118 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.12 seconds
18:43:34.907828 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:43:34.908140 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:43:34.908320 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:43:35.038456 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:43:35.039684 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:43:35.039931 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:43:35.143287 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:43:35.145543 [debug] [Thread-1  ]: finished collecting timing info
18:43:35.145993 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
18:43:35.247110 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
18:43:35.249551 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f7adb23-6a5c-4194-a212-c02dbfe1ccff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048b59a0>]}
18:43:35.250231 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.05s]
18:43:35.251723 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
18:43:35.253892 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
18:43:35.257334 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
18:43:35.258504 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
18:43:35.259137 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
18:43:35.259508 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
18:43:35.275155 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
18:43:35.276276 [debug] [Thread-1  ]: finished collecting timing info
18:43:35.276474 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
18:43:35.280964 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
18:43:35.282333 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:43:35.282508 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:43:35.282635 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:43:35.282763 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:43:36.270150 [debug] [Thread-1  ]: SQL status: BEGIN in 0.99 seconds
18:43:36.270890 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:43:36.271260 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

18:43:36.390325 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
18:43:36.399735 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:43:36.400356 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
18:43:36.497342 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:43:36.505479 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:43:36.506151 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
18:43:36.608642 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:43:36.612481 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:43:36.612865 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:43:36.613039 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:43:36.750671 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
18:43:36.752477 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:43:36.752927 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:43:36.860804 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:43:36.867307 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:43:36.867806 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
18:43:36.970269 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:43:36.974075 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:43:36.974616 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:43:36.974888 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:43:37.101635 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:43:37.103002 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:43:37.103403 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:43:37.208975 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:43:37.210472 [debug] [Thread-1  ]: finished collecting timing info
18:43:37.210897 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
18:43:37.316687 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
18:43:37.319180 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f7adb23-6a5c-4194-a212-c02dbfe1ccff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b4a790>]}
18:43:37.320842 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.06s]
18:43:37.322149 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
18:43:37.328434 [debug] [MainThread]: Acquiring new redshift connection "master"
18:43:37.329040 [debug] [MainThread]: Using redshift connection "master"
18:43:37.329251 [debug] [MainThread]: On master: BEGIN
18:43:37.329448 [debug] [MainThread]: Opening a new connection, currently in state closed
18:43:37.329712 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:43:38.288658 [debug] [MainThread]: SQL status: BEGIN in 0.96 seconds
18:43:38.290432 [debug] [MainThread]: On master: COMMIT
18:43:38.290818 [debug] [MainThread]: Using redshift connection "master"
18:43:38.291573 [debug] [MainThread]: On master: COMMIT
18:43:38.392728 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:43:38.393675 [debug] [MainThread]: On master: Close
18:43:38.395701 [info ] [MainThread]: 
18:43:38.396649 [info ] [MainThread]: Finished running 4 view models in 13.28s.
18:43:38.398873 [debug] [MainThread]: Connection 'master' was properly closed.
18:43:38.399530 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
18:43:38.423411 [info ] [MainThread]: 
18:43:38.423944 [info ] [MainThread]: [32mCompleted successfully[0m
18:43:38.424335 [info ] [MainThread]: 
18:43:38.424641 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
18:43:38.425076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104777310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104836ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104836a30>]}


============================== 2022-07-11 18:47:28.176554 | e6162ee7-c497-460f-b59d-51da2eb901bc ==============================
18:47:28.176568 [info ] [MainThread]: Running with dbt=1.1.1
18:47:28.176990 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:47:28.177063 [debug] [MainThread]: Tracking: tracking
18:47:28.192292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f93070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f936a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f93460>]}
18:47:28.217762 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
18:47:28.218040 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
18:47:28.224120 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
18:47:28.233228 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
18:47:28.239419 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:47:28.241893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e6162ee7-c497-460f-b59d-51da2eb901bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106074dc0>]}
18:47:28.244611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e6162ee7-c497-460f-b59d-51da2eb901bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fa1c10>]}
18:47:28.244752 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:47:28.244873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e6162ee7-c497-460f-b59d-51da2eb901bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106040df0>]}
18:47:28.245571 [info ] [MainThread]: 
18:47:28.245774 [debug] [MainThread]: Acquiring new redshift connection "master"
18:47:28.246174 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
18:47:28.251332 [debug] [ThreadPool]: Using redshift connection "list_dev"
18:47:28.251441 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
18:47:28.251512 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:47:28.251588 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:47:29.303090 [debug] [ThreadPool]: SQL status: SELECT in 1.05 seconds
18:47:29.311136 [debug] [ThreadPool]: On list_dev: Close
18:47:29.315535 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
18:47:29.329598 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:47:29.329963 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
18:47:29.330153 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:47:29.330350 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:47:30.274047 [debug] [ThreadPool]: SQL status: BEGIN in 0.94 seconds
18:47:30.275258 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:47:30.275655 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
18:47:30.393938 [debug] [ThreadPool]: SQL status: SELECT in 0.12 seconds
18:47:30.399690 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
18:47:30.498170 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
18:47:30.514989 [debug] [MainThread]: Using redshift connection "master"
18:47:30.515552 [debug] [MainThread]: On master: BEGIN
18:47:30.515785 [debug] [MainThread]: Opening a new connection, currently in state init
18:47:30.516061 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:47:31.478879 [debug] [MainThread]: SQL status: BEGIN in 0.96 seconds
18:47:31.480207 [debug] [MainThread]: Using redshift connection "master"
18:47:31.480675 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:47:31.659841 [debug] [MainThread]: SQL status: SELECT in 0.18 seconds
18:47:31.667594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e6162ee7-c497-460f-b59d-51da2eb901bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fc9130>]}
18:47:31.669113 [debug] [MainThread]: On master: ROLLBACK
18:47:31.766129 [debug] [MainThread]: Using redshift connection "master"
18:47:31.766993 [debug] [MainThread]: On master: BEGIN
18:47:31.973295 [debug] [MainThread]: SQL status: BEGIN in 0.21 seconds
18:47:31.974327 [debug] [MainThread]: On master: COMMIT
18:47:31.974793 [debug] [MainThread]: Using redshift connection "master"
18:47:31.975341 [debug] [MainThread]: On master: COMMIT
18:47:32.073824 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:47:32.074823 [debug] [MainThread]: On master: Close
18:47:32.076972 [info ] [MainThread]: Concurrency: 1 threads (target='test')
18:47:32.077843 [info ] [MainThread]: 
18:47:32.097534 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
18:47:32.098624 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
18:47:32.099604 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
18:47:32.099847 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
18:47:32.100171 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
18:47:32.105537 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
18:47:32.106500 [debug] [Thread-1  ]: finished collecting timing info
18:47:32.106699 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
18:47:32.132436 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
18:47:32.132929 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:47:32.133053 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:47:32.133154 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:47:32.133270 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:47:33.074715 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
18:47:33.075894 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:47:33.076297 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

18:47:33.183921 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:47:33.206100 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:47:33.206784 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
18:47:33.305914 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:47:33.315695 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:47:33.316298 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
18:47:33.413378 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:47:33.439324 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:47:33.439667 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:47:33.439862 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:47:33.572255 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:47:33.573852 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:47:33.574415 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:47:33.679933 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:47:33.695746 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:47:33.696283 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
18:47:33.794978 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:47:33.799948 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:47:33.800802 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:47:33.801192 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:47:33.931931 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:47:33.933727 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:47:33.934032 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:47:34.029452 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:47:34.031384 [debug] [Thread-1  ]: finished collecting timing info
18:47:34.031854 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
18:47:34.129003 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
18:47:34.131677 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e6162ee7-c497-460f-b59d-51da2eb901bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106170d30>]}
18:47:34.133295 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.03s]
18:47:34.134757 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
18:47:34.139609 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
18:47:34.140245 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
18:47:34.140987 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
18:47:34.141202 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
18:47:34.141423 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
18:47:34.156679 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
18:47:34.157535 [debug] [Thread-1  ]: finished collecting timing info
18:47:34.157862 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
18:47:34.161129 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
18:47:34.161901 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:47:34.162118 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:47:34.162286 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:47:34.162471 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:47:35.125779 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
18:47:35.127006 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:47:35.127394 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
 IS NULL
    THEN NULL
    ELSE 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
  END AS elapsed_time
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
IS NULL
    THEN NULL
    ELSE 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT
  END AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

18:47:35.240775 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:47:35.252618 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:47:35.253424 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
18:47:35.354301 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:47:35.361881 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:47:35.362477 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
18:47:35.469510 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.11 seconds
18:47:35.475298 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:47:35.475910 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:47:35.476197 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:47:35.614323 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
18:47:35.615842 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:47:35.616245 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:47:35.722304 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:47:35.729549 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:47:35.730142 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
18:47:35.829295 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:47:35.833439 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:47:35.834315 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:47:35.834723 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:47:36.014415 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
18:47:36.015350 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:47:36.015890 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:47:36.131333 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:47:36.134022 [debug] [Thread-1  ]: finished collecting timing info
18:47:36.134648 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
18:47:36.239903 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
18:47:36.244336 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e6162ee7-c497-460f-b59d-51da2eb901bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061641c0>]}
18:47:36.246490 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.10s]
18:47:36.253084 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
18:47:36.254072 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
18:47:36.254713 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
18:47:36.258667 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
18:47:36.258906 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
18:47:36.259120 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
18:47:36.264997 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
18:47:36.267902 [debug] [Thread-1  ]: finished collecting timing info
18:47:36.268613 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
18:47:36.274956 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
18:47:36.275849 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:47:36.276023 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:47:36.276165 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:47:36.276325 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:47:37.220781 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
18:47:37.222844 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:47:37.223294 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

18:47:37.327368 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:47:37.338622 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:47:37.339290 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
18:47:37.443841 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:47:37.453417 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:47:37.454286 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
18:47:37.549916 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:47:37.554115 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:47:37.555461 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:47:37.555877 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:47:37.700439 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
18:47:37.702480 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:47:37.702865 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:47:37.801217 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:47:37.808645 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:47:37.809270 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
18:47:37.908319 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:47:37.910471 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:47:37.910681 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:47:37.910863 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:47:38.039257 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:47:38.040375 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:47:38.040760 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:47:38.139880 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:47:38.142019 [debug] [Thread-1  ]: finished collecting timing info
18:47:38.142456 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
18:47:38.239801 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
18:47:38.242293 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e6162ee7-c497-460f-b59d-51da2eb901bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061641c0>]}
18:47:38.244015 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.98s]
18:47:38.245853 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
18:47:38.246675 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
18:47:38.252237 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
18:47:38.253180 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
18:47:38.253445 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
18:47:38.253825 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
18:47:38.269622 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
18:47:38.270699 [debug] [Thread-1  ]: finished collecting timing info
18:47:38.270922 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
18:47:38.275582 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
18:47:38.276483 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:47:38.276634 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:47:38.276764 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:47:38.276912 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:47:39.223251 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
18:47:39.224449 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:47:39.224871 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

18:47:39.337920 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:47:39.349482 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:47:39.350155 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
18:47:39.451183 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:47:39.459481 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:47:39.460155 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
18:47:39.557640 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:47:39.563400 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:47:39.564112 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:47:39.564486 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:47:39.727105 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:47:39.728446 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:47:39.729046 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:47:39.850763 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:47:39.859778 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:47:39.860478 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
18:47:39.960955 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:47:39.964449 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:47:39.964997 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:47:39.965377 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:47:40.139786 [debug] [Thread-1  ]: SQL status: COMMIT in 0.17 seconds
18:47:40.140553 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:47:40.140964 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:47:40.256927 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:47:40.259393 [debug] [Thread-1  ]: finished collecting timing info
18:47:40.260107 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
18:47:40.363500 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
18:47:40.366317 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e6162ee7-c497-460f-b59d-51da2eb901bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106154fa0>]}
18:47:40.367848 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.11s]
18:47:40.369083 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
18:47:40.375846 [debug] [MainThread]: Acquiring new redshift connection "master"
18:47:40.376403 [debug] [MainThread]: Using redshift connection "master"
18:47:40.376581 [debug] [MainThread]: On master: BEGIN
18:47:40.376753 [debug] [MainThread]: Opening a new connection, currently in state closed
18:47:40.376960 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:47:41.306284 [debug] [MainThread]: SQL status: BEGIN in 0.93 seconds
18:47:41.307727 [debug] [MainThread]: On master: COMMIT
18:47:41.308161 [debug] [MainThread]: Using redshift connection "master"
18:47:41.308640 [debug] [MainThread]: On master: COMMIT
18:47:41.405765 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:47:41.406874 [debug] [MainThread]: On master: Close
18:47:41.409708 [info ] [MainThread]: 
18:47:41.410868 [info ] [MainThread]: Finished running 4 view models in 13.16s.
18:47:41.416117 [debug] [MainThread]: Connection 'master' was properly closed.
18:47:41.416651 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
18:47:41.438146 [info ] [MainThread]: 
18:47:41.438705 [info ] [MainThread]: [32mCompleted successfully[0m
18:47:41.439080 [info ] [MainThread]: 
18:47:41.439386 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
18:47:41.439849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061d7880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106154f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106154c10>]}


============================== 2022-07-11 18:50:47.568652 | 9d2197c6-e44f-44a0-ad8e-4cbe63233260 ==============================
18:50:47.568678 [info ] [MainThread]: Running with dbt=1.1.1
18:50:47.568906 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:50:47.568973 [debug] [MainThread]: Tracking: tracking
18:50:47.590251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063c0f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10641cf40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10641c610>]}
18:50:47.619656 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
18:50:47.619984 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
18:50:47.626429 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
18:50:47.635803 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
18:50:47.642720 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:50:47.645390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9d2197c6-e44f-44a0-ad8e-4cbe63233260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064f6c70>]}
18:50:47.648362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9d2197c6-e44f-44a0-ad8e-4cbe63233260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106427c10>]}
18:50:47.648524 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:50:47.648654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9d2197c6-e44f-44a0-ad8e-4cbe63233260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064d0eb0>]}
18:50:47.649450 [info ] [MainThread]: 
18:50:47.649686 [debug] [MainThread]: Acquiring new redshift connection "master"
18:50:47.650187 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
18:50:47.655519 [debug] [ThreadPool]: Using redshift connection "list_dev"
18:50:47.655702 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
18:50:47.655774 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:50:47.655850 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:50:48.684812 [debug] [ThreadPool]: SQL status: SELECT in 1.03 seconds
18:50:48.692178 [debug] [ThreadPool]: On list_dev: Close
18:50:48.696929 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
18:50:48.712085 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:50:48.712482 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
18:50:48.712673 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:50:48.712866 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:50:49.649693 [debug] [ThreadPool]: SQL status: BEGIN in 0.94 seconds
18:50:49.650861 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:50:49.651254 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
18:50:49.768649 [debug] [ThreadPool]: SQL status: SELECT in 0.12 seconds
18:50:49.774189 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
18:50:49.872457 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
18:50:49.895793 [debug] [MainThread]: Using redshift connection "master"
18:50:49.896245 [debug] [MainThread]: On master: BEGIN
18:50:49.896456 [debug] [MainThread]: Opening a new connection, currently in state init
18:50:49.896716 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:50:50.849620 [debug] [MainThread]: SQL status: BEGIN in 0.95 seconds
18:50:50.850543 [debug] [MainThread]: Using redshift connection "master"
18:50:50.851060 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:50:51.026956 [debug] [MainThread]: SQL status: SELECT in 0.18 seconds
18:50:51.035992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9d2197c6-e44f-44a0-ad8e-4cbe63233260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064d0e80>]}
18:50:51.037449 [debug] [MainThread]: On master: ROLLBACK
18:50:51.133734 [debug] [MainThread]: Using redshift connection "master"
18:50:51.134641 [debug] [MainThread]: On master: BEGIN
18:50:51.329725 [debug] [MainThread]: SQL status: BEGIN in 0.19 seconds
18:50:51.330508 [debug] [MainThread]: On master: COMMIT
18:50:51.330928 [debug] [MainThread]: Using redshift connection "master"
18:50:51.331424 [debug] [MainThread]: On master: COMMIT
18:50:51.430114 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:50:51.431013 [debug] [MainThread]: On master: Close
18:50:51.433299 [info ] [MainThread]: Concurrency: 1 threads (target='test')
18:50:51.434241 [info ] [MainThread]: 
18:50:51.452499 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
18:50:51.453141 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
18:50:51.453843 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
18:50:51.454010 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
18:50:51.454178 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
18:50:51.459061 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
18:50:51.460370 [debug] [Thread-1  ]: finished collecting timing info
18:50:51.460604 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
18:50:51.484671 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
18:50:51.485569 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:50:51.485693 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:50:51.485804 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:50:51.485939 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:50:52.454318 [debug] [Thread-1  ]: SQL status: BEGIN in 0.97 seconds
18:50:52.456002 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:50:52.456448 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

18:50:52.558912 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
18:50:52.577204 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:50:52.577976 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
18:50:52.678779 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:50:52.684518 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:50:52.685096 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
18:50:52.783325 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:50:52.815386 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:50:52.816076 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:50:52.816483 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:50:52.952706 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
18:50:52.953703 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:50:52.954099 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:50:53.052243 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:50:53.065552 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:50:53.065971 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
18:50:53.170452 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:50:53.174239 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:50:53.174797 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:50:53.175249 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:50:53.305052 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:50:53.306315 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:50:53.306563 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:50:53.403338 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:50:53.404551 [debug] [Thread-1  ]: finished collecting timing info
18:50:53.404812 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
18:50:53.502993 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
18:50:53.506297 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d2197c6-e44f-44a0-ad8e-4cbe63233260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106605e20>]}
18:50:53.507563 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.05s]
18:50:53.508202 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
18:50:53.508583 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
18:50:53.509193 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
18:50:53.509800 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
18:50:53.510433 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
18:50:53.510639 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
18:50:53.525028 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
18:50:53.526001 [debug] [Thread-1  ]: finished collecting timing info
18:50:53.526259 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
18:50:53.531285 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
18:50:53.533044 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:50:53.533358 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:50:53.533529 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:50:53.533730 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:50:54.489473 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
18:50:54.491158 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:50:54.491362 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , COALESCE(
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
, 0)::FLOAT 
  AS elapsed_time
  , COALESCE(
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
, 0)::FLOAT
  AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

18:50:54.603752 [debug] [Thread-1  ]: Postgres adapter: Postgres error: COALESCE types text and integer cannot be matched

18:50:54.604398 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
18:50:54.706809 [debug] [Thread-1  ]: finished collecting timing info
18:50:54.707243 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
18:50:54.708084 [debug] [Thread-1  ]: Database Error in model amplitude_event (models/amplitude/amplitude_event.sql)
  COALESCE types text and integer cannot be matched
  compiled SQL at target/run/amplitude_event/models/amplitude/amplitude_event.sql
18:50:54.708524 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d2197c6-e44f-44a0-ad8e-4cbe63233260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106570c70>]}
18:50:54.709022 [error] [Thread-1  ]: 2 of 4 ERROR creating view model dbt_amplitude_test.amplitude_event ............ [[31mERROR[0m in 1.20s]
18:50:54.709624 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
18:50:54.709854 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
18:50:54.710521 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
18:50:54.713953 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
18:50:54.715020 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
18:50:54.715902 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
18:50:54.719487 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
18:50:54.722080 [debug] [Thread-1  ]: finished collecting timing info
18:50:54.724034 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
18:50:54.732237 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
18:50:54.733351 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:50:54.733553 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:50:54.733719 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:50:54.733906 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:50:55.662475 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
18:50:55.662886 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:50:55.663060 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

18:50:55.777418 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:50:55.784370 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:50:55.784730 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
18:50:55.883101 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:50:55.891040 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:50:55.903435 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
18:50:56.000811 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:50:56.003781 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:50:56.004196 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:50:56.004493 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:50:56.136847 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:50:56.137757 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:50:56.138115 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:50:56.236886 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:50:56.242452 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:50:56.242931 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
18:50:56.347475 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:50:56.349845 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:50:56.350104 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:50:56.350278 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:50:56.476661 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:50:56.477102 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:50:56.477279 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:50:56.574989 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:50:56.578040 [debug] [Thread-1  ]: finished collecting timing info
18:50:56.578635 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
18:50:56.674768 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
18:50:56.676469 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d2197c6-e44f-44a0-ad8e-4cbe63233260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106570f40>]}
18:50:56.677387 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.96s]
18:50:56.679135 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
18:50:56.679889 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
18:50:56.681880 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
18:50:56.685162 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
18:50:56.685656 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
18:50:56.686166 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
18:50:56.699543 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
18:50:56.700554 [debug] [Thread-1  ]: finished collecting timing info
18:50:56.700759 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
18:50:56.702691 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
18:50:56.703106 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:50:56.703189 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:50:56.703258 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:50:56.703333 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:50:57.650720 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
18:50:57.651802 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:50:57.652105 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

18:50:57.773667 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
18:50:57.779405 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:50:57.779896 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
18:50:57.880353 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:50:57.889897 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:50:57.890536 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
18:50:57.987920 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:50:57.993412 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:50:57.994259 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:50:57.994859 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:50:58.129599 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:50:58.131646 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:50:58.131862 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:50:58.228029 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:50:58.236804 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:50:58.237435 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
18:50:58.341237 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:50:58.345321 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:50:58.345753 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:50:58.346133 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:50:58.477428 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:50:58.478965 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:50:58.479377 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:50:58.575848 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:50:58.578265 [debug] [Thread-1  ]: finished collecting timing info
18:50:58.578646 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
18:50:58.674631 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
18:50:58.675813 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d2197c6-e44f-44a0-ad8e-4cbe63233260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10669dbe0>]}
18:50:58.676789 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 1.99s]
18:50:58.677677 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
18:50:58.680971 [debug] [MainThread]: Acquiring new redshift connection "master"
18:50:58.681719 [debug] [MainThread]: Using redshift connection "master"
18:50:58.681963 [debug] [MainThread]: On master: BEGIN
18:50:58.682168 [debug] [MainThread]: Opening a new connection, currently in state closed
18:50:58.682433 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:50:59.637559 [debug] [MainThread]: SQL status: BEGIN in 0.96 seconds
18:50:59.638379 [debug] [MainThread]: On master: COMMIT
18:50:59.638561 [debug] [MainThread]: Using redshift connection "master"
18:50:59.638744 [debug] [MainThread]: On master: COMMIT
18:50:59.736836 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:50:59.738005 [debug] [MainThread]: On master: Close
18:50:59.739204 [info ] [MainThread]: 
18:50:59.739985 [info ] [MainThread]: Finished running 4 view models in 12.09s.
18:50:59.741414 [debug] [MainThread]: Connection 'master' was properly closed.
18:50:59.742019 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
18:50:59.755835 [info ] [MainThread]: 
18:50:59.756224 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
18:50:59.756483 [info ] [MainThread]: 
18:50:59.756699 [error] [MainThread]: [33mDatabase Error in model amplitude_event (models/amplitude/amplitude_event.sql)[0m
18:50:59.756903 [error] [MainThread]:   COALESCE types text and integer cannot be matched
18:50:59.757090 [error] [MainThread]:   compiled SQL at target/run/amplitude_event/models/amplitude/amplitude_event.sql
18:50:59.757290 [info ] [MainThread]: 
18:50:59.757502 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
18:50:59.757861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106681f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106681cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106681f10>]}


============================== 2022-07-11 18:53:51.427120 | d023b03a-adc0-425d-8e9a-14c4a7efd970 ==============================
18:53:51.427136 [info ] [MainThread]: Running with dbt=1.1.1
18:53:51.427693 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
18:53:51.427757 [debug] [MainThread]: Tracking: tracking
18:53:51.444006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053c3f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105510ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105510580>]}
18:53:51.471634 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
18:53:51.471902 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
18:53:51.478099 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
18:53:51.487105 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
18:53:51.493322 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

18:53:51.495980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd023b03a-adc0-425d-8e9a-14c4a7efd970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105623dc0>]}
18:53:51.499147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd023b03a-adc0-425d-8e9a-14c4a7efd970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10551b910>]}
18:53:51.499298 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
18:53:51.499416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd023b03a-adc0-425d-8e9a-14c4a7efd970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055fceb0>]}
18:53:51.500119 [info ] [MainThread]: 
18:53:51.500326 [debug] [MainThread]: Acquiring new redshift connection "master"
18:53:51.500758 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
18:53:51.506177 [debug] [ThreadPool]: Using redshift connection "list_dev"
18:53:51.506300 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
18:53:51.506366 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:53:51.506441 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:53:52.582624 [debug] [ThreadPool]: SQL status: SELECT in 1.08 seconds
18:53:52.590224 [debug] [ThreadPool]: On list_dev: Close
18:53:52.605471 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
18:53:52.616313 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:53:52.616543 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
18:53:52.616631 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:53:52.616739 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:53:53.564273 [debug] [ThreadPool]: SQL status: BEGIN in 0.95 seconds
18:53:53.565705 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
18:53:53.566153 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
18:53:53.682659 [debug] [ThreadPool]: SQL status: SELECT in 0.12 seconds
18:53:53.690897 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
18:53:53.788692 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
18:53:53.809315 [debug] [MainThread]: Using redshift connection "master"
18:53:53.809874 [debug] [MainThread]: On master: BEGIN
18:53:53.810071 [debug] [MainThread]: Opening a new connection, currently in state init
18:53:53.810272 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:53:54.782706 [debug] [MainThread]: SQL status: BEGIN in 0.97 seconds
18:53:54.784212 [debug] [MainThread]: Using redshift connection "master"
18:53:54.785941 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:53:54.966923 [debug] [MainThread]: SQL status: SELECT in 0.18 seconds
18:53:54.974991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd023b03a-adc0-425d-8e9a-14c4a7efd970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055fcd30>]}
18:53:54.976351 [debug] [MainThread]: On master: ROLLBACK
18:53:55.079130 [debug] [MainThread]: Using redshift connection "master"
18:53:55.080473 [debug] [MainThread]: On master: BEGIN
18:53:55.276492 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
18:53:55.278175 [debug] [MainThread]: On master: COMMIT
18:53:55.279970 [debug] [MainThread]: Using redshift connection "master"
18:53:55.280370 [debug] [MainThread]: On master: COMMIT
18:53:55.380365 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:53:55.381433 [debug] [MainThread]: On master: Close
18:53:55.383500 [info ] [MainThread]: Concurrency: 1 threads (target='test')
18:53:55.384402 [info ] [MainThread]: 
18:53:55.407603 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
18:53:55.408762 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
18:53:55.409746 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
18:53:55.410022 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
18:53:55.416957 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
18:53:55.423713 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
18:53:55.426462 [debug] [Thread-1  ]: finished collecting timing info
18:53:55.426738 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
18:53:55.454409 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
18:53:55.455434 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:53:55.455565 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:53:55.455674 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:53:55.455791 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:53:56.399031 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
18:53:56.400065 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:53:56.400314 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

18:53:56.507616 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:53:56.527300 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:53:56.527656 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
18:53:56.624867 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:53:56.636563 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:53:56.637139 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
18:53:56.738635 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:53:56.764755 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:53:56.765038 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:53:56.765229 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:53:56.895671 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:53:56.898110 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:53:56.898655 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:53:56.996988 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:53:57.012771 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:53:57.013921 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
18:53:57.113106 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:53:57.116472 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:53:57.116960 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:53:57.117332 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
18:53:57.242596 [debug] [Thread-1  ]: SQL status: COMMIT in 0.12 seconds
18:53:57.243836 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
18:53:57.244357 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
18:53:57.340925 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:53:57.343644 [debug] [Thread-1  ]: finished collecting timing info
18:53:57.344403 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
18:53:57.446668 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
18:53:57.449832 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd023b03a-adc0-425d-8e9a-14c4a7efd970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a31f70>]}
18:53:57.451841 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.04s]
18:53:57.457828 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
18:53:57.458665 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
18:53:57.459282 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
18:53:57.460075 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
18:53:57.460500 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
18:53:57.460736 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
18:53:57.481898 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
18:53:57.485426 [debug] [Thread-1  ]: finished collecting timing info
18:53:57.485705 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
18:53:57.488761 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
18:53:57.489242 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:53:57.489410 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:53:57.489557 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:53:57.489708 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:53:58.446533 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
18:53:58.447550 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:53:58.447782 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , COALESCE(
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
, 0::TEXT)::FLOAT 
  AS elapsed_time
  , COALESCE(
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
, 0::TEXT)::FLOAT
  AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

18:53:58.563634 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
18:53:58.573966 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:53:58.574588 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
18:53:58.671497 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:53:58.680735 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:53:58.681465 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
18:53:58.779538 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:53:58.783278 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:53:58.783853 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:53:58.784074 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:53:58.914517 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:53:58.916245 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:53:58.916618 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:53:59.013580 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:53:59.021768 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:53:59.022327 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
18:53:59.130631 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
18:53:59.133938 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:53:59.134372 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:53:59.134748 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
18:53:59.294055 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:53:59.295172 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
18:53:59.296670 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
18:53:59.426337 [debug] [Thread-1  ]: SQL status: BEGIN in 0.13 seconds
18:53:59.429615 [debug] [Thread-1  ]: finished collecting timing info
18:53:59.430211 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
18:53:59.536121 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
18:53:59.539199 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd023b03a-adc0-425d-8e9a-14c4a7efd970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a130a0>]}
18:53:59.540781 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.08s]
18:53:59.542078 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
18:53:59.547221 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
18:53:59.548341 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
18:53:59.549084 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
18:53:59.549317 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
18:53:59.549542 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
18:53:59.558327 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
18:53:59.561829 [debug] [Thread-1  ]: finished collecting timing info
18:53:59.562469 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
18:53:59.566972 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
18:53:59.569533 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:53:59.569861 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:53:59.570042 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:53:59.570279 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:54:00.531573 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
18:54:00.533465 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:54:00.533945 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

18:54:00.641304 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
18:54:00.651669 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:54:00.652331 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
18:54:00.749633 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:54:00.757329 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:54:00.758021 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
18:54:00.858493 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:54:00.863870 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:54:00.864284 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:54:00.864632 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:54:01.034835 [debug] [Thread-1  ]: SQL status: COMMIT in 0.17 seconds
18:54:01.036194 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:54:01.036583 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:54:01.149294 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:54:01.157656 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:54:01.158372 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
18:54:01.260195 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:54:01.263665 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:54:01.264121 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:54:01.264478 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
18:54:01.421887 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:54:01.422875 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
18:54:01.423234 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
18:54:01.540723 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
18:54:01.543345 [debug] [Thread-1  ]: finished collecting timing info
18:54:01.543839 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
18:54:01.643627 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
18:54:01.647084 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd023b03a-adc0-425d-8e9a-14c4a7efd970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105696eb0>]}
18:54:01.649009 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.10s]
18:54:01.650235 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
18:54:01.654638 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
18:54:01.655562 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
18:54:01.656312 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
18:54:01.656533 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
18:54:01.656805 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
18:54:01.675764 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
18:54:01.677091 [debug] [Thread-1  ]: finished collecting timing info
18:54:01.677344 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
18:54:01.682339 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
18:54:01.682939 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:54:01.683093 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:54:01.683235 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:54:01.683398 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:54:02.615912 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
18:54:02.616896 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:54:02.617290 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

18:54:02.739241 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
18:54:02.749135 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:54:02.749883 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
18:54:02.847774 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:54:02.857664 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:54:02.858350 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
18:54:02.957151 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
18:54:02.960836 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:54:02.961363 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:54:02.961722 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:54:03.117918 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
18:54:03.119208 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:54:03.119570 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:54:03.234382 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
18:54:03.240592 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:54:03.241268 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
18:54:03.339512 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
18:54:03.342701 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:54:03.343123 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:54:03.343469 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
18:54:03.474484 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
18:54:03.475302 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
18:54:03.475654 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
18:54:03.574634 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
18:54:03.576642 [debug] [Thread-1  ]: finished collecting timing info
18:54:03.577112 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
18:54:03.674357 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
18:54:03.677711 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd023b03a-adc0-425d-8e9a-14c4a7efd970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056b7e50>]}
18:54:03.679157 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.02s]
18:54:03.680506 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
18:54:03.687648 [debug] [MainThread]: Acquiring new redshift connection "master"
18:54:03.688237 [debug] [MainThread]: Using redshift connection "master"
18:54:03.688419 [debug] [MainThread]: On master: BEGIN
18:54:03.688590 [debug] [MainThread]: Opening a new connection, currently in state closed
18:54:03.688810 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:54:04.644951 [debug] [MainThread]: SQL status: BEGIN in 0.96 seconds
18:54:04.646343 [debug] [MainThread]: On master: COMMIT
18:54:04.646738 [debug] [MainThread]: Using redshift connection "master"
18:54:04.647524 [debug] [MainThread]: On master: COMMIT
18:54:04.752720 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:54:04.754231 [debug] [MainThread]: On master: Close
18:54:04.756534 [info ] [MainThread]: 
18:54:04.758314 [info ] [MainThread]: Finished running 4 view models in 13.26s.
18:54:04.763879 [debug] [MainThread]: Connection 'master' was properly closed.
18:54:04.764272 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
18:54:04.782591 [info ] [MainThread]: 
18:54:04.783338 [info ] [MainThread]: [32mCompleted successfully[0m
18:54:04.783749 [info ] [MainThread]: 
18:54:04.784061 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
18:54:04.784850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056b7fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056b7ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056b7f70>]}


============================== 2022-07-11 19:11:57.795826 | 93bb45a8-987e-4325-9500-5b33326ae2ac ==============================
19:11:57.795844 [info ] [MainThread]: Running with dbt=1.1.1
19:11:57.796262 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
19:11:57.796337 [debug] [MainThread]: Tracking: tracking
19:11:57.814105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046a50d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046a5700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046a54c0>]}
19:11:57.840901 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
19:11:57.841193 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
19:11:57.847185 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
19:11:57.855536 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
19:11:57.861509 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

19:11:57.863975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '93bb45a8-987e-4325-9500-5b33326ae2ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049a4a60>]}
19:11:57.866743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '93bb45a8-987e-4325-9500-5b33326ae2ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046b1c70>]}
19:11:57.866874 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
19:11:57.866997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '93bb45a8-987e-4325-9500-5b33326ae2ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104970fd0>]}
19:11:57.867680 [info ] [MainThread]: 
19:11:57.867895 [debug] [MainThread]: Acquiring new redshift connection "master"
19:11:57.868310 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
19:11:57.873541 [debug] [ThreadPool]: Using redshift connection "list_dev"
19:11:57.873655 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
19:11:57.873723 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:11:57.873794 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:11:58.921916 [debug] [ThreadPool]: SQL status: SELECT in 1.05 seconds
19:11:58.932607 [debug] [ThreadPool]: On list_dev: Close
19:11:58.941269 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
19:11:58.956291 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
19:11:58.956661 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
19:11:58.956838 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:11:58.957049 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:11:59.911181 [debug] [ThreadPool]: SQL status: BEGIN in 0.95 seconds
19:11:59.912793 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
19:11:59.913237 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
19:12:00.029731 [debug] [ThreadPool]: SQL status: SELECT in 0.12 seconds
19:12:00.032088 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
19:12:00.129607 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
19:12:00.144846 [debug] [MainThread]: Using redshift connection "master"
19:12:00.145334 [debug] [MainThread]: On master: BEGIN
19:12:00.145514 [debug] [MainThread]: Opening a new connection, currently in state init
19:12:00.145764 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:12:01.081610 [debug] [MainThread]: SQL status: BEGIN in 0.94 seconds
19:12:01.083375 [debug] [MainThread]: Using redshift connection "master"
19:12:01.084549 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:12:01.266354 [debug] [MainThread]: SQL status: SELECT in 0.18 seconds
19:12:01.273148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '93bb45a8-987e-4325-9500-5b33326ae2ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049884f0>]}
19:12:01.274492 [debug] [MainThread]: On master: ROLLBACK
19:12:01.371475 [debug] [MainThread]: Using redshift connection "master"
19:12:01.372774 [debug] [MainThread]: On master: BEGIN
19:12:01.570717 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
19:12:01.572252 [debug] [MainThread]: On master: COMMIT
19:12:01.572671 [debug] [MainThread]: Using redshift connection "master"
19:12:01.573048 [debug] [MainThread]: On master: COMMIT
19:12:01.669671 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
19:12:01.670391 [debug] [MainThread]: On master: Close
19:12:01.674026 [info ] [MainThread]: Concurrency: 1 threads (target='test')
19:12:01.674925 [info ] [MainThread]: 
19:12:01.689761 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
19:12:01.690435 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
19:12:01.691072 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
19:12:01.691280 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
19:12:01.691540 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
19:12:01.695875 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
19:12:01.697600 [debug] [Thread-1  ]: finished collecting timing info
19:12:01.697805 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
19:12:01.723601 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
19:12:01.725184 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:12:01.725400 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
19:12:01.725510 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:12:01.725628 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:12:02.655145 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
19:12:02.656234 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:12:02.656450 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

19:12:02.759764 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
19:12:02.781034 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:12:02.781713 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
19:12:02.879173 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:12:02.888197 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:12:02.888917 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
19:12:02.983545 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
19:12:03.017902 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:12:03.020162 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:12:03.020466 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:12:03.172702 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
19:12:03.174675 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:12:03.175066 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
19:12:03.296262 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
19:12:03.319324 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:12:03.319701 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
19:12:03.417046 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
19:12:03.420462 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:12:03.420915 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:12:03.421148 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:12:03.611732 [debug] [Thread-1  ]: SQL status: COMMIT in 0.19 seconds
19:12:03.614100 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:12:03.614579 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
19:12:03.724217 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
19:12:03.727582 [debug] [Thread-1  ]: finished collecting timing info
19:12:03.728194 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
19:12:03.828820 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
19:12:03.832410 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93bb45a8-987e-4325-9500-5b33326ae2ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104aa0d90>]}
19:12:03.833631 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.14s]
19:12:03.834674 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
19:12:03.835117 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
19:12:03.835555 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
19:12:03.837117 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
19:12:03.837499 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
19:12:03.837780 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
19:12:03.861470 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
19:12:03.864664 [debug] [Thread-1  ]: finished collecting timing info
19:12:03.865061 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
19:12:03.871860 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
19:12:03.873022 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:12:03.873236 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
19:12:03.873417 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:12:03.873613 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:12:04.812343 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
19:12:04.814227 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:12:04.814458 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
 IS NULL THEN NULL
    ELSE unpack_json('timeElapsed') }}::FLOAT
      END AS elapsed_time
FROM "dev"."stg_amplitude"."event"
  ) ;

19:12:04.955926 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "}"
LINE 51:     ELSE unpack_json('timeElapsed') }}::FLOAT
                                             ^

19:12:04.956511 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
19:12:05.067151 [debug] [Thread-1  ]: finished collecting timing info
19:12:05.068316 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
19:12:05.071665 [debug] [Thread-1  ]: Database Error in model amplitude_event (models/amplitude/amplitude_event.sql)
  syntax error at or near "}"
  LINE 51:     ELSE unpack_json('timeElapsed') }}::FLOAT
                                               ^
  compiled SQL at target/run/amplitude_event/models/amplitude/amplitude_event.sql
19:12:05.072283 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93bb45a8-987e-4325-9500-5b33326ae2ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a0c5e0>]}
19:12:05.073205 [error] [Thread-1  ]: 2 of 4 ERROR creating view model dbt_amplitude_test.amplitude_event ............ [[31mERROR[0m in 1.24s]
19:12:05.074269 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
19:12:05.074864 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
19:12:05.075255 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
19:12:05.076653 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
19:12:05.077043 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
19:12:05.077324 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
19:12:05.084268 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
19:12:05.088872 [debug] [Thread-1  ]: finished collecting timing info
19:12:05.089162 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
19:12:05.097746 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
19:12:05.098129 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:12:05.098465 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
19:12:05.098542 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:12:05.098623 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:12:06.066811 [debug] [Thread-1  ]: SQL status: BEGIN in 0.97 seconds
19:12:06.067323 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:12:06.067824 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

19:12:06.175157 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
19:12:06.183768 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:12:06.184377 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
19:12:06.283019 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:12:06.287989 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:12:06.301816 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
19:12:06.398333 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:12:06.412667 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:12:06.426438 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:12:06.427524 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:12:06.592916 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
19:12:06.599860 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:12:06.601682 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
19:12:06.716609 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
19:12:06.732744 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:12:06.747239 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
19:12:06.862049 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
19:12:06.878578 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:12:06.896688 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:12:06.897531 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:12:07.023664 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
19:12:07.024132 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:12:07.024362 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
19:12:07.122075 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:12:07.123515 [debug] [Thread-1  ]: finished collecting timing info
19:12:07.123850 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
19:12:07.221147 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
19:12:07.222476 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93bb45a8-987e-4325-9500-5b33326ae2ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a1b0d0>]}
19:12:07.223195 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.15s]
19:12:07.224005 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
19:12:07.224944 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
19:12:07.225299 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
19:12:07.226317 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
19:12:07.226675 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
19:12:07.226928 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
19:12:07.238769 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
19:12:07.239810 [debug] [Thread-1  ]: finished collecting timing info
19:12:07.240100 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
19:12:07.243454 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
19:12:07.244011 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:12:07.244196 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
19:12:07.244359 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:12:07.244531 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:12:08.172779 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
19:12:08.174276 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:12:08.174693 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

19:12:08.297778 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
19:12:08.302315 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:12:08.302660 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
19:12:08.404386 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:12:08.413901 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:12:08.414656 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
19:12:08.511645 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:12:08.514639 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:12:08.514862 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:12:08.515092 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:12:08.678230 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
19:12:08.678874 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:12:08.679054 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
19:12:08.801412 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
19:12:08.806711 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:12:08.807162 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
19:12:08.908126 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
19:12:08.910758 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:12:08.910977 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:12:08.911169 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:12:09.064361 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
19:12:09.066028 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:12:09.066273 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
19:12:09.182027 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
19:12:09.186428 [debug] [Thread-1  ]: finished collecting timing info
19:12:09.187032 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
19:12:09.285084 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
19:12:09.288932 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93bb45a8-987e-4325-9500-5b33326ae2ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d490a0>]}
19:12:09.289562 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.06s]
19:12:09.290369 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
19:12:09.296413 [debug] [MainThread]: Acquiring new redshift connection "master"
19:12:09.297100 [debug] [MainThread]: Using redshift connection "master"
19:12:09.297398 [debug] [MainThread]: On master: BEGIN
19:12:09.297652 [debug] [MainThread]: Opening a new connection, currently in state closed
19:12:09.297932 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:12:10.274111 [debug] [MainThread]: SQL status: BEGIN in 0.98 seconds
19:12:10.274593 [debug] [MainThread]: On master: COMMIT
19:12:10.274786 [debug] [MainThread]: Using redshift connection "master"
19:12:10.274954 [debug] [MainThread]: On master: COMMIT
19:12:10.372042 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
19:12:10.372891 [debug] [MainThread]: On master: Close
19:12:10.379219 [info ] [MainThread]: 
19:12:10.380130 [info ] [MainThread]: Finished running 4 view models in 12.51s.
19:12:10.383529 [debug] [MainThread]: Connection 'master' was properly closed.
19:12:10.383905 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
19:12:10.405315 [info ] [MainThread]: 
19:12:10.405963 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
19:12:10.406310 [info ] [MainThread]: 
19:12:10.406622 [error] [MainThread]: [33mDatabase Error in model amplitude_event (models/amplitude/amplitude_event.sql)[0m
19:12:10.406925 [error] [MainThread]:   syntax error at or near "}"
19:12:10.407197 [error] [MainThread]:   LINE 51:     ELSE unpack_json('timeElapsed') }}::FLOAT
19:12:10.407463 [error] [MainThread]:                                                ^
19:12:10.407727 [error] [MainThread]:   compiled SQL at target/run/amplitude_event/models/amplitude/amplitude_event.sql
19:12:10.408025 [info ] [MainThread]: 
19:12:10.408510 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
19:12:10.409215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d490d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a83ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a83220>]}


============================== 2022-07-11 19:13:24.616942 | e90118e0-28d3-4f2b-bb4a-b97ea7cbd083 ==============================
19:13:24.616963 [info ] [MainThread]: Running with dbt=1.1.1
19:13:24.617433 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
19:13:24.617513 [debug] [MainThread]: Tracking: tracking
19:13:24.633179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11080e040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11080efd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11080e670>]}
19:13:24.657475 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
19:13:24.657704 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
19:13:24.663396 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
19:13:24.671918 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
19:13:24.677781 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

19:13:24.680192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e90118e0-28d3-4f2b-bb4a-b97ea7cbd083', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a24e50>]}
19:13:24.682990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e90118e0-28d3-4f2b-bb4a-b97ea7cbd083', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11081bbb0>]}
19:13:24.683129 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
19:13:24.683248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e90118e0-28d3-4f2b-bb4a-b97ea7cbd083', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108f0fa0>]}
19:13:24.683934 [info ] [MainThread]: 
19:13:24.684141 [debug] [MainThread]: Acquiring new redshift connection "master"
19:13:24.684577 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
19:13:24.689545 [debug] [ThreadPool]: Using redshift connection "list_dev"
19:13:24.689619 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
19:13:24.689678 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:13:24.689742 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:13:25.736522 [debug] [ThreadPool]: SQL status: SELECT in 1.05 seconds
19:13:25.740055 [debug] [ThreadPool]: On list_dev: Close
19:13:25.742241 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
19:13:25.754417 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
19:13:25.754734 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
19:13:25.755334 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:13:25.755525 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:13:26.754412 [debug] [ThreadPool]: SQL status: BEGIN in 1.0 seconds
19:13:26.757610 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
19:13:26.758034 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
19:13:26.888492 [debug] [ThreadPool]: SQL status: SELECT in 0.13 seconds
19:13:26.893553 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
19:13:26.994453 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
19:13:27.013928 [debug] [MainThread]: Using redshift connection "master"
19:13:27.014500 [debug] [MainThread]: On master: BEGIN
19:13:27.014752 [debug] [MainThread]: Opening a new connection, currently in state init
19:13:27.015022 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:13:27.956031 [debug] [MainThread]: SQL status: BEGIN in 0.94 seconds
19:13:27.957345 [debug] [MainThread]: Using redshift connection "master"
19:13:27.957653 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:13:28.211006 [debug] [MainThread]: SQL status: SELECT in 0.25 seconds
19:13:28.219517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e90118e0-28d3-4f2b-bb4a-b97ea7cbd083', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a082e0>]}
19:13:28.221177 [debug] [MainThread]: On master: ROLLBACK
19:13:28.317393 [debug] [MainThread]: Using redshift connection "master"
19:13:28.318746 [debug] [MainThread]: On master: BEGIN
19:13:28.516243 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
19:13:28.517587 [debug] [MainThread]: On master: COMMIT
19:13:28.517878 [debug] [MainThread]: Using redshift connection "master"
19:13:28.518165 [debug] [MainThread]: On master: COMMIT
19:13:28.615421 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
19:13:28.616384 [debug] [MainThread]: On master: Close
19:13:28.618606 [info ] [MainThread]: Concurrency: 1 threads (target='test')
19:13:28.619329 [info ] [MainThread]: 
19:13:28.652249 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
19:13:28.653872 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
19:13:28.654643 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
19:13:28.654871 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
19:13:28.655345 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
19:13:28.661104 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
19:13:28.662713 [debug] [Thread-1  ]: finished collecting timing info
19:13:28.662934 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
19:13:28.689673 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
19:13:28.690535 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:13:28.690660 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
19:13:28.690765 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:13:28.690884 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:13:29.637094 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
19:13:29.638196 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:13:29.638412 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

19:13:29.753657 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
19:13:29.770633 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:13:29.771454 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
19:13:29.869716 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:13:29.878275 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:13:29.878767 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
19:13:29.976285 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:13:29.999638 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:13:30.000601 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:13:30.000853 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:13:30.184883 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
19:13:30.186748 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:13:30.186975 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
19:13:30.300132 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
19:13:30.315649 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:13:30.316199 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
19:13:30.415559 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
19:13:30.419792 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:13:30.420274 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:13:30.420632 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:13:30.615310 [debug] [Thread-1  ]: SQL status: COMMIT in 0.19 seconds
19:13:30.616821 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:13:30.617242 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
19:13:30.730148 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
19:13:30.733103 [debug] [Thread-1  ]: finished collecting timing info
19:13:30.733649 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
19:13:30.831329 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
19:13:30.834468 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e90118e0-28d3-4f2b-bb4a-b97ea7cbd083', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b20d00>]}
19:13:30.835613 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.18s]
19:13:30.843658 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
19:13:30.844149 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
19:13:30.844505 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
19:13:30.845532 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
19:13:30.846220 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
19:13:30.846497 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
19:13:30.861195 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
19:13:30.862377 [debug] [Thread-1  ]: finished collecting timing info
19:13:30.862652 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
19:13:30.865968 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
19:13:30.866666 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:13:30.866832 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
19:13:30.866971 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:13:30.867132 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:13:31.819423 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
19:13:31.820414 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:13:31.820656 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
 IS NULL THEN NULL
    ELSE 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT
      END AS elapsed_time
FROM "dev"."stg_amplitude"."event"
  ) ;

19:13:31.952304 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.13 seconds
19:13:31.961022 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:13:31.961722 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
19:13:32.059491 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:13:32.063727 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:13:32.064101 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
19:13:32.163345 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:13:32.170092 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
19:13:32.170489 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:13:32.170727 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
19:13:32.357011 [debug] [Thread-1  ]: SQL status: COMMIT in 0.19 seconds
19:13:32.357879 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:13:32.358656 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
19:13:32.480915 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
19:13:32.488371 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:13:32.488945 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
19:13:32.588482 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
19:13:32.591935 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
19:13:32.592257 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:13:32.592447 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
19:13:32.767273 [debug] [Thread-1  ]: SQL status: COMMIT in 0.17 seconds
19:13:32.767756 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:13:32.767978 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
19:13:32.882608 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
19:13:32.888786 [debug] [Thread-1  ]: finished collecting timing info
19:13:32.889226 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
19:13:32.991364 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
19:13:32.992976 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e90118e0-28d3-4f2b-bb4a-b97ea7cbd083', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b14340>]}
19:13:32.993747 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.15s]
19:13:33.007334 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
19:13:33.007665 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
19:13:33.008077 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
19:13:33.008527 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
19:13:33.008772 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
19:13:33.008899 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
19:13:33.010495 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
19:13:33.010912 [debug] [Thread-1  ]: finished collecting timing info
19:13:33.011057 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
19:13:33.012484 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
19:13:33.012779 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:13:33.012848 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
19:13:33.012909 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:13:33.012975 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:13:33.971407 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
19:13:33.981609 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:13:33.982467 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

19:13:34.099508 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
19:13:34.125728 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:13:34.126018 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
19:13:34.232843 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.11 seconds
19:13:34.236905 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:13:34.237229 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
19:13:34.335490 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:13:34.338814 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:13:34.339316 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:13:34.339662 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:13:34.505473 [debug] [Thread-1  ]: SQL status: COMMIT in 0.17 seconds
19:13:34.506168 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:13:34.506421 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
19:13:34.634586 [debug] [Thread-1  ]: SQL status: BEGIN in 0.13 seconds
19:13:34.639605 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:13:34.640296 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
19:13:34.743277 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
19:13:34.746254 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:13:34.746742 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:13:34.747504 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:13:34.938255 [debug] [Thread-1  ]: SQL status: COMMIT in 0.19 seconds
19:13:34.941645 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:13:34.941924 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
19:13:35.055372 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
19:13:35.057910 [debug] [Thread-1  ]: finished collecting timing info
19:13:35.058353 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
19:13:35.164175 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
19:13:35.166900 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e90118e0-28d3-4f2b-bb4a-b97ea7cbd083', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b14190>]}
19:13:35.168050 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.16s]
19:13:35.169121 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
19:13:35.169536 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
19:13:35.174335 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
19:13:35.176667 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
19:13:35.176919 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
19:13:35.177158 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
19:13:35.189286 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
19:13:35.191186 [debug] [Thread-1  ]: finished collecting timing info
19:13:35.191607 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
19:13:35.196860 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
19:13:35.197972 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:13:35.198267 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
19:13:35.198419 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:13:35.198582 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:13:36.120355 [debug] [Thread-1  ]: SQL status: BEGIN in 0.92 seconds
19:13:36.121279 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:13:36.121840 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

19:13:36.246186 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
19:13:36.250874 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:13:36.251163 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
19:13:36.352563 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:13:36.361791 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:13:36.362219 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
19:13:36.469669 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.11 seconds
19:13:36.473251 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:13:36.473742 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:13:36.474099 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:13:36.643302 [debug] [Thread-1  ]: SQL status: COMMIT in 0.17 seconds
19:13:36.646014 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:13:36.646910 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
19:13:36.771100 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
19:13:36.777270 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:13:36.777888 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
19:13:36.888788 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
19:13:36.890315 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:13:36.890640 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:13:36.890878 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:13:37.054631 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
19:13:37.055763 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:13:37.056025 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
19:13:37.168092 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
19:13:37.169091 [debug] [Thread-1  ]: finished collecting timing info
19:13:37.169903 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
19:13:37.269492 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
19:13:37.270683 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e90118e0-28d3-4f2b-bb4a-b97ea7cbd083', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b88940>]}
19:13:37.272286 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.09s]
19:13:37.273388 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
19:13:37.296239 [debug] [MainThread]: Acquiring new redshift connection "master"
19:13:37.297367 [debug] [MainThread]: Using redshift connection "master"
19:13:37.297825 [debug] [MainThread]: On master: BEGIN
19:13:37.298199 [debug] [MainThread]: Opening a new connection, currently in state closed
19:13:37.298506 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:13:38.231528 [debug] [MainThread]: SQL status: BEGIN in 0.93 seconds
19:13:38.231962 [debug] [MainThread]: On master: COMMIT
19:13:38.232143 [debug] [MainThread]: Using redshift connection "master"
19:13:38.232316 [debug] [MainThread]: On master: COMMIT
19:13:38.330502 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
19:13:38.331781 [debug] [MainThread]: On master: Close
19:13:38.333011 [info ] [MainThread]: 
19:13:38.333464 [info ] [MainThread]: Finished running 4 view models in 13.65s.
19:13:38.334782 [debug] [MainThread]: Connection 'master' was properly closed.
19:13:38.335326 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
19:13:38.349244 [info ] [MainThread]: 
19:13:38.349826 [info ] [MainThread]: [32mCompleted successfully[0m
19:13:38.350445 [info ] [MainThread]: 
19:13:38.351065 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
19:13:38.354718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108f0f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b88610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b04940>]}


============================== 2022-07-11 19:15:23.918962 | bb38efc5-2a53-4295-b149-808b8563eb5e ==============================
19:15:23.918987 [info ] [MainThread]: Running with dbt=1.1.1
19:15:23.919399 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
19:15:23.919470 [debug] [MainThread]: Tracking: tracking
19:15:23.936179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108e4f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110948ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110948580>]}
19:15:23.962694 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
19:15:23.962954 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
19:15:23.968905 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
19:15:23.977645 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
19:15:23.983957 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

19:15:23.986449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bb38efc5-2a53-4295-b149-808b8563eb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a22dc0>]}
19:15:23.989491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bb38efc5-2a53-4295-b149-808b8563eb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110954970>]}
19:15:23.989646 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
19:15:23.989775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb38efc5-2a53-4295-b149-808b8563eb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109fceb0>]}
19:15:23.990512 [info ] [MainThread]: 
19:15:23.990726 [debug] [MainThread]: Acquiring new redshift connection "master"
19:15:23.991157 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
19:15:23.996394 [debug] [ThreadPool]: Using redshift connection "list_dev"
19:15:23.996500 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
19:15:23.996565 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:15:23.996633 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:15:25.099040 [debug] [ThreadPool]: SQL status: SELECT in 1.1 seconds
19:15:25.107384 [debug] [ThreadPool]: On list_dev: Close
19:15:25.112218 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
19:15:25.126022 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
19:15:25.126389 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
19:15:25.126575 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:15:25.126763 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:15:26.083742 [debug] [ThreadPool]: SQL status: BEGIN in 0.96 seconds
19:15:26.085737 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
19:15:26.086334 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
19:15:26.200779 [debug] [ThreadPool]: SQL status: SELECT in 0.11 seconds
19:15:26.205880 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
19:15:26.303570 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
19:15:26.325231 [debug] [MainThread]: Using redshift connection "master"
19:15:26.325799 [debug] [MainThread]: On master: BEGIN
19:15:26.325987 [debug] [MainThread]: Opening a new connection, currently in state init
19:15:26.326226 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:15:27.300377 [debug] [MainThread]: SQL status: BEGIN in 0.97 seconds
19:15:27.302051 [debug] [MainThread]: Using redshift connection "master"
19:15:27.302769 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:15:27.478376 [debug] [MainThread]: SQL status: SELECT in 0.18 seconds
19:15:27.485531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb38efc5-2a53-4295-b149-808b8563eb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109fcd30>]}
19:15:27.486788 [debug] [MainThread]: On master: ROLLBACK
19:15:27.585007 [debug] [MainThread]: Using redshift connection "master"
19:15:27.586619 [debug] [MainThread]: On master: BEGIN
19:15:27.783336 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
19:15:27.784746 [debug] [MainThread]: On master: COMMIT
19:15:27.785074 [debug] [MainThread]: Using redshift connection "master"
19:15:27.785372 [debug] [MainThread]: On master: COMMIT
19:15:27.883409 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
19:15:27.884417 [debug] [MainThread]: On master: Close
19:15:27.886391 [info ] [MainThread]: Concurrency: 1 threads (target='test')
19:15:27.887464 [info ] [MainThread]: 
19:15:27.904527 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
19:15:27.907177 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
19:15:27.908068 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
19:15:27.908412 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
19:15:27.908635 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
19:15:27.912931 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
19:15:27.914835 [debug] [Thread-1  ]: finished collecting timing info
19:15:27.915093 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
19:15:27.934115 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
19:15:27.934798 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:15:27.934963 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
19:15:27.935093 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:15:27.935211 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:15:28.863355 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
19:15:28.864618 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:15:28.865025 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

19:15:28.970791 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
19:15:28.992888 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:15:28.993393 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
19:15:29.090562 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:15:29.101413 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:15:29.102001 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
19:15:29.200962 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:15:29.224838 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:15:29.225178 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:15:29.225371 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:15:29.354055 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
19:15:29.355668 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:15:29.355912 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
19:15:29.454888 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:15:29.475553 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:15:29.476595 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
19:15:29.577134 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
19:15:29.580379 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:15:29.580897 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:15:29.581196 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:15:29.708918 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
19:15:29.709885 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:15:29.710274 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
19:15:29.809699 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:15:29.812863 [debug] [Thread-1  ]: finished collecting timing info
19:15:29.813404 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
19:15:29.912903 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
19:15:29.915807 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb38efc5-2a53-4295-b149-808b8563eb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c20ac0>]}
19:15:29.917311 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.01s]
19:15:29.918684 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
19:15:29.922053 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
19:15:29.922833 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
19:15:29.923838 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
19:15:29.924065 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
19:15:29.924315 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
19:15:29.939219 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
19:15:29.940105 [debug] [Thread-1  ]: finished collecting timing info
19:15:29.940234 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
19:15:29.942085 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
19:15:29.942748 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:15:29.942911 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
19:15:29.943050 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:15:29.943413 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:15:30.898046 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
19:15:30.899363 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:15:30.899790 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , NULLIF(
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT, null) AS elapsed_time
FROM "dev"."stg_amplitude"."event"
  ) ;

19:15:31.014623 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
19:15:31.026295 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:15:31.027043 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
19:15:31.124092 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:15:31.138426 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
19:15:31.139036 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:15:31.139408 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
19:15:31.273189 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
19:15:31.274725 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:15:31.275114 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
19:15:31.373350 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:15:31.379482 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:15:31.380129 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
19:15:31.506399 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.13 seconds
19:15:31.510171 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
19:15:31.510723 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:15:31.511094 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
19:15:31.643857 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
19:15:31.645052 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:15:31.645315 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
19:15:31.743586 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:15:31.746408 [debug] [Thread-1  ]: finished collecting timing info
19:15:31.747114 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
19:15:31.843627 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
19:15:31.848744 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb38efc5-2a53-4295-b149-808b8563eb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110aa8a90>]}
19:15:31.851207 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 1.92s]
19:15:31.852430 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
19:15:31.857069 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
19:15:31.858475 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
19:15:31.862906 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
19:15:31.863557 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
19:15:31.864267 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
19:15:31.869683 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
19:15:31.872227 [debug] [Thread-1  ]: finished collecting timing info
19:15:31.872758 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
19:15:31.876085 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
19:15:31.876872 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:15:31.877001 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
19:15:31.877101 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:15:31.877215 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:15:32.843429 [debug] [Thread-1  ]: SQL status: BEGIN in 0.97 seconds
19:15:32.844903 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:15:32.845434 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

19:15:32.957482 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
19:15:32.967373 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:15:32.967930 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
19:15:33.067823 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:15:33.076350 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:15:33.076988 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
19:15:33.176110 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:15:33.181755 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:15:33.182280 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:15:33.182651 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:15:33.313737 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
19:15:33.315346 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:15:33.315576 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
19:15:33.420729 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:15:33.428509 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:15:33.429262 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
19:15:33.534131 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
19:15:33.537303 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:15:33.537753 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:15:33.538115 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:15:33.675683 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
19:15:33.677013 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:15:33.677412 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
19:15:33.779069 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:15:33.780543 [debug] [Thread-1  ]: finished collecting timing info
19:15:33.781042 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
19:15:33.880561 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
19:15:33.883771 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb38efc5-2a53-4295-b149-808b8563eb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110aa8b50>]}
19:15:33.885291 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.02s]
19:15:33.886758 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
19:15:33.891558 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
19:15:33.892276 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
19:15:33.893014 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
19:15:33.896898 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
19:15:33.897862 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
19:15:33.909919 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
19:15:33.910977 [debug] [Thread-1  ]: finished collecting timing info
19:15:33.911146 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
19:15:33.912272 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
19:15:33.912582 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:15:33.912651 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
19:15:33.912709 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:15:33.912773 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:15:34.864995 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
19:15:34.866333 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:15:34.866822 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

19:15:34.988863 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
19:15:35.003799 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:15:35.004571 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
19:15:35.103334 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:15:35.114481 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:15:35.115034 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
19:15:35.222184 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.11 seconds
19:15:35.225882 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:15:35.226149 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:15:35.226332 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:15:35.417946 [debug] [Thread-1  ]: SQL status: COMMIT in 0.19 seconds
19:15:35.420283 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:15:35.420683 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
19:15:35.543443 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
19:15:35.551043 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:15:35.551594 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
19:15:35.650213 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
19:15:35.653886 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:15:35.654320 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:15:35.654694 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:15:35.789168 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
19:15:35.790702 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:15:35.791129 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
19:15:35.889199 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:15:35.892029 [debug] [Thread-1  ]: finished collecting timing info
19:15:35.892525 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
19:15:35.988875 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
19:15:35.992023 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb38efc5-2a53-4295-b149-808b8563eb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110aa8be0>]}
19:15:35.993516 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.10s]
19:15:35.994858 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
19:15:36.001001 [debug] [MainThread]: Acquiring new redshift connection "master"
19:15:36.001597 [debug] [MainThread]: Using redshift connection "master"
19:15:36.001791 [debug] [MainThread]: On master: BEGIN
19:15:36.001970 [debug] [MainThread]: Opening a new connection, currently in state closed
19:15:36.002197 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:15:36.970541 [debug] [MainThread]: SQL status: BEGIN in 0.97 seconds
19:15:36.971271 [debug] [MainThread]: On master: COMMIT
19:15:36.971651 [debug] [MainThread]: Using redshift connection "master"
19:15:36.972012 [debug] [MainThread]: On master: COMMIT
19:15:37.068762 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
19:15:37.069649 [debug] [MainThread]: On master: Close
19:15:37.071327 [info ] [MainThread]: 
19:15:37.072826 [info ] [MainThread]: Finished running 4 view models in 13.08s.
19:15:37.073419 [debug] [MainThread]: Connection 'master' was properly closed.
19:15:37.073592 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
19:15:37.099791 [info ] [MainThread]: 
19:15:37.100488 [info ] [MainThread]: [32mCompleted successfully[0m
19:15:37.100898 [info ] [MainThread]: 
19:15:37.101206 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
19:15:37.101764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109e23d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110aa8e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110aa8a00>]}


============================== 2022-07-11 19:19:16.922029 | ad12fb11-7fa6-4105-b10b-4276ca7fc0be ==============================
19:19:16.922058 [info ] [MainThread]: Running with dbt=1.1.1
19:19:16.922485 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
19:19:16.922565 [debug] [MainThread]: Tracking: tracking
19:19:16.939599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107167f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071c9f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071c95e0>]}
19:19:16.966579 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
19:19:16.966854 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
19:19:16.972734 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
19:19:16.981175 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
19:19:16.987304 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

19:19:16.989774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ad12fb11-7fa6-4105-b10b-4276ca7fc0be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072a3880>]}
19:19:16.993027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ad12fb11-7fa6-4105-b10b-4276ca7fc0be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071d58b0>]}
19:19:16.993160 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
19:19:16.993276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad12fb11-7fa6-4105-b10b-4276ca7fc0be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10727ce20>]}
19:19:16.994007 [info ] [MainThread]: 
19:19:16.994219 [debug] [MainThread]: Acquiring new redshift connection "master"
19:19:16.996841 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
19:19:17.002315 [debug] [ThreadPool]: Using redshift connection "list_dev"
19:19:17.002454 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
19:19:17.002525 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:19:17.002599 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:19:18.065058 [debug] [ThreadPool]: SQL status: SELECT in 1.06 seconds
19:19:18.072230 [debug] [ThreadPool]: On list_dev: Close
19:19:18.078146 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
19:19:18.101243 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
19:19:18.101829 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
19:19:18.102035 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:19:18.102266 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:19:19.070121 [debug] [ThreadPool]: SQL status: BEGIN in 0.97 seconds
19:19:19.071412 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
19:19:19.071959 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
19:19:19.187248 [debug] [ThreadPool]: SQL status: SELECT in 0.11 seconds
19:19:19.194536 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
19:19:19.294246 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
19:19:19.312606 [debug] [MainThread]: Using redshift connection "master"
19:19:19.313216 [debug] [MainThread]: On master: BEGIN
19:19:19.313430 [debug] [MainThread]: Opening a new connection, currently in state init
19:19:19.313690 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:19:20.260594 [debug] [MainThread]: SQL status: BEGIN in 0.95 seconds
19:19:20.261922 [debug] [MainThread]: Using redshift connection "master"
19:19:20.262356 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:19:20.441955 [debug] [MainThread]: SQL status: SELECT in 0.18 seconds
19:19:20.447791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad12fb11-7fa6-4105-b10b-4276ca7fc0be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10727cca0>]}
19:19:20.448538 [debug] [MainThread]: On master: ROLLBACK
19:19:20.545438 [debug] [MainThread]: Using redshift connection "master"
19:19:20.546573 [debug] [MainThread]: On master: BEGIN
19:19:20.751231 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
19:19:20.754046 [debug] [MainThread]: On master: COMMIT
19:19:20.754708 [debug] [MainThread]: Using redshift connection "master"
19:19:20.755090 [debug] [MainThread]: On master: COMMIT
19:19:20.862030 [debug] [MainThread]: SQL status: COMMIT in 0.11 seconds
19:19:20.863296 [debug] [MainThread]: On master: Close
19:19:20.865095 [info ] [MainThread]: Concurrency: 1 threads (target='test')
19:19:20.871953 [info ] [MainThread]: 
19:19:20.889173 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
19:19:20.890102 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
19:19:20.890919 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
19:19:20.891152 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
19:19:20.891376 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
19:19:20.895360 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
19:19:20.896678 [debug] [Thread-1  ]: finished collecting timing info
19:19:20.896918 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
19:19:20.913774 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
19:19:20.914264 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:19:20.914353 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
19:19:20.914425 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:19:20.914505 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:19:21.844156 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
19:19:21.845041 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:19:21.845424 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

19:19:21.951979 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
19:19:21.974568 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:19:21.975025 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
19:19:22.070330 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
19:19:22.079977 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:19:22.080516 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
19:19:22.183505 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:19:22.212179 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:19:22.212729 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:19:22.213041 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:19:22.350518 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
19:19:22.361230 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:19:22.361834 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
19:19:22.462513 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:19:22.476418 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:19:22.476978 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
19:19:22.574501 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
19:19:22.579308 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:19:22.579922 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:19:22.580275 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:19:22.707254 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
19:19:22.708660 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:19:22.709885 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
19:19:22.808141 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:19:22.811108 [debug] [Thread-1  ]: finished collecting timing info
19:19:22.812255 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
19:19:22.911569 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
19:19:22.915260 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad12fb11-7fa6-4105-b10b-4276ca7fc0be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073a2c70>]}
19:19:22.917303 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.02s]
19:19:22.918995 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
19:19:22.924135 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
19:19:22.924754 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
19:19:22.927760 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
19:19:22.929466 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
19:19:22.929968 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
19:19:22.944220 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
19:19:22.946821 [debug] [Thread-1  ]: finished collecting timing info
19:19:22.947026 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
19:19:22.949851 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
19:19:22.950372 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:19:22.950521 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
19:19:22.950656 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:19:22.950809 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:19:23.886955 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
19:19:23.889615 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:19:23.890075 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
FROM "dev"."stg_amplitude"."event"
  ) ;

19:19:24.008162 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
19:19:24.021964 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:19:24.022545 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
19:19:24.119037 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:19:24.126457 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:19:24.126960 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
19:19:24.228732 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:19:24.233382 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
19:19:24.233781 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:19:24.233984 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
19:19:24.365523 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
19:19:24.367524 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:19:24.368123 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
19:19:24.469951 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:19:24.478345 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:19:24.479048 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
19:19:24.578071 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
19:19:24.581512 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
19:19:24.582004 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:19:24.582367 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
19:19:24.711524 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
19:19:24.712859 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:19:24.713271 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
19:19:24.811221 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:19:24.816800 [debug] [Thread-1  ]: finished collecting timing info
19:19:24.833868 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
19:19:24.935479 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
19:19:24.939142 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad12fb11-7fa6-4105-b10b-4276ca7fc0be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073950d0>]}
19:19:24.940676 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.01s]
19:19:24.941992 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
19:19:24.942419 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
19:19:24.947697 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
19:19:24.949081 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
19:19:24.968761 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
19:19:24.987842 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
19:19:25.017436 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
19:19:25.028570 [debug] [Thread-1  ]: finished collecting timing info
19:19:25.029431 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
19:19:25.035700 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
19:19:25.037440 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:19:25.037712 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
19:19:25.037920 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:19:25.038175 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:19:25.966622 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
19:19:25.968100 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:19:25.968607 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

19:19:26.072756 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
19:19:26.080131 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:19:26.080660 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
19:19:26.176746 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:19:26.185119 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:19:26.185705 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
19:19:26.285958 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:19:26.289797 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:19:26.290267 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:19:26.290442 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:19:26.421718 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
19:19:26.423779 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:19:26.424198 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
19:19:26.521251 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:19:26.527772 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:19:26.528159 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
19:19:26.629419 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
19:19:26.632069 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:19:26.632333 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:19:26.632576 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
19:19:26.756865 [debug] [Thread-1  ]: SQL status: COMMIT in 0.12 seconds
19:19:26.758127 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:19:26.758512 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
19:19:26.857383 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:19:26.859929 [debug] [Thread-1  ]: finished collecting timing info
19:19:26.860446 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
19:19:26.962034 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
19:19:26.965576 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad12fb11-7fa6-4105-b10b-4276ca7fc0be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107395130>]}
19:19:26.967087 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.02s]
19:19:26.968624 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
19:19:26.973834 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
19:19:26.974767 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
19:19:26.975518 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
19:19:26.975736 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
19:19:26.975969 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
19:19:26.989798 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
19:19:26.991916 [debug] [Thread-1  ]: finished collecting timing info
19:19:26.992162 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
19:19:26.996433 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
19:19:26.997234 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:19:26.997358 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
19:19:26.997457 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:19:26.997570 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:19:27.926520 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
19:19:27.927775 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:19:27.928159 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

19:19:28.056669 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.13 seconds
19:19:28.067302 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:19:28.068009 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
19:19:28.165221 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:19:28.173615 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:19:28.174258 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
19:19:28.276680 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:19:28.280762 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:19:28.281271 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:19:28.281613 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:19:28.417495 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
19:19:28.419531 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:19:28.419913 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
19:19:28.518770 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:19:28.525641 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:19:28.526254 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
19:19:28.626060 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
19:19:28.630750 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:19:28.631359 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:19:28.631705 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
19:19:28.761834 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
19:19:28.763432 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:19:28.763835 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
19:19:28.862623 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:19:28.865319 [debug] [Thread-1  ]: finished collecting timing info
19:19:28.865886 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
19:19:28.962720 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
19:19:28.966526 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad12fb11-7fa6-4105-b10b-4276ca7fc0be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10733feb0>]}
19:19:28.968489 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 1.99s]
19:19:28.974638 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
19:19:28.978050 [debug] [MainThread]: Acquiring new redshift connection "master"
19:19:28.978605 [debug] [MainThread]: Using redshift connection "master"
19:19:28.978787 [debug] [MainThread]: On master: BEGIN
19:19:28.978965 [debug] [MainThread]: Opening a new connection, currently in state closed
19:19:28.979199 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:19:29.940441 [debug] [MainThread]: SQL status: BEGIN in 0.96 seconds
19:19:29.941915 [debug] [MainThread]: On master: COMMIT
19:19:29.942322 [debug] [MainThread]: Using redshift connection "master"
19:19:29.942704 [debug] [MainThread]: On master: COMMIT
19:19:30.040142 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
19:19:30.041755 [debug] [MainThread]: On master: Close
19:19:30.044003 [info ] [MainThread]: 
19:19:30.044905 [info ] [MainThread]: Finished running 4 view models in 13.05s.
19:19:30.045553 [debug] [MainThread]: Connection 'master' was properly closed.
19:19:30.049647 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
19:19:30.066730 [info ] [MainThread]: 
19:19:30.069089 [info ] [MainThread]: [32mCompleted successfully[0m
19:19:30.069597 [info ] [MainThread]: 
19:19:30.069861 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
19:19:30.070235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107260430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10733ff40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10733f8b0>]}


============================== 2022-07-11 19:24:58.093034 | a764f344-59b2-448a-afcb-ae2516a218d9 ==============================
19:24:58.093056 [info ] [MainThread]: Running with dbt=1.1.1
19:24:58.093269 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
19:24:58.093335 [debug] [MainThread]: Tracking: tracking
19:24:58.109886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111d4c0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111d4c700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111d4c4c0>]}
19:24:58.135877 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
19:24:58.136162 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
19:24:58.136379 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://macros/json_extract_text.sql
19:24:58.136464 [debug] [MainThread]: Parsing macros/json_extract_text.sql
19:24:58.137863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e3fd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111dc24f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111dc2550>]}


============================== 2022-07-11 19:26:29.101392 | 974355f7-9087-40cf-9eb5-f0e80a5a5473 ==============================
19:26:29.101411 [info ] [MainThread]: Running with dbt=1.1.1
19:26:29.101610 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
19:26:29.101675 [debug] [MainThread]: Tracking: tracking
19:26:29.121238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070040d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107004700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070044c0>]}
19:26:29.145743 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
19:26:29.146026 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
19:26:29.146253 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://macros/json_extract_text.sql
19:26:29.146338 [debug] [MainThread]: Parsing macros/json_extract_text.sql
19:26:29.153143 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
19:26:29.161328 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
19:26:29.161965 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_device.sql
19:26:29.163943 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_device.sql
19:26:29.164472 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_profile.sql
19:26:29.165823 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_profile.sql
19:26:29.166459 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_workouts.sql
19:26:29.169939 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_workouts.sql
19:26:29.176886 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

19:26:29.179431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '974355f7-9087-40cf-9eb5-f0e80a5a5473', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070f5610>]}
19:26:29.182333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '974355f7-9087-40cf-9eb5-f0e80a5a5473', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107004160>]}
19:26:29.182476 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
19:26:29.182604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '974355f7-9087-40cf-9eb5-f0e80a5a5473', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107012d30>]}
19:26:29.183306 [info ] [MainThread]: 
19:26:29.183533 [debug] [MainThread]: Acquiring new redshift connection "master"
19:26:29.183978 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
19:26:29.189087 [debug] [ThreadPool]: Using redshift connection "list_dev"
19:26:29.189171 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
19:26:29.189237 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:26:29.189304 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:26:30.254760 [debug] [ThreadPool]: SQL status: SELECT in 1.07 seconds
19:26:30.265506 [debug] [ThreadPool]: On list_dev: Close
19:26:30.270270 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
19:26:30.284742 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
19:26:30.285099 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
19:26:30.285283 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:26:30.285481 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:26:31.205320 [debug] [ThreadPool]: SQL status: BEGIN in 0.92 seconds
19:26:31.206402 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
19:26:31.206665 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
19:26:31.321057 [debug] [ThreadPool]: SQL status: SELECT in 0.11 seconds
19:26:31.329960 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
19:26:31.432681 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
19:26:31.450495 [debug] [MainThread]: Using redshift connection "master"
19:26:31.451865 [debug] [MainThread]: On master: BEGIN
19:26:31.452124 [debug] [MainThread]: Opening a new connection, currently in state init
19:26:31.452465 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:26:32.392630 [debug] [MainThread]: SQL status: BEGIN in 0.94 seconds
19:26:32.394155 [debug] [MainThread]: Using redshift connection "master"
19:26:32.394569 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:26:32.591895 [debug] [MainThread]: SQL status: SELECT in 0.2 seconds
19:26:32.599638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '974355f7-9087-40cf-9eb5-f0e80a5a5473', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070bf7c0>]}
19:26:32.601021 [debug] [MainThread]: On master: ROLLBACK
19:26:32.696259 [debug] [MainThread]: Using redshift connection "master"
19:26:32.697541 [debug] [MainThread]: On master: BEGIN
19:26:32.898255 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
19:26:32.899573 [debug] [MainThread]: On master: COMMIT
19:26:32.900036 [debug] [MainThread]: Using redshift connection "master"
19:26:32.900411 [debug] [MainThread]: On master: COMMIT
19:26:33.001533 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
19:26:33.002437 [debug] [MainThread]: On master: Close
19:26:33.004405 [info ] [MainThread]: Concurrency: 1 threads (target='test')
19:26:33.005293 [info ] [MainThread]: 
19:26:33.020721 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
19:26:33.021915 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
19:26:33.023275 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
19:26:33.023609 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
19:26:33.023889 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
19:26:33.029245 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
19:26:33.034524 [debug] [Thread-1  ]: finished collecting timing info
19:26:33.034795 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
19:26:33.053647 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
19:26:33.054333 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:26:33.054478 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
19:26:33.054601 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:26:33.054733 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:26:33.956639 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
19:26:33.957716 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:26:33.958047 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(event_properties,'device_type',true),user_properties))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

19:26:34.062594 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
19:26:34.086823 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:26:34.087365 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
19:26:34.180969 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
19:26:34.191571 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:26:34.192051 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
19:26:34.286298 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
19:26:34.309903 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:26:34.310555 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:26:34.310770 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:26:34.439110 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
19:26:34.441225 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:26:34.441626 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
19:26:34.537344 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:26:34.556072 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:26:34.556619 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
19:26:34.664976 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
19:26:34.668478 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:26:34.668838 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:26:34.669223 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
19:26:34.792761 [debug] [Thread-1  ]: SQL status: COMMIT in 0.12 seconds
19:26:34.793766 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
19:26:34.794141 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
19:26:34.899483 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
19:26:34.902440 [debug] [Thread-1  ]: finished collecting timing info
19:26:34.903003 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
19:26:34.996204 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
19:26:35.000107 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '974355f7-9087-40cf-9eb5-f0e80a5a5473', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10716e070>]}
19:26:35.001775 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 1.98s]
19:26:35.003382 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
19:26:35.004024 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
19:26:35.004604 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
19:26:35.009117 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
19:26:35.009512 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
19:26:35.009851 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
19:26:35.025865 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
19:26:35.028129 [debug] [Thread-1  ]: finished collecting timing info
19:26:35.028474 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
19:26:35.036014 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
19:26:35.036470 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:26:35.036539 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
19:26:35.036597 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:26:35.036664 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:26:35.948849 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
19:26:35.950155 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
19:26:35.950551 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(event_properties,'membership_status',true),user_properties))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(event_properties,'onboardingVersion',true),user_properties))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),))

  AS class_quit_reason
  , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),0))
::FLOAT 
  AS elapsed_time
FROM "dev"."stg_amplitude"."event"
  ) ;

19:26:36.060691 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near ")"
LINE 15: ...xtract_path_text(event_properties,'multiplayerMode',true),))
                                                                      ^

19:26:36.062631 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
19:26:36.157271 [debug] [Thread-1  ]: finished collecting timing info
19:26:36.158227 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
19:26:36.160194 [debug] [Thread-1  ]: Database Error in model amplitude_event (models/amplitude/amplitude_event.sql)
  syntax error at or near ")"
  LINE 15: ...xtract_path_text(event_properties,'multiplayerMode',true),))
                                                                        ^
  compiled SQL at target/run/amplitude_event/models/amplitude/amplitude_event.sql
19:26:36.161540 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '974355f7-9087-40cf-9eb5-f0e80a5a5473', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10724a520>]}
19:26:36.163009 [error] [Thread-1  ]: 2 of 4 ERROR creating view model dbt_amplitude_test.amplitude_event ............ [[31mERROR[0m in 1.15s]
19:26:36.164535 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
19:26:36.170132 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
19:26:36.171829 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
19:26:36.173349 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
19:26:36.174012 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
19:26:36.174255 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
19:26:36.181859 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
19:26:36.182917 [debug] [Thread-1  ]: finished collecting timing info
19:26:36.183135 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
19:26:36.187598 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
19:26:36.189406 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:26:36.189797 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
19:26:36.189989 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:26:36.190194 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:26:37.144681 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
19:26:37.145796 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
19:26:37.146017 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

19:26:37.258092 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near ")"
LINE 9: ...nullif(json_extract_path_text(event_properties,'id',true),))
                                                                     ^

19:26:37.259615 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
19:26:37.353127 [debug] [Thread-1  ]: finished collecting timing info
19:26:37.353992 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
19:26:37.355786 [debug] [Thread-1  ]: Database Error in model amplitude_profile (models/amplitude/amplitude_profile.sql)
  syntax error at or near ")"
  LINE 9: ...nullif(json_extract_path_text(event_properties,'id',true),))
                                                                       ^
  compiled SQL at target/run/amplitude_event/models/amplitude/amplitude_profile.sql
19:26:37.356778 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '974355f7-9087-40cf-9eb5-f0e80a5a5473', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107258c70>]}
19:26:37.358131 [error] [Thread-1  ]: 3 of 4 ERROR creating view model dbt_amplitude_test.amplitude_profile .......... [[31mERROR[0m in 1.18s]
19:26:37.362227 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
19:26:37.362921 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
19:26:37.363575 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
19:26:37.365041 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
19:26:37.365257 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
19:26:37.365483 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
19:26:37.378333 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
19:26:37.379402 [debug] [Thread-1  ]: finished collecting timing info
19:26:37.379638 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
19:26:37.381139 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
19:26:37.381376 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:26:37.381442 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
19:26:37.381499 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:26:37.381576 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:26:38.287598 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
19:26:38.288888 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
19:26:38.289292 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(event_properties,'membership_status',true),user_properties))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(event_properties,'onboardingVersion',true),user_properties))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

19:26:38.408580 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near ")"
LINE 59: ...on_extract_path_text(event_properties,'classLength',true),))
                                                                      ^

19:26:38.409701 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
19:26:38.505179 [debug] [Thread-1  ]: finished collecting timing info
19:26:38.506122 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
19:26:38.507889 [debug] [Thread-1  ]: Database Error in model amplitude_workouts (models/amplitude/amplitude_workouts.sql)
  syntax error at or near ")"
  LINE 59: ...on_extract_path_text(event_properties,'classLength',true),))
                                                                        ^
  compiled SQL at target/run/amplitude_event/models/amplitude/amplitude_workouts.sql
19:26:38.508851 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '974355f7-9087-40cf-9eb5-f0e80a5a5473', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107282a30>]}
19:26:38.510148 [error] [Thread-1  ]: 4 of 4 ERROR creating view model dbt_amplitude_test.amplitude_workouts ......... [[31mERROR[0m in 1.14s]
19:26:38.511550 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
19:26:38.518162 [debug] [MainThread]: Acquiring new redshift connection "master"
19:26:38.518684 [debug] [MainThread]: Using redshift connection "master"
19:26:38.518872 [debug] [MainThread]: On master: BEGIN
19:26:38.519056 [debug] [MainThread]: Opening a new connection, currently in state closed
19:26:38.519278 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:26:39.427456 [debug] [MainThread]: SQL status: BEGIN in 0.91 seconds
19:26:39.428961 [debug] [MainThread]: On master: COMMIT
19:26:39.430154 [debug] [MainThread]: Using redshift connection "master"
19:26:39.430585 [debug] [MainThread]: On master: COMMIT
19:26:39.528953 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
19:26:39.529855 [debug] [MainThread]: On master: Close
19:26:39.532113 [info ] [MainThread]: 
19:26:39.533021 [info ] [MainThread]: Finished running 4 view models in 10.35s.
19:26:39.533684 [debug] [MainThread]: Connection 'master' was properly closed.
19:26:39.539179 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
19:26:39.555317 [info ] [MainThread]: 
19:26:39.556054 [info ] [MainThread]: [31mCompleted with 3 errors and 0 warnings:[0m
19:26:39.556451 [info ] [MainThread]: 
19:26:39.556761 [error] [MainThread]: [33mDatabase Error in model amplitude_event (models/amplitude/amplitude_event.sql)[0m
19:26:39.557079 [error] [MainThread]:   syntax error at or near ")"
19:26:39.557605 [error] [MainThread]:   LINE 15: ...xtract_path_text(event_properties,'multiplayerMode',true),))
19:26:39.557951 [error] [MainThread]:                                                                         ^
19:26:39.558178 [error] [MainThread]:   compiled SQL at target/run/amplitude_event/models/amplitude/amplitude_event.sql
19:26:39.558424 [info ] [MainThread]: 
19:26:39.558668 [error] [MainThread]: [33mDatabase Error in model amplitude_profile (models/amplitude/amplitude_profile.sql)[0m
19:26:39.558902 [error] [MainThread]:   syntax error at or near ")"
19:26:39.559124 [error] [MainThread]:   LINE 9: ...nullif(json_extract_path_text(event_properties,'id',true),))
19:26:39.559339 [error] [MainThread]:                                                                        ^
19:26:39.559547 [error] [MainThread]:   compiled SQL at target/run/amplitude_event/models/amplitude/amplitude_profile.sql
19:26:39.559760 [info ] [MainThread]: 
19:26:39.560365 [error] [MainThread]: [33mDatabase Error in model amplitude_workouts (models/amplitude/amplitude_workouts.sql)[0m
19:26:39.560644 [error] [MainThread]:   syntax error at or near ")"
19:26:39.560874 [error] [MainThread]:   LINE 59: ...on_extract_path_text(event_properties,'classLength',true),))
19:26:39.561102 [error] [MainThread]:                                                                         ^
19:26:39.561318 [error] [MainThread]:   compiled SQL at target/run/amplitude_event/models/amplitude/amplitude_workouts.sql
19:26:39.561572 [info ] [MainThread]: 
19:26:39.561826 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=3 SKIP=0 TOTAL=4
19:26:39.562265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071f9040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107012550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071d2160>]}


============================== 2022-07-11 20:00:41.251446 | 31c5f33f-2054-4f7d-ab0e-1e4e9ec27ffa ==============================
20:00:41.251464 [info ] [MainThread]: Running with dbt=1.1.1
20:00:41.251659 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
20:00:41.251723 [debug] [MainThread]: Tracking: tracking
20:00:41.268178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b45fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bc5a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bc5670>]}
20:00:41.294357 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
20:00:41.294614 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
20:00:41.294858 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://macros/json_extract_text.sql
20:00:41.294947 [debug] [MainThread]: Parsing macros/json_extract_text.sql
20:00:41.301914 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
20:00:41.309700 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
20:00:41.310301 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_device.sql
20:00:41.312233 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_device.sql
20:00:41.312745 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_profile.sql
20:00:41.314094 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_profile.sql
20:00:41.314712 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_workouts.sql
20:00:41.318014 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_workouts.sql
20:00:41.324950 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

20:00:41.327482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31c5f33f-2054-4f7d-ab0e-1e4e9ec27ffa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f1eee0>]}
20:00:41.330187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31c5f33f-2054-4f7d-ab0e-1e4e9ec27ffa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d61250>]}
20:00:41.330321 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 194 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
20:00:41.330441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '31c5f33f-2054-4f7d-ab0e-1e4e9ec27ffa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bd2d90>]}
20:00:41.331146 [info ] [MainThread]: 
20:00:41.331360 [debug] [MainThread]: Acquiring new redshift connection "master"
20:00:41.331800 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
20:00:41.336909 [debug] [ThreadPool]: Using redshift connection "list_dev"
20:00:41.336998 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
20:00:41.337063 [debug] [ThreadPool]: Opening a new connection, currently in state init
20:00:41.337128 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:00:42.362398 [debug] [ThreadPool]: SQL status: SELECT in 1.03 seconds
20:00:42.369662 [debug] [ThreadPool]: On list_dev: Close
20:00:42.374031 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
20:00:42.388937 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
20:00:42.389377 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
20:00:42.389569 [debug] [ThreadPool]: Opening a new connection, currently in state closed
20:00:42.389772 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:00:43.308464 [debug] [ThreadPool]: SQL status: BEGIN in 0.92 seconds
20:00:43.309153 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
20:00:43.309363 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
20:00:43.425810 [debug] [ThreadPool]: SQL status: SELECT in 0.12 seconds
20:00:43.431685 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
20:00:43.526773 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
20:00:43.544546 [debug] [MainThread]: Using redshift connection "master"
20:00:43.545070 [debug] [MainThread]: On master: BEGIN
20:00:43.545279 [debug] [MainThread]: Opening a new connection, currently in state init
20:00:43.545542 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:00:44.450154 [debug] [MainThread]: SQL status: BEGIN in 0.9 seconds
20:00:44.451461 [debug] [MainThread]: Using redshift connection "master"
20:00:44.451862 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
20:00:44.616142 [debug] [MainThread]: SQL status: SELECT in 0.16 seconds
20:00:44.624161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '31c5f33f-2054-4f7d-ab0e-1e4e9ec27ffa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bf7040>]}
20:00:44.625522 [debug] [MainThread]: On master: ROLLBACK
20:00:44.716319 [debug] [MainThread]: Using redshift connection "master"
20:00:44.717113 [debug] [MainThread]: On master: BEGIN
20:00:44.903401 [debug] [MainThread]: SQL status: BEGIN in 0.19 seconds
20:00:44.904498 [debug] [MainThread]: On master: COMMIT
20:00:44.904897 [debug] [MainThread]: Using redshift connection "master"
20:00:44.905254 [debug] [MainThread]: On master: COMMIT
20:00:45.000649 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
20:00:45.001577 [debug] [MainThread]: On master: Close
20:00:45.005044 [info ] [MainThread]: Concurrency: 1 threads (target='test')
20:00:45.006315 [info ] [MainThread]: 
20:00:45.025298 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
20:00:45.030148 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
20:00:45.031494 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
20:00:45.031896 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
20:00:45.032186 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
20:00:45.036082 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
20:00:45.036793 [debug] [Thread-1  ]: finished collecting timing info
20:00:45.036914 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
20:00:45.055055 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
20:00:45.055623 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:00:45.055734 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
20:00:45.055824 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:00:45.055921 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:00:45.955063 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
20:00:45.956475 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:00:45.956823 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

20:00:46.057765 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
20:00:46.077137 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:00:46.078213 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
20:00:46.170100 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
20:00:46.176869 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:00:46.177325 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
20:00:46.273902 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
20:00:46.296800 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
20:00:46.297370 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:00:46.297638 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
20:00:46.436252 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
20:00:46.437723 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:00:46.438102 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
20:00:46.533697 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
20:00:46.549963 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:00:46.550613 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
20:00:46.645637 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.09 seconds
20:00:46.648795 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
20:00:46.649189 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:00:46.649539 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
20:00:46.773130 [debug] [Thread-1  ]: SQL status: COMMIT in 0.12 seconds
20:00:46.774039 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:00:46.774690 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
20:00:46.870214 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
20:00:46.872943 [debug] [Thread-1  ]: finished collecting timing info
20:00:46.873430 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
20:00:46.964886 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
20:00:46.967620 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '31c5f33f-2054-4f7d-ab0e-1e4e9ec27ffa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f5a220>]}
20:00:46.969164 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 1.94s]
20:00:46.970635 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
20:00:46.975989 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
20:00:46.976740 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
20:00:46.977465 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
20:00:46.977683 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
20:00:46.977938 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
20:00:46.991577 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
20:00:46.993684 [debug] [Thread-1  ]: finished collecting timing info
20:00:46.993919 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
20:00:46.996015 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
20:00:46.996543 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:00:46.996648 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
20:00:46.996741 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:00:46.996845 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:00:47.949394 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
20:00:47.950602 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:00:47.951004 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , nullif(json_extract_path_text('event_properties','timeElapsed',true),'0') :: FLOAT AS elapsed_time
FROM "dev"."stg_amplitude"."event"
  ) ;

20:00:48.064974 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
20:00:48.074834 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:00:48.075488 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
20:00:48.167304 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
20:00:48.173886 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:00:48.174356 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
20:00:48.268799 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
20:00:48.274509 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
20:00:48.275320 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:00:48.275698 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
20:00:48.423095 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
20:00:48.424387 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:00:48.424758 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
20:00:48.530663 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
20:00:48.537002 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:00:48.537721 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
20:00:48.634863 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
20:00:48.638264 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
20:00:48.638821 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:00:48.639189 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
20:00:48.765030 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
20:00:48.765820 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:00:48.766181 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
20:00:48.863608 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
20:00:48.865725 [debug] [Thread-1  ]: finished collecting timing info
20:00:48.866205 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
20:00:48.960384 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
20:00:48.962859 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '31c5f33f-2054-4f7d-ab0e-1e4e9ec27ffa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f7c040>]}
20:00:48.964260 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 1.99s]
20:00:48.965677 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
20:00:48.970864 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
20:00:48.971555 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
20:00:48.972304 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
20:00:48.972527 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
20:00:48.972755 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
20:00:48.979153 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
20:00:48.981105 [debug] [Thread-1  ]: finished collecting timing info
20:00:48.981420 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
20:00:48.983559 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
20:00:48.984028 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:00:48.984185 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
20:00:48.984319 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:00:48.984463 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:00:49.921056 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
20:00:49.922372 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:00:49.922810 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

20:00:50.031660 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
20:00:50.042936 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:00:50.043790 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
20:00:50.136273 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
20:00:50.147458 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:00:50.148207 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
20:00:50.241319 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
20:00:50.246836 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
20:00:50.247320 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:00:50.247677 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
20:00:50.376943 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
20:00:50.378114 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:00:50.378505 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
20:00:50.472969 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
20:00:50.478649 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:00:50.479015 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
20:00:50.579081 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
20:00:50.582531 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
20:00:50.583323 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:00:50.583681 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
20:00:50.706313 [debug] [Thread-1  ]: SQL status: COMMIT in 0.12 seconds
20:00:50.707179 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:00:50.707556 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
20:00:50.804688 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
20:00:50.806897 [debug] [Thread-1  ]: finished collecting timing info
20:00:50.807380 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
20:00:50.901561 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
20:00:50.904028 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '31c5f33f-2054-4f7d-ab0e-1e4e9ec27ffa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10714b040>]}
20:00:50.905323 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.93s]
20:00:50.906672 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
20:00:50.911418 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
20:00:50.912057 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
20:00:50.912770 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
20:00:50.912987 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
20:00:50.913213 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
20:00:50.929250 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
20:00:50.931244 [debug] [Thread-1  ]: finished collecting timing info
20:00:50.931509 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
20:00:50.933997 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
20:00:50.934940 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:00:50.935148 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
20:00:50.935318 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:00:50.935500 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:00:51.829469 [debug] [Thread-1  ]: SQL status: BEGIN in 0.89 seconds
20:00:51.830376 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:00:51.830774 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

20:00:51.939867 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
20:00:51.948660 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:00:51.949324 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
20:00:52.042737 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
20:00:52.049858 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:00:52.050506 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
20:00:52.144975 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
20:00:52.148445 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
20:00:52.148872 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:00:52.149350 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
20:00:52.308055 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
20:00:52.309892 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:00:52.310291 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
20:00:52.424340 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
20:00:52.430912 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:00:52.431886 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
20:00:52.530113 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
20:00:52.532664 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
20:00:52.533106 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:00:52.533439 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
20:00:52.661353 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
20:00:52.662188 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:00:52.662570 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
20:00:52.758277 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
20:00:52.761111 [debug] [Thread-1  ]: finished collecting timing info
20:00:52.761781 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
20:00:52.855156 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
20:00:52.858426 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '31c5f33f-2054-4f7d-ab0e-1e4e9ec27ffa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f58e20>]}
20:00:52.859962 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 1.95s]
20:00:52.861419 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
20:00:52.868956 [debug] [MainThread]: Acquiring new redshift connection "master"
20:00:52.869381 [debug] [MainThread]: Using redshift connection "master"
20:00:52.869569 [debug] [MainThread]: On master: BEGIN
20:00:52.869839 [debug] [MainThread]: Opening a new connection, currently in state closed
20:00:52.870061 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:00:53.748857 [debug] [MainThread]: SQL status: BEGIN in 0.88 seconds
20:00:53.750482 [debug] [MainThread]: On master: COMMIT
20:00:53.750967 [debug] [MainThread]: Using redshift connection "master"
20:00:53.751390 [debug] [MainThread]: On master: COMMIT
20:00:53.846115 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
20:00:53.846990 [debug] [MainThread]: On master: Close
20:00:53.849305 [info ] [MainThread]: 
20:00:53.850686 [info ] [MainThread]: Finished running 4 view models in 12.52s.
20:00:53.851729 [debug] [MainThread]: Connection 'master' was properly closed.
20:00:53.852087 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
20:00:53.867705 [info ] [MainThread]: 
20:00:53.868232 [info ] [MainThread]: [32mCompleted successfully[0m
20:00:53.869134 [info ] [MainThread]: 
20:00:53.869595 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
20:00:53.870095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d61280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bc50a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bd2d90>]}


============================== 2022-07-11 20:06:24.961088 | 2fa67b83-da7e-4cb6-9d9e-0bcdda062c92 ==============================
20:06:24.961108 [info ] [MainThread]: Running with dbt=1.1.1
20:06:24.961314 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
20:06:24.961378 [debug] [MainThread]: Tracking: tracking
20:06:24.978646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ce1fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d0ff70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d0f610>]}
20:06:25.005097 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
20:06:25.005364 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
20:06:25.005607 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://macros/json_extract_text.sql
20:06:25.005692 [debug] [MainThread]: Parsing macros/json_extract_text.sql
20:06:25.012898 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
20:06:25.021339 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
20:06:25.021918 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_device.sql
20:06:25.023480 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_device.sql
20:06:25.023931 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_profile.sql
20:06:25.025231 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_profile.sql
20:06:25.025860 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_workouts.sql
20:06:25.029386 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_workouts.sql
20:06:25.036526 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.amplitude

20:06:25.039223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2fa67b83-da7e-4cb6-9d9e-0bcdda062c92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e14f70>]}
20:06:25.042523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2fa67b83-da7e-4cb6-9d9e-0bcdda062c92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109de15b0>]}
20:06:25.042674 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 195 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
20:06:25.042798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2fa67b83-da7e-4cb6-9d9e-0bcdda062c92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d1a400>]}
20:06:25.043490 [info ] [MainThread]: 
20:06:25.043697 [debug] [MainThread]: Acquiring new redshift connection "master"
20:06:25.044136 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
20:06:25.049353 [debug] [ThreadPool]: Using redshift connection "list_dev"
20:06:25.049437 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
20:06:25.049497 [debug] [ThreadPool]: Opening a new connection, currently in state init
20:06:25.049569 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:06:26.117740 [debug] [ThreadPool]: SQL status: SELECT in 1.07 seconds
20:06:26.120748 [debug] [ThreadPool]: On list_dev: Close
20:06:26.123641 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
20:06:26.138147 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
20:06:26.138523 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
20:06:26.138730 [debug] [ThreadPool]: Opening a new connection, currently in state closed
20:06:26.138950 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:06:27.091334 [debug] [ThreadPool]: SQL status: BEGIN in 0.95 seconds
20:06:27.092619 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
20:06:27.093014 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
20:06:27.216362 [debug] [ThreadPool]: SQL status: SELECT in 0.12 seconds
20:06:27.221513 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
20:06:27.327274 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
20:06:27.341093 [debug] [MainThread]: Using redshift connection "master"
20:06:27.341841 [debug] [MainThread]: On master: BEGIN
20:06:27.342128 [debug] [MainThread]: Opening a new connection, currently in state init
20:06:27.342461 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:06:28.315338 [debug] [MainThread]: SQL status: BEGIN in 0.97 seconds
20:06:28.316725 [debug] [MainThread]: Using redshift connection "master"
20:06:28.317246 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
20:06:28.560533 [debug] [MainThread]: SQL status: SELECT in 0.24 seconds
20:06:28.567148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2fa67b83-da7e-4cb6-9d9e-0bcdda062c92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d1af40>]}
20:06:28.568209 [debug] [MainThread]: On master: ROLLBACK
20:06:28.664584 [debug] [MainThread]: Using redshift connection "master"
20:06:28.665400 [debug] [MainThread]: On master: BEGIN
20:06:28.872891 [debug] [MainThread]: SQL status: BEGIN in 0.21 seconds
20:06:28.873785 [debug] [MainThread]: On master: COMMIT
20:06:28.874240 [debug] [MainThread]: Using redshift connection "master"
20:06:28.874649 [debug] [MainThread]: On master: COMMIT
20:06:28.973753 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
20:06:28.974631 [debug] [MainThread]: On master: Close
20:06:28.977239 [info ] [MainThread]: Concurrency: 1 threads (target='test')
20:06:28.978509 [info ] [MainThread]: 
20:06:28.995992 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
20:06:28.996916 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
20:06:28.997701 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
20:06:28.997980 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
20:06:28.998237 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
20:06:29.003518 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
20:06:29.004765 [debug] [Thread-1  ]: finished collecting timing info
20:06:29.004937 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
20:06:29.025277 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
20:06:29.025958 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:06:29.026096 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
20:06:29.026206 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:06:29.026318 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:06:29.965989 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
20:06:29.966889 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:06:29.967270 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

20:06:30.080120 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
20:06:30.100632 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:06:30.101132 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
20:06:30.197646 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
20:06:30.207310 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:06:30.208014 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
20:06:30.305665 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
20:06:30.327022 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
20:06:30.327616 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:06:30.327861 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
20:06:30.549268 [debug] [Thread-1  ]: SQL status: COMMIT in 0.22 seconds
20:06:30.550557 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:06:30.550991 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
20:06:30.663081 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
20:06:30.676650 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:06:30.677218 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
20:06:30.787483 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
20:06:30.790354 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
20:06:30.790791 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:06:30.791150 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
20:06:30.952032 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
20:06:30.952815 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:06:30.953188 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
20:06:31.067960 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
20:06:31.070334 [debug] [Thread-1  ]: finished collecting timing info
20:06:31.071057 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
20:06:31.166789 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
20:06:31.169225 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2fa67b83-da7e-4cb6-9d9e-0bcdda062c92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109edf190>]}
20:06:31.170646 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.17s]
20:06:31.177362 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
20:06:31.178190 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
20:06:31.178808 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
20:06:31.180321 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
20:06:31.180890 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
20:06:31.181596 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
20:06:31.195065 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
20:06:31.197481 [debug] [Thread-1  ]: finished collecting timing info
20:06:31.197649 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
20:06:31.199321 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
20:06:31.199613 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:06:31.199678 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
20:06:31.199734 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:06:31.199794 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:06:32.140042 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
20:06:32.141166 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:06:32.141589 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),'') :: FLOAT)
T AS elapsed_time
  , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),'') :: FLOAT)
 
  AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

20:06:32.265209 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near "AS"
LINE 50: T AS elapsed_time
           ^

20:06:32.266499 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
20:06:32.374047 [debug] [Thread-1  ]: finished collecting timing info
20:06:32.375055 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
20:06:32.377248 [debug] [Thread-1  ]: Database Error in model amplitude_event (models/amplitude/amplitude_event.sql)
  syntax error at or near "AS"
  LINE 50: T AS elapsed_time
             ^
  compiled SQL at target/run/amplitude_event/models/amplitude/amplitude_event.sql
20:06:32.378269 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2fa67b83-da7e-4cb6-9d9e-0bcdda062c92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f8b190>]}
20:06:32.379739 [error] [Thread-1  ]: 2 of 4 ERROR creating view model dbt_amplitude_test.amplitude_event ............ [[31mERROR[0m in 1.20s]
20:06:32.381033 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
20:06:32.387102 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
20:06:32.388189 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
20:06:32.388956 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
20:06:32.389168 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
20:06:32.389389 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
20:06:32.397482 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
20:06:32.398844 [debug] [Thread-1  ]: finished collecting timing info
20:06:32.399067 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
20:06:32.402796 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
20:06:32.404327 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:06:32.404582 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
20:06:32.404760 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:06:32.404981 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:06:33.346187 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
20:06:33.347405 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:06:33.348015 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

20:06:33.451754 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
20:06:33.462584 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:06:33.463323 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
20:06:33.558528 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
20:06:33.565081 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:06:33.565661 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
20:06:33.669213 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
20:06:33.674355 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
20:06:33.674956 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:06:33.675312 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
20:06:33.831495 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
20:06:33.833331 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:06:33.833850 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
20:06:33.947406 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
20:06:33.955721 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:06:33.956281 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
20:06:34.062678 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
20:06:34.065855 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
20:06:34.066260 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:06:34.066609 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
20:06:34.220926 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
20:06:34.221984 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:06:34.222458 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
20:06:34.346143 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
20:06:34.349164 [debug] [Thread-1  ]: finished collecting timing info
20:06:34.349927 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
20:06:34.449891 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
20:06:34.452797 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2fa67b83-da7e-4cb6-9d9e-0bcdda062c92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ef8280>]}
20:06:34.454287 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.06s]
20:06:34.456238 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
20:06:34.461339 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
20:06:34.461948 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
20:06:34.462673 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
20:06:34.462937 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
20:06:34.463267 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
20:06:34.479896 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
20:06:34.482116 [debug] [Thread-1  ]: finished collecting timing info
20:06:34.482367 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
20:06:34.488294 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
20:06:34.489024 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:06:34.489149 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
20:06:34.489241 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:06:34.489344 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:06:35.415229 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
20:06:35.416499 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:06:35.416925 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

20:06:35.541794 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
20:06:35.552151 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:06:35.552766 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
20:06:35.650862 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
20:06:35.657869 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:06:35.658487 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
20:06:35.755720 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
20:06:35.759815 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
20:06:35.760127 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:06:35.760305 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
20:06:35.924729 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
20:06:35.925924 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:06:35.926297 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
20:06:36.040060 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
20:06:36.046557 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:06:36.047041 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
20:06:36.150674 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
20:06:36.153857 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
20:06:36.154523 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:06:36.155001 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
20:06:36.312257 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
20:06:36.313067 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:06:36.313428 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
20:06:36.434525 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
20:06:36.437392 [debug] [Thread-1  ]: finished collecting timing info
20:06:36.437941 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
20:06:36.542549 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
20:06:36.545239 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2fa67b83-da7e-4cb6-9d9e-0bcdda062c92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fd1580>]}
20:06:36.546624 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.08s]
20:06:36.547879 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
20:06:36.555394 [debug] [MainThread]: Acquiring new redshift connection "master"
20:06:36.555975 [debug] [MainThread]: Using redshift connection "master"
20:06:36.556159 [debug] [MainThread]: On master: BEGIN
20:06:36.556335 [debug] [MainThread]: Opening a new connection, currently in state closed
20:06:36.556612 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:06:37.511316 [debug] [MainThread]: SQL status: BEGIN in 0.95 seconds
20:06:37.512855 [debug] [MainThread]: On master: COMMIT
20:06:37.513512 [debug] [MainThread]: Using redshift connection "master"
20:06:37.513975 [debug] [MainThread]: On master: COMMIT
20:06:37.612452 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
20:06:37.614149 [debug] [MainThread]: On master: Close
20:06:37.617275 [info ] [MainThread]: 
20:06:37.618545 [info ] [MainThread]: Finished running 4 view models in 12.57s.
20:06:37.624469 [debug] [MainThread]: Connection 'master' was properly closed.
20:06:37.625112 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
20:06:37.640041 [info ] [MainThread]: 
20:06:37.640551 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
20:06:37.640908 [info ] [MainThread]: 
20:06:37.641209 [error] [MainThread]: [33mDatabase Error in model amplitude_event (models/amplitude/amplitude_event.sql)[0m
20:06:37.641520 [error] [MainThread]:   syntax error at or near "AS"
20:06:37.641803 [error] [MainThread]:   LINE 50: T AS elapsed_time
20:06:37.642074 [error] [MainThread]:              ^
20:06:37.642338 [error] [MainThread]:   compiled SQL at target/run/amplitude_event/models/amplitude/amplitude_event.sql
20:06:37.642631 [info ] [MainThread]: 
20:06:37.642933 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
20:06:37.643562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109eef280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109eef310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109df0ee0>]}


============================== 2022-07-11 20:08:19.811742 | 8cbadad2-43bc-475c-9687-4c874b964dde ==============================
20:08:19.811767 [info ] [MainThread]: Running with dbt=1.1.1
20:08:19.812008 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
20:08:19.812082 [debug] [MainThread]: Tracking: tracking
20:08:19.830061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cc60a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cc66d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cc6490>]}
20:08:19.844920 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
20:08:19.845142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '8cbadad2-43bc-475c-9687-4c874b964dde', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cf9ca0>]}
20:08:19.859016 [debug] [MainThread]: Parsing macros/json_extract_text.sql
20:08:19.860318 [debug] [MainThread]: Parsing macros/catalog.sql
20:08:19.868066 [debug] [MainThread]: Parsing macros/relations.sql
20:08:19.868440 [debug] [MainThread]: Parsing macros/adapters.sql
20:08:19.885766 [debug] [MainThread]: Parsing macros/materializations/snapshot_merge.sql
20:08:19.886218 [debug] [MainThread]: Parsing macros/catalog.sql
20:08:19.887417 [debug] [MainThread]: Parsing macros/relations.sql
20:08:19.888138 [debug] [MainThread]: Parsing macros/adapters.sql
20:08:19.900442 [debug] [MainThread]: Parsing macros/materializations/snapshot_merge.sql
20:08:19.901385 [debug] [MainThread]: Parsing macros/materializations/hooks.sql
20:08:19.903355 [debug] [MainThread]: Parsing macros/materializations/configs.sql
20:08:19.904606 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot_merge.sql
20:08:19.905440 [debug] [MainThread]: Parsing macros/materializations/snapshots/strategies.sql
20:08:19.914393 [debug] [MainThread]: Parsing macros/materializations/snapshots/helpers.sql
20:08:19.921958 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot.sql
20:08:19.928358 [debug] [MainThread]: Parsing macros/materializations/tests/test.sql
20:08:19.930814 [debug] [MainThread]: Parsing macros/materializations/tests/helpers.sql
20:08:19.931754 [debug] [MainThread]: Parsing macros/materializations/tests/where_subquery.sql
20:08:19.932642 [debug] [MainThread]: Parsing macros/materializations/models/incremental/column_helpers.sql
20:08:19.934806 [debug] [MainThread]: Parsing macros/materializations/models/incremental/merge.sql
20:08:19.944257 [debug] [MainThread]: Parsing macros/materializations/models/incremental/is_incremental.sql
20:08:19.945005 [debug] [MainThread]: Parsing macros/materializations/models/incremental/incremental.sql
20:08:19.950287 [debug] [MainThread]: Parsing macros/materializations/models/incremental/on_schema_change.sql
20:08:19.958762 [debug] [MainThread]: Parsing macros/materializations/models/table/table.sql
20:08:19.962844 [debug] [MainThread]: Parsing macros/materializations/models/table/create_table_as.sql
20:08:19.964209 [debug] [MainThread]: Parsing macros/materializations/models/view/view.sql
20:08:19.968087 [debug] [MainThread]: Parsing macros/materializations/models/view/helpers.sql
20:08:19.968694 [debug] [MainThread]: Parsing macros/materializations/models/view/create_or_replace_view.sql
20:08:19.970023 [debug] [MainThread]: Parsing macros/materializations/models/view/create_view_as.sql
20:08:19.971100 [debug] [MainThread]: Parsing macros/materializations/seeds/seed.sql
20:08:19.974266 [debug] [MainThread]: Parsing macros/materializations/seeds/helpers.sql
20:08:19.983229 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_alias.sql
20:08:19.983926 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_schema.sql
20:08:19.985088 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_database.sql
20:08:19.985824 [debug] [MainThread]: Parsing macros/generic_test_sql/relationships.sql
20:08:19.986244 [debug] [MainThread]: Parsing macros/generic_test_sql/not_null.sql
20:08:19.986631 [debug] [MainThread]: Parsing macros/generic_test_sql/unique.sql
20:08:19.986969 [debug] [MainThread]: Parsing macros/generic_test_sql/accepted_values.sql
20:08:19.987705 [debug] [MainThread]: Parsing macros/etc/statement.sql
20:08:19.989871 [debug] [MainThread]: Parsing macros/etc/datetime.sql
20:08:19.994224 [debug] [MainThread]: Parsing macros/adapters/schema.sql
20:08:19.995224 [debug] [MainThread]: Parsing macros/adapters/indexes.sql
20:08:19.996487 [debug] [MainThread]: Parsing macros/adapters/relation.sql
20:08:20.001295 [debug] [MainThread]: Parsing macros/adapters/freshness.sql
20:08:20.002699 [debug] [MainThread]: Parsing macros/adapters/persist_docs.sql
20:08:20.004816 [debug] [MainThread]: Parsing macros/adapters/metadata.sql
20:08:20.008647 [debug] [MainThread]: Parsing macros/adapters/columns.sql
20:08:20.013517 [debug] [MainThread]: Parsing tests/generic/builtin.sql
20:08:20.106524 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_device.sql
20:08:20.113073 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_device.sql
20:08:20.113669 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
20:08:20.117128 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
20:08:20.117600 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_profile.sql
20:08:20.118888 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_profile.sql
20:08:20.119522 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_workouts.sql
20:08:20.123159 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_workouts.sql
20:08:20.155233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8cbadad2-43bc-475c-9687-4c874b964dde', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105dc7d30>]}
20:08:20.157908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8cbadad2-43bc-475c-9687-4c874b964dde', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cf9100>]}
20:08:20.158047 [info ] [MainThread]: Found 4 models, 2 tests, 0 snapshots, 0 analyses, 195 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
20:08:20.158180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8cbadad2-43bc-475c-9687-4c874b964dde', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105dc7a30>]}
20:08:20.158854 [info ] [MainThread]: 
20:08:20.159065 [debug] [MainThread]: Acquiring new redshift connection "master"
20:08:20.159507 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
20:08:20.164541 [debug] [ThreadPool]: Using redshift connection "list_dev"
20:08:20.164633 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
20:08:20.164732 [debug] [ThreadPool]: Opening a new connection, currently in state init
20:08:20.164797 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:08:21.196639 [debug] [ThreadPool]: SQL status: SELECT in 1.03 seconds
20:08:21.203482 [debug] [ThreadPool]: On list_dev: Close
20:08:21.209997 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
20:08:21.223369 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
20:08:21.223709 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
20:08:21.223890 [debug] [ThreadPool]: Opening a new connection, currently in state closed
20:08:21.224078 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:08:22.174063 [debug] [ThreadPool]: SQL status: BEGIN in 0.95 seconds
20:08:22.175283 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
20:08:22.194987 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
20:08:22.310458 [debug] [ThreadPool]: SQL status: SELECT in 0.11 seconds
20:08:22.315443 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
20:08:22.425953 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
20:08:22.442109 [debug] [MainThread]: Using redshift connection "master"
20:08:22.443196 [debug] [MainThread]: On master: BEGIN
20:08:22.443466 [debug] [MainThread]: Opening a new connection, currently in state init
20:08:22.443796 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:08:23.391751 [debug] [MainThread]: SQL status: BEGIN in 0.95 seconds
20:08:23.393203 [debug] [MainThread]: Using redshift connection "master"
20:08:23.393822 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
20:08:23.564957 [debug] [MainThread]: SQL status: SELECT in 0.17 seconds
20:08:23.572485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8cbadad2-43bc-475c-9687-4c874b964dde', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d046d0>]}
20:08:23.573694 [debug] [MainThread]: On master: ROLLBACK
20:08:23.669928 [debug] [MainThread]: Using redshift connection "master"
20:08:23.671200 [debug] [MainThread]: On master: BEGIN
20:08:23.866095 [debug] [MainThread]: SQL status: BEGIN in 0.19 seconds
20:08:23.867056 [debug] [MainThread]: On master: COMMIT
20:08:23.867445 [debug] [MainThread]: Using redshift connection "master"
20:08:23.867803 [debug] [MainThread]: On master: COMMIT
20:08:23.973254 [debug] [MainThread]: SQL status: COMMIT in 0.11 seconds
20:08:23.974460 [debug] [MainThread]: On master: Close
20:08:23.976513 [info ] [MainThread]: Concurrency: 1 threads (target='test')
20:08:23.977376 [info ] [MainThread]: 
20:08:23.994510 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
20:08:23.995801 [info ] [Thread-1  ]: 1 of 4 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
20:08:23.996808 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
20:08:23.997064 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
20:08:23.997370 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
20:08:24.003457 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
20:08:24.004314 [debug] [Thread-1  ]: finished collecting timing info
20:08:24.004500 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
20:08:24.026332 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
20:08:24.027049 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:08:24.027178 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
20:08:24.027285 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:08:24.027408 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:08:24.968714 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
20:08:24.969712 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:08:24.970094 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

20:08:25.075122 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
20:08:25.093782 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:08:25.094341 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
20:08:25.201103 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.11 seconds
20:08:25.209568 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:08:25.210237 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
20:08:25.307296 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
20:08:25.329797 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
20:08:25.330258 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:08:25.330538 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
20:08:25.461627 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
20:08:25.463155 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:08:25.463565 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
20:08:25.563270 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
20:08:25.578491 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:08:25.579079 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
20:08:25.681861 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
20:08:25.689523 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
20:08:25.690060 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:08:25.690411 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
20:08:25.816856 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
20:08:25.817848 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
20:08:25.818233 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
20:08:25.919170 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
20:08:25.921917 [debug] [Thread-1  ]: finished collecting timing info
20:08:25.922482 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
20:08:26.020004 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
20:08:26.022789 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cbadad2-43bc-475c-9687-4c874b964dde', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e7d160>]}
20:08:26.024415 [info ] [Thread-1  ]: 1 of 4 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.03s]
20:08:26.025640 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
20:08:26.030526 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
20:08:26.031475 [info ] [Thread-1  ]: 2 of 4 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
20:08:26.032250 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
20:08:26.032475 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
20:08:26.032731 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
20:08:26.050076 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
20:08:26.052579 [debug] [Thread-1  ]: finished collecting timing info
20:08:26.052850 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
20:08:26.055168 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
20:08:26.055764 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:08:26.055875 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
20:08:26.055965 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:08:26.056073 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:08:26.988645 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
20:08:26.989816 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:08:26.990212 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
  AS membership_status
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
  AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),'') :: FLOAT)
 AS elapsed_time
  , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),'') :: FLOAT)
 
  AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

20:08:27.104141 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
20:08:27.114348 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:08:27.115111 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
20:08:27.210440 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
20:08:27.218119 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:08:27.218818 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
20:08:27.315702 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
20:08:27.321323 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
20:08:27.321818 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:08:27.322180 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
20:08:27.471048 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
20:08:27.472332 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:08:27.472698 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
20:08:27.585322 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
20:08:27.591288 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:08:27.591749 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
20:08:27.690155 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
20:08:27.692825 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
20:08:27.693240 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:08:27.693592 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
20:08:27.828561 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
20:08:27.829346 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
20:08:27.829703 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
20:08:27.927152 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
20:08:27.929189 [debug] [Thread-1  ]: finished collecting timing info
20:08:27.929745 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
20:08:28.026470 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
20:08:28.028896 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cbadad2-43bc-475c-9687-4c874b964dde', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e7de20>]}
20:08:28.030386 [info ] [Thread-1  ]: 2 of 4 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.00s]
20:08:28.032143 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
20:08:28.037285 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
20:08:28.037969 [info ] [Thread-1  ]: 3 of 4 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
20:08:28.038687 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
20:08:28.038904 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
20:08:28.039131 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
20:08:28.045422 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
20:08:28.047132 [debug] [Thread-1  ]: finished collecting timing info
20:08:28.047445 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
20:08:28.055061 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
20:08:28.056727 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:08:28.056994 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
20:08:28.057099 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:08:28.057225 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:08:28.994681 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
20:08:28.995997 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:08:28.996434 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

20:08:29.101549 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
20:08:29.112183 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:08:29.112964 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
20:08:29.209520 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
20:08:29.218531 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:08:29.219107 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
20:08:29.315010 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
20:08:29.321105 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
20:08:29.321625 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:08:29.321987 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
20:08:29.457455 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
20:08:29.459285 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:08:29.459681 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
20:08:29.558411 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
20:08:29.564733 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:08:29.565208 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
20:08:29.666627 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
20:08:29.670137 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
20:08:29.670657 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:08:29.671020 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
20:08:29.820527 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
20:08:29.822072 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
20:08:29.822515 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
20:08:29.918468 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
20:08:29.920474 [debug] [Thread-1  ]: finished collecting timing info
20:08:29.920763 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
20:08:30.019987 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
20:08:30.022795 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cbadad2-43bc-475c-9687-4c874b964dde', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e7dd90>]}
20:08:30.024400 [info ] [Thread-1  ]: 3 of 4 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.98s]
20:08:30.025691 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
20:08:30.030735 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
20:08:30.031632 [info ] [Thread-1  ]: 4 of 4 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
20:08:30.032463 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
20:08:30.032690 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
20:08:30.032921 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
20:08:30.045901 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
20:08:30.047953 [debug] [Thread-1  ]: finished collecting timing info
20:08:30.048206 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
20:08:30.051542 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
20:08:30.052367 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:08:30.052496 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
20:08:30.052590 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:08:30.052703 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:08:30.983864 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
20:08:30.985067 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:08:30.985461 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

20:08:31.099728 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
20:08:31.110504 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:08:31.111233 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
20:08:31.210728 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
20:08:31.218080 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:08:31.218754 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
20:08:31.319842 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
20:08:31.325508 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
20:08:31.326033 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:08:31.326392 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
20:08:31.486101 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
20:08:31.487292 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:08:31.487780 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
20:08:31.601955 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
20:08:31.608021 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:08:31.608570 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
20:08:31.715521 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
20:08:31.718766 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
20:08:31.719207 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:08:31.719561 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
20:08:31.872216 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
20:08:31.872717 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
20:08:31.872896 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
20:08:31.988469 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
20:08:31.991218 [debug] [Thread-1  ]: finished collecting timing info
20:08:31.991907 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
20:08:32.092730 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
20:08:32.094979 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cbadad2-43bc-475c-9687-4c874b964dde', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105dc8a30>]}
20:08:32.096310 [info ] [Thread-1  ]: 4 of 4 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.06s]
20:08:32.097613 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
20:08:32.104890 [debug] [MainThread]: Acquiring new redshift connection "master"
20:08:32.105437 [debug] [MainThread]: Using redshift connection "master"
20:08:32.105666 [debug] [MainThread]: On master: BEGIN
20:08:32.105854 [debug] [MainThread]: Opening a new connection, currently in state closed
20:08:32.106087 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:08:33.052597 [debug] [MainThread]: SQL status: BEGIN in 0.95 seconds
20:08:33.053969 [debug] [MainThread]: On master: COMMIT
20:08:33.054367 [debug] [MainThread]: Using redshift connection "master"
20:08:33.054877 [debug] [MainThread]: On master: COMMIT
20:08:33.151700 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
20:08:33.152563 [debug] [MainThread]: On master: Close
20:08:33.154694 [info ] [MainThread]: 
20:08:33.155628 [info ] [MainThread]: Finished running 4 view models in 13.00s.
20:08:33.161297 [debug] [MainThread]: Connection 'master' was properly closed.
20:08:33.161879 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
20:08:33.174501 [info ] [MainThread]: 
20:08:33.174973 [info ] [MainThread]: [32mCompleted successfully[0m
20:08:33.175270 [info ] [MainThread]: 
20:08:33.175479 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
20:08:33.175815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d3fdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d3f670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ee7730>]}


============================== 2022-07-12 09:39:45.408471 | b79bbbad-b5ef-4bbd-bc4c-5df585df2fe0 ==============================
09:39:45.408485 [info ] [MainThread]: Running with dbt=1.1.1
09:39:45.408709 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
09:39:45.408771 [debug] [MainThread]: Tracking: tracking
09:39:45.426703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066fb040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066fbfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066fb670>]}
09:39:45.452409 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
09:39:45.452606 [debug] [MainThread]: Partial parsing: added file: amplitude_event://models/amplitude/amplitude_onb_version.sql
09:39:45.452748 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_event.sql
09:39:45.458740 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_onb_version.sql
09:39:45.466231 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_onb_version.sql
09:39:45.466843 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
09:39:45.470181 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
09:39:45.478854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b79bbbad-b5ef-4bbd-bc4c-5df585df2fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10680ff40>]}
09:39:45.482217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b79bbbad-b5ef-4bbd-bc4c-5df585df2fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067dda30>]}
09:39:45.482360 [info ] [MainThread]: Found 5 models, 2 tests, 0 snapshots, 0 analyses, 195 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
09:39:45.482491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b79bbbad-b5ef-4bbd-bc4c-5df585df2fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067ddf10>]}
09:39:45.483354 [info ] [MainThread]: 
09:39:45.483730 [debug] [MainThread]: Acquiring new redshift connection "master"
09:39:45.484771 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
09:39:45.490109 [debug] [ThreadPool]: Using redshift connection "list_dev"
09:39:45.490193 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
09:39:45.490257 [debug] [ThreadPool]: Opening a new connection, currently in state init
09:39:45.490324 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
09:39:46.568330 [debug] [ThreadPool]: SQL status: SELECT in 1.08 seconds
09:39:46.573635 [debug] [ThreadPool]: On list_dev: Close
09:39:46.577699 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
09:39:46.590589 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
09:39:46.590810 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
09:39:46.590939 [debug] [ThreadPool]: Opening a new connection, currently in state closed
09:39:46.591050 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
09:39:47.518961 [debug] [ThreadPool]: SQL status: BEGIN in 0.93 seconds
09:39:47.520016 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
09:39:47.520222 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
09:39:47.637298 [debug] [ThreadPool]: SQL status: SELECT in 0.12 seconds
09:39:47.642564 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
09:39:47.740480 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
09:39:47.756682 [debug] [MainThread]: Using redshift connection "master"
09:39:47.757319 [debug] [MainThread]: On master: BEGIN
09:39:47.757558 [debug] [MainThread]: Opening a new connection, currently in state init
09:39:47.757941 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
09:39:48.729282 [debug] [MainThread]: SQL status: BEGIN in 0.97 seconds
09:39:48.729950 [debug] [MainThread]: Using redshift connection "master"
09:39:48.730314 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
09:39:48.915107 [debug] [MainThread]: SQL status: SELECT in 0.18 seconds
09:39:48.923254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b79bbbad-b5ef-4bbd-bc4c-5df585df2fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10686eb50>]}
09:39:48.924923 [debug] [MainThread]: On master: ROLLBACK
09:39:49.022896 [debug] [MainThread]: Using redshift connection "master"
09:39:49.024481 [debug] [MainThread]: On master: BEGIN
09:39:49.238977 [debug] [MainThread]: SQL status: BEGIN in 0.21 seconds
09:39:49.240414 [debug] [MainThread]: On master: COMMIT
09:39:49.240857 [debug] [MainThread]: Using redshift connection "master"
09:39:49.241303 [debug] [MainThread]: On master: COMMIT
09:39:49.337348 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
09:39:49.338240 [debug] [MainThread]: On master: Close
09:39:49.340562 [info ] [MainThread]: Concurrency: 1 threads (target='test')
09:39:49.341533 [info ] [MainThread]: 
09:39:49.354255 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
09:39:49.355345 [info ] [Thread-1  ]: 1 of 5 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
09:39:49.356238 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
09:39:49.356500 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
09:39:49.356756 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
09:39:49.364061 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
09:39:49.365771 [debug] [Thread-1  ]: finished collecting timing info
09:39:49.365997 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
09:39:49.386887 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
09:39:49.387437 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
09:39:49.387542 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
09:39:49.387631 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:39:49.387725 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
09:39:50.317844 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
09:39:50.319088 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
09:39:50.319547 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

09:39:50.431775 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
09:39:50.453201 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
09:39:50.453771 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
09:39:50.556734 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
09:39:50.563073 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
09:39:50.563579 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
09:39:50.660770 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
09:39:50.684498 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
09:39:50.685077 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
09:39:50.685286 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
09:39:50.819865 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
09:39:50.822017 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
09:39:50.822989 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
09:39:50.923169 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
09:39:50.940088 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
09:39:50.940722 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
09:39:51.038834 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
09:39:51.042341 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
09:39:51.042834 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
09:39:51.043200 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
09:39:51.172334 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
09:39:51.173150 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
09:39:51.173519 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
09:39:51.273455 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
09:39:51.275946 [debug] [Thread-1  ]: finished collecting timing info
09:39:51.276542 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
09:39:51.373587 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
09:39:51.376115 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b79bbbad-b5ef-4bbd-bc4c-5df585df2fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106924e50>]}
09:39:51.377549 [info ] [Thread-1  ]: 1 of 5 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.02s]
09:39:51.379039 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
09:39:51.384229 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
09:39:51.384934 [info ] [Thread-1  ]: 2 of 5 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
09:39:51.385853 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
09:39:51.386085 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
09:39:51.386308 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
09:39:51.400033 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
09:39:51.403864 [debug] [Thread-1  ]: finished collecting timing info
09:39:51.404128 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
09:39:51.405598 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
09:39:51.405865 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
09:39:51.405930 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
09:39:51.405991 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:39:51.406059 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
09:39:52.324647 [debug] [Thread-1  ]: SQL status: BEGIN in 0.92 seconds
09:39:52.325918 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
09:39:52.326304 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),'') :: FLOAT)
 AS elapsed_time
  , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),'') :: FLOAT)
 
  AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

09:39:52.447336 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
09:39:52.457224 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
09:39:52.457861 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
09:39:52.554127 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
09:39:52.560370 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
09:39:52.560900 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
09:39:52.657778 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
09:39:52.662629 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
09:39:52.663061 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
09:39:52.663461 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
09:39:52.805587 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
09:39:52.807428 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
09:39:52.807812 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
09:39:52.905658 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
09:39:52.912554 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
09:39:52.913516 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
09:39:53.012642 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
09:39:53.015818 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
09:39:53.016246 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
09:39:53.016589 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
09:39:53.145007 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
09:39:53.145787 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
09:39:53.146132 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
09:39:53.244423 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
09:39:53.246371 [debug] [Thread-1  ]: finished collecting timing info
09:39:53.246855 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
09:39:53.342107 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
09:39:53.344493 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b79bbbad-b5ef-4bbd-bc4c-5df585df2fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10689bb50>]}
09:39:53.345824 [info ] [Thread-1  ]: 2 of 5 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 1.96s]
09:39:53.347260 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
09:39:53.353263 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_onb_version
09:39:53.354017 [info ] [Thread-1  ]: 3 of 5 START view model dbt_amplitude_test.amplitude_onb_version ............... [RUN]
09:39:53.355181 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_onb_version"
09:39:53.355832 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_onb_version
09:39:53.356111 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_onb_version
09:39:53.364062 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_onb_version"
09:39:53.368125 [debug] [Thread-1  ]: finished collecting timing info
09:39:53.369774 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_onb_version
09:39:53.375012 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_onb_version"
09:39:53.376890 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
09:39:53.377090 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
09:39:53.377174 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:39:53.377270 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
09:39:54.312825 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
09:39:54.314135 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
09:39:54.314541 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */


  create view "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" as (
    SELECT DISTINCT
  user_id
	, session_id
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))

  AS onb_version
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_start'
  AND
    (nullif(json_extract_path_text(user_properties,'onb_version',true),null))
 IS NOT NULL
  ) ;

09:39:54.418754 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
09:39:54.429212 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
09:39:54.429902 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" rename to "amplitude_onb_version"
09:39:54.527005 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
09:39:54.531226 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
09:39:54.531790 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
09:39:54.532134 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
09:39:54.664787 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
09:39:54.666704 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
09:39:54.667120 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
09:39:54.764646 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
09:39:54.769593 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
09:39:54.770054 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_backup" cascade
09:39:54.886982 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.12 seconds
09:39:54.890036 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
09:39:54.890395 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
09:39:54.890613 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
09:39:55.016358 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
09:39:55.017143 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
09:39:55.017609 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
09:39:55.118333 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
09:39:55.120706 [debug] [Thread-1  ]: finished collecting timing info
09:39:55.121168 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: ROLLBACK
09:39:55.217731 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: Close
09:39:55.220787 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b79bbbad-b5ef-4bbd-bc4c-5df585df2fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10686d700>]}
09:39:55.222212 [info ] [Thread-1  ]: 3 of 5 OK created view model dbt_amplitude_test.amplitude_onb_version .......... [[32mCREATE VIEW[0m in 1.87s]
09:39:55.223355 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_onb_version
09:39:55.227548 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
09:39:55.228032 [info ] [Thread-1  ]: 4 of 5 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
09:39:55.228807 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
09:39:55.229518 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
09:39:55.229779 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
09:39:55.238918 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
09:39:55.241195 [debug] [Thread-1  ]: finished collecting timing info
09:39:55.242381 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
09:39:55.247979 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
09:39:55.249616 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
09:39:55.249824 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
09:39:55.249920 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:39:55.250025 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
09:39:56.208729 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
09:39:56.209906 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
09:39:56.210290 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

09:39:56.315570 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
09:39:56.320156 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
09:39:56.320636 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
09:39:56.419500 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
09:39:56.426114 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
09:39:56.426461 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
09:39:56.523702 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
09:39:56.527179 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
09:39:56.527705 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
09:39:56.527997 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
09:39:56.662929 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
09:39:56.663715 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
09:39:56.663989 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
09:39:56.764439 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
09:39:56.769612 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
09:39:56.770028 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
09:39:56.870420 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
09:39:56.872391 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
09:39:56.872590 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
09:39:56.872774 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
09:39:57.103407 [debug] [Thread-1  ]: SQL status: COMMIT in 0.23 seconds
09:39:57.105297 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
09:39:57.105505 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
09:39:57.209106 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
09:39:57.214968 [debug] [Thread-1  ]: finished collecting timing info
09:39:57.215818 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
09:39:57.314135 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
09:39:57.318287 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b79bbbad-b5ef-4bbd-bc4c-5df585df2fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106877a00>]}
09:39:57.320300 [info ] [Thread-1  ]: 4 of 5 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.09s]
09:39:57.323189 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
09:39:57.326221 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
09:39:57.326971 [info ] [Thread-1  ]: 5 of 5 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
09:39:57.337016 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
09:39:57.338640 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
09:39:57.339132 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
09:39:57.346293 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
09:39:57.348365 [debug] [Thread-1  ]: finished collecting timing info
09:39:57.348504 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
09:39:57.350033 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
09:39:57.350386 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
09:39:57.350460 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
09:39:57.350540 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
09:39:57.350638 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
09:39:58.278470 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
09:39:58.279684 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
09:39:58.279955 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

09:39:58.395786 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
09:39:58.407285 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
09:39:58.407812 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
09:39:58.506659 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
09:39:58.514007 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
09:39:58.514793 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
09:39:58.611845 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
09:39:58.615761 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
09:39:58.616049 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
09:39:58.616220 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
09:39:58.783742 [debug] [Thread-1  ]: SQL status: COMMIT in 0.17 seconds
09:39:58.784423 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
09:39:58.784631 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
09:39:58.894339 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
09:39:58.898260 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
09:39:58.898840 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
09:39:58.995879 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
09:39:58.998331 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
09:39:58.998836 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
09:39:58.999210 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
09:39:59.126155 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
09:39:59.126910 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
09:39:59.127305 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
09:39:59.233775 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
09:39:59.235659 [debug] [Thread-1  ]: finished collecting timing info
09:39:59.236114 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
09:39:59.336102 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
09:39:59.339608 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b79bbbad-b5ef-4bbd-bc4c-5df585df2fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106979460>]}
09:39:59.341228 [info ] [Thread-1  ]: 5 of 5 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.01s]
09:39:59.342822 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
09:39:59.349420 [debug] [MainThread]: Acquiring new redshift connection "master"
09:39:59.350168 [debug] [MainThread]: Using redshift connection "master"
09:39:59.350385 [debug] [MainThread]: On master: BEGIN
09:39:59.350593 [debug] [MainThread]: Opening a new connection, currently in state closed
09:39:59.350861 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
09:40:00.311351 [debug] [MainThread]: SQL status: BEGIN in 0.96 seconds
09:40:00.312853 [debug] [MainThread]: On master: COMMIT
09:40:00.313173 [debug] [MainThread]: Using redshift connection "master"
09:40:00.313524 [debug] [MainThread]: On master: COMMIT
09:40:00.420205 [debug] [MainThread]: SQL status: COMMIT in 0.11 seconds
09:40:00.421142 [debug] [MainThread]: On master: Close
09:40:00.423633 [info ] [MainThread]: 
09:40:00.424620 [info ] [MainThread]: Finished running 5 view models in 14.94s.
09:40:00.425420 [debug] [MainThread]: Connection 'master' was properly closed.
09:40:00.426777 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
09:40:00.444684 [info ] [MainThread]: 
09:40:00.445006 [info ] [MainThread]: [32mCompleted successfully[0m
09:40:00.445236 [info ] [MainThread]: 
09:40:00.445402 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
09:40:00.445763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068a1970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068a18b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068a19a0>]}


============================== 2022-07-12 10:27:10.786143 | 364c5466-61e7-4e44-92ab-7eafff3e4e44 ==============================
10:27:10.786162 [info ] [MainThread]: Running with dbt=1.1.1
10:27:10.786359 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:27:10.786423 [debug] [MainThread]: Tracking: tracking
10:27:10.803755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f6cfa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fd3fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fd3640>]}
10:27:10.830242 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
10:27:10.830524 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_device.sql
10:27:10.836512 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_device.sql
10:27:10.844289 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_device.sql
10:27:10.853318 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '364c5466-61e7-4e44-92ab-7eafff3e4e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080b4d30>]}
10:27:10.856739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '364c5466-61e7-4e44-92ab-7eafff3e4e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108085c70>]}
10:27:10.856893 [info ] [MainThread]: Found 5 models, 2 tests, 0 snapshots, 0 analyses, 195 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
10:27:10.857024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '364c5466-61e7-4e44-92ab-7eafff3e4e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108085eb0>]}
10:27:10.857775 [info ] [MainThread]: 
10:27:10.857995 [debug] [MainThread]: Acquiring new redshift connection "master"
10:27:10.858441 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
10:27:10.863902 [debug] [ThreadPool]: Using redshift connection "list_dev"
10:27:10.864012 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
10:27:10.864073 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:27:10.864144 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:27:11.925775 [debug] [ThreadPool]: SQL status: SELECT in 1.06 seconds
10:27:11.933423 [debug] [ThreadPool]: On list_dev: Close
10:27:11.942274 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
10:27:11.952280 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
10:27:11.952553 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
10:27:11.952652 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:27:11.952761 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:27:12.913843 [debug] [ThreadPool]: SQL status: BEGIN in 0.96 seconds
10:27:12.914878 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
10:27:12.915075 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
10:27:13.030953 [debug] [ThreadPool]: SQL status: SELECT in 0.12 seconds
10:27:13.036598 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
10:27:13.134511 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
10:27:13.151832 [debug] [MainThread]: Using redshift connection "master"
10:27:13.152809 [debug] [MainThread]: On master: BEGIN
10:27:13.153038 [debug] [MainThread]: Opening a new connection, currently in state init
10:27:13.153295 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:27:14.097447 [debug] [MainThread]: SQL status: BEGIN in 0.94 seconds
10:27:14.099196 [debug] [MainThread]: Using redshift connection "master"
10:27:14.099818 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
10:27:14.274915 [debug] [MainThread]: SQL status: SELECT in 0.17 seconds
10:27:14.282334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '364c5466-61e7-4e44-92ab-7eafff3e4e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081029a0>]}
10:27:14.283454 [debug] [MainThread]: On master: ROLLBACK
10:27:14.377923 [debug] [MainThread]: Using redshift connection "master"
10:27:14.378744 [debug] [MainThread]: On master: BEGIN
10:27:14.597500 [debug] [MainThread]: SQL status: BEGIN in 0.22 seconds
10:27:14.598856 [debug] [MainThread]: On master: COMMIT
10:27:14.599395 [debug] [MainThread]: Using redshift connection "master"
10:27:14.599915 [debug] [MainThread]: On master: COMMIT
10:27:14.704613 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
10:27:14.705589 [debug] [MainThread]: On master: Close
10:27:14.707422 [info ] [MainThread]: Concurrency: 1 threads (target='test')
10:27:14.708239 [info ] [MainThread]: 
10:27:14.725814 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
10:27:14.726708 [info ] [Thread-1  ]: 1 of 5 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
10:27:14.727544 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
10:27:14.727819 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
10:27:14.728090 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
10:27:14.734424 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
10:27:14.736133 [debug] [Thread-1  ]: finished collecting timing info
10:27:14.736335 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
10:27:14.762717 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
10:27:14.763634 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:27:14.763773 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
10:27:14.763889 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:27:14.764023 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:27:15.672503 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
10:27:15.673814 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:27:15.674207 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

10:27:15.777619 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
10:27:15.798957 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:27:15.799229 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
10:27:15.905965 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.11 seconds
10:27:15.914423 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:27:15.915030 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
10:27:16.010404 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
10:27:16.031092 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
10:27:16.031959 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:27:16.032349 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
10:27:16.163684 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:27:16.166119 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:27:16.166571 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
10:27:16.272014 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
10:27:16.285177 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:27:16.285879 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
10:27:16.391832 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
10:27:16.393935 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
10:27:16.394392 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:27:16.394625 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
10:27:16.540107 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
10:27:16.541099 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:27:16.541550 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
10:27:16.641795 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:27:16.644671 [debug] [Thread-1  ]: finished collecting timing info
10:27:16.645011 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
10:27:16.745838 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
10:27:16.748824 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '364c5466-61e7-4e44-92ab-7eafff3e4e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081b3370>]}
10:27:16.750094 [info ] [Thread-1  ]: 1 of 5 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.02s]
10:27:16.751256 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
10:27:16.756002 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
10:27:16.756437 [info ] [Thread-1  ]: 2 of 5 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
10:27:16.757429 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
10:27:16.757671 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
10:27:16.757913 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
10:27:16.778335 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
10:27:16.779667 [debug] [Thread-1  ]: finished collecting timing info
10:27:16.779934 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
10:27:16.783433 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
10:27:16.784141 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:27:16.784338 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
10:27:16.784509 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:27:16.784698 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:27:17.726628 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
10:27:17.727746 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:27:17.728283 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),'') :: FLOAT)
 AS elapsed_time
  , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),'') :: FLOAT)
 
  AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

10:27:17.842073 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
10:27:17.850265 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:27:17.850899 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
10:27:17.950339 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:27:17.963270 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:27:17.964196 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
10:27:18.061429 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:27:18.065236 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:27:18.065462 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:27:18.065653 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:27:18.261274 [debug] [Thread-1  ]: SQL status: COMMIT in 0.2 seconds
10:27:18.263049 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:27:18.263439 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
10:27:18.376169 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
10:27:18.383504 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:27:18.384104 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
10:27:18.485770 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:27:18.488471 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:27:18.488893 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:27:18.489327 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:27:18.628323 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
10:27:18.629228 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:27:18.629594 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
10:27:18.729557 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:27:18.732395 [debug] [Thread-1  ]: finished collecting timing info
10:27:18.733004 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
10:27:18.828861 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
10:27:18.830608 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '364c5466-61e7-4e44-92ab-7eafff3e4e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081f4d60>]}
10:27:18.831624 [info ] [Thread-1  ]: 2 of 5 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.07s]
10:27:18.832473 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
10:27:18.835417 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_onb_version
10:27:18.836105 [info ] [Thread-1  ]: 3 of 5 START view model dbt_amplitude_test.amplitude_onb_version ............... [RUN]
10:27:18.837140 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_onb_version"
10:27:18.837363 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_onb_version
10:27:18.837591 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_onb_version
10:27:18.846399 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_onb_version"
10:27:18.848324 [debug] [Thread-1  ]: finished collecting timing info
10:27:18.848585 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_onb_version
10:27:18.852855 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_onb_version"
10:27:18.854003 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:27:18.854218 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
10:27:18.854394 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:27:18.854582 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:27:19.808719 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
10:27:19.810387 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:27:19.810589 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */


  create view "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" as (
    SELECT DISTINCT
  user_id
	, session_id
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))

  AS onb_version
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_start'
  AND
    (nullif(json_extract_path_text(user_properties,'onb_version',true),null))
 IS NOT NULL
  ) ;

10:27:19.914405 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
10:27:19.918260 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:27:19.918625 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version" rename to "amplitude_onb_version__dbt_backup"
10:27:20.020939 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:27:20.027639 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:27:20.027976 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" rename to "amplitude_onb_version"
10:27:20.126747 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:27:20.130800 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:27:20.131578 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:27:20.131826 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:27:20.266785 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:27:20.269124 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:27:20.269609 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
10:27:20.371972 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:27:20.378625 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:27:20.379315 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_backup" cascade
10:27:20.476684 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:27:20.481717 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:27:20.482382 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:27:20.482745 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:27:20.632454 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
10:27:20.633176 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:27:20.633540 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
10:27:20.731564 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:27:20.735001 [debug] [Thread-1  ]: finished collecting timing info
10:27:20.735720 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: ROLLBACK
10:27:20.835154 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: Close
10:27:20.837416 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '364c5466-61e7-4e44-92ab-7eafff3e4e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10819f2b0>]}
10:27:20.838517 [info ] [Thread-1  ]: 3 of 5 OK created view model dbt_amplitude_test.amplitude_onb_version .......... [[32mCREATE VIEW[0m in 2.00s]
10:27:20.839351 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_onb_version
10:27:20.840998 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
10:27:20.842077 [info ] [Thread-1  ]: 4 of 5 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
10:27:20.842992 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
10:27:20.843223 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
10:27:20.843464 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
10:27:20.856887 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
10:27:20.862213 [debug] [Thread-1  ]: finished collecting timing info
10:27:20.862693 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
10:27:20.867163 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
10:27:20.868466 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:27:20.868705 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
10:27:20.869113 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:27:20.869329 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:27:21.826270 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
10:27:21.827234 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:27:21.828762 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

10:27:21.931984 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
10:27:21.943003 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:27:21.943629 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
10:27:22.040740 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:27:22.047134 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:27:22.047825 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
10:27:22.143874 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:27:22.147133 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:27:22.147468 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:27:22.147670 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:27:22.284645 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
10:27:22.285313 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:27:22.285504 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
10:27:22.382335 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:27:22.397319 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:27:22.397499 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
10:27:22.496748 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:27:22.499689 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:27:22.499985 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:27:22.500161 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:27:22.630641 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:27:22.631465 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:27:22.634281 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
10:27:22.732698 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:27:22.734230 [debug] [Thread-1  ]: finished collecting timing info
10:27:22.734690 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
10:27:22.838152 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
10:27:22.839738 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '364c5466-61e7-4e44-92ab-7eafff3e4e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108233790>]}
10:27:22.840482 [info ] [Thread-1  ]: 4 of 5 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.00s]
10:27:22.841361 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
10:27:22.842624 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
10:27:22.843210 [info ] [Thread-1  ]: 5 of 5 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
10:27:22.844473 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
10:27:22.845522 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
10:27:22.849522 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
10:27:22.864871 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
10:27:22.865308 [debug] [Thread-1  ]: finished collecting timing info
10:27:22.865394 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
10:27:22.866512 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
10:27:22.866729 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:27:22.866794 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
10:27:22.866852 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:27:22.866913 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:27:23.827272 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
10:27:23.831406 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:27:23.832068 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

10:27:23.953850 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
10:27:23.962706 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:27:23.963817 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
10:27:24.061738 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:27:24.067136 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:27:24.067477 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
10:27:24.167317 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:27:24.171898 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:27:24.172459 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:27:24.172840 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:27:24.316022 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
10:27:24.318347 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:27:24.318972 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
10:27:24.415694 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:27:24.422360 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:27:24.422874 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
10:27:24.524805 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:27:24.528357 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:27:24.528866 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:27:24.529109 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:27:24.659928 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:27:24.660867 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:27:24.662027 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
10:27:24.768715 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
10:27:24.771061 [debug] [Thread-1  ]: finished collecting timing info
10:27:24.771444 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
10:27:24.867986 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
10:27:24.869198 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '364c5466-61e7-4e44-92ab-7eafff3e4e44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10812de80>]}
10:27:24.870146 [info ] [Thread-1  ]: 5 of 5 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.03s]
10:27:24.870841 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
10:27:24.874159 [debug] [MainThread]: Acquiring new redshift connection "master"
10:27:24.874557 [debug] [MainThread]: Using redshift connection "master"
10:27:24.874772 [debug] [MainThread]: On master: BEGIN
10:27:24.874965 [debug] [MainThread]: Opening a new connection, currently in state closed
10:27:24.875237 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:27:25.795049 [debug] [MainThread]: SQL status: BEGIN in 0.92 seconds
10:27:25.796047 [debug] [MainThread]: On master: COMMIT
10:27:25.796245 [debug] [MainThread]: Using redshift connection "master"
10:27:25.796434 [debug] [MainThread]: On master: COMMIT
10:27:25.893498 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
10:27:25.893960 [debug] [MainThread]: On master: Close
10:27:25.894858 [info ] [MainThread]: 
10:27:25.895290 [info ] [MainThread]: Finished running 5 view models in 15.04s.
10:27:25.896044 [debug] [MainThread]: Connection 'master' was properly closed.
10:27:25.896253 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_workouts' was properly closed.
10:27:25.905907 [info ] [MainThread]: 
10:27:25.906388 [info ] [MainThread]: [32mCompleted successfully[0m
10:27:25.906762 [info ] [MainThread]: 
10:27:25.907076 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
10:27:25.907593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108123eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10802f580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10812f490>]}


============================== 2022-07-12 10:47:42.686775 | 04613b1d-0524-482d-a64d-bceb605afb53 ==============================
10:47:42.686794 [info ] [MainThread]: Running with dbt=1.1.1
10:47:42.686990 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:47:42.687060 [debug] [MainThread]: Tracking: tracking
10:47:42.705689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ac9fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b43520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b43670>]}
10:47:42.731838 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 2 files added, 0 files changed.
10:47:42.732087 [debug] [MainThread]: Partial parsing: added file: amplitude_event://models/amplitude_device.sql
10:47:42.732193 [debug] [MainThread]: Partial parsing: added file: amplitude_event://models/staging/stg_amplitude_device.sql
10:47:42.732276 [debug] [MainThread]: Partial parsing: deleted file: amplitude_event://models/amplitude/amplitude_device.sql
10:47:42.738269 [debug] [MainThread]: 1699: static parser successfully parsed amplitude_device.sql
10:47:42.744777 [debug] [MainThread]: 1603: static parser failed on staging/stg_amplitude_device.sql
10:47:42.747132 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_amplitude_device.sql
10:47:42.756013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04613b1d-0524-482d-a64d-bceb605afb53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c191f0>]}
10:47:42.759510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04613b1d-0524-482d-a64d-bceb605afb53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b4ea30>]}
10:47:42.759654 [info ] [MainThread]: Found 6 models, 2 tests, 0 snapshots, 0 analyses, 195 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
10:47:42.759781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '04613b1d-0524-482d-a64d-bceb605afb53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b4e6a0>]}
10:47:42.760553 [info ] [MainThread]: 
10:47:42.760793 [debug] [MainThread]: Acquiring new redshift connection "master"
10:47:42.761324 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
10:47:42.766551 [debug] [ThreadPool]: Using redshift connection "list_dev"
10:47:42.766639 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
10:47:42.766704 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:47:42.766777 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:47:43.769115 [debug] [ThreadPool]: SQL status: SELECT in 1.0 seconds
10:47:43.775862 [debug] [ThreadPool]: On list_dev: Close
10:47:43.780895 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
10:47:43.797878 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
10:47:43.798248 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
10:47:43.798429 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:47:43.798619 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:47:44.727433 [debug] [ThreadPool]: SQL status: BEGIN in 0.93 seconds
10:47:44.728596 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
10:47:44.729355 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
10:47:44.896620 [debug] [ThreadPool]: SQL status: SELECT in 0.17 seconds
10:47:44.900485 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
10:47:45.010626 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
10:47:45.028225 [debug] [MainThread]: Using redshift connection "master"
10:47:45.028827 [debug] [MainThread]: On master: BEGIN
10:47:45.029040 [debug] [MainThread]: Opening a new connection, currently in state init
10:47:45.029294 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:47:45.941169 [debug] [MainThread]: SQL status: BEGIN in 0.91 seconds
10:47:45.943775 [debug] [MainThread]: Using redshift connection "master"
10:47:45.944043 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
10:47:46.309112 [debug] [MainThread]: SQL status: SELECT in 0.36 seconds
10:47:46.317292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '04613b1d-0524-482d-a64d-bceb605afb53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b6b6d0>]}
10:47:46.318460 [debug] [MainThread]: On master: ROLLBACK
10:47:46.412708 [debug] [MainThread]: Using redshift connection "master"
10:47:46.413806 [debug] [MainThread]: On master: BEGIN
10:47:46.604739 [debug] [MainThread]: SQL status: BEGIN in 0.19 seconds
10:47:46.605729 [debug] [MainThread]: On master: COMMIT
10:47:46.606154 [debug] [MainThread]: Using redshift connection "master"
10:47:46.606516 [debug] [MainThread]: On master: COMMIT
10:47:46.708635 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
10:47:46.709991 [debug] [MainThread]: On master: Close
10:47:46.711746 [info ] [MainThread]: Concurrency: 1 threads (target='test')
10:47:46.712487 [info ] [MainThread]: 
10:47:46.729189 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
10:47:46.730273 [info ] [Thread-1  ]: 1 of 6 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
10:47:46.733589 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
10:47:46.734937 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
10:47:46.735208 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
10:47:46.751707 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
10:47:46.753084 [debug] [Thread-1  ]: finished collecting timing info
10:47:46.753290 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
10:47:46.778693 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
10:47:46.779616 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:47:46.779740 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
10:47:46.779836 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:47:46.779953 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:47:47.690245 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
10:47:47.692200 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:47:47.692666 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),'') :: FLOAT)
 AS elapsed_time
  , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),'') :: FLOAT)
 
  AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

10:47:47.832326 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.14 seconds
10:47:47.858234 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:47:47.859098 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
10:47:47.954568 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:47:47.962488 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:47:47.963006 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
10:47:48.059237 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:47:48.083457 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:47:48.084039 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:47:48.084254 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:47:48.294973 [debug] [Thread-1  ]: SQL status: COMMIT in 0.21 seconds
10:47:48.297029 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:47:48.297454 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
10:47:48.402381 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:47:48.419038 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:47:48.419721 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
10:47:48.518110 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:47:48.521209 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:47:48.521805 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:47:48.522343 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:47:48.727950 [debug] [Thread-1  ]: SQL status: COMMIT in 0.2 seconds
10:47:48.729204 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:47:48.729601 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
10:47:48.847240 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
10:47:48.850209 [debug] [Thread-1  ]: finished collecting timing info
10:47:48.851135 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
10:47:48.944135 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
10:47:48.946563 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04613b1d-0524-482d-a64d-bceb605afb53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d38af0>]}
10:47:48.947967 [info ] [Thread-1  ]: 1 of 6 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.21s]
10:47:48.953180 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
10:47:48.954252 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_onb_version
10:47:48.956125 [info ] [Thread-1  ]: 2 of 6 START view model dbt_amplitude_test.amplitude_onb_version ............... [RUN]
10:47:48.957097 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_onb_version"
10:47:48.957339 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_onb_version
10:47:48.957629 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_onb_version
10:47:48.966931 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_onb_version"
10:47:48.969525 [debug] [Thread-1  ]: finished collecting timing info
10:47:48.969802 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_onb_version
10:47:48.973223 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_onb_version"
10:47:48.973900 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:47:48.974091 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
10:47:48.974256 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:47:48.974441 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:47:49.877904 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
10:47:49.878909 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:47:49.879513 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */


  create view "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" as (
    SELECT DISTINCT
  user_id
	, session_id
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))

  AS onb_version
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_start'
  AND
    (nullif(json_extract_path_text(user_properties,'onb_version',true),null))
 IS NOT NULL
  ) ;

10:47:49.999206 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
10:47:50.009252 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:47:50.009742 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version" rename to "amplitude_onb_version__dbt_backup"
10:47:50.105167 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:47:50.112606 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:47:50.113199 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" rename to "amplitude_onb_version"
10:47:50.210849 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:47:50.213358 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:47:50.213619 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:47:50.213820 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:47:50.406233 [debug] [Thread-1  ]: SQL status: COMMIT in 0.19 seconds
10:47:50.408082 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:47:50.408370 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
10:47:50.514528 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
10:47:50.519386 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:47:50.519937 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_backup" cascade
10:47:50.620172 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:47:50.623377 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:47:50.623787 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:47:50.624145 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:47:50.802579 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
10:47:50.804002 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:47:50.804429 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
10:47:50.908860 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:47:50.911869 [debug] [Thread-1  ]: finished collecting timing info
10:47:50.913062 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: ROLLBACK
10:47:51.006018 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: Close
10:47:51.009011 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04613b1d-0524-482d-a64d-bceb605afb53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d64d30>]}
10:47:51.010427 [info ] [Thread-1  ]: 2 of 6 OK created view model dbt_amplitude_test.amplitude_onb_version .......... [[32mCREATE VIEW[0m in 2.05s]
10:47:51.011687 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_onb_version
10:47:51.016210 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
10:47:51.017106 [info ] [Thread-1  ]: 3 of 6 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
10:47:51.017813 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
10:47:51.018031 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
10:47:51.018251 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
10:47:51.026290 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
10:47:51.028279 [debug] [Thread-1  ]: finished collecting timing info
10:47:51.028552 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
10:47:51.033817 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
10:47:51.035921 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:47:51.036311 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
10:47:51.036504 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:47:51.036716 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:47:51.939602 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
10:47:51.940885 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:47:51.941181 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

10:47:52.052878 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
10:47:52.062306 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:47:52.063034 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
10:47:52.158515 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:47:52.166758 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:47:52.167453 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
10:47:52.260969 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
10:47:52.265318 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:47:52.265755 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:47:52.266107 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:47:52.415314 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
10:47:52.417328 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:47:52.417720 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
10:47:52.530224 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
10:47:52.537371 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:47:52.538283 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
10:47:52.634601 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:47:52.638035 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:47:52.638524 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:47:52.638891 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:47:52.800846 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
10:47:52.801767 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:47:52.802140 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
10:47:52.911421 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
10:47:52.915640 [debug] [Thread-1  ]: finished collecting timing info
10:47:52.916264 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
10:47:53.013960 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
10:47:53.017213 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04613b1d-0524-482d-a64d-bceb605afb53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d11640>]}
10:47:53.018739 [info ] [Thread-1  ]: 3 of 6 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.00s]
10:47:53.019995 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
10:47:53.024775 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
10:47:53.025650 [info ] [Thread-1  ]: 4 of 6 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
10:47:53.026611 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
10:47:53.026862 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
10:47:53.027091 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
10:47:53.041568 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
10:47:53.044087 [debug] [Thread-1  ]: finished collecting timing info
10:47:53.044344 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
10:47:53.047714 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
10:47:53.048257 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:47:53.048418 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
10:47:53.048731 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:47:53.049009 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:47:53.950602 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
10:47:53.951609 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:47:53.952004 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

10:47:54.096166 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.14 seconds
10:47:54.105313 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:47:54.106056 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
10:47:54.201547 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:47:54.208912 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:47:54.209665 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
10:47:54.309791 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:47:54.314884 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:47:54.315329 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:47:54.315679 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:47:54.507973 [debug] [Thread-1  ]: SQL status: COMMIT in 0.19 seconds
10:47:54.510063 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:47:54.510480 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
10:47:54.627884 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
10:47:54.632856 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:47:54.633325 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
10:47:54.736828 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:47:54.740846 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:47:54.741336 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:47:54.742737 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:47:54.903357 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
10:47:54.905094 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:47:54.905403 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
10:47:55.012503 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
10:47:55.015998 [debug] [Thread-1  ]: finished collecting timing info
10:47:55.016634 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
10:47:55.117863 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
10:47:55.121410 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04613b1d-0524-482d-a64d-bceb605afb53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108dc6520>]}
10:47:55.123582 [info ] [Thread-1  ]: 4 of 6 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.09s]
10:47:55.129066 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
10:47:55.129745 [debug] [Thread-1  ]: Began running node model.amplitude_event.stg_amplitude_device
10:47:55.130149 [info ] [Thread-1  ]: 5 of 6 START view model dbt_amplitude_test.stg_amplitude_device ................ [RUN]
10:47:55.131339 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.stg_amplitude_device"
10:47:55.131637 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.stg_amplitude_device
10:47:55.131866 [debug] [Thread-1  ]: Compiling model.amplitude_event.stg_amplitude_device
10:47:55.140345 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.stg_amplitude_device"
10:47:55.144011 [debug] [Thread-1  ]: finished collecting timing info
10:47:55.144365 [debug] [Thread-1  ]: Began executing node model.amplitude_event.stg_amplitude_device
10:47:55.146393 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.stg_amplitude_device"
10:47:55.147581 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:47:55.147844 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
10:47:55.148015 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:47:55.148196 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:47:56.071742 [debug] [Thread-1  ]: SQL status: BEGIN in 0.92 seconds
10:47:56.072946 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:47:56.073333 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

10:47:56.185625 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
10:47:56.195135 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:47:56.195817 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_tmp" rename to "stg_amplitude_device"
10:47:56.290945 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
10:47:56.295332 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
10:47:56.295920 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:47:56.296273 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
10:47:56.551984 [debug] [Thread-1  ]: SQL status: COMMIT in 0.26 seconds
10:47:56.554027 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:47:56.554419 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
10:47:56.668344 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
10:47:56.676127 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:47:56.676876 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_backup" cascade
10:47:56.773204 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:47:56.776654 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
10:47:56.777065 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:47:56.777425 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
10:47:56.930158 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
10:47:56.931481 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:47:56.931883 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
10:47:57.043418 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
10:47:57.046199 [debug] [Thread-1  ]: finished collecting timing info
10:47:57.046751 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: ROLLBACK
10:47:57.142296 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: Close
10:47:57.144697 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04613b1d-0524-482d-a64d-bceb605afb53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d38af0>]}
10:47:57.146015 [info ] [Thread-1  ]: 5 of 6 OK created view model dbt_amplitude_test.stg_amplitude_device ........... [[32mCREATE VIEW[0m in 2.01s]
10:47:57.146942 [debug] [Thread-1  ]: Finished running node model.amplitude_event.stg_amplitude_device
10:47:57.148121 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
10:47:57.148551 [info ] [Thread-1  ]: 6 of 6 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
10:47:57.149507 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
10:47:57.149773 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
10:47:57.150032 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
10:47:57.156256 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
10:47:57.158307 [debug] [Thread-1  ]: finished collecting timing info
10:47:57.158635 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
10:47:57.163316 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
10:47:57.164569 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:47:57.164792 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
10:47:57.164969 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:47:57.165158 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:47:58.075990 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
10:47:58.077230 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:47:58.077634 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    WITH device AS (
  SELECT DISTINCT
    user_id
    , device_type
 FROM "dev"."dbt_amplitude_test"."stg_amplitude_device"
)

SELECT
  user_id
  , device_type
  , COUNT(user_id) OVER (PARTITION BY user_id) AS num_devices
FROM device
;
  ) ;

10:47:58.187908 [debug] [Thread-1  ]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 17: ;
         ^

10:47:58.188797 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
10:47:58.285149 [debug] [Thread-1  ]: finished collecting timing info
10:47:58.286065 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
10:47:58.287771 [debug] [Thread-1  ]: Database Error in model amplitude_device (models/amplitude_device.sql)
  syntax error at or near ";"
  LINE 17: ;
           ^
  compiled SQL at target/run/amplitude_event/models/amplitude_device.sql
10:47:58.288749 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04613b1d-0524-482d-a64d-bceb605afb53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d84070>]}
10:47:58.289989 [error] [Thread-1  ]: 6 of 6 ERROR creating view model dbt_amplitude_test.amplitude_device ........... [[31mERROR[0m in 1.14s]
10:47:58.291433 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
10:47:58.298507 [debug] [MainThread]: Acquiring new redshift connection "master"
10:47:58.299120 [debug] [MainThread]: Using redshift connection "master"
10:47:58.299332 [debug] [MainThread]: On master: BEGIN
10:47:58.299602 [debug] [MainThread]: Opening a new connection, currently in state closed
10:47:58.299825 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:47:59.197961 [debug] [MainThread]: SQL status: BEGIN in 0.9 seconds
10:47:59.198982 [debug] [MainThread]: On master: COMMIT
10:47:59.199267 [debug] [MainThread]: Using redshift connection "master"
10:47:59.199612 [debug] [MainThread]: On master: COMMIT
10:47:59.293675 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
10:47:59.294875 [debug] [MainThread]: On master: Close
10:47:59.298498 [info ] [MainThread]: 
10:47:59.299727 [info ] [MainThread]: Finished running 6 view models in 16.54s.
10:47:59.304961 [debug] [MainThread]: Connection 'master' was properly closed.
10:47:59.305349 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_device' was properly closed.
10:47:59.325253 [info ] [MainThread]: 
10:47:59.325698 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
10:47:59.326000 [info ] [MainThread]: 
10:47:59.326453 [error] [MainThread]: [33mDatabase Error in model amplitude_device (models/amplitude_device.sql)[0m
10:47:59.326720 [error] [MainThread]:   syntax error at or near ";"
10:47:59.326959 [error] [MainThread]:   LINE 17: ;
10:47:59.327182 [error] [MainThread]:            ^
10:47:59.327402 [error] [MainThread]:   compiled SQL at target/run/amplitude_event/models/amplitude_device.sql
10:47:59.327651 [info ] [MainThread]: 
10:47:59.327896 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
10:47:59.328257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b4e6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108dc6520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cfeca0>]}


============================== 2022-07-12 10:49:46.061333 | 0ae42868-1b26-470e-9590-204889122ae3 ==============================
10:49:46.061350 [info ] [MainThread]: Running with dbt=1.1.1
10:49:46.061741 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:49:46.061816 [debug] [MainThread]: Tracking: tracking
10:49:46.076734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087a20a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087a26d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087a2490>]}
10:49:46.099731 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
10:49:46.099944 [debug] [MainThread]: Partial parsing: added file: amplitude_event://models/amplitude/amplitude_device.sql
10:49:46.100026 [debug] [MainThread]: Partial parsing: deleted file: amplitude_event://models/amplitude_device.sql
10:49:46.105890 [debug] [MainThread]: 1699: static parser successfully parsed amplitude/amplitude_device.sql
10:49:46.120553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0ae42868-1b26-470e-9590-204889122ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108908e80>]}
10:49:46.123418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0ae42868-1b26-470e-9590-204889122ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088c58e0>]}
10:49:46.123564 [info ] [MainThread]: Found 6 models, 2 tests, 0 snapshots, 0 analyses, 195 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
10:49:46.123701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ae42868-1b26-470e-9590-204889122ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087ae730>]}
10:49:46.124446 [info ] [MainThread]: 
10:49:46.124654 [debug] [MainThread]: Acquiring new redshift connection "master"
10:49:46.125148 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
10:49:46.130156 [debug] [ThreadPool]: Using redshift connection "list_dev"
10:49:46.130230 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
10:49:46.130292 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:49:46.130358 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:49:47.147349 [debug] [ThreadPool]: SQL status: SELECT in 1.02 seconds
10:49:47.152155 [debug] [ThreadPool]: On list_dev: Close
10:49:47.156732 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
10:49:47.174498 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
10:49:47.174872 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
10:49:47.175056 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:49:47.175245 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:49:48.098940 [debug] [ThreadPool]: SQL status: BEGIN in 0.92 seconds
10:49:48.100177 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
10:49:48.100620 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
10:49:48.223222 [debug] [ThreadPool]: SQL status: SELECT in 0.12 seconds
10:49:48.228994 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
10:49:48.329612 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
10:49:48.347154 [debug] [MainThread]: Using redshift connection "master"
10:49:48.347694 [debug] [MainThread]: On master: BEGIN
10:49:48.347941 [debug] [MainThread]: Opening a new connection, currently in state init
10:49:48.348406 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:49:49.272922 [debug] [MainThread]: SQL status: BEGIN in 0.92 seconds
10:49:49.274124 [debug] [MainThread]: Using redshift connection "master"
10:49:49.274516 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
10:49:49.461051 [debug] [MainThread]: SQL status: SELECT in 0.19 seconds
10:49:49.470209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ae42868-1b26-470e-9590-204889122ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088a7ac0>]}
10:49:49.471567 [debug] [MainThread]: On master: ROLLBACK
10:49:49.563168 [debug] [MainThread]: Using redshift connection "master"
10:49:49.564031 [debug] [MainThread]: On master: BEGIN
10:49:49.749886 [debug] [MainThread]: SQL status: BEGIN in 0.19 seconds
10:49:49.751146 [debug] [MainThread]: On master: COMMIT
10:49:49.751806 [debug] [MainThread]: Using redshift connection "master"
10:49:49.752215 [debug] [MainThread]: On master: COMMIT
10:49:49.851247 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
10:49:49.852210 [debug] [MainThread]: On master: Close
10:49:49.853221 [info ] [MainThread]: Concurrency: 1 threads (target='test')
10:49:49.853785 [info ] [MainThread]: 
10:49:49.868355 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
10:49:49.870127 [info ] [Thread-1  ]: 1 of 6 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
10:49:49.871476 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
10:49:49.871848 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
10:49:49.872318 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
10:49:49.885078 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
10:49:49.886919 [debug] [Thread-1  ]: finished collecting timing info
10:49:49.887282 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
10:49:49.912690 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
10:49:49.913448 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:49:49.913567 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
10:49:49.913666 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:49:49.913779 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:49:50.794610 [debug] [Thread-1  ]: SQL status: BEGIN in 0.88 seconds
10:49:50.795973 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:49:50.796577 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),'') :: FLOAT)
 AS elapsed_time
  , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),'') :: FLOAT)
 
  AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

10:49:50.904175 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
10:49:50.923850 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:49:50.924417 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
10:49:51.018011 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
10:49:51.030951 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:49:51.031527 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
10:49:51.125461 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
10:49:51.149276 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:49:51.149649 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:49:51.149839 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:49:51.318717 [debug] [Thread-1  ]: SQL status: COMMIT in 0.17 seconds
10:49:51.320187 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:49:51.323023 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
10:49:51.437917 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
10:49:51.453320 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:49:51.453934 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
10:49:51.549091 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.09 seconds
10:49:51.552969 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:49:51.553678 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:49:51.554054 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:49:51.682509 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:49:51.683373 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:49:51.683761 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
10:49:51.779456 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:49:51.782172 [debug] [Thread-1  ]: finished collecting timing info
10:49:51.782713 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
10:49:51.877024 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
10:49:51.881118 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ae42868-1b26-470e-9590-204889122ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108995a90>]}
10:49:51.883170 [info ] [Thread-1  ]: 1 of 6 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.01s]
10:49:51.884678 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
10:49:51.885287 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_onb_version
10:49:51.886039 [info ] [Thread-1  ]: 2 of 6 START view model dbt_amplitude_test.amplitude_onb_version ............... [RUN]
10:49:51.888979 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_onb_version"
10:49:51.889771 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_onb_version
10:49:51.890067 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_onb_version
10:49:51.901906 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_onb_version"
10:49:51.903842 [debug] [Thread-1  ]: finished collecting timing info
10:49:51.904903 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_onb_version
10:49:51.909003 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_onb_version"
10:49:51.909980 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:49:51.910162 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
10:49:51.910311 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:49:51.910470 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:49:52.819226 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
10:49:52.820936 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:49:52.821367 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */


  create view "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" as (
    SELECT DISTINCT
  user_id
	, session_id
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))

  AS onb_version
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_start'
  AND
    (nullif(json_extract_path_text(user_properties,'onb_version',true),null))
 IS NOT NULL
  ) ;

10:49:52.923491 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
10:49:52.933215 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:49:52.933873 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version" rename to "amplitude_onb_version__dbt_backup"
10:49:53.029163 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:49:53.037099 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:49:53.037757 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" rename to "amplitude_onb_version"
10:49:53.139970 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:49:53.142849 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:49:53.143226 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:49:53.143416 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:49:53.287340 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
10:49:53.289366 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:49:53.289758 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
10:49:53.385582 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:49:53.393128 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:49:53.393711 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_backup" cascade
10:49:53.490783 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:49:53.494751 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:49:53.495392 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:49:53.495772 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:49:53.623699 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:49:53.625129 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:49:53.625522 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
10:49:53.722047 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:49:53.725027 [debug] [Thread-1  ]: finished collecting timing info
10:49:53.725638 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: ROLLBACK
10:49:53.821021 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: Close
10:49:53.824443 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ae42868-1b26-470e-9590-204889122ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10896e790>]}
10:49:53.825631 [info ] [Thread-1  ]: 2 of 6 OK created view model dbt_amplitude_test.amplitude_onb_version .......... [[32mCREATE VIEW[0m in 1.94s]
10:49:53.826520 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_onb_version
10:49:53.827532 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
10:49:53.828029 [info ] [Thread-1  ]: 3 of 6 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
10:49:53.828687 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
10:49:53.828886 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
10:49:53.829076 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
10:49:53.834034 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
10:49:53.836661 [debug] [Thread-1  ]: finished collecting timing info
10:49:53.837073 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
10:49:53.841721 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
10:49:53.843159 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:49:53.843409 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
10:49:53.843609 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:49:53.843817 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:49:54.756125 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
10:49:54.757330 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:49:54.757944 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

10:49:54.859996 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
10:49:54.869186 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:49:54.869931 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
10:49:54.961920 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
10:49:54.971436 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:49:54.972056 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
10:49:55.064181 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
10:49:55.068632 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:49:55.069213 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:49:55.069434 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:49:55.201521 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:49:55.203578 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:49:55.203897 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
10:49:55.296748 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
10:49:55.303797 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:49:55.304392 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
10:49:55.398179 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.09 seconds
10:49:55.402318 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:49:55.402596 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:49:55.402831 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:49:55.532197 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:49:55.533481 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:49:55.533891 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
10:49:55.628872 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
10:49:55.631415 [debug] [Thread-1  ]: finished collecting timing info
10:49:55.631918 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
10:49:55.725769 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
10:49:55.728833 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ae42868-1b26-470e-9590-204889122ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10896e310>]}
10:49:55.730245 [info ] [Thread-1  ]: 3 of 6 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.90s]
10:49:55.731606 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
10:49:55.736284 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
10:49:55.737377 [info ] [Thread-1  ]: 4 of 6 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
10:49:55.738100 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
10:49:55.738370 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
10:49:55.738599 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
10:49:55.753628 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
10:49:55.758816 [debug] [Thread-1  ]: finished collecting timing info
10:49:55.759280 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
10:49:55.765317 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
10:49:55.766304 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:49:55.766517 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
10:49:55.766685 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:49:55.766873 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:49:56.675038 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
10:49:56.676518 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:49:56.676971 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

10:49:56.796203 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
10:49:56.806344 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:49:56.807136 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
10:49:56.901455 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
10:49:56.912708 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:49:56.913985 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
10:49:57.017446 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:49:57.020944 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:49:57.021317 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:49:57.021522 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:49:57.157723 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
10:49:57.159820 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:49:57.160214 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
10:49:57.255058 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
10:49:57.261594 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:49:57.262073 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
10:49:57.360372 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:49:57.363340 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:49:57.363854 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:49:57.364236 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:49:57.487175 [debug] [Thread-1  ]: SQL status: COMMIT in 0.12 seconds
10:49:57.488256 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:49:57.488469 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
10:49:57.584497 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:49:57.586884 [debug] [Thread-1  ]: finished collecting timing info
10:49:57.587369 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
10:49:57.690364 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
10:49:57.692819 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ae42868-1b26-470e-9590-204889122ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089f6340>]}
10:49:57.694703 [info ] [Thread-1  ]: 4 of 6 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 1.95s]
10:49:57.700900 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
10:49:57.701912 [debug] [Thread-1  ]: Began running node model.amplitude_event.stg_amplitude_device
10:49:57.702580 [info ] [Thread-1  ]: 5 of 6 START view model dbt_amplitude_test.stg_amplitude_device ................ [RUN]
10:49:57.703727 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.stg_amplitude_device"
10:49:57.704053 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.stg_amplitude_device
10:49:57.704378 [debug] [Thread-1  ]: Compiling model.amplitude_event.stg_amplitude_device
10:49:57.712615 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.stg_amplitude_device"
10:49:57.714640 [debug] [Thread-1  ]: finished collecting timing info
10:49:57.715202 [debug] [Thread-1  ]: Began executing node model.amplitude_event.stg_amplitude_device
10:49:57.722412 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.stg_amplitude_device"
10:49:57.723920 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:49:57.724123 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
10:49:57.724302 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:49:57.724523 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:49:58.625391 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
10:49:58.626849 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:49:58.627282 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

10:49:58.732757 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
10:49:58.743472 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:49:58.744076 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."stg_amplitude_device" rename to "stg_amplitude_device__dbt_backup"
10:49:58.837679 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
10:49:58.847082 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:49:58.849076 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_tmp" rename to "stg_amplitude_device"
10:49:58.945518 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:49:58.949688 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
10:49:58.950009 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:49:58.950276 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
10:49:59.081865 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:49:59.084224 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:49:59.085008 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
10:49:59.176892 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
10:49:59.183617 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:49:59.184126 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_backup" cascade
10:49:59.282186 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:49:59.285512 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
10:49:59.286050 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:49:59.286348 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
10:49:59.421337 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:49:59.422521 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:49:59.422862 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
10:49:59.516940 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
10:49:59.519450 [debug] [Thread-1  ]: finished collecting timing info
10:49:59.519988 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: ROLLBACK
10:49:59.613908 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: Close
10:49:59.617268 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ae42868-1b26-470e-9590-204889122ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087d45b0>]}
10:49:59.619094 [info ] [Thread-1  ]: 5 of 6 OK created view model dbt_amplitude_test.stg_amplitude_device ........... [[32mCREATE VIEW[0m in 1.91s]
10:49:59.620568 [debug] [Thread-1  ]: Finished running node model.amplitude_event.stg_amplitude_device
10:49:59.626396 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
10:49:59.626862 [info ] [Thread-1  ]: 6 of 6 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
10:49:59.627639 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
10:49:59.627861 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
10:49:59.628080 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
10:49:59.634409 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
10:49:59.636429 [debug] [Thread-1  ]: finished collecting timing info
10:49:59.636710 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
10:49:59.641981 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
10:49:59.643921 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:49:59.644187 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
10:49:59.644485 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:49:59.644783 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:50:00.558667 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
10:50:00.560035 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:50:00.560301 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    WITH device AS (
  SELECT DISTINCT
    user_id
    , device_type
 FROM "dev"."dbt_amplitude_test"."stg_amplitude_device"
)

SELECT
  user_id
  , device_type
  , COUNT(user_id) OVER (PARTITION BY user_id) AS num_devices
FROM device
  ) ;

10:50:00.658777 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
10:50:00.668566 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:50:00.669167 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device" rename to "amplitude_device__dbt_backup"
10:50:00.762201 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
10:50:00.770106 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:50:00.770820 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
10:50:00.864457 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
10:50:00.867896 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
10:50:00.868438 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:50:00.868713 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
10:50:00.994676 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:50:00.996714 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:50:00.997099 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
10:50:01.091092 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
10:50:01.098185 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:50:01.098854 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
10:50:01.195842 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:50:01.199044 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
10:50:01.199486 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:50:01.199727 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
10:50:01.328875 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:50:01.329518 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:50:01.329819 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
10:50:01.425194 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:50:01.427486 [debug] [Thread-1  ]: finished collecting timing info
10:50:01.427881 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
10:50:01.540980 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
10:50:01.545430 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ae42868-1b26-470e-9590-204889122ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088b27c0>]}
10:50:01.546613 [info ] [Thread-1  ]: 6 of 6 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 1.92s]
10:50:01.547687 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
10:50:01.554540 [debug] [MainThread]: Acquiring new redshift connection "master"
10:50:01.555000 [debug] [MainThread]: Using redshift connection "master"
10:50:01.555201 [debug] [MainThread]: On master: BEGIN
10:50:01.555378 [debug] [MainThread]: Opening a new connection, currently in state closed
10:50:01.555613 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:50:02.474379 [debug] [MainThread]: SQL status: BEGIN in 0.92 seconds
10:50:02.476065 [debug] [MainThread]: On master: COMMIT
10:50:02.476719 [debug] [MainThread]: Using redshift connection "master"
10:50:02.477129 [debug] [MainThread]: On master: COMMIT
10:50:02.571830 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
10:50:02.572751 [debug] [MainThread]: On master: Close
10:50:02.574728 [info ] [MainThread]: 
10:50:02.575781 [info ] [MainThread]: Finished running 6 view models in 16.45s.
10:50:02.581086 [debug] [MainThread]: Connection 'master' was properly closed.
10:50:02.581764 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_device' was properly closed.
10:50:02.597474 [info ] [MainThread]: 
10:50:02.597916 [info ] [MainThread]: [32mCompleted successfully[0m
10:50:02.598273 [info ] [MainThread]: 
10:50:02.598522 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
10:50:02.599281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a491f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a49130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a492b0>]}


============================== 2022-07-12 11:24:34.918371 | c37eeb2b-39a7-46ae-b3bd-a873435ddc2d ==============================
11:24:34.918392 [info ] [MainThread]: Running with dbt=1.1.1
11:24:34.918756 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
11:24:34.918827 [debug] [MainThread]: Tracking: tracking
11:24:34.936369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111821f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111886f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1118865e0>]}
11:24:34.961938 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
11:24:34.962198 [debug] [MainThread]: Partial parsing: updated file: amplitude_event://models/amplitude/amplitude_device.sql
11:24:34.968103 [debug] [MainThread]: 1699: static parser successfully parsed amplitude/amplitude_device.sql
11:24:34.982166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c37eeb2b-39a7-46ae-b3bd-a873435ddc2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119ede80>]}
11:24:34.985238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c37eeb2b-39a7-46ae-b3bd-a873435ddc2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119ac8e0>]}
11:24:34.985386 [info ] [MainThread]: Found 6 models, 2 tests, 0 snapshots, 0 analyses, 195 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
11:24:34.985511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c37eeb2b-39a7-46ae-b3bd-a873435ddc2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111894580>]}
11:24:34.986282 [info ] [MainThread]: 
11:24:34.986491 [debug] [MainThread]: Acquiring new redshift connection "master"
11:24:34.986980 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
11:24:34.992065 [debug] [ThreadPool]: Using redshift connection "list_dev"
11:24:34.992147 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
11:24:34.992206 [debug] [ThreadPool]: Opening a new connection, currently in state init
11:24:34.992280 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
11:24:36.053896 [debug] [ThreadPool]: SQL status: SELECT in 1.06 seconds
11:24:36.064454 [debug] [ThreadPool]: On list_dev: Close
11:24:36.068246 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
11:24:36.083471 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
11:24:36.083787 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
11:24:36.083973 [debug] [ThreadPool]: Opening a new connection, currently in state closed
11:24:36.084168 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
11:24:37.039445 [debug] [ThreadPool]: SQL status: BEGIN in 0.96 seconds
11:24:37.040766 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
11:24:37.041211 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
11:24:37.156497 [debug] [ThreadPool]: SQL status: SELECT in 0.11 seconds
11:24:37.161690 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
11:24:37.259979 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
11:24:37.275862 [debug] [MainThread]: Using redshift connection "master"
11:24:37.276448 [debug] [MainThread]: On master: BEGIN
11:24:37.276719 [debug] [MainThread]: Opening a new connection, currently in state init
11:24:37.277076 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
11:24:38.225951 [debug] [MainThread]: SQL status: BEGIN in 0.95 seconds
11:24:38.227232 [debug] [MainThread]: Using redshift connection "master"
11:24:38.227663 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
11:24:38.403502 [debug] [MainThread]: SQL status: SELECT in 0.18 seconds
11:24:38.411188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c37eeb2b-39a7-46ae-b3bd-a873435ddc2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11193be50>]}
11:24:38.412391 [debug] [MainThread]: On master: ROLLBACK
11:24:38.509287 [debug] [MainThread]: Using redshift connection "master"
11:24:38.510202 [debug] [MainThread]: On master: BEGIN
11:24:38.706668 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
11:24:38.708044 [debug] [MainThread]: On master: COMMIT
11:24:38.709327 [debug] [MainThread]: Using redshift connection "master"
11:24:38.709762 [debug] [MainThread]: On master: COMMIT
11:24:38.809834 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
11:24:38.810797 [debug] [MainThread]: On master: Close
11:24:38.812822 [info ] [MainThread]: Concurrency: 1 threads (target='test')
11:24:38.813667 [info ] [MainThread]: 
11:24:38.827366 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
11:24:38.828340 [info ] [Thread-1  ]: 1 of 6 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
11:24:38.829318 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
11:24:38.829609 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
11:24:38.829889 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
11:24:38.842081 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
11:24:38.844013 [debug] [Thread-1  ]: finished collecting timing info
11:24:38.844240 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
11:24:38.868461 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
11:24:38.869823 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
11:24:38.869957 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
11:24:38.870059 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:24:38.870177 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
11:24:39.804600 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
11:24:39.808381 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
11:24:39.808988 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),'') :: FLOAT)
 AS elapsed_time
  , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),'') :: FLOAT)
 
  AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

11:24:39.925243 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
11:24:39.953744 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
11:24:39.954525 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
11:24:40.052002 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
11:24:40.057974 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
11:24:40.058362 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
11:24:40.157197 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
11:24:40.190672 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
11:24:40.191485 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
11:24:40.191617 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
11:24:40.326601 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
11:24:40.327823 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
11:24:40.328237 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
11:24:40.426123 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
11:24:40.436124 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
11:24:40.437064 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
11:24:40.535568 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
11:24:40.537000 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
11:24:40.537195 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
11:24:40.537365 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
11:24:40.667149 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
11:24:40.667999 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
11:24:40.668278 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
11:24:40.767392 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
11:24:40.769975 [debug] [Thread-1  ]: finished collecting timing info
11:24:40.770329 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
11:24:40.875651 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
11:24:40.878226 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c37eeb2b-39a7-46ae-b3bd-a873435ddc2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11195e550>]}
11:24:40.879336 [info ] [Thread-1  ]: 1 of 6 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.05s]
11:24:40.880395 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
11:24:40.880732 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_onb_version
11:24:40.882125 [info ] [Thread-1  ]: 2 of 6 START view model dbt_amplitude_test.amplitude_onb_version ............... [RUN]
11:24:40.882922 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_onb_version"
11:24:40.883143 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_onb_version
11:24:40.883371 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_onb_version
11:24:40.894358 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_onb_version"
11:24:40.897392 [debug] [Thread-1  ]: finished collecting timing info
11:24:40.897598 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_onb_version
11:24:40.899479 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_onb_version"
11:24:40.900228 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
11:24:40.900382 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
11:24:40.900466 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:24:40.900562 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
11:24:41.827143 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
11:24:41.830793 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
11:24:41.836631 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */


  create view "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" as (
    SELECT DISTINCT
  user_id
	, session_id
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))

  AS onb_version
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_start'
  AND
    (nullif(json_extract_path_text(user_properties,'onb_version',true),null))
 IS NOT NULL
  ) ;

11:24:41.944700 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
11:24:41.953103 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
11:24:41.953687 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version" rename to "amplitude_onb_version__dbt_backup"
11:24:42.049904 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
11:24:42.058830 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
11:24:42.059507 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" rename to "amplitude_onb_version"
11:24:42.155991 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
11:24:42.160011 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
11:24:42.160519 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
11:24:42.160734 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
11:24:42.293985 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
11:24:42.295656 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
11:24:42.296226 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
11:24:42.393563 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
11:24:42.401018 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
11:24:42.401758 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_backup" cascade
11:24:42.506910 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
11:24:42.510225 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
11:24:42.510641 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
11:24:42.511000 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
11:24:42.640709 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
11:24:42.641779 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
11:24:42.641992 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
11:24:42.738234 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
11:24:42.741592 [debug] [Thread-1  ]: finished collecting timing info
11:24:42.742405 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: ROLLBACK
11:24:42.840693 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: Close
11:24:42.843388 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c37eeb2b-39a7-46ae-b3bd-a873435ddc2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b800d0>]}
11:24:42.844780 [info ] [Thread-1  ]: 2 of 6 OK created view model dbt_amplitude_test.amplitude_onb_version .......... [[32mCREATE VIEW[0m in 1.96s]
11:24:42.846026 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_onb_version
11:24:42.848092 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
11:24:42.850351 [info ] [Thread-1  ]: 3 of 6 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
11:24:42.852264 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
11:24:42.852707 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
11:24:42.853075 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
11:24:42.859602 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
11:24:42.862587 [debug] [Thread-1  ]: finished collecting timing info
11:24:42.862940 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
11:24:42.867020 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
11:24:42.868310 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
11:24:42.868558 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
11:24:42.868757 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:24:42.868958 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
11:24:43.817755 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
11:24:43.819769 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
11:24:43.820597 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

11:24:43.925726 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
11:24:43.935130 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
11:24:43.935607 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
11:24:44.040743 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
11:24:44.051517 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
11:24:44.052207 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
11:24:44.150755 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
11:24:44.156440 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
11:24:44.156885 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
11:24:44.158435 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
11:24:44.294476 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
11:24:44.296670 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
11:24:44.297105 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
11:24:44.394430 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
11:24:44.400784 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
11:24:44.401393 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
11:24:44.502634 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
11:24:44.505995 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
11:24:44.506417 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
11:24:44.506783 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
11:24:44.637193 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
11:24:44.638448 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
11:24:44.638838 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
11:24:44.737416 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
11:24:44.740126 [debug] [Thread-1  ]: finished collecting timing info
11:24:44.740638 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
11:24:44.838139 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
11:24:44.840697 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c37eeb2b-39a7-46ae-b3bd-a873435ddc2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b801f0>]}
11:24:44.841662 [info ] [Thread-1  ]: 3 of 6 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.99s]
11:24:44.842958 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
11:24:44.843482 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
11:24:44.844452 [info ] [Thread-1  ]: 4 of 6 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
11:24:44.846037 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
11:24:44.846365 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
11:24:44.846710 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
11:24:44.861538 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
11:24:44.862949 [debug] [Thread-1  ]: finished collecting timing info
11:24:44.863245 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
11:24:44.869106 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
11:24:44.870142 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
11:24:44.870360 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
11:24:44.870539 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:24:44.870738 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
11:24:45.791521 [debug] [Thread-1  ]: SQL status: BEGIN in 0.92 seconds
11:24:45.792110 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
11:24:45.793915 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

11:24:45.913254 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
11:24:45.921144 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
11:24:45.921515 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
11:24:46.023258 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
11:24:46.029791 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
11:24:46.030108 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
11:24:46.128603 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
11:24:46.139180 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
11:24:46.141892 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
11:24:46.143866 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
11:24:46.297435 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
11:24:46.299456 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
11:24:46.299828 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
11:24:46.439155 [debug] [Thread-1  ]: SQL status: BEGIN in 0.14 seconds
11:24:46.442035 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
11:24:46.442359 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
11:24:46.542753 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
11:24:46.544403 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
11:24:46.544599 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
11:24:46.544784 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
11:24:46.671834 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
11:24:46.673264 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
11:24:46.673686 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
11:24:46.770320 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
11:24:46.773558 [debug] [Thread-1  ]: finished collecting timing info
11:24:46.774576 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
11:24:46.876171 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
11:24:46.880827 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c37eeb2b-39a7-46ae-b3bd-a873435ddc2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bd8550>]}
11:24:46.882320 [info ] [Thread-1  ]: 4 of 6 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.03s]
11:24:46.883238 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
11:24:46.883586 [debug] [Thread-1  ]: Began running node model.amplitude_event.stg_amplitude_device
11:24:46.883926 [info ] [Thread-1  ]: 5 of 6 START view model dbt_amplitude_test.stg_amplitude_device ................ [RUN]
11:24:46.885305 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.stg_amplitude_device"
11:24:46.887063 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.stg_amplitude_device
11:24:46.887326 [debug] [Thread-1  ]: Compiling model.amplitude_event.stg_amplitude_device
11:24:46.895343 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.stg_amplitude_device"
11:24:46.897172 [debug] [Thread-1  ]: finished collecting timing info
11:24:46.897512 [debug] [Thread-1  ]: Began executing node model.amplitude_event.stg_amplitude_device
11:24:46.900116 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.stg_amplitude_device"
11:24:46.900588 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
11:24:46.900729 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
11:24:46.900850 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:24:46.900996 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
11:24:47.862976 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
11:24:47.865090 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
11:24:47.865729 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

11:24:47.967566 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
11:24:47.975099 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
11:24:47.975540 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."stg_amplitude_device" rename to "stg_amplitude_device__dbt_backup"
11:24:48.071673 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
11:24:48.080407 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
11:24:48.080983 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_tmp" rename to "stg_amplitude_device"
11:24:48.177296 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
11:24:48.181453 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
11:24:48.182001 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
11:24:48.182326 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
11:24:48.314421 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
11:24:48.315904 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
11:24:48.316153 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
11:24:48.422900 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
11:24:48.427687 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
11:24:48.428176 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_backup" cascade
11:24:48.545973 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.12 seconds
11:24:48.549586 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
11:24:48.550044 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
11:24:48.550456 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
11:24:48.679243 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
11:24:48.680217 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
11:24:48.680505 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
11:24:48.785083 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
11:24:48.787530 [debug] [Thread-1  ]: finished collecting timing info
11:24:48.787935 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: ROLLBACK
11:24:48.886435 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: Close
11:24:48.887471 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c37eeb2b-39a7-46ae-b3bd-a873435ddc2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c14970>]}
11:24:48.887989 [info ] [Thread-1  ]: 5 of 6 OK created view model dbt_amplitude_test.stg_amplitude_device ........... [[32mCREATE VIEW[0m in 2.00s]
11:24:48.888508 [debug] [Thread-1  ]: Finished running node model.amplitude_event.stg_amplitude_device
11:24:48.889123 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
11:24:48.889636 [info ] [Thread-1  ]: 6 of 6 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
11:24:48.890298 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
11:24:48.890594 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
11:24:48.890815 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
11:24:48.894919 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
11:24:48.895927 [debug] [Thread-1  ]: finished collecting timing info
11:24:48.896194 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
11:24:48.900042 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
11:24:48.901003 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
11:24:48.901276 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
11:24:48.901503 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
11:24:48.901908 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
11:24:49.850617 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
11:24:49.851595 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
11:24:49.851823 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    WITH device AS (
  SELECT DISTINCT
    user_id
    , device_type
  FROM "dev"."dbt_amplitude_test"."stg_amplitude_device"
  WHERE device_type IS NOT NULL
)

SELECT
  user_id
  , device_type
  , COUNT(user_id) OVER (PARTITION BY user_id) AS num_devices
FROM device
  ) ;

11:24:49.954851 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
11:24:49.963948 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
11:24:49.964439 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
11:24:50.064176 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
11:24:50.067963 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
11:24:50.068326 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
11:24:50.068532 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
11:24:50.198710 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
11:24:50.199890 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
11:24:50.200812 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
11:24:50.297764 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
11:24:50.302380 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
11:24:50.302840 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
11:24:50.413790 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
11:24:50.417446 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
11:24:50.418216 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
11:24:50.418632 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
11:24:50.542367 [debug] [Thread-1  ]: SQL status: COMMIT in 0.12 seconds
11:24:50.543750 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
11:24:50.544164 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
11:24:50.650415 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
11:24:50.651921 [debug] [Thread-1  ]: finished collecting timing info
11:24:50.652281 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
11:24:50.751490 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
11:24:50.753128 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c37eeb2b-39a7-46ae-b3bd-a873435ddc2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119fdee0>]}
11:24:50.754014 [info ] [Thread-1  ]: 6 of 6 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 1.86s]
11:24:50.754992 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
11:24:50.757992 [debug] [MainThread]: Acquiring new redshift connection "master"
11:24:50.758677 [debug] [MainThread]: Using redshift connection "master"
11:24:50.759047 [debug] [MainThread]: On master: BEGIN
11:24:50.759524 [debug] [MainThread]: Opening a new connection, currently in state closed
11:24:50.759903 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
11:24:51.733662 [debug] [MainThread]: SQL status: BEGIN in 0.97 seconds
11:24:51.735330 [debug] [MainThread]: On master: COMMIT
11:24:51.735750 [debug] [MainThread]: Using redshift connection "master"
11:24:51.736150 [debug] [MainThread]: On master: COMMIT
11:24:51.832421 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
11:24:51.834060 [debug] [MainThread]: On master: Close
11:24:51.835250 [info ] [MainThread]: 
11:24:51.836585 [info ] [MainThread]: Finished running 6 view models in 16.85s.
11:24:51.837092 [debug] [MainThread]: Connection 'master' was properly closed.
11:24:51.838697 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_device' was properly closed.
11:24:51.859218 [info ] [MainThread]: 
11:24:51.859706 [info ] [MainThread]: [32mCompleted successfully[0m
11:24:51.860081 [info ] [MainThread]: 
11:24:51.860993 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
11:24:51.863129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bcf430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bcf760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bcf9d0>]}


============================== 2022-07-18 10:51:38.250824 | e207ac70-ae99-4127-88e4-0d9f6817e554 ==============================
10:51:38.250841 [info ] [MainThread]: Running with dbt=1.1.1
10:51:38.251267 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
10:51:38.251334 [debug] [MainThread]: Tracking: tracking
10:51:38.268992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043b5fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044168b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104416460>]}
10:51:38.294432 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
10:51:38.294572 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
10:51:38.297924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e207ac70-ae99-4127-88e4-0d9f6817e554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044e0fa0>]}
10:51:38.301720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e207ac70-ae99-4127-88e4-0d9f6817e554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10447ab20>]}
10:51:38.301857 [info ] [MainThread]: Found 6 models, 2 tests, 0 snapshots, 0 analyses, 195 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
10:51:38.301980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e207ac70-ae99-4127-88e4-0d9f6817e554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10447a970>]}
10:51:38.302705 [info ] [MainThread]: 
10:51:38.302916 [debug] [MainThread]: Acquiring new redshift connection "master"
10:51:38.303375 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
10:51:38.308479 [debug] [ThreadPool]: Using redshift connection "list_dev"
10:51:38.308558 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
10:51:38.308624 [debug] [ThreadPool]: Opening a new connection, currently in state init
10:51:38.308692 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:51:39.357435 [debug] [ThreadPool]: SQL status: SELECT in 1.05 seconds
10:51:39.362839 [debug] [ThreadPool]: On list_dev: Close
10:51:39.369035 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
10:51:39.381655 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
10:51:39.381979 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
10:51:39.382165 [debug] [ThreadPool]: Opening a new connection, currently in state closed
10:51:39.382348 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:51:40.314014 [debug] [ThreadPool]: SQL status: BEGIN in 0.93 seconds
10:51:40.315244 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
10:51:40.315639 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
10:51:40.430812 [debug] [ThreadPool]: SQL status: SELECT in 0.11 seconds
10:51:40.436610 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
10:51:40.530039 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
10:51:40.546242 [debug] [MainThread]: Using redshift connection "master"
10:51:40.546856 [debug] [MainThread]: On master: BEGIN
10:51:40.547083 [debug] [MainThread]: Opening a new connection, currently in state init
10:51:40.547439 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:51:41.471475 [debug] [MainThread]: SQL status: BEGIN in 0.92 seconds
10:51:41.472457 [debug] [MainThread]: Using redshift connection "master"
10:51:41.472662 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
10:51:41.657392 [debug] [MainThread]: SQL status: SELECT in 0.18 seconds
10:51:41.664462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e207ac70-ae99-4127-88e4-0d9f6817e554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044e8640>]}
10:51:41.665631 [debug] [MainThread]: On master: ROLLBACK
10:51:41.760580 [debug] [MainThread]: Using redshift connection "master"
10:51:41.761798 [debug] [MainThread]: On master: BEGIN
10:51:41.979289 [debug] [MainThread]: SQL status: BEGIN in 0.22 seconds
10:51:41.980603 [debug] [MainThread]: On master: COMMIT
10:51:41.981051 [debug] [MainThread]: Using redshift connection "master"
10:51:41.981605 [debug] [MainThread]: On master: COMMIT
10:51:42.078715 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
10:51:42.079359 [debug] [MainThread]: On master: Close
10:51:42.080819 [info ] [MainThread]: Concurrency: 1 threads (target='test')
10:51:42.081591 [info ] [MainThread]: 
10:51:42.100406 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
10:51:42.101542 [info ] [Thread-1  ]: 1 of 6 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
10:51:42.103158 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
10:51:42.103662 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
10:51:42.104117 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
10:51:42.118688 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
10:51:42.121133 [debug] [Thread-1  ]: finished collecting timing info
10:51:42.121298 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
10:51:42.145461 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
10:51:42.146110 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:51:42.146236 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
10:51:42.146334 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:51:42.146436 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:51:43.047233 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
10:51:43.048497 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:51:43.048977 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),'') :: FLOAT)
 AS elapsed_time
  , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),'') :: FLOAT)
 
  AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

10:51:43.166076 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
10:51:43.184195 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:51:43.184752 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
10:51:43.280256 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:51:43.288792 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:51:43.289413 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
10:51:43.385793 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:51:43.403469 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:51:43.404383 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:51:43.404612 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:51:43.563946 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
10:51:43.566486 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:51:43.567261 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
10:51:43.681704 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
10:51:43.694539 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:51:43.695154 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
10:51:43.795482 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:51:43.799519 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:51:43.799965 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:51:43.800156 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
10:51:43.935124 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:51:43.936333 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
10:51:43.936659 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
10:51:44.031925 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
10:51:44.034609 [debug] [Thread-1  ]: finished collecting timing info
10:51:44.035107 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
10:51:44.128101 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
10:51:44.132258 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e207ac70-ae99-4127-88e4-0d9f6817e554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104448550>]}
10:51:44.133989 [info ] [Thread-1  ]: 1 of 6 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.03s]
10:51:44.135358 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
10:51:44.139235 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_onb_version
10:51:44.140234 [info ] [Thread-1  ]: 2 of 6 START view model dbt_amplitude_test.amplitude_onb_version ............... [RUN]
10:51:44.143580 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_onb_version"
10:51:44.143925 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_onb_version
10:51:44.144163 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_onb_version
10:51:44.151574 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_onb_version"
10:51:44.154409 [debug] [Thread-1  ]: finished collecting timing info
10:51:44.154588 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_onb_version
10:51:44.156194 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_onb_version"
10:51:44.156777 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:51:44.156910 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
10:51:44.156994 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:51:44.157097 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:51:45.061711 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
10:51:45.062865 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:51:45.063164 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */


  create view "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" as (
    SELECT DISTINCT
  user_id
	, session_id
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))

  AS onb_version
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_start'
  AND
    (nullif(json_extract_path_text(user_properties,'onb_version',true),null))
 IS NOT NULL
  ) ;

10:51:45.165883 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
10:51:45.174668 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:51:45.175380 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version" rename to "amplitude_onb_version__dbt_backup"
10:51:45.270919 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:51:45.277639 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:51:45.278121 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" rename to "amplitude_onb_version"
10:51:45.373268 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
10:51:45.377491 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:51:45.378337 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:51:45.378769 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:51:45.512121 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:51:45.514459 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:51:45.514894 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
10:51:45.610322 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
10:51:45.616372 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:51:45.616928 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_backup" cascade
10:51:45.714799 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:51:45.717679 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:51:45.717953 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:51:45.718127 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
10:51:45.848214 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:51:45.848941 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
10:51:45.849126 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
10:51:45.966145 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
10:51:45.968489 [debug] [Thread-1  ]: finished collecting timing info
10:51:45.968777 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: ROLLBACK
10:51:46.075483 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: Close
10:51:46.079753 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e207ac70-ae99-4127-88e4-0d9f6817e554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045b1940>]}
10:51:46.081083 [info ] [Thread-1  ]: 2 of 6 OK created view model dbt_amplitude_test.amplitude_onb_version .......... [[32mCREATE VIEW[0m in 1.94s]
10:51:46.082143 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_onb_version
10:51:46.087291 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
10:51:46.087926 [info ] [Thread-1  ]: 3 of 6 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
10:51:46.088643 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
10:51:46.092629 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
10:51:46.095203 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
10:51:46.097532 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
10:51:46.098086 [debug] [Thread-1  ]: finished collecting timing info
10:51:46.098186 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
10:51:46.099681 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
10:51:46.100084 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:51:46.100170 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
10:51:46.100241 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:51:46.100322 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:51:47.028348 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
10:51:47.029426 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:51:47.029650 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

10:51:47.132871 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
10:51:47.144543 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:51:47.145070 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
10:51:47.247694 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:51:47.260696 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:51:47.261306 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
10:51:47.355822 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
10:51:47.361691 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:51:47.362259 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:51:47.362541 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:51:47.494642 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:51:47.496002 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:51:47.496417 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
10:51:47.592209 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:51:47.599449 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:51:47.600113 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
10:51:47.697384 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:51:47.703290 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:51:47.704100 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:51:47.704396 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
10:51:47.838046 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:51:47.839022 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
10:51:47.839217 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
10:51:47.934184 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
10:51:47.937286 [debug] [Thread-1  ]: finished collecting timing info
10:51:47.938120 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
10:51:48.049476 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
10:51:48.056161 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e207ac70-ae99-4127-88e4-0d9f6817e554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104615520>]}
10:51:48.057641 [info ] [Thread-1  ]: 3 of 6 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 1.97s]
10:51:48.058662 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
10:51:48.059039 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
10:51:48.059377 [info ] [Thread-1  ]: 4 of 6 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
10:51:48.060116 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
10:51:48.066602 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
10:51:48.067214 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
10:51:48.073906 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
10:51:48.076694 [debug] [Thread-1  ]: finished collecting timing info
10:51:48.077109 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
10:51:48.080676 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
10:51:48.082023 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:51:48.082369 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
10:51:48.082471 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:51:48.082565 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:51:49.003646 [debug] [Thread-1  ]: SQL status: BEGIN in 0.92 seconds
10:51:49.004905 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:51:49.005307 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

10:51:49.117192 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
10:51:49.124628 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:51:49.125450 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
10:51:49.224903 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:51:49.235276 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:51:49.236144 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
10:51:49.333681 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:51:49.337431 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:51:49.337812 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:51:49.338084 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:51:49.488593 [debug] [Thread-1  ]: SQL status: COMMIT in 0.15 seconds
10:51:49.491321 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:51:49.491725 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
10:51:49.598617 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
10:51:49.605476 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:51:49.606090 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
10:51:49.706801 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
10:51:49.709824 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:51:49.710275 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:51:49.710644 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
10:51:49.837955 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:51:49.838422 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
10:51:49.838597 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
10:51:49.934343 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:51:49.935845 [debug] [Thread-1  ]: finished collecting timing info
10:51:49.936268 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
10:51:50.038439 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
10:51:50.040308 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e207ac70-ae99-4127-88e4-0d9f6817e554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044cc5b0>]}
10:51:50.042529 [info ] [Thread-1  ]: 4 of 6 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 1.98s]
10:51:50.043682 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
10:51:50.047163 [debug] [Thread-1  ]: Began running node model.amplitude_event.stg_amplitude_device
10:51:50.047534 [info ] [Thread-1  ]: 5 of 6 START view model dbt_amplitude_test.stg_amplitude_device ................ [RUN]
10:51:50.048205 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.stg_amplitude_device"
10:51:50.048512 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.stg_amplitude_device
10:51:50.048734 [debug] [Thread-1  ]: Compiling model.amplitude_event.stg_amplitude_device
10:51:50.053062 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.stg_amplitude_device"
10:51:50.056393 [debug] [Thread-1  ]: finished collecting timing info
10:51:50.056702 [debug] [Thread-1  ]: Began executing node model.amplitude_event.stg_amplitude_device
10:51:50.062108 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.stg_amplitude_device"
10:51:50.064794 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:51:50.065161 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
10:51:50.066186 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:51:50.066411 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:51:50.992870 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
10:51:50.994154 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:51:50.994628 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

10:51:51.097459 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
10:51:51.107299 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:51:51.107917 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."stg_amplitude_device" rename to "stg_amplitude_device__dbt_backup"
10:51:51.202900 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
10:51:51.208923 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:51:51.209393 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_tmp" rename to "stg_amplitude_device"
10:51:51.305184 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:51:51.310887 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
10:51:51.311633 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:51:51.311999 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
10:51:51.447275 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:51:51.449259 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:51:51.449670 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
10:51:51.547466 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:51:51.554851 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:51:51.555593 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_backup" cascade
10:51:51.665609 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
10:51:51.669368 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
10:51:51.669794 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:51:51.670158 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
10:51:51.799844 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:51:51.801164 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
10:51:51.801590 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
10:51:51.897201 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:51:51.899834 [debug] [Thread-1  ]: finished collecting timing info
10:51:51.900224 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: ROLLBACK
10:51:51.992827 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: Close
10:51:51.994944 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e207ac70-ae99-4127-88e4-0d9f6817e554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045fab20>]}
10:51:51.996068 [info ] [Thread-1  ]: 5 of 6 OK created view model dbt_amplitude_test.stg_amplitude_device ........... [[32mCREATE VIEW[0m in 1.95s]
10:51:51.997381 [debug] [Thread-1  ]: Finished running node model.amplitude_event.stg_amplitude_device
10:51:52.002199 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
10:51:52.002793 [info ] [Thread-1  ]: 6 of 6 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
10:51:52.003468 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
10:51:52.003663 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
10:51:52.003860 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
10:51:52.008467 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
10:51:52.010048 [debug] [Thread-1  ]: finished collecting timing info
10:51:52.010718 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
10:51:52.017506 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
10:51:52.019071 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:51:52.019328 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
10:51:52.019516 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
10:51:52.019711 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:51:52.946703 [debug] [Thread-1  ]: SQL status: BEGIN in 0.93 seconds
10:51:52.947769 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:51:52.947974 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    WITH device AS (
  SELECT DISTINCT
    user_id
    , device_type
  FROM "dev"."dbt_amplitude_test"."stg_amplitude_device"
  WHERE device_type IS NOT NULL
)

SELECT
  user_id
  , device_type
  , COUNT(user_id) OVER (PARTITION BY user_id) AS num_devices
FROM device
  ) ;

10:51:53.052026 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
10:51:53.071820 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:51:53.076791 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
10:51:53.173269 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
10:51:53.179014 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
10:51:53.179651 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:51:53.180008 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
10:51:53.310076 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:51:53.312323 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:51:53.312788 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
10:51:53.406950 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
10:51:53.413756 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:51:53.414321 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
10:51:53.528806 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
10:51:53.533262 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
10:51:53.533780 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:51:53.533990 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
10:51:53.661318 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
10:51:53.662038 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
10:51:53.662441 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
10:51:53.758701 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
10:51:53.759833 [debug] [Thread-1  ]: finished collecting timing info
10:51:53.760119 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
10:51:53.856388 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
10:51:53.858296 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e207ac70-ae99-4127-88e4-0d9f6817e554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10451c100>]}
10:51:53.859295 [info ] [Thread-1  ]: 6 of 6 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 1.85s]
10:51:53.859969 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
10:51:53.861174 [debug] [MainThread]: Acquiring new redshift connection "master"
10:51:53.861436 [debug] [MainThread]: Using redshift connection "master"
10:51:53.861622 [debug] [MainThread]: On master: BEGIN
10:51:53.861942 [debug] [MainThread]: Opening a new connection, currently in state closed
10:51:53.862359 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
10:51:54.781764 [debug] [MainThread]: SQL status: BEGIN in 0.92 seconds
10:51:54.783085 [debug] [MainThread]: On master: COMMIT
10:51:54.783469 [debug] [MainThread]: Using redshift connection "master"
10:51:54.783857 [debug] [MainThread]: On master: COMMIT
10:51:54.894785 [debug] [MainThread]: SQL status: COMMIT in 0.11 seconds
10:51:54.899473 [debug] [MainThread]: On master: Close
10:51:54.901338 [info ] [MainThread]: 
10:51:54.902616 [info ] [MainThread]: Finished running 6 view models in 16.60s.
10:51:54.910373 [debug] [MainThread]: Connection 'master' was properly closed.
10:51:54.910557 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_device' was properly closed.
10:51:54.921273 [info ] [MainThread]: 
10:51:54.922001 [info ] [MainThread]: [32mCompleted successfully[0m
10:51:54.927231 [info ] [MainThread]: 
10:51:54.927657 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
10:51:54.928083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10454a4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045a2580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045a0a90>]}


============================== 2022-07-21 13:59:16.889417 | b4b71598-7ad2-467d-93e7-4d87f99c811a ==============================
13:59:16.889436 [info ] [MainThread]: Running with dbt=1.1.0
13:59:16.889884 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
13:59:16.889959 [debug] [MainThread]: Tracking: tracking
13:59:17.162964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10857c550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10857c100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10857c0d0>]}
13:59:17.194190 [info ] [MainThread]: Unable to do partial parsing because of a dbt version mismatch. Saved manifest version: 1.1.1. Current version: 1.1.0.
13:59:17.194474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'b4b71598-7ad2-467d-93e7-4d87f99c811a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10708fd00>]}
13:59:17.215890 [debug] [MainThread]: Parsing macros/json_extract_text.sql
13:59:17.217488 [debug] [MainThread]: Parsing macros/catalog.sql
13:59:17.226323 [debug] [MainThread]: Parsing macros/relations.sql
13:59:17.226642 [debug] [MainThread]: Parsing macros/adapters.sql
13:59:17.243965 [debug] [MainThread]: Parsing macros/materializations/snapshot_merge.sql
13:59:17.244293 [debug] [MainThread]: Parsing macros/catalog.sql
13:59:17.245414 [debug] [MainThread]: Parsing macros/relations.sql
13:59:17.246087 [debug] [MainThread]: Parsing macros/adapters.sql
13:59:17.256776 [debug] [MainThread]: Parsing macros/materializations/snapshot_merge.sql
13:59:17.257523 [debug] [MainThread]: Parsing macros/materializations/hooks.sql
13:59:17.259249 [debug] [MainThread]: Parsing macros/materializations/configs.sql
13:59:17.260311 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot_merge.sql
13:59:17.261034 [debug] [MainThread]: Parsing macros/materializations/snapshots/strategies.sql
13:59:17.268993 [debug] [MainThread]: Parsing macros/materializations/snapshots/helpers.sql
13:59:17.275504 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot.sql
13:59:17.280911 [debug] [MainThread]: Parsing macros/materializations/tests/test.sql
13:59:17.282998 [debug] [MainThread]: Parsing macros/materializations/tests/helpers.sql
13:59:17.283797 [debug] [MainThread]: Parsing macros/materializations/tests/where_subquery.sql
13:59:17.284615 [debug] [MainThread]: Parsing macros/materializations/models/incremental/column_helpers.sql
13:59:17.286622 [debug] [MainThread]: Parsing macros/materializations/models/incremental/merge.sql
13:59:17.294793 [debug] [MainThread]: Parsing macros/materializations/models/incremental/is_incremental.sql
13:59:17.295464 [debug] [MainThread]: Parsing macros/materializations/models/incremental/incremental.sql
13:59:17.300125 [debug] [MainThread]: Parsing macros/materializations/models/incremental/on_schema_change.sql
13:59:17.307534 [debug] [MainThread]: Parsing macros/materializations/models/table/table.sql
13:59:17.311220 [debug] [MainThread]: Parsing macros/materializations/models/table/create_table_as.sql
13:59:17.312465 [debug] [MainThread]: Parsing macros/materializations/models/view/view.sql
13:59:17.315945 [debug] [MainThread]: Parsing macros/materializations/models/view/helpers.sql
13:59:17.316515 [debug] [MainThread]: Parsing macros/materializations/models/view/create_or_replace_view.sql
13:59:17.317782 [debug] [MainThread]: Parsing macros/materializations/models/view/create_view_as.sql
13:59:17.318784 [debug] [MainThread]: Parsing macros/materializations/seeds/seed.sql
13:59:17.321561 [debug] [MainThread]: Parsing macros/materializations/seeds/helpers.sql
13:59:17.329404 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_alias.sql
13:59:17.330049 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_schema.sql
13:59:17.331133 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_database.sql
13:59:17.331816 [debug] [MainThread]: Parsing macros/generic_test_sql/relationships.sql
13:59:17.332202 [debug] [MainThread]: Parsing macros/generic_test_sql/not_null.sql
13:59:17.332545 [debug] [MainThread]: Parsing macros/generic_test_sql/unique.sql
13:59:17.332848 [debug] [MainThread]: Parsing macros/generic_test_sql/accepted_values.sql
13:59:17.333438 [debug] [MainThread]: Parsing macros/etc/statement.sql
13:59:17.335404 [debug] [MainThread]: Parsing macros/etc/datetime.sql
13:59:17.339422 [debug] [MainThread]: Parsing macros/adapters/schema.sql
13:59:17.340344 [debug] [MainThread]: Parsing macros/adapters/indexes.sql
13:59:17.341490 [debug] [MainThread]: Parsing macros/adapters/relation.sql
13:59:17.345827 [debug] [MainThread]: Parsing macros/adapters/freshness.sql
13:59:17.347103 [debug] [MainThread]: Parsing macros/adapters/persist_docs.sql
13:59:17.349035 [debug] [MainThread]: Parsing macros/adapters/metadata.sql
13:59:17.352388 [debug] [MainThread]: Parsing macros/adapters/columns.sql
13:59:17.356772 [debug] [MainThread]: Parsing tests/generic/builtin.sql
13:59:17.442795 [debug] [MainThread]: 1603: static parser failed on staging/stg_amplitude_device.sql
13:59:17.448867 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_amplitude_device.sql
13:59:17.449406 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_onb_version.sql
13:59:17.451473 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_onb_version.sql
13:59:17.452004 [debug] [MainThread]: 1699: static parser successfully parsed amplitude/amplitude_device.sql
13:59:17.452964 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
13:59:17.456398 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
13:59:17.456880 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_profile.sql
13:59:17.458176 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_profile.sql
13:59:17.458706 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_workouts.sql
13:59:17.462044 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_workouts.sql
13:59:17.491787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b4b71598-7ad2-467d-93e7-4d87f99c811a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086aac40>]}
13:59:17.495454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b4b71598-7ad2-467d-93e7-4d87f99c811a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10857c0a0>]}
13:59:17.495593 [info ] [MainThread]: Found 6 models, 2 tests, 0 snapshots, 0 analyses, 195 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
13:59:17.495717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b4b71598-7ad2-467d-93e7-4d87f99c811a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087252b0>]}
13:59:17.496459 [info ] [MainThread]: 
13:59:17.496672 [debug] [MainThread]: Acquiring new redshift connection "master"
13:59:17.497124 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
13:59:17.501824 [debug] [ThreadPool]: Using redshift connection "list_dev"
13:59:17.501908 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
13:59:17.501977 [debug] [ThreadPool]: Opening a new connection, currently in state init
13:59:17.502041 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:59:19.521619 [debug] [ThreadPool]: SQL status: SELECT in 2.02 seconds
13:59:19.530509 [debug] [ThreadPool]: On list_dev: Close
13:59:19.536191 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
13:59:19.548852 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
13:59:19.549235 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
13:59:19.549445 [debug] [ThreadPool]: Opening a new connection, currently in state closed
13:59:19.549695 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:59:21.088478 [debug] [ThreadPool]: SQL status: BEGIN in 1.54 seconds
13:59:21.089376 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
13:59:21.089949 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
13:59:21.248214 [debug] [ThreadPool]: SQL status: SELECT in 0.16 seconds
13:59:21.254029 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
13:59:21.396255 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
13:59:21.412450 [debug] [MainThread]: Using redshift connection "master"
13:59:21.413189 [debug] [MainThread]: On master: BEGIN
13:59:21.413456 [debug] [MainThread]: Opening a new connection, currently in state init
13:59:21.413749 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:59:22.791566 [debug] [MainThread]: SQL status: BEGIN in 1.38 seconds
13:59:22.793720 [debug] [MainThread]: Using redshift connection "master"
13:59:22.794160 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
13:59:23.044887 [debug] [MainThread]: SQL status: SELECT in 0.25 seconds
13:59:23.050740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b4b71598-7ad2-467d-93e7-4d87f99c811a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086aafa0>]}
13:59:23.051941 [debug] [MainThread]: On master: ROLLBACK
13:59:23.179534 [debug] [MainThread]: Using redshift connection "master"
13:59:23.180587 [debug] [MainThread]: On master: BEGIN
13:59:23.456125 [debug] [MainThread]: SQL status: BEGIN in 0.28 seconds
13:59:23.457519 [debug] [MainThread]: On master: COMMIT
13:59:23.457925 [debug] [MainThread]: Using redshift connection "master"
13:59:23.458691 [debug] [MainThread]: On master: COMMIT
13:59:23.598381 [debug] [MainThread]: SQL status: COMMIT in 0.14 seconds
13:59:23.599389 [debug] [MainThread]: On master: Close
13:59:23.601355 [info ] [MainThread]: Concurrency: 1 threads (target='test')
13:59:23.602597 [info ] [MainThread]: 
13:59:23.617304 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
13:59:23.618492 [info ] [Thread-1  ]: 1 of 6 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
13:59:23.619607 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
13:59:23.619951 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
13:59:23.620597 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
13:59:23.625948 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
13:59:23.628455 [debug] [Thread-1  ]: finished collecting timing info
13:59:23.628742 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
13:59:23.647656 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
13:59:23.648091 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
13:59:23.648217 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
13:59:23.648324 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
13:59:23.648437 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:59:24.996858 [debug] [Thread-1  ]: SQL status: BEGIN in 1.35 seconds
13:59:24.998305 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
13:59:24.998691 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),'') :: FLOAT)
 AS elapsed_time
  , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),'') :: FLOAT)
 
  AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

13:59:25.199257 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.2 seconds
13:59:25.222635 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
13:59:25.223396 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
13:59:25.366066 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.14 seconds
13:59:25.373418 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
13:59:25.374345 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
13:59:25.510509 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.14 seconds
13:59:25.533243 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
13:59:25.533548 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
13:59:25.533727 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
13:59:25.696566 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
13:59:25.698421 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
13:59:25.698820 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
13:59:25.839218 [debug] [Thread-1  ]: SQL status: BEGIN in 0.14 seconds
13:59:25.855807 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
13:59:25.856546 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
13:59:25.994062 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.14 seconds
13:59:25.997302 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
13:59:25.997895 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
13:59:25.998286 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
13:59:26.188342 [debug] [Thread-1  ]: SQL status: COMMIT in 0.19 seconds
13:59:26.189377 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
13:59:26.189763 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
13:59:26.329003 [debug] [Thread-1  ]: SQL status: BEGIN in 0.14 seconds
13:59:26.330582 [debug] [Thread-1  ]: finished collecting timing info
13:59:26.331011 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
13:59:26.471266 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
13:59:26.473613 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4b71598-7ad2-467d-93e7-4d87f99c811a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108771f10>]}
13:59:26.474942 [info ] [Thread-1  ]: 1 of 6 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.85s]
13:59:26.480565 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
13:59:26.481174 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_onb_version
13:59:26.481679 [info ] [Thread-1  ]: 2 of 6 START view model dbt_amplitude_test.amplitude_onb_version ............... [RUN]
13:59:26.482351 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_onb_version"
13:59:26.482582 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_onb_version
13:59:26.482798 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_onb_version
13:59:26.489869 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_onb_version"
13:59:26.492653 [debug] [Thread-1  ]: finished collecting timing info
13:59:26.492948 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_onb_version
13:59:26.494797 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_onb_version"
13:59:26.495222 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
13:59:26.495307 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
13:59:26.495380 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
13:59:26.495462 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:59:27.950659 [debug] [Thread-1  ]: SQL status: BEGIN in 1.46 seconds
13:59:27.952209 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
13:59:27.952759 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */


  create view "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" as (
    SELECT DISTINCT
  user_id
	, session_id
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))

  AS onb_version
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_start'
  AND
    (nullif(json_extract_path_text(user_properties,'onb_version',true),null))
 IS NOT NULL
  ) ;

13:59:28.101106 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.15 seconds
13:59:28.111541 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
13:59:28.112390 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version" rename to "amplitude_onb_version__dbt_backup"
13:59:28.268217 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.16 seconds
13:59:28.275445 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
13:59:28.276185 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" rename to "amplitude_onb_version"
13:59:28.420916 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.14 seconds
13:59:28.425103 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
13:59:28.425848 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
13:59:28.426369 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
13:59:28.604862 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
13:59:28.606022 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
13:59:28.606417 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
13:59:28.735316 [debug] [Thread-1  ]: SQL status: BEGIN in 0.13 seconds
13:59:28.742214 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
13:59:28.742964 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_backup" cascade
13:59:28.882428 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.14 seconds
13:59:28.886048 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
13:59:28.886616 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
13:59:28.887160 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
13:59:29.048121 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
13:59:29.049123 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
13:59:29.049517 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
13:59:29.179284 [debug] [Thread-1  ]: SQL status: BEGIN in 0.13 seconds
13:59:29.181554 [debug] [Thread-1  ]: finished collecting timing info
13:59:29.182253 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: ROLLBACK
13:59:29.312725 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: Close
13:59:29.315480 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4b71598-7ad2-467d-93e7-4d87f99c811a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088012b0>]}
13:59:29.316880 [info ] [Thread-1  ]: 2 of 6 OK created view model dbt_amplitude_test.amplitude_onb_version .......... [[32mCREATE VIEW[0m in 2.83s]
13:59:29.318579 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_onb_version
13:59:29.323847 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
13:59:29.324537 [info ] [Thread-1  ]: 3 of 6 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
13:59:29.325979 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
13:59:29.326291 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
13:59:29.326518 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
13:59:29.333327 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
13:59:29.336459 [debug] [Thread-1  ]: finished collecting timing info
13:59:29.336735 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
13:59:29.342380 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
13:59:29.344337 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
13:59:29.344585 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
13:59:29.344998 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
13:59:29.345208 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:59:30.756728 [debug] [Thread-1  ]: SQL status: BEGIN in 1.41 seconds
13:59:30.758445 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
13:59:30.758884 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

13:59:30.903811 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.14 seconds
13:59:30.914689 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
13:59:30.915356 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
13:59:31.046343 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.13 seconds
13:59:31.053987 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
13:59:31.054823 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
13:59:31.188582 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.13 seconds
13:59:31.195197 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
13:59:31.196182 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
13:59:31.196589 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
13:59:31.364490 [debug] [Thread-1  ]: SQL status: COMMIT in 0.17 seconds
13:59:31.365862 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
13:59:31.366452 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
13:59:31.501257 [debug] [Thread-1  ]: SQL status: BEGIN in 0.13 seconds
13:59:31.507416 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
13:59:31.508272 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
13:59:31.720928 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.21 seconds
13:59:31.724708 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
13:59:31.725181 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
13:59:31.725362 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
13:59:31.905513 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
13:59:31.906102 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
13:59:31.906292 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
13:59:32.039481 [debug] [Thread-1  ]: SQL status: BEGIN in 0.13 seconds
13:59:32.043809 [debug] [Thread-1  ]: finished collecting timing info
13:59:32.044695 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
13:59:32.174380 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
13:59:32.179205 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4b71598-7ad2-467d-93e7-4d87f99c811a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108771910>]}
13:59:32.181067 [info ] [Thread-1  ]: 3 of 6 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.85s]
13:59:32.182320 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
13:59:32.188318 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
13:59:32.189006 [info ] [Thread-1  ]: 4 of 6 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
13:59:32.189709 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
13:59:32.189926 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
13:59:32.190155 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
13:59:32.210873 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
13:59:32.213754 [debug] [Thread-1  ]: finished collecting timing info
13:59:32.214013 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
13:59:32.216475 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
13:59:32.216966 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
13:59:32.217083 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
13:59:32.217186 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
13:59:32.217305 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:59:33.568649 [debug] [Thread-1  ]: SQL status: BEGIN in 1.35 seconds
13:59:33.570090 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
13:59:33.570504 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

13:59:33.779150 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.21 seconds
13:59:33.787393 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
13:59:33.788009 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
13:59:33.986427 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.2 seconds
13:59:33.994217 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
13:59:33.995017 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
13:59:34.136227 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.14 seconds
13:59:34.140103 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
13:59:34.140589 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
13:59:34.140933 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
13:59:34.365100 [debug] [Thread-1  ]: SQL status: COMMIT in 0.22 seconds
13:59:34.366578 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
13:59:34.366965 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
13:59:34.560554 [debug] [Thread-1  ]: SQL status: BEGIN in 0.19 seconds
13:59:34.566378 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
13:59:34.567042 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
13:59:34.701200 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.13 seconds
13:59:34.704675 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
13:59:34.705168 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
13:59:34.705534 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
13:59:34.902152 [debug] [Thread-1  ]: SQL status: COMMIT in 0.2 seconds
13:59:34.903226 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
13:59:34.903679 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
13:59:35.088214 [debug] [Thread-1  ]: SQL status: BEGIN in 0.18 seconds
13:59:35.090591 [debug] [Thread-1  ]: finished collecting timing info
13:59:35.091085 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
13:59:35.225067 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
13:59:35.228346 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4b71598-7ad2-467d-93e7-4d87f99c811a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108771a60>]}
13:59:35.230213 [info ] [Thread-1  ]: 4 of 6 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 3.04s]
13:59:35.231566 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
13:59:35.236714 [debug] [Thread-1  ]: Began running node model.amplitude_event.stg_amplitude_device
13:59:35.237555 [info ] [Thread-1  ]: 5 of 6 START view model dbt_amplitude_test.stg_amplitude_device ................ [RUN]
13:59:35.238269 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.stg_amplitude_device"
13:59:35.238491 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.stg_amplitude_device
13:59:35.238720 [debug] [Thread-1  ]: Compiling model.amplitude_event.stg_amplitude_device
13:59:35.250644 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.stg_amplitude_device"
13:59:35.253544 [debug] [Thread-1  ]: finished collecting timing info
13:59:35.254147 [debug] [Thread-1  ]: Began executing node model.amplitude_event.stg_amplitude_device
13:59:35.261487 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.stg_amplitude_device"
13:59:35.263947 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
13:59:35.264252 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
13:59:35.264360 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
13:59:35.264477 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:59:37.295919 [debug] [Thread-1  ]: SQL status: BEGIN in 2.03 seconds
13:59:37.297429 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
13:59:37.297859 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

13:59:37.436974 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.14 seconds
13:59:37.447881 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
13:59:37.448568 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."stg_amplitude_device" rename to "stg_amplitude_device__dbt_backup"
13:59:37.577404 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.13 seconds
13:59:37.585773 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
13:59:37.586456 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_tmp" rename to "stg_amplitude_device"
13:59:37.729163 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.14 seconds
13:59:37.735250 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
13:59:37.735814 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
13:59:37.736297 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
13:59:37.958070 [debug] [Thread-1  ]: SQL status: COMMIT in 0.22 seconds
13:59:37.960805 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
13:59:37.961334 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
13:59:38.123082 [debug] [Thread-1  ]: SQL status: BEGIN in 0.16 seconds
13:59:38.130665 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
13:59:38.131244 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_backup" cascade
13:59:38.313769 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.18 seconds
13:59:38.318854 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
13:59:38.319504 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
13:59:38.319877 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
13:59:38.485387 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
13:59:38.486329 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
13:59:38.487139 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
13:59:38.632033 [debug] [Thread-1  ]: SQL status: BEGIN in 0.14 seconds
13:59:38.634899 [debug] [Thread-1  ]: finished collecting timing info
13:59:38.635540 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: ROLLBACK
13:59:38.764269 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: Close
13:59:38.767781 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4b71598-7ad2-467d-93e7-4d87f99c811a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108771bb0>]}
13:59:38.769252 [info ] [Thread-1  ]: 5 of 6 OK created view model dbt_amplitude_test.stg_amplitude_device ........... [[32mCREATE VIEW[0m in 3.53s]
13:59:38.770824 [debug] [Thread-1  ]: Finished running node model.amplitude_event.stg_amplitude_device
13:59:38.777826 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
13:59:38.778832 [info ] [Thread-1  ]: 6 of 6 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
13:59:38.779828 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
13:59:38.780052 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
13:59:38.780275 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
13:59:38.788004 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
13:59:38.789829 [debug] [Thread-1  ]: finished collecting timing info
13:59:38.790133 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
13:59:38.796823 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
13:59:38.798341 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
13:59:38.798652 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
13:59:38.798772 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
13:59:38.798906 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:59:40.144515 [debug] [Thread-1  ]: SQL status: BEGIN in 1.35 seconds
13:59:40.146124 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
13:59:40.146570 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    WITH device AS (
  SELECT DISTINCT
    user_id
    , device_type
  FROM "dev"."dbt_amplitude_test"."stg_amplitude_device"
  WHERE device_type IS NOT NULL
)

SELECT
  user_id
  , device_type
  , COUNT(user_id) OVER (PARTITION BY user_id) AS num_devices
FROM device
  ) ;

13:59:40.303199 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.16 seconds
13:59:40.313301 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
13:59:40.313947 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
13:59:40.444093 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.13 seconds
13:59:40.448328 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
13:59:40.449040 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
13:59:40.449674 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
13:59:40.629473 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
13:59:40.630857 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
13:59:40.631236 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
13:59:40.768862 [debug] [Thread-1  ]: SQL status: BEGIN in 0.14 seconds
13:59:40.781311 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
13:59:40.782039 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
13:59:40.961442 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.18 seconds
13:59:40.965448 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
13:59:40.966002 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
13:59:40.966780 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
13:59:41.132579 [debug] [Thread-1  ]: SQL status: COMMIT in 0.17 seconds
13:59:41.134400 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
13:59:41.134839 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
13:59:41.263372 [debug] [Thread-1  ]: SQL status: BEGIN in 0.13 seconds
13:59:41.266029 [debug] [Thread-1  ]: finished collecting timing info
13:59:41.266769 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
13:59:41.395738 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
13:59:41.398560 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4b71598-7ad2-467d-93e7-4d87f99c811a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10885ceb0>]}
13:59:41.400549 [info ] [Thread-1  ]: 6 of 6 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.62s]
13:59:41.401994 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
13:59:41.412366 [debug] [MainThread]: Acquiring new redshift connection "master"
13:59:41.412915 [debug] [MainThread]: Using redshift connection "master"
13:59:41.413096 [debug] [MainThread]: On master: BEGIN
13:59:41.413267 [debug] [MainThread]: Opening a new connection, currently in state closed
13:59:41.413482 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:59:42.763331 [debug] [MainThread]: SQL status: BEGIN in 1.35 seconds
13:59:42.764734 [debug] [MainThread]: On master: COMMIT
13:59:42.765121 [debug] [MainThread]: Using redshift connection "master"
13:59:42.765499 [debug] [MainThread]: On master: COMMIT
13:59:42.898067 [debug] [MainThread]: SQL status: COMMIT in 0.13 seconds
13:59:42.898973 [debug] [MainThread]: On master: Close
13:59:42.901125 [info ] [MainThread]: 
13:59:42.902148 [info ] [MainThread]: Finished running 6 view models in 25.40s.
13:59:42.908301 [debug] [MainThread]: Connection 'master' was properly closed.
13:59:42.910726 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_device' was properly closed.
13:59:42.927083 [info ] [MainThread]: 
13:59:42.927856 [info ] [MainThread]: [32mCompleted successfully[0m
13:59:42.928246 [info ] [MainThread]: 
13:59:42.928572 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
13:59:42.929122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085924c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108804be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108751160>]}


============================== 2022-07-25 07:00:14.908265 | 695cd7bb-655b-4dec-9d24-def60057e94a ==============================
07:00:14.908286 [info ] [MainThread]: Running with dbt=1.1.0
07:00:14.908850 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
07:00:14.908924 [debug] [MainThread]: Tracking: tracking
07:00:14.928074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063f8a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063f8430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063f8490>]}
07:00:14.956556 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
07:00:14.956693 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
07:00:14.960797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '695cd7bb-655b-4dec-9d24-def60057e94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065040d0>]}
07:00:14.964909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '695cd7bb-655b-4dec-9d24-def60057e94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106442fd0>]}
07:00:14.965090 [info ] [MainThread]: Found 6 models, 2 tests, 0 snapshots, 0 analyses, 195 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
07:00:14.965254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '695cd7bb-655b-4dec-9d24-def60057e94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064d6070>]}
07:00:14.966069 [info ] [MainThread]: 
07:00:14.966382 [debug] [MainThread]: Acquiring new redshift connection "master"
07:00:14.966976 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
07:00:14.972210 [debug] [ThreadPool]: Using redshift connection "list_dev"
07:00:14.972347 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
07:00:14.972415 [debug] [ThreadPool]: Opening a new connection, currently in state init
07:00:14.972482 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
07:00:16.043731 [debug] [ThreadPool]: SQL status: SELECT in 1.07 seconds
07:00:16.053142 [debug] [ThreadPool]: On list_dev: Close
07:00:16.058903 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
07:00:16.070925 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
07:00:16.071295 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
07:00:16.071446 [debug] [ThreadPool]: Opening a new connection, currently in state closed
07:00:16.071583 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
07:00:17.042955 [debug] [ThreadPool]: SQL status: BEGIN in 0.97 seconds
07:00:17.043429 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
07:00:17.043627 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
07:00:17.205113 [debug] [ThreadPool]: SQL status: SELECT in 0.16 seconds
07:00:17.208901 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
07:00:17.338957 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
07:00:17.355383 [debug] [MainThread]: Using redshift connection "master"
07:00:17.355992 [debug] [MainThread]: On master: BEGIN
07:00:17.356211 [debug] [MainThread]: Opening a new connection, currently in state init
07:00:17.356647 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
07:00:18.281569 [debug] [MainThread]: SQL status: BEGIN in 0.93 seconds
07:00:18.282799 [debug] [MainThread]: Using redshift connection "master"
07:00:18.283036 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
07:00:18.477448 [debug] [MainThread]: SQL status: SELECT in 0.19 seconds
07:00:18.484231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '695cd7bb-655b-4dec-9d24-def60057e94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064cd370>]}
07:00:18.485405 [debug] [MainThread]: On master: ROLLBACK
07:00:18.583706 [debug] [MainThread]: Using redshift connection "master"
07:00:18.584758 [debug] [MainThread]: On master: BEGIN
07:00:18.785690 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
07:00:18.787022 [debug] [MainThread]: On master: COMMIT
07:00:18.787263 [debug] [MainThread]: Using redshift connection "master"
07:00:18.787523 [debug] [MainThread]: On master: COMMIT
07:00:18.887334 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
07:00:18.890643 [debug] [MainThread]: On master: Close
07:00:18.892812 [info ] [MainThread]: Concurrency: 1 threads (target='test')
07:00:18.893646 [info ] [MainThread]: 
07:00:18.917876 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
07:00:18.921880 [info ] [Thread-1  ]: 1 of 6 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
07:00:18.924257 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
07:00:18.924815 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
07:00:18.925076 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
07:00:18.934221 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
07:00:18.936192 [debug] [Thread-1  ]: finished collecting timing info
07:00:18.936421 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
07:00:18.959433 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
07:00:18.960165 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
07:00:18.960242 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
07:00:18.960302 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:00:18.960373 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
07:00:19.910821 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
07:00:19.911536 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
07:00:19.911892 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),'') :: FLOAT)
 AS elapsed_time
  , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),'') :: FLOAT)
 
  AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

07:00:20.030352 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
07:00:20.042307 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
07:00:20.042820 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
07:00:20.135989 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
07:00:20.145289 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
07:00:20.148323 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
07:00:20.243153 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
07:00:20.266872 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
07:00:20.268929 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
07:00:20.269374 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
07:00:20.410685 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
07:00:20.420616 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
07:00:20.421024 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
07:00:20.595889 [debug] [Thread-1  ]: SQL status: BEGIN in 0.17 seconds
07:00:20.608877 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
07:00:20.609235 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
07:00:20.709545 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
07:00:20.712637 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
07:00:20.713096 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
07:00:20.714379 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
07:00:20.841169 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
07:00:20.842119 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
07:00:20.842343 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
07:00:20.946717 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
07:00:20.949675 [debug] [Thread-1  ]: finished collecting timing info
07:00:20.950409 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
07:00:21.042841 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
07:00:21.045576 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '695cd7bb-655b-4dec-9d24-def60057e94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065903d0>]}
07:00:21.047394 [info ] [Thread-1  ]: 1 of 6 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.12s]
07:00:21.052041 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
07:00:21.052391 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_onb_version
07:00:21.052732 [info ] [Thread-1  ]: 2 of 6 START view model dbt_amplitude_test.amplitude_onb_version ............... [RUN]
07:00:21.053398 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_onb_version"
07:00:21.053618 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_onb_version
07:00:21.053834 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_onb_version
07:00:21.063105 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_onb_version"
07:00:21.066000 [debug] [Thread-1  ]: finished collecting timing info
07:00:21.066209 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_onb_version
07:00:21.068676 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_onb_version"
07:00:21.069344 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
07:00:21.069487 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
07:00:21.069608 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:00:21.069741 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
07:00:22.021150 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
07:00:22.022668 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
07:00:22.023059 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */


  create view "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" as (
    SELECT DISTINCT
  user_id
	, session_id
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))

  AS onb_version
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_start'
  AND
    (nullif(json_extract_path_text(user_properties,'onb_version',true),null))
 IS NOT NULL
  ) ;

07:00:22.132236 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
07:00:22.136882 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
07:00:22.137327 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version" rename to "amplitude_onb_version__dbt_backup"
07:00:22.241385 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
07:00:22.247673 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
07:00:22.248170 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" rename to "amplitude_onb_version"
07:00:22.348054 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
07:00:22.351352 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
07:00:22.351747 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
07:00:22.351914 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
07:00:22.492237 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
07:00:22.493223 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
07:00:22.493599 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
07:00:22.587547 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
07:00:22.592310 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
07:00:22.592783 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_backup" cascade
07:00:22.691905 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
07:00:22.695772 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
07:00:22.696366 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
07:00:22.696592 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
07:00:22.829258 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
07:00:22.830196 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
07:00:22.830588 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
07:00:22.927561 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
07:00:22.930132 [debug] [Thread-1  ]: finished collecting timing info
07:00:22.930621 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: ROLLBACK
07:00:23.030018 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: Close
07:00:23.033704 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '695cd7bb-655b-4dec-9d24-def60057e94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106504af0>]}
07:00:23.035376 [info ] [Thread-1  ]: 2 of 6 OK created view model dbt_amplitude_test.amplitude_onb_version .......... [[32mCREATE VIEW[0m in 1.98s]
07:00:23.036409 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_onb_version
07:00:23.036829 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
07:00:23.040198 [info ] [Thread-1  ]: 3 of 6 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
07:00:23.042088 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
07:00:23.042440 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
07:00:23.045647 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
07:00:23.051686 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
07:00:23.053336 [debug] [Thread-1  ]: finished collecting timing info
07:00:23.053711 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
07:00:23.056304 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
07:00:23.056875 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
07:00:23.057030 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
07:00:23.057166 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:00:23.057321 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
07:00:24.033130 [debug] [Thread-1  ]: SQL status: BEGIN in 0.98 seconds
07:00:24.034490 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
07:00:24.034809 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

07:00:24.140791 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
07:00:24.155274 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
07:00:24.156347 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
07:00:24.251738 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
07:00:24.262177 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
07:00:24.263629 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
07:00:24.366011 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
07:00:24.370328 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
07:00:24.370880 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
07:00:24.371063 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
07:00:24.507971 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
07:00:24.509865 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
07:00:24.510068 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
07:00:24.607875 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
07:00:24.614655 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
07:00:24.615645 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
07:00:24.725553 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
07:00:24.729689 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
07:00:24.730322 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
07:00:24.730552 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
07:00:24.860000 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
07:00:24.861433 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
07:00:24.861857 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
07:00:24.957417 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
07:00:24.958702 [debug] [Thread-1  ]: finished collecting timing info
07:00:24.958939 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
07:00:25.054909 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
07:00:25.056122 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '695cd7bb-655b-4dec-9d24-def60057e94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10665fa60>]}
07:00:25.056668 [info ] [Thread-1  ]: 3 of 6 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.01s]
07:00:25.057166 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
07:00:25.057680 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
07:00:25.058131 [info ] [Thread-1  ]: 4 of 6 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
07:00:25.058736 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
07:00:25.059445 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
07:00:25.059644 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
07:00:25.069334 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
07:00:25.070300 [debug] [Thread-1  ]: finished collecting timing info
07:00:25.070539 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
07:00:25.074373 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
07:00:25.077543 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
07:00:25.078507 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
07:00:25.078692 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:00:25.079310 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
07:00:26.025214 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
07:00:26.026604 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
07:00:26.026991 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

07:00:26.174196 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.15 seconds
07:00:26.178875 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
07:00:26.179219 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
07:00:26.273622 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
07:00:26.283086 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
07:00:26.283665 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
07:00:26.379058 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
07:00:26.384862 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
07:00:26.386001 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
07:00:26.386220 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
07:00:26.553431 [debug] [Thread-1  ]: SQL status: COMMIT in 0.17 seconds
07:00:26.555359 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
07:00:26.555631 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
07:00:26.677687 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
07:00:26.689326 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
07:00:26.690683 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
07:00:26.829730 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.14 seconds
07:00:26.834864 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
07:00:26.835522 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
07:00:26.835955 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
07:00:26.976995 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
07:00:26.978559 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
07:00:26.978992 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
07:00:27.079630 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
07:00:27.082840 [debug] [Thread-1  ]: finished collecting timing info
07:00:27.083567 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
07:00:27.189576 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
07:00:27.192645 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '695cd7bb-655b-4dec-9d24-def60057e94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106575850>]}
07:00:27.193866 [info ] [Thread-1  ]: 4 of 6 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.13s]
07:00:27.195210 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
07:00:27.199098 [debug] [Thread-1  ]: Began running node model.amplitude_event.stg_amplitude_device
07:00:27.200342 [info ] [Thread-1  ]: 5 of 6 START view model dbt_amplitude_test.stg_amplitude_device ................ [RUN]
07:00:27.202257 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.stg_amplitude_device"
07:00:27.202952 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.stg_amplitude_device
07:00:27.203190 [debug] [Thread-1  ]: Compiling model.amplitude_event.stg_amplitude_device
07:00:27.206967 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.stg_amplitude_device"
07:00:27.209770 [debug] [Thread-1  ]: finished collecting timing info
07:00:27.210379 [debug] [Thread-1  ]: Began executing node model.amplitude_event.stg_amplitude_device
07:00:27.223809 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.stg_amplitude_device"
07:00:27.226360 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
07:00:27.226670 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
07:00:27.226794 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:00:27.226922 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
07:00:28.207328 [debug] [Thread-1  ]: SQL status: BEGIN in 0.98 seconds
07:00:28.208050 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
07:00:28.208317 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

07:00:28.314127 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.11 seconds
07:00:28.321505 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
07:00:28.322193 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."stg_amplitude_device" rename to "stg_amplitude_device__dbt_backup"
07:00:28.420307 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
07:00:28.427909 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
07:00:28.428721 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_tmp" rename to "stg_amplitude_device"
07:00:28.525186 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
07:00:28.533058 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
07:00:28.535184 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
07:00:28.535414 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
07:00:28.674580 [debug] [Thread-1  ]: SQL status: COMMIT in 0.14 seconds
07:00:28.676307 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
07:00:28.676631 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
07:00:28.779994 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
07:00:28.786944 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
07:00:28.787689 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_backup" cascade
07:00:28.907413 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.12 seconds
07:00:28.910630 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
07:00:28.911103 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
07:00:28.911774 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
07:00:29.043009 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
07:00:29.044948 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
07:00:29.045380 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
07:00:29.148562 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
07:00:29.151592 [debug] [Thread-1  ]: finished collecting timing info
07:00:29.152293 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: ROLLBACK
07:00:29.251192 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: Close
07:00:29.254199 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '695cd7bb-655b-4dec-9d24-def60057e94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10652d2b0>]}
07:00:29.256250 [info ] [Thread-1  ]: 5 of 6 OK created view model dbt_amplitude_test.stg_amplitude_device ........... [[32mCREATE VIEW[0m in 2.05s]
07:00:29.257490 [debug] [Thread-1  ]: Finished running node model.amplitude_event.stg_amplitude_device
07:00:29.259851 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
07:00:29.261466 [info ] [Thread-1  ]: 6 of 6 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
07:00:29.262708 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
07:00:29.263103 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
07:00:29.263422 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
07:00:29.272322 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
07:00:29.273571 [debug] [Thread-1  ]: finished collecting timing info
07:00:29.273872 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
07:00:29.279649 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
07:00:29.280298 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
07:00:29.280491 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
07:00:29.280658 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
07:00:29.280835 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
07:00:30.270596 [debug] [Thread-1  ]: SQL status: BEGIN in 0.99 seconds
07:00:30.272011 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
07:00:30.272219 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    WITH device AS (
  SELECT DISTINCT
    user_id
    , device_type
  FROM "dev"."dbt_amplitude_test"."stg_amplitude_device"
  WHERE device_type IS NOT NULL
)

SELECT
  user_id
  , device_type
  , COUNT(user_id) OVER (PARTITION BY user_id) AS num_devices
FROM device
  ) ;

07:00:30.374314 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
07:00:30.386503 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
07:00:30.387164 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
07:00:30.482042 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
07:00:30.487806 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
07:00:30.488412 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
07:00:30.488830 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
07:00:30.649023 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
07:00:30.650144 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
07:00:30.650562 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
07:00:30.752141 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
07:00:30.757183 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
07:00:30.757655 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.0", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
07:00:30.871359 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
07:00:30.874653 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
07:00:30.875106 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
07:00:30.875465 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
07:00:31.004367 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
07:00:31.005713 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
07:00:31.006095 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
07:00:31.100109 [debug] [Thread-1  ]: SQL status: BEGIN in 0.09 seconds
07:00:31.102512 [debug] [Thread-1  ]: finished collecting timing info
07:00:31.102856 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
07:00:31.233062 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
07:00:31.236025 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '695cd7bb-655b-4dec-9d24-def60057e94a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106686b20>]}
07:00:31.237191 [info ] [Thread-1  ]: 6 of 6 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 1.97s]
07:00:31.237988 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
07:00:31.241347 [debug] [MainThread]: Acquiring new redshift connection "master"
07:00:31.243203 [debug] [MainThread]: Using redshift connection "master"
07:00:31.243535 [debug] [MainThread]: On master: BEGIN
07:00:31.243751 [debug] [MainThread]: Opening a new connection, currently in state closed
07:00:31.244002 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
07:00:32.199300 [debug] [MainThread]: SQL status: BEGIN in 0.96 seconds
07:00:32.201656 [debug] [MainThread]: On master: COMMIT
07:00:32.202402 [debug] [MainThread]: Using redshift connection "master"
07:00:32.202606 [debug] [MainThread]: On master: COMMIT
07:00:32.303232 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
07:00:32.304520 [debug] [MainThread]: On master: Close
07:00:32.306233 [info ] [MainThread]: 
07:00:32.306849 [info ] [MainThread]: Finished running 6 view models in 17.34s.
07:00:32.307404 [debug] [MainThread]: Connection 'master' was properly closed.
07:00:32.308528 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_device' was properly closed.
07:00:32.326313 [info ] [MainThread]: 
07:00:32.327036 [info ] [MainThread]: [32mCompleted successfully[0m
07:00:32.327430 [info ] [MainThread]: 
07:00:32.327732 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
07:00:32.328197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106590820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064d6130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065a6f70>]}


============================== 2022-07-28 08:37:34.395569 | a565064d-cfa7-402a-9b57-d2d661d2d589 ==============================
08:37:34.395588 [info ] [MainThread]: Running with dbt=1.1.1
08:37:34.396142 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/evelynchen/.dbt', 'send_anonymous_usage_stats': True, 'event_buffer_size': 100000, 'quiet': False, 'no_print': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
08:37:34.396213 [debug] [MainThread]: Tracking: tracking
08:37:34.422847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104be7eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c10e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c10520>]}
08:37:34.436566 [info ] [MainThread]: Unable to do partial parsing because of a dbt version mismatch. Saved manifest version: 1.1.0. Current version: 1.1.1.
08:37:34.436756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a565064d-cfa7-402a-9b57-d2d661d2d589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c33e20>]}
08:37:34.452734 [debug] [MainThread]: Parsing macros/json_extract_text.sql
08:37:34.454202 [debug] [MainThread]: Parsing macros/catalog.sql
08:37:34.461572 [debug] [MainThread]: Parsing macros/relations.sql
08:37:34.461854 [debug] [MainThread]: Parsing macros/adapters.sql
08:37:34.478627 [debug] [MainThread]: Parsing macros/materializations/snapshot_merge.sql
08:37:34.478952 [debug] [MainThread]: Parsing macros/catalog.sql
08:37:34.480099 [debug] [MainThread]: Parsing macros/relations.sql
08:37:34.480793 [debug] [MainThread]: Parsing macros/adapters.sql
08:37:34.492637 [debug] [MainThread]: Parsing macros/materializations/snapshot_merge.sql
08:37:34.493480 [debug] [MainThread]: Parsing macros/materializations/hooks.sql
08:37:34.495385 [debug] [MainThread]: Parsing macros/materializations/configs.sql
08:37:34.496564 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot_merge.sql
08:37:34.497373 [debug] [MainThread]: Parsing macros/materializations/snapshots/strategies.sql
08:37:34.505909 [debug] [MainThread]: Parsing macros/materializations/snapshots/helpers.sql
08:37:34.513045 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot.sql
08:37:34.519085 [debug] [MainThread]: Parsing macros/materializations/tests/test.sql
08:37:34.521369 [debug] [MainThread]: Parsing macros/materializations/tests/helpers.sql
08:37:34.522302 [debug] [MainThread]: Parsing macros/materializations/tests/where_subquery.sql
08:37:34.523215 [debug] [MainThread]: Parsing macros/materializations/models/incremental/column_helpers.sql
08:37:34.525417 [debug] [MainThread]: Parsing macros/materializations/models/incremental/merge.sql
08:37:34.534815 [debug] [MainThread]: Parsing macros/materializations/models/incremental/is_incremental.sql
08:37:34.535567 [debug] [MainThread]: Parsing macros/materializations/models/incremental/incremental.sql
08:37:34.540830 [debug] [MainThread]: Parsing macros/materializations/models/incremental/on_schema_change.sql
08:37:34.549325 [debug] [MainThread]: Parsing macros/materializations/models/table/table.sql
08:37:34.553472 [debug] [MainThread]: Parsing macros/materializations/models/table/create_table_as.sql
08:37:34.554840 [debug] [MainThread]: Parsing macros/materializations/models/view/view.sql
08:37:34.558726 [debug] [MainThread]: Parsing macros/materializations/models/view/helpers.sql
08:37:34.559348 [debug] [MainThread]: Parsing macros/materializations/models/view/create_or_replace_view.sql
08:37:34.560679 [debug] [MainThread]: Parsing macros/materializations/models/view/create_view_as.sql
08:37:34.561770 [debug] [MainThread]: Parsing macros/materializations/seeds/seed.sql
08:37:34.564936 [debug] [MainThread]: Parsing macros/materializations/seeds/helpers.sql
08:37:34.573944 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_alias.sql
08:37:34.574677 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_schema.sql
08:37:34.575868 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_database.sql
08:37:34.576606 [debug] [MainThread]: Parsing macros/generic_test_sql/relationships.sql
08:37:34.577022 [debug] [MainThread]: Parsing macros/generic_test_sql/not_null.sql
08:37:34.577399 [debug] [MainThread]: Parsing macros/generic_test_sql/unique.sql
08:37:34.577718 [debug] [MainThread]: Parsing macros/generic_test_sql/accepted_values.sql
08:37:34.578440 [debug] [MainThread]: Parsing macros/etc/statement.sql
08:37:34.580602 [debug] [MainThread]: Parsing macros/etc/datetime.sql
08:37:34.584924 [debug] [MainThread]: Parsing macros/adapters/schema.sql
08:37:34.585942 [debug] [MainThread]: Parsing macros/adapters/indexes.sql
08:37:34.587216 [debug] [MainThread]: Parsing macros/adapters/relation.sql
08:37:34.591997 [debug] [MainThread]: Parsing macros/adapters/freshness.sql
08:37:34.593388 [debug] [MainThread]: Parsing macros/adapters/persist_docs.sql
08:37:34.595508 [debug] [MainThread]: Parsing macros/adapters/metadata.sql
08:37:34.599305 [debug] [MainThread]: Parsing macros/adapters/columns.sql
08:37:34.604178 [debug] [MainThread]: Parsing tests/generic/builtin.sql
08:37:34.701651 [debug] [MainThread]: 1603: static parser failed on staging/stg_amplitude_device.sql
08:37:34.709124 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_amplitude_device.sql
08:37:34.709848 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_onb_version.sql
08:37:34.711891 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_onb_version.sql
08:37:34.712411 [debug] [MainThread]: 1699: static parser successfully parsed amplitude/amplitude_device.sql
08:37:34.713367 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_event.sql
08:37:34.717078 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_event.sql
08:37:34.717560 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_profile.sql
08:37:34.718893 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_profile.sql
08:37:34.719477 [debug] [MainThread]: 1603: static parser failed on amplitude/amplitude_workouts.sql
08:37:34.722640 [debug] [MainThread]: 1602: parser fallback to jinja rendering on amplitude/amplitude_workouts.sql
08:37:34.755954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a565064d-cfa7-402a-9b57-d2d661d2d589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f006d0>]}
08:37:34.759806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a565064d-cfa7-402a-9b57-d2d661d2d589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bedd60>]}
08:37:34.759955 [info ] [MainThread]: Found 6 models, 2 tests, 0 snapshots, 0 analyses, 195 macros, 0 operations, 0 seed files, 1 source, 0 exposures, 0 metrics
08:37:34.760090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a565064d-cfa7-402a-9b57-d2d661d2d589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f005b0>]}
08:37:34.760877 [info ] [MainThread]: 
08:37:34.761091 [debug] [MainThread]: Acquiring new redshift connection "master"
08:37:34.761558 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev"
08:37:34.766515 [debug] [ThreadPool]: Using redshift connection "list_dev"
08:37:34.766591 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
08:37:34.766652 [debug] [ThreadPool]: Opening a new connection, currently in state init
08:37:34.766719 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
08:37:35.835670 [debug] [ThreadPool]: SQL status: SELECT in 1.07 seconds
08:37:35.842221 [debug] [ThreadPool]: On list_dev: Close
08:37:35.854032 [debug] [ThreadPool]: Acquiring new redshift connection "list_dev_dbt_amplitude_test"
08:37:35.870549 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
08:37:35.870991 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: BEGIN
08:37:35.871192 [debug] [ThreadPool]: Opening a new connection, currently in state closed
08:37:35.871371 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
08:37:36.806462 [debug] [ThreadPool]: SQL status: BEGIN in 0.94 seconds
08:37:36.807698 [debug] [ThreadPool]: Using redshift connection "list_dev_dbt_amplitude_test"
08:37:36.808389 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "list_dev_dbt_amplitude_test"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt_amplitude_test'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt_amplitude_test'
  
08:37:36.925393 [debug] [ThreadPool]: SQL status: SELECT in 0.12 seconds
08:37:36.931630 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: ROLLBACK
08:37:37.030029 [debug] [ThreadPool]: On list_dev_dbt_amplitude_test: Close
08:37:37.046166 [debug] [MainThread]: Using redshift connection "master"
08:37:37.046698 [debug] [MainThread]: On master: BEGIN
08:37:37.046909 [debug] [MainThread]: Opening a new connection, currently in state init
08:37:37.047158 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
08:37:37.984107 [debug] [MainThread]: SQL status: BEGIN in 0.94 seconds
08:37:37.985493 [debug] [MainThread]: Using redshift connection "master"
08:37:37.985900 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
08:37:38.358818 [debug] [MainThread]: SQL status: SELECT in 0.37 seconds
08:37:38.364157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a565064d-cfa7-402a-9b57-d2d661d2d589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cdb220>]}
08:37:38.365160 [debug] [MainThread]: On master: ROLLBACK
08:37:38.464782 [debug] [MainThread]: Using redshift connection "master"
08:37:38.465104 [debug] [MainThread]: On master: BEGIN
08:37:38.666439 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
08:37:38.668033 [debug] [MainThread]: On master: COMMIT
08:37:38.669108 [debug] [MainThread]: Using redshift connection "master"
08:37:38.669511 [debug] [MainThread]: On master: COMMIT
08:37:38.767243 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
08:37:38.768441 [debug] [MainThread]: On master: Close
08:37:38.770458 [info ] [MainThread]: Concurrency: 1 threads (target='test')
08:37:38.771353 [info ] [MainThread]: 
08:37:38.784131 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_event
08:37:38.785087 [info ] [Thread-1  ]: 1 of 6 START view model dbt_amplitude_test.amplitude_event ..................... [RUN]
08:37:38.785944 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_event"
08:37:38.786211 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_event
08:37:38.786495 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_event
08:37:38.797205 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_event"
08:37:38.799801 [debug] [Thread-1  ]: finished collecting timing info
08:37:38.800183 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_event
08:37:38.822998 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_event"
08:37:38.823605 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
08:37:38.823735 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
08:37:38.823842 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:37:38.823955 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
08:37:39.770579 [debug] [Thread-1  ]: SQL status: BEGIN in 0.95 seconds
08:37:39.771947 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
08:37:39.772347 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */


  create view "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" as (
    SELECT *
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
  , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
  AS multiplayer_mode
  , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
  AS genre
  , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

  AS is_tutorial
  , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
  AS studio
  , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
      THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

      ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

  END AS class_name
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
  AS class_id
  , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

  AS class_quit_reason
  , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),'') :: FLOAT)
 AS elapsed_time
  , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),'') :: FLOAT)
 
  AS class_length
FROM "dev"."stg_amplitude"."event"
  ) ;

08:37:39.888989 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
08:37:39.908912 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
08:37:39.909452 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event" rename to "amplitude_event__dbt_backup"
08:37:40.014011 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
08:37:40.021316 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
08:37:40.021895 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
alter table "dev"."dbt_amplitude_test"."amplitude_event__dbt_tmp" rename to "amplitude_event"
08:37:40.126338 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
08:37:40.148030 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
08:37:40.148640 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
08:37:40.148849 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
08:37:40.380176 [debug] [Thread-1  ]: SQL status: COMMIT in 0.23 seconds
08:37:40.381330 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
08:37:40.381724 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
08:37:40.497590 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
08:37:40.513642 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
08:37:40.514191 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_event"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_event__dbt_backup" cascade
08:37:40.928269 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.41 seconds
08:37:40.932216 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
08:37:40.932650 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
08:37:40.933039 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: COMMIT
08:37:41.111382 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
08:37:41.112289 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_event"
08:37:41.112700 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: BEGIN
08:37:41.231115 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
08:37:41.233504 [debug] [Thread-1  ]: finished collecting timing info
08:37:41.233982 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: ROLLBACK
08:37:41.335100 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_event: Close
08:37:41.338485 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a565064d-cfa7-402a-9b57-d2d661d2d589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105089c40>]}
08:37:41.339898 [info ] [Thread-1  ]: 1 of 6 OK created view model dbt_amplitude_test.amplitude_event ................ [[32mCREATE VIEW[0m in 2.55s]
08:37:41.341004 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_event
08:37:41.341370 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_onb_version
08:37:41.346970 [info ] [Thread-1  ]: 2 of 6 START view model dbt_amplitude_test.amplitude_onb_version ............... [RUN]
08:37:41.348472 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_onb_version"
08:37:41.348758 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_onb_version
08:37:41.348989 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_onb_version
08:37:41.355722 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_onb_version"
08:37:41.358628 [debug] [Thread-1  ]: finished collecting timing info
08:37:41.358849 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_onb_version
08:37:41.361481 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_onb_version"
08:37:41.362035 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
08:37:41.362159 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
08:37:41.362262 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:37:41.362370 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
08:37:42.298066 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
08:37:42.300490 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
08:37:42.300944 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */


  create view "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" as (
    SELECT DISTINCT
  user_id
	, session_id
  , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))

  AS onb_version
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_start'
  AND
    (nullif(json_extract_path_text(user_properties,'onb_version',true),null))
 IS NOT NULL
  ) ;

08:37:42.950687 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.65 seconds
08:37:42.960491 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
08:37:42.960930 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version" rename to "amplitude_onb_version__dbt_backup"
08:37:43.073300 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.11 seconds
08:37:43.090094 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
08:37:43.092268 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
alter table "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_tmp" rename to "amplitude_onb_version"
08:37:43.191610 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
08:37:43.194894 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
08:37:43.195289 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
08:37:43.195633 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
08:37:43.401847 [debug] [Thread-1  ]: SQL status: COMMIT in 0.21 seconds
08:37:43.402555 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
08:37:43.402832 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
08:37:43.518061 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
08:37:43.525732 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
08:37:43.526123 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_onb_version"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_onb_version__dbt_backup" cascade
08:37:43.946204 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.42 seconds
08:37:43.950705 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
08:37:43.951305 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
08:37:43.951698 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: COMMIT
08:37:44.142992 [debug] [Thread-1  ]: SQL status: COMMIT in 0.19 seconds
08:37:44.143834 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_onb_version"
08:37:44.144207 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: BEGIN
08:37:44.267093 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
08:37:44.269443 [debug] [Thread-1  ]: finished collecting timing info
08:37:44.269929 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: ROLLBACK
08:37:44.366900 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_onb_version: Close
08:37:44.369386 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a565064d-cfa7-402a-9b57-d2d661d2d589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105201940>]}
08:37:44.370786 [info ] [Thread-1  ]: 2 of 6 OK created view model dbt_amplitude_test.amplitude_onb_version .......... [[32mCREATE VIEW[0m in 3.02s]
08:37:44.372282 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_onb_version
08:37:44.376602 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_profile
08:37:44.377531 [info ] [Thread-1  ]: 3 of 6 START view model dbt_amplitude_test.amplitude_profile ................... [RUN]
08:37:44.378263 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_profile"
08:37:44.378477 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_profile
08:37:44.378700 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_profile
08:37:44.384649 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_profile"
08:37:44.386607 [debug] [Thread-1  ]: finished collecting timing info
08:37:44.386910 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_profile
08:37:44.391607 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_profile"
08:37:44.392438 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
08:37:44.392611 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
08:37:44.392752 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:37:44.392904 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
08:37:45.332129 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
08:37:45.333104 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
08:37:45.333357 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */


  create view "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'id',true),null))
, '/PlayerProfile/', 2)
  AS profile_id
FROM stg_amplitude.event e 
WHERE event_type = 'profile_updated'
  ) ;

08:37:45.458754 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.13 seconds
08:37:45.466538 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
08:37:45.467141 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile" rename to "amplitude_profile__dbt_backup"
08:37:45.565282 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
08:37:45.572148 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
08:37:45.572740 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
alter table "dev"."dbt_amplitude_test"."amplitude_profile__dbt_tmp" rename to "amplitude_profile"
08:37:45.671973 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
08:37:45.676823 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
08:37:45.677515 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
08:37:45.677963 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
08:37:46.024802 [debug] [Thread-1  ]: SQL status: COMMIT in 0.35 seconds
08:37:46.026896 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
08:37:46.027309 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
08:37:46.145787 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
08:37:46.151646 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
08:37:46.152226 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_profile"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_profile__dbt_backup" cascade
08:37:46.258340 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.11 seconds
08:37:46.260896 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
08:37:46.261117 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
08:37:46.261292 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: COMMIT
08:37:46.980762 [debug] [Thread-1  ]: SQL status: COMMIT in 0.72 seconds
08:37:46.983635 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_profile"
08:37:46.984045 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: BEGIN
08:37:47.098717 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
08:37:47.101509 [debug] [Thread-1  ]: finished collecting timing info
08:37:47.102047 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: ROLLBACK
08:37:47.199170 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_profile: Close
08:37:47.201710 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a565064d-cfa7-402a-9b57-d2d661d2d589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f6b040>]}
08:37:47.203104 [info ] [Thread-1  ]: 3 of 6 OK created view model dbt_amplitude_test.amplitude_profile .............. [[32mCREATE VIEW[0m in 2.82s]
08:37:47.204602 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_profile
08:37:47.210622 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_workouts
08:37:47.211315 [info ] [Thread-1  ]: 4 of 6 START view model dbt_amplitude_test.amplitude_workouts .................. [RUN]
08:37:47.212114 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_workouts"
08:37:47.212340 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_workouts
08:37:47.212573 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_workouts
08:37:47.229508 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_workouts"
08:37:47.231178 [debug] [Thread-1  ]: finished collecting timing info
08:37:47.231488 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_workouts
08:37:47.233897 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_workouts"
08:37:47.234412 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
08:37:47.234528 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
08:37:47.234628 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:37:47.234739 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
08:37:48.215597 [debug] [Thread-1  ]: SQL status: BEGIN in 0.98 seconds
08:37:48.216157 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
08:37:48.216341 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */


  create view "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" as (
    WITH workouts AS (
    SELECT
        client_event_time
        , device_id
        , id
        , server_upload_time
        , amplitude_id
        , event_type_id
        , user_id
        , project_name
        , amplitude_event_type
        , library
        , start_version
        , location_lng
        , location_lat
        , city
        , uuid
        , is_attribution_event
        , idfa
        , paying
        , ip_address
        , language
        , app
        , country
        , region
        , session_id
        , version_name
        , sample_rate
        , ad_id
        , os_version
        , event_type
        , dma
        , schema
        , client_upload_time
        , server_received_time
        , processed_time
        , event_time
        , user_creation_time
        , data
        , groups
        , _insert_id
        , group_properties
        , event_properties
        , user_properties
        , _fivetran_synced
        , 
    (nullif(json_extract_path_text(user_properties,'membership_status',true),null))
 
        AS membership_status
        , 
    (nullif(json_extract_path_text(user_properties,'onboardingVersion',true),null))
 
        AS onboarding_version
        , 
    (nullif(json_extract_path_text(event_properties,'classLength',true),null))
::FLOAT 
        AS class_length
        , 
    (nullif(json_extract_path_text(event_properties,'multiplayerMode',true),null))
 
        AS multiplayer_mode
        , 
    (nullif(json_extract_path_text(event_properties,'genre',true),null))
 
        AS genre
        , 
    (nullif(json_extract_path_text(event_properties,'isTutorial',true),null))

        AS is_tutorial
        , 
    (nullif(json_extract_path_text(event_properties,'studio',true),null))
 
        AS studio
        , CASE WHEN 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))
 = ''
            THEN 
    (nullif(json_extract_path_text(event_properties,'classDipslayName',true),null))

            ELSE 
    (nullif(json_extract_path_text(event_properties,'classDisplayName',true),null))

        END AS class_name
        , SPLIT_PART(
    (nullif(json_extract_path_text(event_properties,'classXRefId',true),null))
, '/StudioClass/', 2)
        AS class_id
        , 
    (nullif(json_extract_path_text(event_properties,'timeElapsed',true),null))
::FLOAT 
        AS elapsed_time
        , 
    (nullif(json_extract_path_text(event_properties,'quitReasonMultiplayerInvitation',true),null))

        AS class_quit_reason
    FROM "dev"."stg_amplitude"."event" 
    WHERE event_type IN ('class_start', 'class_end', 'class_quit','class_finish','class_start_collections','class_end_collections','class_restarted','class_replayed')
)

SELECT *
FROM workouts
  ) ;

08:37:48.361535 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.14 seconds
08:37:48.372501 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
08:37:48.373116 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts" rename to "amplitude_workouts__dbt_backup"
08:37:48.472853 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
08:37:48.477047 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
08:37:48.477485 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
alter table "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_tmp" rename to "amplitude_workouts"
08:37:48.578398 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
08:37:48.581847 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
08:37:48.582262 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
08:37:48.582612 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
08:37:49.035109 [debug] [Thread-1  ]: SQL status: COMMIT in 0.45 seconds
08:37:49.037181 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
08:37:49.037577 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
08:37:49.152711 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
08:37:49.159543 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
08:37:49.160102 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_workouts"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_workouts__dbt_backup" cascade
08:37:49.263638 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.1 seconds
08:37:49.266780 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
08:37:49.267174 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
08:37:49.267524 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: COMMIT
08:37:49.477862 [debug] [Thread-1  ]: SQL status: COMMIT in 0.21 seconds
08:37:49.479189 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_workouts"
08:37:49.479601 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: BEGIN
08:37:49.595925 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
08:37:49.602677 [debug] [Thread-1  ]: finished collecting timing info
08:37:49.603354 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: ROLLBACK
08:37:49.700297 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_workouts: Close
08:37:49.702932 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a565064d-cfa7-402a-9b57-d2d661d2d589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105034fd0>]}
08:37:49.704314 [info ] [Thread-1  ]: 4 of 6 OK created view model dbt_amplitude_test.amplitude_workouts ............. [[32mCREATE VIEW[0m in 2.49s]
08:37:49.705791 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_workouts
08:37:49.711434 [debug] [Thread-1  ]: Began running node model.amplitude_event.stg_amplitude_device
08:37:49.711965 [info ] [Thread-1  ]: 5 of 6 START view model dbt_amplitude_test.stg_amplitude_device ................ [RUN]
08:37:49.713046 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.stg_amplitude_device"
08:37:49.713418 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.stg_amplitude_device
08:37:49.713647 [debug] [Thread-1  ]: Compiling model.amplitude_event.stg_amplitude_device
08:37:49.723659 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.stg_amplitude_device"
08:37:49.728182 [debug] [Thread-1  ]: finished collecting timing info
08:37:49.730227 [debug] [Thread-1  ]: Began executing node model.amplitude_event.stg_amplitude_device
08:37:49.731883 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.stg_amplitude_device"
08:37:49.732535 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
08:37:49.732627 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
08:37:49.732693 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:37:49.732769 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
08:37:50.676830 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
08:37:50.678052 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
08:37:50.678455 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_tmp" as (
    SELECT DISTINCT
  user_id
  , session_id
  , 
    (nullif(json_extract_path_text(user_properties,'device_type',true),null))

  AS device_type
FROM "dev"."stg_amplitude"."event"
WHERE event_type = 'app_server_env'
  ) ;

08:37:50.782991 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
08:37:50.798178 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
08:37:50.798797 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."stg_amplitude_device" rename to "stg_amplitude_device__dbt_backup"
08:37:50.894605 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
08:37:50.900703 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
08:37:50.901144 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_tmp" rename to "stg_amplitude_device"
08:37:51.001808 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
08:37:51.004557 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
08:37:51.004765 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
08:37:51.004930 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
08:37:51.189426 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
08:37:51.190796 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
08:37:51.191194 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
08:37:51.311608 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
08:37:51.317403 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
08:37:51.317892 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.stg_amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."stg_amplitude_device__dbt_backup" cascade
08:37:51.439491 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.12 seconds
08:37:51.441474 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
08:37:51.441724 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
08:37:51.441915 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: COMMIT
08:37:52.057653 [debug] [Thread-1  ]: SQL status: COMMIT in 0.62 seconds
08:37:52.059620 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.stg_amplitude_device"
08:37:52.060041 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: BEGIN
08:37:52.174104 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
08:37:52.176695 [debug] [Thread-1  ]: finished collecting timing info
08:37:52.177203 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: ROLLBACK
08:37:52.275151 [debug] [Thread-1  ]: On model.amplitude_event.stg_amplitude_device: Close
08:37:52.277545 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a565064d-cfa7-402a-9b57-d2d661d2d589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f6b040>]}
08:37:52.278982 [info ] [Thread-1  ]: 5 of 6 OK created view model dbt_amplitude_test.stg_amplitude_device ........... [[32mCREATE VIEW[0m in 2.56s]
08:37:52.280265 [debug] [Thread-1  ]: Finished running node model.amplitude_event.stg_amplitude_device
08:37:52.285939 [debug] [Thread-1  ]: Began running node model.amplitude_event.amplitude_device
08:37:52.286582 [info ] [Thread-1  ]: 6 of 6 START view model dbt_amplitude_test.amplitude_device .................... [RUN]
08:37:52.287284 [debug] [Thread-1  ]: Acquiring new redshift connection "model.amplitude_event.amplitude_device"
08:37:52.287500 [debug] [Thread-1  ]: Began compiling node model.amplitude_event.amplitude_device
08:37:52.287726 [debug] [Thread-1  ]: Compiling model.amplitude_event.amplitude_device
08:37:52.295170 [debug] [Thread-1  ]: Writing injected SQL for node "model.amplitude_event.amplitude_device"
08:37:52.298259 [debug] [Thread-1  ]: finished collecting timing info
08:37:52.298883 [debug] [Thread-1  ]: Began executing node model.amplitude_event.amplitude_device
08:37:52.302979 [debug] [Thread-1  ]: Writing runtime SQL for node "model.amplitude_event.amplitude_device"
08:37:52.303973 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
08:37:52.304161 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
08:37:52.304331 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
08:37:52.304519 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
08:37:53.647557 [debug] [Thread-1  ]: SQL status: BEGIN in 1.34 seconds
08:37:53.650343 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
08:37:53.650788 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */


  create view "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" as (
    WITH device AS (
  SELECT DISTINCT
    user_id
    , device_type
  FROM "dev"."dbt_amplitude_test"."stg_amplitude_device"
  WHERE device_type IS NOT NULL
)

SELECT
  user_id
  , device_type
  , COUNT(user_id) OVER (PARTITION BY user_id) AS num_devices
FROM device
  ) ;

08:37:53.753867 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.1 seconds
08:37:53.763300 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
08:37:53.764124 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
alter table "dev"."dbt_amplitude_test"."amplitude_device__dbt_tmp" rename to "amplitude_device"
08:37:53.862286 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
08:37:53.866011 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
08:37:53.866438 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
08:37:53.866790 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
08:37:54.054554 [debug] [Thread-1  ]: SQL status: COMMIT in 0.19 seconds
08:37:54.056831 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
08:37:54.057228 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
08:37:54.174139 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
08:37:54.180897 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
08:37:54.181367 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: /* {"app": "dbt", "dbt_version": "1.1.1", "profile_name": "amplitude_event", "target_name": "test", "node_id": "model.amplitude_event.amplitude_device"} */
drop view if exists "dev"."dbt_amplitude_test"."amplitude_device__dbt_backup" cascade
08:37:54.297336 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.12 seconds
08:37:54.300546 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
08:37:54.300970 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
08:37:54.301325 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: COMMIT
08:37:54.969749 [debug] [Thread-1  ]: SQL status: COMMIT in 0.67 seconds
08:37:54.972385 [debug] [Thread-1  ]: Using redshift connection "model.amplitude_event.amplitude_device"
08:37:54.972837 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: BEGIN
08:37:55.084879 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
08:37:55.087426 [debug] [Thread-1  ]: finished collecting timing info
08:37:55.087925 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: ROLLBACK
08:37:55.185064 [debug] [Thread-1  ]: On model.amplitude_event.amplitude_device: Close
08:37:55.187679 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a565064d-cfa7-402a-9b57-d2d661d2d589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105085be0>]}
08:37:55.189084 [info ] [Thread-1  ]: 6 of 6 OK created view model dbt_amplitude_test.amplitude_device ............... [[32mCREATE VIEW[0m in 2.90s]
08:37:55.190537 [debug] [Thread-1  ]: Finished running node model.amplitude_event.amplitude_device
08:37:55.198623 [debug] [MainThread]: Acquiring new redshift connection "master"
08:37:55.199187 [debug] [MainThread]: Using redshift connection "master"
08:37:55.199367 [debug] [MainThread]: On master: BEGIN
08:37:55.199544 [debug] [MainThread]: Opening a new connection, currently in state closed
08:37:55.199768 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
08:37:56.175881 [debug] [MainThread]: SQL status: BEGIN in 0.98 seconds
08:37:56.177278 [debug] [MainThread]: On master: COMMIT
08:37:56.177669 [debug] [MainThread]: Using redshift connection "master"
08:37:56.178055 [debug] [MainThread]: On master: COMMIT
08:37:56.276589 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
08:37:56.277826 [debug] [MainThread]: On master: Close
08:37:56.280254 [info ] [MainThread]: 
08:37:56.281356 [info ] [MainThread]: Finished running 6 view models in 21.52s.
08:37:56.282031 [debug] [MainThread]: Connection 'master' was properly closed.
08:37:56.282914 [debug] [MainThread]: Connection 'model.amplitude_event.amplitude_device' was properly closed.
08:37:56.303443 [info ] [MainThread]: 
08:37:56.303805 [info ] [MainThread]: [32mCompleted successfully[0m
08:37:56.303994 [info ] [MainThread]: 
08:37:56.304135 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
08:37:56.304396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f004f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f007f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105249fa0>]}
